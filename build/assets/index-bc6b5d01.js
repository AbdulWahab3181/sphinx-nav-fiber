import{g as nt,a as st,s as pe,_ as Y,a9 as ao,r as g,b as rt,j as n,d as it,c as de,e as at,u as Lt,aM as co,b6 as Ve,b7 as ct,a7 as bt,b8 as lo,b9 as uo,a0 as po,f as V,F as v,h as F,D as Re,b0 as Wt,T as q,B as Ut,N as Be,a_ as ge,b1 as Yt,ba as fo,bb as ho,bc as mo,Z as N,bd as he,be as me,ap as xt,bf as $e,bg as Ie,bh as yt,bi as ee,bj as go,ar as bo,bk as wt,bl as jt,bm as vt,bn as Et,bo as xo,am as yo,W as wo,bp as jo,bq as vo,br as Eo,aS as Pt}from"./index-10ba6357.js";import{B as Po}from"./index-e1510dd9.js";import{p as Co,q as To,i as Oo,C as ue,I as Mo,B as Ce,c as lt,b as Gt,F as Ht,r as So}from"./react-toastify.esm-0311feb0.js";import{e as Ao,A as De}from"./index-9836f46b.js";import{T as Fe}from"./index-43fb0a19.js";import{c as Ct,d as Zt,a as ko}from"./index-e7c3d3b1.js";import{D as _o,P as No}from"./PlusIcon-6cb366e3.js";import{p as Kt,c as $o,g as Io,t as ot}from"./index-0f3979ce.js";import{u as zo}from"./Popover-9ed2c7f9.js";import{u as Ro}from"./index-e1fcdb12.js";import{L as Bo,m as Do,u as ne,b as Le,T as Xt,H as Fo,C as Vo}from"./constant-92e5673d.js";import{f as qt,P as Lo,L as Wo}from"./constants-c56d39c1.js";import{A as Tt}from"./AddContentIcon-c24bcd17.js";import"./useSlotProps-1ec3b865.js";import"./Popper-22c826b9.js";import"./index.esm-12fd3e0f.js";import"./InfoIcon-7e45a0a9.js";import"./generateCategoricalChart-7ff4e896.js";import"./NoFilterResultIcon-b024c34c.js";import"./index-e6b7dc22.js";import"./index-28559a3e.js";import"./CheckIcon-46f01c1b.js";function Uo(t){return nt("PrivateSwitchBase",t)}st("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Yo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],Go=t=>{const{classes:o,checked:s,disabled:e,edge:a}=t,c={root:["root",s&&"checked",e&&"disabled",a&&`edge${de(a)}`],input:["input"]};return at(c,Uo,o)},Ho=pe(Co)(({ownerState:t})=>Y({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Zo=pe("input",{shouldForwardProp:ao})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Ko=g.forwardRef(function(o,s){const{autoFocus:e,checked:a,checkedIcon:c,className:d,defaultChecked:i,disabled:l,disableFocusRipple:j=!1,edge:u=!1,icon:f,id:h,inputProps:x,inputRef:m,name:M,onBlur:T,onChange:y,onFocus:E,readOnly:_,required:A=!1,tabIndex:w,type:b,value:P}=o,k=rt(o,Yo),[R,S]=Ro({controlled:a,default:!!i,name:"SwitchBase",state:"checked"}),D=zo(),oe=G=>{E&&E(G),D&&D.onFocus&&D.onFocus(G)},I=G=>{T&&T(G),D&&D.onBlur&&D.onBlur(G)},Z=G=>{if(G.nativeEvent.defaultPrevented)return;const K=G.target.checked;S(K),y&&y(G,K)};let L=l;D&&typeof L>"u"&&(L=D.disabled);const Q=b==="checkbox"||b==="radio",J=Y({},o,{checked:R,disabled:L,disableFocusRipple:j,edge:u}),X=Go(J);return n.jsxs(Ho,Y({component:"span",className:it(X.root,d),centerRipple:!0,focusRipple:!j,disabled:L,tabIndex:null,role:void 0,onFocus:oe,onBlur:I,ownerState:J,ref:s},k,{children:[n.jsx(Zo,Y({autoFocus:e,checked:a,defaultChecked:i,className:X.input,disabled:L,id:Q?h:void 0,name:M,onChange:Z,readOnly:_,ref:m,required:A,ownerState:J,tabIndex:w,type:b},b==="checkbox"&&P===void 0?{}:{value:P},x)),R?c:f]}))}),Xo=Ko,qo=g.createContext(),Ot=qo;function Qo(t){return nt("MuiGrid",t)}const Jo=[0,1,2,3,4,5,6,7,8,9,10],en=["column-reverse","column","row-reverse","row"],tn=["nowrap","wrap-reverse","wrap"],Ee=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],on=st("MuiGrid",["root","container","item","zeroMinWidth",...Jo.map(t=>`spacing-xs-${t}`),...en.map(t=>`direction-xs-${t}`),...tn.map(t=>`wrap-xs-${t}`),...Ee.map(t=>`grid-xs-${t}`),...Ee.map(t=>`grid-sm-${t}`),...Ee.map(t=>`grid-md-${t}`),...Ee.map(t=>`grid-lg-${t}`),...Ee.map(t=>`grid-xl-${t}`)]),Pe=on,nn=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function be(t){const o=parseFloat(t);return`${o}${String(t).replace(String(o),"")||"px"}`}function sn({theme:t,ownerState:o}){let s;return t.breakpoints.keys.reduce((e,a)=>{let c={};if(o[a]&&(s=o[a]),!s)return e;if(s===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(s==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const d=Ve({values:o.columns,breakpoints:t.breakpoints.values}),i=typeof d=="object"?d[a]:d;if(i==null)return e;const l=`${Math.round(s/i*1e8)/1e6}%`;let j={};if(o.container&&o.item&&o.columnSpacing!==0){const u=t.spacing(o.columnSpacing);if(u!=="0px"){const f=`calc(${l} + ${be(u)})`;j={flexBasis:f,maxWidth:f}}}c=Y({flexBasis:l,flexGrow:0,maxWidth:l},j)}return t.breakpoints.values[a]===0?Object.assign(e,c):e[t.breakpoints.up(a)]=c,e},{})}function rn({theme:t,ownerState:o}){const s=Ve({values:o.direction,breakpoints:t.breakpoints.values});return ct({theme:t},s,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${Pe.item}`]={maxWidth:"none"}),a})}function Qt({breakpoints:t,values:o}){let s="";Object.keys(o).forEach(a=>{s===""&&o[a]!==0&&(s=a)});const e=Object.keys(t).sort((a,c)=>t[a]-t[c]);return e.slice(0,e.indexOf(s))}function an({theme:t,ownerState:o}){const{container:s,rowSpacing:e}=o;let a={};if(s&&e!==0){const c=Ve({values:e,breakpoints:t.breakpoints.values});let d;typeof c=="object"&&(d=Qt({breakpoints:t.breakpoints.values,values:c})),a=ct({theme:t},c,(i,l)=>{var j;const u=t.spacing(i);return u!=="0px"?{marginTop:`-${be(u)}`,[`& > .${Pe.item}`]:{paddingTop:be(u)}}:(j=d)!=null&&j.includes(l)?{}:{marginTop:0,[`& > .${Pe.item}`]:{paddingTop:0}}})}return a}function cn({theme:t,ownerState:o}){const{container:s,columnSpacing:e}=o;let a={};if(s&&e!==0){const c=Ve({values:e,breakpoints:t.breakpoints.values});let d;typeof c=="object"&&(d=Qt({breakpoints:t.breakpoints.values,values:c})),a=ct({theme:t},c,(i,l)=>{var j;const u=t.spacing(i);return u!=="0px"?{width:`calc(100% + ${be(u)})`,marginLeft:`-${be(u)}`,[`& > .${Pe.item}`]:{paddingLeft:be(u)}}:(j=d)!=null&&j.includes(l)?{}:{width:"100%",marginLeft:0,[`& > .${Pe.item}`]:{paddingLeft:0}}})}return a}function ln(t,o,s={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[s[`spacing-xs-${String(t)}`]];const e=[];return o.forEach(a=>{const c=t[a];Number(c)>0&&e.push(s[`spacing-${a}-${String(c)}`])}),e}const dn=pe("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t,{container:e,direction:a,item:c,spacing:d,wrap:i,zeroMinWidth:l,breakpoints:j}=s;let u=[];e&&(u=ln(d,j,o));const f=[];return j.forEach(h=>{const x=s[h];x&&f.push(o[`grid-${h}-${String(x)}`])}),[o.root,e&&o.container,c&&o.item,l&&o.zeroMinWidth,...u,a!=="row"&&o[`direction-xs-${String(a)}`],i!=="wrap"&&o[`wrap-xs-${String(i)}`],...f]}})(({ownerState:t})=>Y({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),rn,an,cn,sn);function un(t,o){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const s=[];return o.forEach(e=>{const a=t[e];if(Number(a)>0){const c=`spacing-${e}-${String(a)}`;s.push(c)}}),s}const pn=t=>{const{classes:o,container:s,direction:e,item:a,spacing:c,wrap:d,zeroMinWidth:i,breakpoints:l}=t;let j=[];s&&(j=un(c,l));const u=[];l.forEach(h=>{const x=t[h];x&&u.push(`grid-${h}-${String(x)}`)});const f={root:["root",s&&"container",a&&"item",i&&"zeroMinWidth",...j,e!=="row"&&`direction-xs-${String(e)}`,d!=="wrap"&&`wrap-xs-${String(d)}`,...u]};return at(f,Qo,o)},fn=g.forwardRef(function(o,s){const e=Lt({props:o,name:"MuiGrid"}),{breakpoints:a}=co(),c=Ao(e),{className:d,columns:i,columnSpacing:l,component:j="div",container:u=!1,direction:f="row",item:h=!1,rowSpacing:x,spacing:m=0,wrap:M="wrap",zeroMinWidth:T=!1}=c,y=rt(c,nn),E=x||m,_=l||m,A=g.useContext(Ot),w=u?i||12:A,b={},P=Y({},y);a.keys.forEach(S=>{y[S]!=null&&(b[S]=y[S],delete P[S])});const k=Y({},c,{columns:w,container:u,direction:f,item:h,rowSpacing:E,columnSpacing:_,wrap:M,zeroMinWidth:T,spacing:m},b,{breakpoints:a.keys}),R=pn(k);return n.jsx(Ot.Provider,{value:w,children:n.jsx(dn,Y({ownerState:k,className:it(R.root,d),as:j,ref:s},P))})}),ce=fn;function hn(t){return nt("MuiSwitch",t)}const mn=st("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),H=mn,gn=["className","color","edge","size","sx"],bn=t=>{const{classes:o,edge:s,size:e,color:a,checked:c,disabled:d}=t,i={root:["root",s&&`edge${de(s)}`,`size${de(e)}`],switchBase:["switchBase",`color${de(a)}`,c&&"checked",d&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},l=at(i,hn,o);return Y({},o,l)},xn=pe("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,s.edge&&o[`edge${de(s.edge)}`],o[`size${de(s.size)}`]]}})(({ownerState:t})=>Y({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${H.thumb}`]:{width:16,height:16},[`& .${H.switchBase}`]:{padding:4,[`&.${H.checked}`]:{transform:"translateX(16px)"}}})),yn=pe(Xo,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.switchBase,{[`& .${H.input}`]:o.input},s.color!=="default"&&o[`color${de(s.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${H.checked}`]:{transform:"translateX(20px)"},[`&.${H.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${H.checked} + .${H.track}`]:{opacity:.5},[`&.${H.disabled} + .${H.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${H.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:o})=>Y({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:bt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${H.checked}`]:{color:(t.vars||t).palette[o.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:bt(t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${H.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${o.color}DisabledColor`]:`${t.palette.mode==="light"?lo(t.palette[o.color].main,.62):uo(t.palette[o.color].main,.55)}`}},[`&.${H.checked} + .${H.track}`]:{backgroundColor:(t.vars||t).palette[o.color].main}})),wn=pe("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,o)=>o.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),jn=pe("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,o)=>o.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),vn=g.forwardRef(function(o,s){const e=Lt({props:o,name:"MuiSwitch"}),{className:a,color:c="primary",edge:d=!1,size:i="medium",sx:l}=e,j=rt(e,gn),u=Y({},e,{color:c,edge:d,size:i}),f=bn(u),h=n.jsx(jn,{className:f.thumb,ownerState:u});return n.jsxs(xn,{className:it(f.root,a),sx:l,ownerState:u,children:[n.jsx(yn,Y({type:"checkbox",icon:h,checkedIcon:h,ref:s,ownerState:u},j,{classes:Y({},f,{root:f.switchBase})})),n.jsx(wn,{className:f.track,ownerState:u})]})}),En=vn,Pn={schemas:[],links:[]},Jt=po(t=>({...Pn,setSchemas:o=>{t({schemas:o})},setSchemaLinks:o=>{t({links:o})}})),Cn=/^[a-z0-9_]+$/,Tn=({parentParam:t,onDelete:o})=>{const[s,e]=g.useState(!1),[a,c]=g.useState([]),{fields:d,append:i,replace:l,remove:j}=To({name:"attributes"}),{setValue:u,watch:f}=Oo();return g.useEffect(()=>{const h=async()=>{try{let x=[{required:!1,type:"string",key:""}];if(t!==Zt.value.toLowerCase()){e(!0);const m=await Wt(t);x=Kt(m)}x=x.filter(m=>m.key!=="node_key"),l(x),c(x)}catch(x){console.warn(x)}finally{e(!1)}};a.length===0&&h()},[t,u,l,a.length]),n.jsxs(n.Fragment,{children:[s?n.jsx(v,{align:"center",children:n.jsx(ue,{color:F.SECONDARY_BLUE,size:"30"})}):n.jsx(On,{py:8,children:n.jsx(ce,{container:!0,spacing:2,children:d.map((h,x)=>{const m=f(`attributes[${x}].type`),M=f(`attributes[${x}].required`),T=h.isNew||!1,y=["name"].includes(f(`attributes[${x}].key`));return n.jsxs(g.Fragment,{children:[n.jsx(ce,{item:!0,xs:5,children:n.jsx(Fe,{autoComplete:"off",className:"text-input",disabled:!T,id:"cy-item-name",maxLength:50,name:`attributes.${x}.key`,placeholder:"Enter value",rules:{...Re,pattern:{message:"Please avoid special characters, spaces and uppercase",value:Cn}}})}),n.jsx(ce,{item:!0,xs:4,children:n.jsx(De,{disabled:y,onSelect:E=>u(`attributes[${x}].type`,E==null?void 0:E.value),options:Ct,selectedValue:Ct.find(E=>E.value===m)})}),n.jsxs(ce,{item:!0,xs:3,children:[n.jsx(En,{checked:M,disabled:y,name:`attributes.${x}.required`,onChange:E=>u(`attributes[${x}].required`,E.target.checked),size:"small"}),!y&&n.jsx(Mo,{onClick:()=>{j(x),h.key!==void 0&&o&&o(h.key)},children:n.jsx(_o,{})})]})]},h.id)})})}),n.jsx(v,{align:"flex-start",py:12,children:n.jsx(Ce,{onClick:()=>i({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:n.jsx(No,{}),variant:"contained",children:"Add Attribute"})})]})},On=V(v)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,Mn=({parent:t,onDelete:o})=>{const s=t;return n.jsxs(v,{children:[n.jsx(v,{direction:"row",mb:10,children:n.jsxs(ce,{container:!0,spacing:2,children:[n.jsx(ce,{item:!0,xs:5,children:n.jsx(Je,{style:{marginRight:180},children:"Attributes"})}),n.jsx(ce,{item:!0,xs:4,children:n.jsx(Je,{style:{marginRight:130},children:"Type"})}),n.jsx(ce,{item:!0,xs:3,children:n.jsx(Je,{children:"Required"})})]})}),s&&n.jsx(Tn,{onDelete:o,parentParam:s},s)]})},Je=V(q)`
  font-size: 15px;
  color: gray;
`,Sn={type:"",parent:""},An=(t,o)=>t.length!==o.length?!0:t.some((s,e)=>{const a=o[e];return s.required!==a.required||s.type!==a.type||s.key!==a.key}),kn=async(t,o=!1,s)=>{try{const{attributes:e,...a}=t,c={...a,attributes:$o(e),...s.reduce((i,l)=>({...i,[l]:"delete"}),{})};let d;if(o?d=await Be.put("/schema",JSON.stringify(c),{}):d=await Be.post("/schema",JSON.stringify({...c,node_key:"name"}),{}),d.status!=="success")throw new Error("error");return d==null?void 0:d.ref_id}catch(e){let a=ge;if(e.status===400){const c=await e.json();a=c.errorCode||(c==null?void 0:c.status)||ge}else e instanceof Error&&(a=e.message);throw new Error(a)}},_n=t=>t.charAt(0).toUpperCase()+t.slice(1),Mt=async(t,o)=>{try{const c=((await Yt()).schemas||[]).filter(d=>!d.is_deleted&&d.type&&(!o||o(d))).map(d=>d.type==="thing"?{label:"No Parent",value:d.type}:{label:_n(d.type),value:d.type});t(c)}catch(s){console.warn(s)}},Nn=({graphLoading:t,onSchemaCreate:o,selectedSchema:s,onDelete:e,setSelectedSchemaId:a,setGraphLoading:c,setIsCreateNew:d,onSchemaUpdate:i})=>{var ke,we;const{close:l,visible:j}=Ut("addType"),u=lt({mode:"onChange",defaultValues:s?{type:s.type,parent:s.parent}:Sn}),{watch:f,setValue:h,reset:x,getValues:m}=u,[M,T]=g.useState(!1),[y,E]=g.useState(!1),[_,A]=g.useState(!1),[w,b]=g.useState(null),[P,k]=g.useState(!1),[R,S]=g.useState(null),[D,oe]=g.useState(""),[I,Z]=g.useState(null),[L,Q]=g.useState([]),[J,X]=g.useState([]);g.useEffect(()=>()=>{x()},[j,x]);const G=()=>{d(!1),a("")};g.useEffect(()=>{s||(A(!0),Mt(b).finally(()=>A(!1)))},[s]),g.useEffect(()=>{(async()=>{if(s){h("type",s==null?void 0:s.type),h("parent",s.parent);let B=[{required:!1,type:"string",key:""}];if(s.type!==Zt.value.toLowerCase()){const W=await Wt(s.type);B=Kt(W)}B=B.filter(W=>W.key!=="node_key"),X(B),Mt(S,W=>W.type!==s.type&&W.type!==s.parent)}})()},[s,h]);const K=f("parent"),le=f("type"),xe=$=>Array.isArray($)&&$.every(B=>typeof B=="object"&&"key"in B),ye=f("attributes"),We=xe(ye)?ye:[],Te=()=>{l()},Ue=$=>{Q(B=>[...B,$])},Ye=async()=>{if(s!=null&&s.type){E(!0),c(!0);try{await Be.delete(`/schema/${s.ref_id}`),e(s.type),l()}catch($){let B=ge;if(($==null?void 0:$.status)===400){const W=await $.json();B=W.errorCode||(W==null?void 0:W.status)||ge}else $ instanceof Error&&(B=$.message);Z(B)}finally{E(!1),c(!1),d(!1)}}},Oe=u.handleSubmit(async $=>{if(!K){k(!0);return}T(!0);try{if(s&&$.type!==(s==null?void 0:s.type)||s&&m().parent!==(s==null?void 0:s.parent)){const W=m().parent??(s==null?void 0:s.parent);c(!0),await Be.put(`/schema/${s==null?void 0:s.ref_id}`,JSON.stringify({type:$.type,parent:W})),await i()}const B=await kn({...$,...s?{ref_id:s==null?void 0:s.ref_id}:{}},!!s,L);o({type:$.type,parent:K||"",ref_id:(s==null?void 0:s.ref_id)||B||"new"}),Te()}catch(B){let W=ge;if((B==null?void 0:B.status)===400){const fe=await B.json();W=fe.errorCode||(fe==null?void 0:fe.status)||ge}else B instanceof Error&&(W=B.message);oe(W)}finally{T(!1),c(!1),d(!1)}}),Ge=An(We,J),He=(le==null?void 0:le.trim())!==((ke=s==null?void 0:s.type)==null?void 0:ke.trim())||K!==((we=s==null?void 0:s.parent)==null?void 0:we.trim())||Ge,Me=!!le.trim(),Se=s?M||!He||!Me||P:M||P,Ae=()=>w==null?void 0:w.find($=>$.value===K),Ze=()=>R==null?void 0:R.find($=>$.value===K);return n.jsxs(v,{children:[n.jsx(v,{direction:"row",justify:"flex-end",children:n.jsx(zn,{"data-testid":"close-sidebar-sub-view",onClick:G,children:n.jsx(Gt,{})})}),n.jsx(v,{children:n.jsx(Ht,{...u,children:n.jsxs("form",{id:"add-type-form",onSubmit:Oe,children:[n.jsx(v,{children:s?n.jsxs(n.Fragment,{children:[n.jsxs(v,{mb:12,children:[n.jsx(v,{mb:12,children:n.jsx(q,{children:"Name"})}),n.jsx(v,{mb:12,children:n.jsx(Fe,{defaultValue:s==null?void 0:s.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Re},value:K})})]}),n.jsxs(v,{mb:12,children:[n.jsx(v,{mb:12,children:n.jsx(q,{children:"Parent"})}),n.jsx(De,{isLoading:_||t,onSelect:$=>{h("parent",($==null?void 0:$.value)||""),k(!1)},options:R||[],selectedValue:Ze()}),D&&n.jsx(et,{children:D})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs(v,{mb:12,children:[n.jsx(v,{mb:12,children:n.jsx(q,{children:"Select Parent"})}),n.jsx(De,{isLoading:_,onSelect:$=>{h("parent",($==null?void 0:$.value)||""),k(!1)},options:w,selectedValue:Ae()}),P&&n.jsx(et,{children:"A parent type must be selected"})]}),n.jsxs(v,{children:[n.jsx(v,{mb:12,children:n.jsx(q,{children:"Type name"})}),n.jsx(v,{mb:12,children:n.jsx(Fe,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Re},value:K})})]})]})}),n.jsx(Mn,{onDelete:Ue,parent:s?s.type:K}),n.jsxs(v,{direction:"row",justify:"space-between",mt:20,children:[s&&n.jsxs(v,{direction:"column",children:[n.jsxs(In,{color:"secondary",disabled:y,onClick:Ye,size:"large",style:{marginRight:20},variant:"contained",children:["Delete",y&&n.jsxs(St,{children:[n.jsx(ue,{color:F.lightGray,size:12})," "]})]}),I&&n.jsx(et,{children:I})]}),n.jsxs($n,{color:"secondary",disabled:Se,onClick:Oe,size:"large",variant:"contained",children:["Confirm",M&&n.jsxs(St,{children:[n.jsx(ue,{color:F.lightGray,size:12})," "]})]})]})]})})})]})},$n=V(Ce)`
  width: 100% !important;
  margin: 0 auto !important;
`,St=V.span`
  margin-top: 2px;
`,In=V(Ce)`
  && {
    color: ${F.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${F.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,zn=V(v)`
  font-size: 32px;
  color: ${F.white};
  cursor: pointer;
`,et=V(v)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var Rn=Object.defineProperty,Bn=(t,o,s)=>o in t?Rn(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,C=(t,o,s)=>(Bn(t,typeof o!="symbol"?o+"":o,s),s);const ze=new fo,At=new ho,Dn=Math.cos(70*(Math.PI/180)),kt=(t,o)=>(t%o+o)%o;let Fn=class extends mo{constructor(o,s){super(),C(this,"object"),C(this,"domElement"),C(this,"enabled",!0),C(this,"target",new N),C(this,"minDistance",0),C(this,"maxDistance",1/0),C(this,"minZoom",0),C(this,"maxZoom",1/0),C(this,"minPolarAngle",0),C(this,"maxPolarAngle",Math.PI),C(this,"minAzimuthAngle",-1/0),C(this,"maxAzimuthAngle",1/0),C(this,"enableDamping",!1),C(this,"dampingFactor",.05),C(this,"enableZoom",!0),C(this,"zoomSpeed",1),C(this,"enableRotate",!0),C(this,"rotateSpeed",1),C(this,"enablePan",!0),C(this,"panSpeed",1),C(this,"screenSpacePanning",!0),C(this,"keyPanSpeed",7),C(this,"zoomToCursor",!1),C(this,"autoRotate",!1),C(this,"autoRotateSpeed",2),C(this,"reverseOrbit",!1),C(this,"reverseHorizontalOrbit",!1),C(this,"reverseVerticalOrbit",!1),C(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),C(this,"mouseButtons",{LEFT:he.ROTATE,MIDDLE:he.DOLLY,RIGHT:he.PAN}),C(this,"touches",{ONE:me.ROTATE,TWO:me.DOLLY_PAN}),C(this,"target0"),C(this,"position0"),C(this,"zoom0"),C(this,"_domElementKeyEvents",null),C(this,"getPolarAngle"),C(this,"getAzimuthalAngle"),C(this,"setPolarAngle"),C(this,"setAzimuthalAngle"),C(this,"getDistance"),C(this,"listenToKeyEvents"),C(this,"stopListenToKeyEvents"),C(this,"saveState"),C(this,"reset"),C(this,"update"),C(this,"connect"),C(this,"dispose"),this.object=o,this.domElement=s,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=r=>{let p=kt(r,2*Math.PI),O=u.phi;O<0&&(O+=2*Math.PI),p<0&&(p+=2*Math.PI);let z=Math.abs(p-O);2*Math.PI-z<z&&(p<O?p+=2*Math.PI:O+=2*Math.PI),f.phi=p-O,e.update()},this.setAzimuthalAngle=r=>{let p=kt(r,2*Math.PI),O=u.theta;O<0&&(O+=2*Math.PI),p<0&&(p+=2*Math.PI);let z=Math.abs(p-O);2*Math.PI-z<z&&(p<O?p+=2*Math.PI:O+=2*Math.PI),f.theta=p-O,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=r=>{r.addEventListener("keydown",qe),this._domElementKeyEvents=r},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",qe),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),l=i.NONE},this.update=(()=>{const r=new N,p=new N(0,1,0),O=new xt().setFromUnitVectors(o.up,p),z=O.clone().invert(),U=new N,se=new xt,ae=2*Math.PI;return function(){const gt=e.object.position;O.setFromUnitVectors(o.up,p),z.copy(O).invert(),r.copy(gt).sub(e.target),r.applyQuaternion(O),u.setFromVector3(r),e.autoRotate&&l===i.NONE&&Z(oe()),e.enableDamping?(u.theta+=f.theta*e.dampingFactor,u.phi+=f.phi*e.dampingFactor):(u.theta+=f.theta,u.phi+=f.phi);let re=e.minAzimuthAngle,ie=e.maxAzimuthAngle;isFinite(re)&&isFinite(ie)&&(re<-Math.PI?re+=ae:re>Math.PI&&(re-=ae),ie<-Math.PI?ie+=ae:ie>Math.PI&&(ie-=ae),re<=ie?u.theta=Math.max(re,Math.min(ie,u.theta)):u.theta=u.theta>(re+ie)/2?Math.max(re,u.theta):Math.min(ie,u.theta)),u.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,u.phi)),u.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(x,e.dampingFactor):e.target.add(x),e.zoomToCursor&&R||e.object.isOrthographicCamera?u.radius=xe(u.radius):u.radius=xe(u.radius*h),r.setFromSpherical(u),r.applyQuaternion(z),gt.copy(e.target).add(r),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,x.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),x.set(0,0,0));let _e=!1;if(e.zoomToCursor&&R){let je=null;if(e.object instanceof $e&&e.object.isPerspectiveCamera){const ve=r.length();je=xe(ve*h);const Ne=ve-je;e.object.position.addScaledVector(P,Ne),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const ve=new N(k.x,k.y,0);ve.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),_e=!0;const Ne=new N(k.x,k.y,0);Ne.unproject(e.object),e.object.position.sub(Ne).add(ve),e.object.updateMatrixWorld(),je=r.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;je!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(je).add(e.object.position):(ze.origin.copy(e.object.position),ze.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(ze.direction))<Dn?o.lookAt(e.target):(At.setFromNormalAndCoplanarPoint(e.object.up,e.target),ze.intersectPlane(At,e.target))))}else e.object instanceof Ie&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),_e=!0);return h=1,R=!1,_e||U.distanceToSquared(e.object.position)>j||8*(1-se.dot(e.object.quaternion))>j?(e.dispatchEvent(a),U.copy(e.object.position),se.copy(e.object.quaternion),_e=!1,!0):!1}})(),this.connect=r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=r,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",ft),e.domElement.addEventListener("pointerdown",dt),e.domElement.addEventListener("pointercancel",ut),e.domElement.addEventListener("wheel",pt)},this.dispose=()=>{var r,p,O,z,U,se;(r=e.domElement)==null||r.removeEventListener("contextmenu",ft),(p=e.domElement)==null||p.removeEventListener("pointerdown",dt),(O=e.domElement)==null||O.removeEventListener("pointercancel",ut),(z=e.domElement)==null||z.removeEventListener("wheel",pt),(U=e.domElement)==null||U.ownerDocument.removeEventListener("pointermove",Ke),(se=e.domElement)==null||se.ownerDocument.removeEventListener("pointerup",Xe),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",qe)};const e=this,a={type:"change"},c={type:"start"},d={type:"end"},i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=i.NONE;const j=1e-6,u=new yt,f=new yt;let h=1;const x=new N,m=new ee,M=new ee,T=new ee,y=new ee,E=new ee,_=new ee,A=new ee,w=new ee,b=new ee,P=new N,k=new ee;let R=!1;const S=[],D={};function oe(){return 2*Math.PI/60/60*e.autoRotateSpeed}function I(){return Math.pow(.95,e.zoomSpeed)}function Z(r){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=r:f.theta-=r}function L(r){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=r:f.phi-=r}const Q=(()=>{const r=new N;return function(O,z){r.setFromMatrixColumn(z,0),r.multiplyScalar(-O),x.add(r)}})(),J=(()=>{const r=new N;return function(O,z){e.screenSpacePanning===!0?r.setFromMatrixColumn(z,1):(r.setFromMatrixColumn(z,0),r.crossVectors(e.object.up,r)),r.multiplyScalar(O),x.add(r)}})(),X=(()=>{const r=new N;return function(O,z){const U=e.domElement;if(U&&e.object instanceof $e&&e.object.isPerspectiveCamera){const se=e.object.position;r.copy(se).sub(e.target);let ae=r.length();ae*=Math.tan(e.object.fov/2*Math.PI/180),Q(2*O*ae/U.clientHeight,e.object.matrix),J(2*z*ae/U.clientHeight,e.object.matrix)}else U&&e.object instanceof Ie&&e.object.isOrthographicCamera?(Q(O*(e.object.right-e.object.left)/e.object.zoom/U.clientWidth,e.object.matrix),J(z*(e.object.top-e.object.bottom)/e.object.zoom/U.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function G(r){e.object instanceof $e&&e.object.isPerspectiveCamera||e.object instanceof Ie&&e.object.isOrthographicCamera?h/=r:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function K(r){e.object instanceof $e&&e.object.isPerspectiveCamera||e.object instanceof Ie&&e.object.isOrthographicCamera?h*=r:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function le(r){if(!e.zoomToCursor||!e.domElement)return;R=!0;const p=e.domElement.getBoundingClientRect(),O=r.clientX-p.left,z=r.clientY-p.top,U=p.width,se=p.height;k.x=O/U*2-1,k.y=-(z/se)*2+1,P.set(k.x,k.y,1).unproject(e.object).sub(e.object.position).normalize()}function xe(r){return Math.max(e.minDistance,Math.min(e.maxDistance,r))}function ye(r){m.set(r.clientX,r.clientY)}function We(r){le(r),A.set(r.clientX,r.clientY)}function Te(r){y.set(r.clientX,r.clientY)}function Ue(r){M.set(r.clientX,r.clientY),T.subVectors(M,m).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(Z(2*Math.PI*T.x/p.clientHeight),L(2*Math.PI*T.y/p.clientHeight)),m.copy(M),e.update()}function Ye(r){w.set(r.clientX,r.clientY),b.subVectors(w,A),b.y>0?G(I()):b.y<0&&K(I()),A.copy(w),e.update()}function Oe(r){E.set(r.clientX,r.clientY),_.subVectors(E,y).multiplyScalar(e.panSpeed),X(_.x,_.y),y.copy(E),e.update()}function Ge(r){le(r),r.deltaY<0?K(I()):r.deltaY>0&&G(I()),e.update()}function He(r){let p=!1;switch(r.code){case e.keys.UP:X(0,e.keyPanSpeed),p=!0;break;case e.keys.BOTTOM:X(0,-e.keyPanSpeed),p=!0;break;case e.keys.LEFT:X(e.keyPanSpeed,0),p=!0;break;case e.keys.RIGHT:X(-e.keyPanSpeed,0),p=!0;break}p&&(r.preventDefault(),e.update())}function Me(){if(S.length==1)m.set(S[0].pageX,S[0].pageY);else{const r=.5*(S[0].pageX+S[1].pageX),p=.5*(S[0].pageY+S[1].pageY);m.set(r,p)}}function Se(){if(S.length==1)y.set(S[0].pageX,S[0].pageY);else{const r=.5*(S[0].pageX+S[1].pageX),p=.5*(S[0].pageY+S[1].pageY);y.set(r,p)}}function Ae(){const r=S[0].pageX-S[1].pageX,p=S[0].pageY-S[1].pageY,O=Math.sqrt(r*r+p*p);A.set(0,O)}function Ze(){e.enableZoom&&Ae(),e.enablePan&&Se()}function ke(){e.enableZoom&&Ae(),e.enableRotate&&Me()}function we(r){if(S.length==1)M.set(r.pageX,r.pageY);else{const O=Qe(r),z=.5*(r.pageX+O.x),U=.5*(r.pageY+O.y);M.set(z,U)}T.subVectors(M,m).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(Z(2*Math.PI*T.x/p.clientHeight),L(2*Math.PI*T.y/p.clientHeight)),m.copy(M)}function $(r){if(S.length==1)E.set(r.pageX,r.pageY);else{const p=Qe(r),O=.5*(r.pageX+p.x),z=.5*(r.pageY+p.y);E.set(O,z)}_.subVectors(E,y).multiplyScalar(e.panSpeed),X(_.x,_.y),y.copy(E)}function B(r){const p=Qe(r),O=r.pageX-p.x,z=r.pageY-p.y,U=Math.sqrt(O*O+z*z);w.set(0,U),b.set(0,Math.pow(w.y/A.y,e.zoomSpeed)),G(b.y),A.copy(w)}function W(r){e.enableZoom&&B(r),e.enablePan&&$(r)}function fe(r){e.enableZoom&&B(r),e.enableRotate&&we(r)}function dt(r){var p,O;e.enabled!==!1&&(S.length===0&&((p=e.domElement)==null||p.ownerDocument.addEventListener("pointermove",Ke),(O=e.domElement)==null||O.ownerDocument.addEventListener("pointerup",Xe)),io(r),r.pointerType==="touch"?so(r):oo(r))}function Ke(r){e.enabled!==!1&&(r.pointerType==="touch"?ro(r):no(r))}function Xe(r){var p,O,z;ht(r),S.length===0&&((p=e.domElement)==null||p.releasePointerCapture(r.pointerId),(O=e.domElement)==null||O.ownerDocument.removeEventListener("pointermove",Ke),(z=e.domElement)==null||z.ownerDocument.removeEventListener("pointerup",Xe)),e.dispatchEvent(d),l=i.NONE}function ut(r){ht(r)}function oo(r){let p;switch(r.button){case 0:p=e.mouseButtons.LEFT;break;case 1:p=e.mouseButtons.MIDDLE;break;case 2:p=e.mouseButtons.RIGHT;break;default:p=-1}switch(p){case he.DOLLY:if(e.enableZoom===!1)return;We(r),l=i.DOLLY;break;case he.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(e.enablePan===!1)return;Te(r),l=i.PAN}else{if(e.enableRotate===!1)return;ye(r),l=i.ROTATE}break;case he.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(e.enableRotate===!1)return;ye(r),l=i.ROTATE}else{if(e.enablePan===!1)return;Te(r),l=i.PAN}break;default:l=i.NONE}l!==i.NONE&&e.dispatchEvent(c)}function no(r){if(e.enabled!==!1)switch(l){case i.ROTATE:if(e.enableRotate===!1)return;Ue(r);break;case i.DOLLY:if(e.enableZoom===!1)return;Ye(r);break;case i.PAN:if(e.enablePan===!1)return;Oe(r);break}}function pt(r){e.enabled===!1||e.enableZoom===!1||l!==i.NONE&&l!==i.ROTATE||(r.preventDefault(),e.dispatchEvent(c),Ge(r),e.dispatchEvent(d))}function qe(r){e.enabled===!1||e.enablePan===!1||He(r)}function so(r){switch(mt(r),S.length){case 1:switch(e.touches.ONE){case me.ROTATE:if(e.enableRotate===!1)return;Me(),l=i.TOUCH_ROTATE;break;case me.PAN:if(e.enablePan===!1)return;Se(),l=i.TOUCH_PAN;break;default:l=i.NONE}break;case 2:switch(e.touches.TWO){case me.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ze(),l=i.TOUCH_DOLLY_PAN;break;case me.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;ke(),l=i.TOUCH_DOLLY_ROTATE;break;default:l=i.NONE}break;default:l=i.NONE}l!==i.NONE&&e.dispatchEvent(c)}function ro(r){switch(mt(r),l){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;we(r),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;$(r),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;W(r),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;fe(r),e.update();break;default:l=i.NONE}}function ft(r){e.enabled!==!1&&r.preventDefault()}function io(r){S.push(r)}function ht(r){delete D[r.pointerId];for(let p=0;p<S.length;p++)if(S[p].pointerId==r.pointerId){S.splice(p,1);return}}function mt(r){let p=D[r.pointerId];p===void 0&&(p=new ee,D[r.pointerId]=p),p.set(r.pageX,r.pageY)}function Qe(r){const p=r.pointerId===S[0].pointerId?S[1]:S[0];return D[p.pointerId]}s!==void 0&&this.connect(s),this.update()}};const Vn=new N,_t=g.forwardRef(function({start:o=[0,0,0],end:s=[0,0,0],mid:e,segments:a=20,...c},d){const i=g.useRef(null),[l]=g.useState(()=>new go(void 0,void 0,void 0)),j=g.useCallback((f,h,x,m=20)=>(f instanceof N?l.v0.copy(f):l.v0.set(...f),h instanceof N?l.v2.copy(h):l.v2.set(...h),x instanceof N?l.v1.copy(x):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(Vn.set(0,l.v0.y-l.v2.y,0))),l.getPoints(m)),[]);g.useLayoutEffect(()=>{i.current.setPoints=(f,h,x)=>{const m=j(f,h,x);i.current.geometry&&i.current.geometry.setPositions(m.map(M=>M.toArray()).flat())}},[]);const u=g.useMemo(()=>j(o,s,e,a),[o,s,e,a]);return g.createElement(Bo,Y({ref:Do([i,d]),points:u},c))}),Ln=g.forwardRef(({makeDefault:t,camera:o,regress:s,domElement:e,enableDamping:a=!0,onChange:c,onStart:d,onEnd:i,...l},j)=>{const u=ne(w=>w.invalidate),f=ne(w=>w.camera),h=ne(w=>w.gl),x=ne(w=>w.events),m=ne(w=>w.setEvents),M=ne(w=>w.set),T=ne(w=>w.get),y=ne(w=>w.performance),E=o||f,_=e||x.connected||h.domElement,A=g.useMemo(()=>new Fn(E),[E]);return Le(()=>{A.enabled&&A.update()},-1),g.useEffect(()=>(A.connect(_),()=>void A.dispose()),[_,s,A,u]),g.useEffect(()=>{const w=k=>{u(),s&&y.regress(),c&&c(k)},b=k=>{d&&d(k)},P=k=>{i&&i(k)};return A.addEventListener("change",w),A.addEventListener("start",b),A.addEventListener("end",P),()=>{A.removeEventListener("start",b),A.removeEventListener("end",P),A.removeEventListener("change",w)}},[c,d,i,A,u,m]),g.useEffect(()=>{if(t){const w=T().controls;return M({controls:A}),()=>M({controls:w})}},[t,A]),g.createElement("primitive",Y({ref:j,object:A,enableDamping:a},l))});function Wn(t){const o=t+"Geometry";return g.forwardRef(({args:s,children:e,...a},c)=>g.createElement("mesh",Y({ref:c},a),g.createElement(o,{attach:"geometry",args:s}),e))}const Un=Wn("circle"),Nt=t=>{const o=g.useRef();return g.useEffect(()=>{o.current=t}),o.current},te=10,Yn=2,Gn=2,$t=10,Hn=10,It=(t,o,s)=>{const c=new N().subVectors(o,t).normalize().multiplyScalar(s);return new N().addVectors(t,c)},Zn=(t,o,s,e)=>{const a=new N().lerpVectors(t,o,.5),c=new N().subVectors(o,t).normalize(),d=new N(-c.y,c.x,c.z).normalize(),i=(s-e/2)*Hn;return new N().addVectors(a,d.multiplyScalar(i))},eo=({links:t,nodes:o,onEdgeClick:s})=>{const e=g.useRef(null),{camera:a}=ne(),c=new N,d=new N,i=new N,l=new N,j=new N,u=new N,f=new N,h=new N;Le(()=>{e.current&&o&&e.current.children.forEach((m,M)=>{var R,S,D,oe;const T=t[M];if(!T)return;const y=o.find(I=>I.ref_id===T.source),E=o.find(I=>I.ref_id===T.target);c.set((E==null?void 0:E.x)||0,(E==null?void 0:E.y)||0,(E==null?void 0:E.z)||0),d.set((y==null?void 0:y.x)||0,(y==null?void 0:y.y)||0,(y==null?void 0:y.z)||0);const _=m.children[0],A=m.children[1],w=m.children[2],b=m.children[3],P=t.filter(I=>I.source===T.source&&I.target===T.target||I.source===T.target&&I.target===T.source).length,k=t.filter((I,Z)=>Z<M&&(I.source===T.source&&I.target===T.target||I.source===T.target&&I.target===T.source)).length;if((E==null?void 0:E.ref_id)===(y==null?void 0:y.ref_id)){const[I,Z,L]=Io(c);(R=_.setPoints)==null||R.call(_,c,L,I),(S=A.setPoints)==null||S.call(A,L,d,I),w.position.set(L.x,L.y,Z.z),w.lookAt(I),w.rotateX(-Math.PI/2),b.position.set(L.x,L.y,Z.z),b.lookAt(a.position)}else{h.copy(It(c,d,te)),f.copy(It(d,c,te+.5)),i.lerpVectors(h,f,.5),P>1?i.copy(Zn(h,f,k,P)):i.lerpVectors(h,f,.5);const I=30;l.subVectors(f,h).normalize().multiplyScalar(I/2),j.subVectors(i,l),u.addVectors(i,l);const Z=new N().addVectors(h,j).multiplyScalar(.5),L=new N().addVectors(u,f).multiplyScalar(.5);(D=_.setPoints)==null||D.call(_,h,j,Z),(oe=A.setPoints)==null||oe.call(A,u,f,L),w.position.set(f.x,f.y,f.z),w.lookAt(h),w.rotateX(-Math.PI/2),b.position.set(i.x,i.y,i.z),b.lookAt(a.position);let Q=Math.atan2(f.y-h.y,f.x-h.x);(Q>Math.PI/2||Q<-Math.PI/2)&&(Q+=Math.PI),b.rotation.set(0,0,Q);const J=h.distanceTo(f),X=J<I?2:4;J<I?b.text=ot(T.edge_type,$t):b.text=T.edge_type,b.fontSize=X}})});const x=(m,M,T,y)=>{if(m==="CHILD_OF"||M==="string"||T==="string")return;const E=o==null?void 0:o.find(b=>b.ref_id===M),_=o==null?void 0:o.find(b=>b.ref_id===T),A=(E==null?void 0:E.type)||"",w=(_==null?void 0:_.type)||"";s(y,m,A,w)};return n.jsx("group",{ref:e,children:t.map(m=>n.jsxs("group",{children:[n.jsx(_t,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),n.jsx(_t,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),n.jsxs("mesh",{position:new N(0,0,0),children:[n.jsx("coneGeometry",{args:[Yn,Gn,32]}),n.jsx("meshBasicMaterial",{color:"white"})]}),n.jsx(Xt,{anchorX:"center",anchorY:"middle",color:"white",...qt,lineHeight:1,maxWidth:20,onClick:()=>x(m.edge_type,m.source,m.target,m.ref_id),rotation:[0,0,0],textAlign:"center",children:ot(m.edge_type,$t)})]},m.ref_id))})};eo.displayName="Lines";const Kn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"],Xn=V.div`
  color: white;
  background: rgba(0, 0, 0, 1);
  padding: 2px 5px;
  border-radius: 4px;
  word-wrap: break-word;
  text-align: center;
  white-space: nowrap;
  visibility: visible;
  font-size: 12px;
  font-style: normal;
  font-weight: 400;
`,qn=V(Fo)`
  position: absolute;
`;new bo(2,2,2);const to=g.memo(({node:t,setSelectedNode:o,onSimulationUpdate:s,isSelected:e})=>{var M;const a=g.useRef(null),[c,d]=g.useState(!1);console.log(e);const{size:i,camera:l}=ne(),j=So(T=>{if(t.type==="Thing")return;const{xy:[y,E],down:_,dragging:A,first:w,elapsedTime:b}=T;if(!(!A||w||b<100)&&_&&a.current){s();const P=(y-i.left)/window.innerWidth*i.width,k=(E-i.top)/window.innerHeight*i.height,D=new N(P/i.width*2-1,-k/i.height*2+1,0).unproject(l).multiply(new N(1,1,0)).clone();t.fx=D.x,t.fy=D.y}});Le(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const u=Kn[(M=t==null?void 0:t.children)==null?void 0:M.length]||"red",f=T=>{T.stopPropagation(),t.type!=="Thing"&&o()},h=ot(t.type||"",te),x=()=>{d(!0)},m=()=>{d(!1)};return n.jsxs("mesh",{ref:a,onClick:f,...j(),onPointerOut:m,onPointerOver:x,position:new N(t.x,t.y,0),children:[n.jsx(Un,{args:[te,30,20],children:n.jsx("meshStandardMaterial",{attach:"material",color:u})}),n.jsx(Xt,{...qt,clipRect:[-te,-te,te,te],color:"#000",fontSize:2,maxWidth:te*2,textAlign:"left",children:h}),c&&n.jsx(qn,{position:[0,5,0],zIndexRange:[100,0],children:n.jsx(Xn,{children:t.type})})]})});to.displayName="Node";const Qn=({simulation:t,setSelectedSchemaId:o,selectedId:s,setIsAddEdgeNode:e})=>{const[a]=Jt(d=>[d.schemas]),c=()=>{t&&(t.alpha(.05),t.restart())};return n.jsx(n.Fragment,{children:a.map((d,i)=>{const l=t.nodes()[i];return l?n.jsx(to,{isSelected:l.ref_id===s,node:l,onSimulationUpdate:c,setSelectedNode:()=>{e(!1),o(l.ref_id)}},l.ref_id):null})})},Jn=({schemasWithPositions:t,filteredLinks:o,setSelectedSchemaId:s,selectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:c})=>{const[d,i]=g.useState(null),l=Nt(t),j=Nt(o);return g.useEffect(()=>{if(!t.length||!o.length)return;const u=structuredClone(t),f=structuredClone(o);if(d){l&&l.length!==t.length&&j&&j.length!==o.length&&(d.nodes(u).force("link",wt(f).id(x=>x.ref_id).distance(100)).force("charge",jt()).force("center",vt()).force("collide",Et(te+5)).alpha(.5).restart(),i({...d}));return}const h=xo(u).force("link",wt(f).id(x=>x.ref_id).distance(120)).force("charge",jt().strength(-100)).force("center",vt()).force("collide",Et(te+5));i(h)},[t,d,o,l,j]),Le(()=>{}),d?n.jsxs(n.Fragment,{children:[n.jsx(eo,{links:o,nodes:d.nodes(),onEdgeClick:c}),n.jsx(Qn,{selectedId:e,setIsAddEdgeNode:a,setSelectedSchemaId:s,simulation:d})]}):null},tt=new yo(0),es=({selectedSchemaId:t,links:o,schemasWithPositions:s,setSelectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:c})=>n.jsxs(Vo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[n.jsx("color",{args:[tt.r,tt.g,tt.b],attach:"background"}),wo&&n.jsx(Lo,{position:"right-bottom"}),n.jsx(ts,{}),n.jsx(Wo,{}),n.jsx(Jn,{filteredLinks:o,onEdgeClick:c,schemasWithPositions:s,selectedSchemaId:t,setIsAddEdgeNode:a,setSelectedSchemaId:e})]}),ts=()=>{g.useEffect(()=>{const s=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="grab")},e=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="default")};return window.addEventListener("keydown",s,!1),window.addEventListener("keyup",e,!1),()=>{window.removeEventListener("keydown",s,!1),window.removeEventListener("keyup",e,!1)}},[]);const t=()=>{document.body.style.cursor="grabbing"},o=()=>{document.body.style.cursor="default"};return n.jsx(Ln,{dampingFactor:1,enableDamping:!0,enablePan:!0,enableRotate:!1,enableZoom:!0,maxZoom:20,minZoom:1,onEnd:o,onStart:t,zoomSpeed:1.5,zoomToCursor:!0})},os=({onCreateNew:t,onAddEdgeNode:o})=>n.jsxs(ns,{children:[n.jsx(ss,{children:"BLUEPRINT"}),n.jsxs(zt,{"data-testid":"add-schema-type",onClick:t,children:[n.jsx(Rt,{children:n.jsx(Tt,{})}),n.jsx(q,{children:"Add Type"})]}),n.jsxs(zt,{"data-testid":"add-edge",onClick:o,children:[n.jsx(Rt,{children:n.jsx(Tt,{})}),n.jsx(q,{children:"Add Edge"})]})]}),ns=V(v).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${F.BG2};
  max-height: 100vh;
  border-top-left-radius: 9px;
  border-bottom-left-radius: 9px;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,zt=V(v).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${F.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${q} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${F.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${F.primaryBlue};
    }

    ${q} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${F.white};
    background: ${F.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${F.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,ss=V(v)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${F.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${F.white};
`,Rt=V(v)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,rs={type:"",parent:""},Bt=({onSelect:t,dataTestId:o,edgeLink:s})=>{const e=lt({mode:"onChange",defaultValues:rs}),{watch:a,setValue:c}=e,[d,i]=g.useState([]),[l,j]=g.useState(!1),u=m=>{c("parent",(m==null?void 0:m.value)||""),t(m==null?void 0:m.value)},f=m=>m.charAt(0).toUpperCase()+m.slice(1);g.useEffect(()=>{(async()=>{j(!0);try{const T=(await Yt()).schemas.filter(y=>!y.is_deleted&&y.type).map(y=>(y==null?void 0:y.type)==="thing"?{label:"No Parent",value:y.type}:{label:f(y.type),value:y.type});i(T),s&&c("parent",s)}catch(M){console.warn(M)}finally{j(!1)}})()},[s,c]);const h=a("parent"),x=()=>{const m=d==null?void 0:d.find(M=>M.value===h);if(m)return m;if(s)return{label:s,value:s}};return n.jsx(De,{dataTestId:o,disabled:!!s,isLoading:l,onSelect:u,options:d||ko,selectedValue:x()})},is=({selectedType:t,setSelectedFromNode:o,setSelectedToNode:s,edgeLinkData:e})=>n.jsxs(v,{children:[n.jsx(v,{align:"center",direction:"row",justify:"space-between",mb:35,children:n.jsx(v,{align:"center",direction:"row",children:n.jsx(as,{children:e!=null&&e.refId?"Edit Edge":"Add Edge"})})}),n.jsxs(v,{mb:25,children:[n.jsx(v,{mb:12,children:n.jsx(q,{children:"Source"})}),n.jsx(Bt,{dataTestId:"from_node",edgeLink:e==null?void 0:e.source,onSelect:o})]}),n.jsxs(v,{mb:10,children:[n.jsx(v,{mb:12,children:n.jsx(q,{children:"Edge Name"})}),n.jsx(v,{mb:12,children:n.jsx(Fe,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Re},value:t})})]}),n.jsxs(v,{mb:25,children:[n.jsx(v,{mb:12,children:n.jsx(q,{children:"Destination"})}),n.jsx(Bt,{dataTestId:"to_node",edgeLink:e==null?void 0:e.target,onSelect:s})]})]}),as=V(q)`
  font-size: 22px;
  font-weight: 600;
`,cs=({onCancel:t,edgeLinkData:o,setGraphLoading:s})=>{var b,P,k;const e=lt({mode:"onChange"}),{setValue:a,getValues:c}=e,[d,i]=g.useState(!1),[l,j]=g.useState(!1),[u,f]=g.useState(""),[h,x]=g.useState(""),[m,M]=g.useState(""),T=e.watch("type");g.useEffect(()=>{a("type",o==null?void 0:o.edgeType)},[o==null?void 0:o.edgeType,a]),g.useEffect(()=>{f(T)},[T]);const y=e.handleSubmit(async R=>{i(!0),s(!0);const S={source:h,target:m,edge_type:R.type},D={ref_id:o==null?void 0:o.refId,edge_type:R.type};try{o!=null&&o.refId?await jo(D):(!m||!h)&&await vo(S)}catch(oe){console.warn("API Error:",oe)}finally{i(!1),s(!1),x(""),M(""),t()}}),E=(P=(b=c())==null?void 0:b.type)==null?void 0:P.trim(),_=E&&((k=o==null?void 0:o.edgeType)==null?void 0:k.trim())!==E,A=o!=null&&o.refId?d||!_:d||!m||!h||!u,w=async()=>{j(!0),s(!0);try{o!=null&&o.refId&&await Eo(o==null?void 0:o.refId)}catch(R){console.warn("API Error:",R)}finally{j(!1),s(!1),x(""),M(""),t()}};return n.jsx(Ht,{...e,children:n.jsxs("form",{id:"add-type-form",onSubmit:y,children:[n.jsx(is,{edgeLinkData:o,selectedType:u,setSelectedFromNode:x,setSelectedToNode:M}),n.jsxs(v,{direction:"row",justify:"space-between",mt:20,children:[(o==null?void 0:o.refId)&&n.jsx(v,{direction:"column",children:n.jsxs(ds,{color:"secondary",disabled:l,onClick:w,size:"large",style:{marginRight:20},variant:"contained",children:["Delete",l&&n.jsxs(Dt,{children:[n.jsx(ue,{color:F.lightGray,size:12})," "]})]})}),n.jsxs(ls,{color:"secondary",disabled:A,onClick:y,size:"large",variant:"contained",children:["Confirm",d&&n.jsxs(Dt,{children:[n.jsx(ue,{color:F.lightGray,size:12})," "]})]})]})]})})},ls=V(Ce)`
  width: 293px !important;
  margin: 0 0 10px auto !important;
`,Dt=V.span`
  margin-top: 2px;
`,ds=V(Ce)`
  && {
    color: ${F.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${F.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,us=({setIsAddEdgeNode:t,edgeData:o,setGraphLoading:s})=>{const e=()=>{t(!1)};return n.jsxs(v,{children:[n.jsx(v,{direction:"row",justify:"flex-end",children:n.jsx(ps,{"data-testid":"close-sidebar-sub-view",onClick:e,children:n.jsx(Gt,{})})}),n.jsx(cs,{edgeLinkData:o,onCancel:e,setGraphLoading:s})]})},ps=V(v)`
  font-size: 32px;
  color: ${F.white};
  cursor: pointer;
`,fs=()=>{const[t,o]=g.useState(""),[s,e]=g.useState(!1),[a,c]=g.useState(!1),[d,i]=g.useState(!1),[l,j]=g.useState({refId:"",edgeType:"",source:"",target:""}),[u,f]=g.useState(!1),[h,x,m,M]=Jt(b=>[b.schemas,b.links,b.setSchemas,b.setSchemaLinks]);g.useEffect(()=>{(async()=>{c(!0);try{const P=await Pt(),k=P.schemas.filter(R=>R.ref_id&&!R.is_deleted);m(k.length>0?k:P.schemas),M(P.edges.length>0?P.edges:[]),c(!1)}catch(P){console.error("Error fetching data:",P),c(!1)}})()},[m,M]);const T=b=>{if(h.some(k=>k.ref_id===b.ref_id))m(h.map(k=>k.ref_id===b.ref_id?{...b,children:[]}:k));else{m([...h,{...b,children:[]}]);const k=h.find(R=>b.parent===R.type);M([...x,{ref_id:`new-link-${x.length}`,edge_type:"CHILD_OF",source:b.ref_id||"new",target:(k==null?void 0:k.ref_id)||"new"}])}},y=async()=>{const b=await Pt();m(b.schemas.filter(P=>P.ref_id&&!P.is_deleted&&P.ref_id)),M(b.edges)},E=b=>{m(h.filter(P=>P.type!==b))},_=h.map(b=>({...b,children:h.filter(P=>P.parent===b.type).map(P=>P.ref_id||"")})),A=x.filter(b=>_.some(P=>P.ref_id===b.source)&&_.some(P=>P.ref_id===b.target)),w=h.find(b=>b.ref_id===t)||null;return a?n.jsx(v,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(ue,{color:F.white})}):n.jsx(n.Fragment,{children:n.jsxs(v,{align:"stretch",direction:"row",grow:1,children:[n.jsx(v,{ml:-20,my:-20,children:n.jsx(os,{onAddEdgeNode:()=>{i(!0),e(!1),o(""),j({refId:"",edgeType:"",source:"",target:""})},onCreateNew:()=>{i(!1),e(!0),o("")}})}),n.jsx(v,{children:w||s?n.jsx(Ft,{children:n.jsx(Vt,{children:n.jsx(Nn,{graphLoading:u,onDelete:E,onSchemaCreate:T,onSchemaUpdate:y,selectedSchema:w,setGraphLoading:f,setIsCreateNew:e,setSelectedSchemaId:o})})}):null}),n.jsx(v,{children:d?n.jsx(Ft,{children:n.jsx(Vt,{children:n.jsx(us,{edgeData:l,setGraphLoading:f,setIsAddEdgeNode:i})})}):null}),n.jsx(hs,{direction:"row",grow:1,children:n.jsx(ms,{children:u?n.jsx(v,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(ue,{color:F.white})}):n.jsx(es,{links:A,onEdgeClick:(b,P,k,R)=>{j({refId:b,edgeType:P,source:k,target:R}),i(!0),e(!1),o("")},schemasWithPositions:_,selectedSchemaId:t,setIsAddEdgeNode:i,setSelectedSchemaId:o})})})]})})},hs=V(v)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Ft=V(v)`
  width: 100%;
  max-width: 400px;
  background: ${F.BG1};
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Vt=V.div`
  height: 100%;
  overflow-y: auto;
  padding: 16px;
`,ms=V(v)`
  flex: 1 1 100%;
`,gs=()=>{const{close:t}=Ut("blueprintGraph"),o=()=>{t()};return n.jsx(Po,{background:"black",id:"blueprintGraph",kind:"full",onClose:o,preventOutsideClose:!0,children:n.jsx(fs,{})})},Vs=g.memo(gs);export{Vs as BlueprintModal};
