import{g as Be,a as Fe,s as le,_ as F,a9 as to,r as x,b as Ve,j as n,d as We,c as ce,e as Ye,u as Mt,aM as oo,b4 as Se,b5 as Ue,a7 as at,b6 as no,b7 as so,a0 as ro,f as R,F as j,h as z,D as ke,a_ as io,T as H,B as At,N as Ce,aY as fe,a$ as Nt,b8 as ao,b9 as co,ba as lo,Z as $,bb as ue,bc as pe,ap as ct,bd as ve,be as Ee,bf as lt,bg as Z,bh as uo,ar as po,bi as dt,bj as ut,bk as pt,bl as ft,bm as fo,am as ho,W as mo,bn as go,bo as ht}from"./index-382466ac.js";import{B as xo}from"./index-13ebb6fc.js";import{p as bo,q as yo,i as wo,C as be,I as jo,B as Me,c as Ge,b as _t,F as $t,r as vo}from"./react-toastify.esm-544b3ad9.js";import{e as Eo,A as Te}from"./index-4a0f3f68.js";import{T as Oe}from"./index-43f46160.js";import{c as mt,d as Po,a as ko}from"./index-2c970141.js";import{D as Co,P as To}from"./PlusIcon-cb42ca64.js";import{p as Oo,c as So,g as Mo,t as Re}from"./index-7405dfa3.js";import{u as Ao}from"./Popover-d886eaf8.js";import{u as No}from"./index-14984475.js";import{L as _o,m as $o,u as q,b as Ae,T as Lt,H as Lo,C as Do}from"./constant-1f06321e.js";import{f as Io,P as zo,L as Ro}from"./constants-a04d8d00.js";import{A as gt}from"./AddContentIcon-7016e2ba.js";import"./useSlotProps-f9180805.js";import"./Popper-e0faa8b7.js";import"./index.esm-effff289.js";import"./InfoIcon-c480a4d1.js";import"./generateCategoricalChart-51d7969d.js";import"./NoFilterResultIcon-de060e9d.js";import"./index-7123bf58.js";import"./index-8843bf0c.js";import"./CheckIcon-72fa76b6.js";function Bo(t){return Be("PrivateSwitchBase",t)}Fe("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Fo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],Vo=t=>{const{classes:s,checked:r,disabled:e,edge:c}=t,a={root:["root",r&&"checked",e&&"disabled",c&&`edge${ce(c)}`],input:["input"]};return Ye(a,Bo,s)},Wo=le(bo)(({ownerState:t})=>F({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Yo=le("input",{shouldForwardProp:to})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Uo=x.forwardRef(function(s,r){const{autoFocus:e,checked:c,checkedIcon:a,className:f,defaultChecked:l,disabled:d,disableFocusRipple:y=!1,edge:i=!1,icon:h,id:p,inputProps:b,inputRef:T,name:k,onBlur:w,onChange:C,onFocus:N,readOnly:A,required:m=!1,tabIndex:g,type:O,value:I}=s,L=Ve(s,Fo),[D,v]=No({controlled:c,default:!!l,name:"SwitchBase",state:"checked"}),_=Ao(),ie=V=>{N&&N(V),_&&_.onFocus&&_.onFocus(V)},ne=V=>{w&&w(V),_&&_.onBlur&&_.onBlur(V)},G=V=>{if(V.nativeEvent.defaultPrevented)return;const S=V.target.checked;v(S),C&&C(V,S)};let K=d;_&&typeof K>"u"&&(K=_.disabled);const de=O==="checkbox"||O==="radio",J=F({},s,{checked:D,disabled:K,disableFocusRipple:y,edge:i}),X=Vo(J);return n.jsxs(Wo,F({component:"span",className:We(X.root,f),centerRipple:!0,focusRipple:!y,disabled:K,tabIndex:null,role:void 0,onFocus:ie,onBlur:ne,ownerState:J,ref:r},L,{children:[n.jsx(Yo,F({autoFocus:e,checked:c,defaultChecked:l,className:X.input,disabled:K,id:de?p:void 0,name:k,onChange:G,readOnly:A,ref:T,required:m,ownerState:J,tabIndex:g,type:O},O==="checkbox"&&I===void 0?{}:{value:I},b)),D?a:h]}))}),Go=Uo,Ho=x.createContext(),xt=Ho;function Xo(t){return Be("MuiGrid",t)}const Zo=[0,1,2,3,4,5,6,7,8,9,10],Ko=["column-reverse","column","row-reverse","row"],qo=["nowrap","wrap-reverse","wrap"],xe=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Qo=Fe("MuiGrid",["root","container","item","zeroMinWidth",...Zo.map(t=>`spacing-xs-${t}`),...Ko.map(t=>`direction-xs-${t}`),...qo.map(t=>`wrap-xs-${t}`),...xe.map(t=>`grid-xs-${t}`),...xe.map(t=>`grid-sm-${t}`),...xe.map(t=>`grid-md-${t}`),...xe.map(t=>`grid-lg-${t}`),...xe.map(t=>`grid-xl-${t}`)]),ye=Qo,Jo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function he(t){const s=parseFloat(t);return`${s}${String(t).replace(String(s),"")||"px"}`}function en({theme:t,ownerState:s}){let r;return t.breakpoints.keys.reduce((e,c)=>{let a={};if(s[c]&&(r=s[c]),!r)return e;if(r===!0)a={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(r==="auto")a={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const f=Se({values:s.columns,breakpoints:t.breakpoints.values}),l=typeof f=="object"?f[c]:f;if(l==null)return e;const d=`${Math.round(r/l*1e8)/1e6}%`;let y={};if(s.container&&s.item&&s.columnSpacing!==0){const i=t.spacing(s.columnSpacing);if(i!=="0px"){const h=`calc(${d} + ${he(i)})`;y={flexBasis:h,maxWidth:h}}}a=F({flexBasis:d,flexGrow:0,maxWidth:d},y)}return t.breakpoints.values[c]===0?Object.assign(e,a):e[t.breakpoints.up(c)]=a,e},{})}function tn({theme:t,ownerState:s}){const r=Se({values:s.direction,breakpoints:t.breakpoints.values});return Ue({theme:t},r,e=>{const c={flexDirection:e};return e.indexOf("column")===0&&(c[`& > .${ye.item}`]={maxWidth:"none"}),c})}function Dt({breakpoints:t,values:s}){let r="";Object.keys(s).forEach(c=>{r===""&&s[c]!==0&&(r=c)});const e=Object.keys(t).sort((c,a)=>t[c]-t[a]);return e.slice(0,e.indexOf(r))}function on({theme:t,ownerState:s}){const{container:r,rowSpacing:e}=s;let c={};if(r&&e!==0){const a=Se({values:e,breakpoints:t.breakpoints.values});let f;typeof a=="object"&&(f=Dt({breakpoints:t.breakpoints.values,values:a})),c=Ue({theme:t},a,(l,d)=>{var y;const i=t.spacing(l);return i!=="0px"?{marginTop:`-${he(i)}`,[`& > .${ye.item}`]:{paddingTop:he(i)}}:(y=f)!=null&&y.includes(d)?{}:{marginTop:0,[`& > .${ye.item}`]:{paddingTop:0}}})}return c}function nn({theme:t,ownerState:s}){const{container:r,columnSpacing:e}=s;let c={};if(r&&e!==0){const a=Se({values:e,breakpoints:t.breakpoints.values});let f;typeof a=="object"&&(f=Dt({breakpoints:t.breakpoints.values,values:a})),c=Ue({theme:t},a,(l,d)=>{var y;const i=t.spacing(l);return i!=="0px"?{width:`calc(100% + ${he(i)})`,marginLeft:`-${he(i)}`,[`& > .${ye.item}`]:{paddingLeft:he(i)}}:(y=f)!=null&&y.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${ye.item}`]:{paddingLeft:0}}})}return c}function sn(t,s,r={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[r[`spacing-xs-${String(t)}`]];const e=[];return s.forEach(c=>{const a=t[c];Number(a)>0&&e.push(r[`spacing-${c}-${String(a)}`])}),e}const rn=le("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t,{container:e,direction:c,item:a,spacing:f,wrap:l,zeroMinWidth:d,breakpoints:y}=r;let i=[];e&&(i=sn(f,y,s));const h=[];return y.forEach(p=>{const b=r[p];b&&h.push(s[`grid-${p}-${String(b)}`])}),[s.root,e&&s.container,a&&s.item,d&&s.zeroMinWidth,...i,c!=="row"&&s[`direction-xs-${String(c)}`],l!=="wrap"&&s[`wrap-xs-${String(l)}`],...h]}})(({ownerState:t})=>F({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),tn,on,nn,en);function an(t,s){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const r=[];return s.forEach(e=>{const c=t[e];if(Number(c)>0){const a=`spacing-${e}-${String(c)}`;r.push(a)}}),r}const cn=t=>{const{classes:s,container:r,direction:e,item:c,spacing:a,wrap:f,zeroMinWidth:l,breakpoints:d}=t;let y=[];r&&(y=an(a,d));const i=[];d.forEach(p=>{const b=t[p];b&&i.push(`grid-${p}-${String(b)}`)});const h={root:["root",r&&"container",c&&"item",l&&"zeroMinWidth",...y,e!=="row"&&`direction-xs-${String(e)}`,f!=="wrap"&&`wrap-xs-${String(f)}`,...i]};return Ye(h,Xo,s)},ln=x.forwardRef(function(s,r){const e=Mt({props:s,name:"MuiGrid"}),{breakpoints:c}=oo(),a=Eo(e),{className:f,columns:l,columnSpacing:d,component:y="div",container:i=!1,direction:h="row",item:p=!1,rowSpacing:b,spacing:T=0,wrap:k="wrap",zeroMinWidth:w=!1}=a,C=Ve(a,Jo),N=b||T,A=d||T,m=x.useContext(xt),g=i?l||12:m,O={},I=F({},C);c.keys.forEach(v=>{C[v]!=null&&(O[v]=C[v],delete I[v])});const L=F({},a,{columns:g,container:i,direction:h,item:p,rowSpacing:N,columnSpacing:A,wrap:k,zeroMinWidth:w,spacing:T},O,{breakpoints:c.keys}),D=cn(L);return n.jsx(xt.Provider,{value:g,children:n.jsx(rn,F({ownerState:L,className:We(D.root,f),as:y,ref:r},I))})}),re=ln;function dn(t){return Be("MuiSwitch",t)}const un=Fe("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Y=un,pn=["className","color","edge","size","sx"],fn=t=>{const{classes:s,edge:r,size:e,color:c,checked:a,disabled:f}=t,l={root:["root",r&&`edge${ce(r)}`,`size${ce(e)}`],switchBase:["switchBase",`color${ce(c)}`,a&&"checked",f&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=Ye(l,dn,s);return F({},s,d)},hn=le("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,r.edge&&s[`edge${ce(r.edge)}`],s[`size${ce(r.size)}`]]}})(({ownerState:t})=>F({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${Y.thumb}`]:{width:16,height:16},[`& .${Y.switchBase}`]:{padding:4,[`&.${Y.checked}`]:{transform:"translateX(16px)"}}})),mn=le(Go,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.switchBase,{[`& .${Y.input}`]:s.input},r.color!=="default"&&s[`color${ce(r.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${Y.checked}`]:{transform:"translateX(20px)"},[`&.${Y.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${Y.checked} + .${Y.track}`]:{opacity:.5},[`&.${Y.disabled} + .${Y.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${Y.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:s})=>F({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:at(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},s.color!=="default"&&{[`&.${Y.checked}`]:{color:(t.vars||t).palette[s.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[s.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:at(t.palette[s.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Y.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${s.color}DisabledColor`]:`${t.palette.mode==="light"?no(t.palette[s.color].main,.62):so(t.palette[s.color].main,.55)}`}},[`&.${Y.checked} + .${Y.track}`]:{backgroundColor:(t.vars||t).palette[s.color].main}})),gn=le("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,s)=>s.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),xn=le("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,s)=>s.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),bn=x.forwardRef(function(s,r){const e=Mt({props:s,name:"MuiSwitch"}),{className:c,color:a="primary",edge:f=!1,size:l="medium",sx:d}=e,y=Ve(e,pn),i=F({},e,{color:a,edge:f,size:l}),h=fn(i),p=n.jsx(xn,{className:h.thumb,ownerState:i});return n.jsxs(hn,{className:We(h.root,c),sx:d,ownerState:i,children:[n.jsx(mn,F({type:"checkbox",icon:p,checkedIcon:p,ref:r,ownerState:i},y,{classes:F({},h,{root:h.switchBase})})),n.jsx(gn,{className:h.track,ownerState:i})]})}),yn=bn,wn={schemas:[],links:[]},It=ro(t=>({...wn,setSchemas:s=>{t({schemas:s})},setSchemaLinks:s=>{t({links:s})}})),jn=/^[a-z0-9_]+$/,vn=({parentParam:t})=>{const[s,r]=x.useState(!1),[e,c]=x.useState([]),{fields:a,append:f,replace:l,remove:d}=yo({name:"attributes"}),{setValue:y,watch:i}=wo();return x.useEffect(()=>{const h=async()=>{try{let p=[{required:!1,type:"string",key:""}];if(t!==Po.value.toLowerCase()){r(!0);const b=await io(t);p=Oo(b)}p=p.filter(b=>b.key!=="node_key"),l(p),c(p)}catch(p){console.warn(p)}finally{r(!1)}};e.length===0&&h()},[t,y,l,e.length]),n.jsxs(n.Fragment,{children:[s?n.jsx(j,{align:"center",children:n.jsx(be,{color:z.SECONDARY_BLUE,size:"30"})}):n.jsx(En,{py:8,children:n.jsx(re,{container:!0,spacing:2,children:a.map((h,p)=>{const b=i(`attributes[${p}].type`),T=i(`attributes[${p}].required`),k=h.isNew||!1,w=["name"].includes(i(`attributes[${p}].key`));return n.jsxs(x.Fragment,{children:[n.jsx(re,{item:!0,xs:5,children:n.jsx(Oe,{autoComplete:"off",className:"text-input",disabled:!k,id:"cy-item-name",maxLength:50,name:`attributes.${p}.key`,placeholder:"Enter value",rules:{...ke,pattern:{message:"Please avoid special characters, spaces and uppercase",value:jn}}})}),n.jsx(re,{item:!0,xs:4,children:n.jsx(Te,{disabled:w,onSelect:C=>y(`attributes[${p}].type`,C==null?void 0:C.value),options:mt,selectedValue:mt.find(C=>C.value===b)})}),n.jsxs(re,{item:!0,xs:3,children:[n.jsx(yn,{checked:T,disabled:w,name:`attributes.${p}.required`,onChange:C=>y(`attributes[${p}].required`,C.target.checked),size:"small"}),!w&&n.jsx(jo,{onClick:()=>d(p),children:n.jsx(Co,{})})]})]},h.id)})})}),n.jsx(j,{align:"flex-start",py:12,children:n.jsx(Me,{onClick:()=>f({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:n.jsx(To,{}),variant:"contained",children:"Add Attribute"})})]})},En=R(j)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,Pn=({parent:t})=>{const s=t;return n.jsxs(j,{children:[n.jsx(j,{direction:"row",mb:10,children:n.jsxs(re,{container:!0,spacing:2,children:[n.jsx(re,{item:!0,xs:5,children:n.jsx(De,{style:{marginRight:180},children:"Attributes"})}),n.jsx(re,{item:!0,xs:4,children:n.jsx(De,{style:{marginRight:130},children:"Type"})}),n.jsx(re,{item:!0,xs:3,children:n.jsx(De,{children:"Required"})})]})}),s&&n.jsx(vn,{parentParam:s},s)]})},De=R(H)`
  font-size: 15px;
  color: gray;
`,kn={type:"",parent:""},Cn=async(t,s=!1)=>{try{const{attributes:r,...e}=t,c={...e,attributes:So(r)};let a;if(s?a=await Ce.put("/schema",JSON.stringify(c),{}):a=await Ce.post("/schema",JSON.stringify({...c,node_key:"name"}),{}),a.status!=="success")throw new Error("error");return a==null?void 0:a.ref_id}catch(r){let e=fe;if(r.status===400){const c=await r.json();e=c.errorCode||(c==null?void 0:c.status)||fe}else r instanceof Error&&(e=r.message);throw new Error(e)}},Tn=t=>t.charAt(0).toUpperCase()+t.slice(1),bt=async(t,s)=>{try{const a=((await Nt()).schemas||[]).filter(f=>!f.is_deleted&&f.type&&(!s||s(f))).map(f=>f.type==="thing"?{label:"No Parent",value:f.type}:{label:Tn(f.type),value:f.type});t(a)}catch(r){console.warn(r)}},On=({graphLoading:t,onSchemaCreate:s,selectedSchema:r,onDelete:e,setSelectedSchemaId:c,setGraphLoading:a,setIsCreateNew:f,onSchemaUpdate:l})=>{const{close:d,visible:y}=At("addType"),i=Ge({mode:"onChange",defaultValues:r?{type:r.type,parent:r.parent}:kn}),{watch:h,setValue:p,reset:b,getValues:T}=i,[k,w]=x.useState(!1),[C,N]=x.useState(!1),[A,m]=x.useState(null),[g,O]=x.useState(!1),[I,L]=x.useState(null),[D,v]=x.useState(""),[_,ie]=x.useState(null);x.useEffect(()=>()=>{b()},[y,b]);const ne=()=>{f(!1),c("")};x.useEffect(()=>{r||(N(!0),bt(m).finally(()=>N(!1)))},[r]),x.useEffect(()=>{r&&(p("type",r==null?void 0:r.type),p("parent",r.parent),bt(L,S=>S.type!==r.type&&S.type!==r.parent))},[r,p]);const G=h("parent"),K=()=>{d()},de=async()=>{if(r!=null&&r.type)try{await Ce.delete(`/schema/${r.ref_id}`),e(r.type),d()}catch(S){let W=fe;if((S==null?void 0:S.status)===400){const U=await S.json();W=U.errorCode||(U==null?void 0:U.status)||fe}else S instanceof Error&&(W=S.message);ie(W)}finally{f(!1)}},J=i.handleSubmit(async S=>{if(!G){O(!0);return}w(!0);try{if(r&&S.type!==(r==null?void 0:r.type)||r&&T().parent!==(r==null?void 0:r.parent)){const U=T().parent??(r==null?void 0:r.parent);a(!0),await Ce.put(`/schema/${r==null?void 0:r.ref_id}`,JSON.stringify({type:S.type,parent:U})),await l()}const W=await Cn({...S,...r?{ref_id:r==null?void 0:r.ref_id}:{}},!!r);s({type:S.type,parent:G||"",ref_id:(r==null?void 0:r.ref_id)||W||"new"}),K()}catch(W){let U=fe;if((W==null?void 0:W.status)===400){const ae=await W.json();U=ae.errorCode||(ae==null?void 0:ae.status)||fe}else W instanceof Error&&(U=W.message);v(U)}finally{w(!1),a(!1),f(!1)}}),X=()=>A==null?void 0:A.find(S=>S.value===G),V=()=>I==null?void 0:I.find(S=>S.value===G);return n.jsxs(j,{children:[n.jsx(j,{direction:"row",justify:"flex-end",children:n.jsx(Mn,{"data-testid":"close-sidebar-sub-view",onClick:ne,children:n.jsx(_t,{})})}),n.jsx(j,{children:n.jsx($t,{...i,children:n.jsxs("form",{id:"add-type-form",onSubmit:J,children:[n.jsx(j,{children:r?n.jsxs(n.Fragment,{children:[n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(H,{children:"Name"})}),n.jsx(j,{mb:12,children:n.jsx(Oe,{defaultValue:r==null?void 0:r.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...ke},value:G})})]}),n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(H,{children:"Parent"})}),n.jsx(Te,{isLoading:C||t,onSelect:S=>{p("parent",(S==null?void 0:S.value)||""),O(!1)},options:I||[],selectedValue:V()}),D&&n.jsx(Ie,{children:D})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(H,{children:"Select Parent"})}),n.jsx(Te,{isLoading:C,onSelect:S=>{p("parent",(S==null?void 0:S.value)||""),O(!1)},options:A,selectedValue:X()}),g&&n.jsx(Ie,{children:"A parent type must be selected"})]}),n.jsxs(j,{children:[n.jsx(j,{mb:12,children:n.jsx(H,{children:"Type name"})}),n.jsx(j,{mb:12,children:n.jsx(Oe,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...ke},value:G})})]})]})}),n.jsx(Pn,{parent:r?r.type:G}),n.jsxs(j,{direction:"row",justify:"space-between",mt:20,children:[r?n.jsxs(j,{direction:"column",children:[n.jsx(Sn,{color:"secondary",onClick:de,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}),_&&n.jsx(Ie,{children:_})]}):null,n.jsx(Me,{color:"secondary",disabled:k||g,onClick:J,size:"large",startIcon:k?n.jsx(be,{color:z.white,size:10}):null,variant:"contained",children:"Save"})]})]})})})]})},Sn=R(Me)`
  && {
    color: ${z.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${z.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,Mn=R(j)`
  font-size: 32px;
  color: ${z.white};
  cursor: pointer;
`,Ie=R(j)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var An=Object.defineProperty,Nn=(t,s,r)=>s in t?An(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,E=(t,s,r)=>(Nn(t,typeof s!="symbol"?s+"":s,r),r);const Pe=new ao,yt=new co,_n=Math.cos(70*(Math.PI/180)),wt=(t,s)=>(t%s+s)%s;let $n=class extends lo{constructor(s,r){super(),E(this,"object"),E(this,"domElement"),E(this,"enabled",!0),E(this,"target",new $),E(this,"minDistance",0),E(this,"maxDistance",1/0),E(this,"minZoom",0),E(this,"maxZoom",1/0),E(this,"minPolarAngle",0),E(this,"maxPolarAngle",Math.PI),E(this,"minAzimuthAngle",-1/0),E(this,"maxAzimuthAngle",1/0),E(this,"enableDamping",!1),E(this,"dampingFactor",.05),E(this,"enableZoom",!0),E(this,"zoomSpeed",1),E(this,"enableRotate",!0),E(this,"rotateSpeed",1),E(this,"enablePan",!0),E(this,"panSpeed",1),E(this,"screenSpacePanning",!0),E(this,"keyPanSpeed",7),E(this,"zoomToCursor",!1),E(this,"autoRotate",!1),E(this,"autoRotateSpeed",2),E(this,"reverseOrbit",!1),E(this,"reverseHorizontalOrbit",!1),E(this,"reverseVerticalOrbit",!1),E(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),E(this,"mouseButtons",{LEFT:ue.ROTATE,MIDDLE:ue.DOLLY,RIGHT:ue.PAN}),E(this,"touches",{ONE:pe.ROTATE,TWO:pe.DOLLY_PAN}),E(this,"target0"),E(this,"position0"),E(this,"zoom0"),E(this,"_domElementKeyEvents",null),E(this,"getPolarAngle"),E(this,"getAzimuthalAngle"),E(this,"setPolarAngle"),E(this,"setAzimuthalAngle"),E(this,"getDistance"),E(this,"listenToKeyEvents"),E(this,"stopListenToKeyEvents"),E(this,"saveState"),E(this,"reset"),E(this,"update"),E(this,"connect"),E(this,"dispose"),this.object=s,this.domElement=r,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>i.phi,this.getAzimuthalAngle=()=>i.theta,this.setPolarAngle=o=>{let u=wt(o,2*Math.PI),P=i.phi;P<0&&(P+=2*Math.PI),u<0&&(u+=2*Math.PI);let M=Math.abs(u-P);2*Math.PI-M<M&&(u<P?u+=2*Math.PI:P+=2*Math.PI),h.phi=u-P,e.update()},this.setAzimuthalAngle=o=>{let u=wt(o,2*Math.PI),P=i.theta;P<0&&(P+=2*Math.PI),u<0&&(u+=2*Math.PI);let M=Math.abs(u-P);2*Math.PI-M<M&&(u<P?u+=2*Math.PI:P+=2*Math.PI),h.theta=u-P,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=o=>{o.addEventListener("keydown",$e),this._domElementKeyEvents=o},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",$e),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(c),e.update(),d=l.NONE},this.update=(()=>{const o=new $,u=new $(0,1,0),P=new ct().setFromUnitVectors(s.up,u),M=P.clone().invert(),B=new $,ee=new ct,se=2*Math.PI;return function(){const it=e.object.position;P.setFromUnitVectors(s.up,u),M.copy(P).invert(),o.copy(it).sub(e.target),o.applyQuaternion(P),i.setFromVector3(o),e.autoRotate&&d===l.NONE&&G(ie()),e.enableDamping?(i.theta+=h.theta*e.dampingFactor,i.phi+=h.phi*e.dampingFactor):(i.theta+=h.theta,i.phi+=h.phi);let te=e.minAzimuthAngle,oe=e.maxAzimuthAngle;isFinite(te)&&isFinite(oe)&&(te<-Math.PI?te+=se:te>Math.PI&&(te-=se),oe<-Math.PI?oe+=se:oe>Math.PI&&(oe-=se),te<=oe?i.theta=Math.max(te,Math.min(oe,i.theta)):i.theta=i.theta>(te+oe)/2?Math.max(te,i.theta):Math.min(oe,i.theta)),i.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,i.phi)),i.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(b,e.dampingFactor):e.target.add(b),e.zoomToCursor&&D||e.object.isOrthographicCamera?i.radius=U(i.radius):i.radius=U(i.radius*p),o.setFromSpherical(i),o.applyQuaternion(M),it.copy(e.target).add(o),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(h.theta*=1-e.dampingFactor,h.phi*=1-e.dampingFactor,b.multiplyScalar(1-e.dampingFactor)):(h.set(0,0,0),b.set(0,0,0));let we=!1;if(e.zoomToCursor&&D){let me=null;if(e.object instanceof ve&&e.object.isPerspectiveCamera){const ge=o.length();me=U(ge*p);const je=ge-me;e.object.position.addScaledVector(I,je),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const ge=new $(L.x,L.y,0);ge.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix(),we=!0;const je=new $(L.x,L.y,0);je.unproject(e.object),e.object.position.sub(je).add(ge),e.object.updateMatrixWorld(),me=o.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;me!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(me).add(e.object.position):(Pe.origin.copy(e.object.position),Pe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(Pe.direction))<_n?s.lookAt(e.target):(yt.setFromNormalAndCoplanarPoint(e.object.up,e.target),Pe.intersectPlane(yt,e.target))))}else e.object instanceof Ee&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix(),we=!0);return p=1,D=!1,we||B.distanceToSquared(e.object.position)>y||8*(1-ee.dot(e.object.quaternion))>y?(e.dispatchEvent(c),B.copy(e.object.position),ee.copy(e.object.quaternion),we=!1,!0):!1}})(),this.connect=o=>{o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=o,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",nt),e.domElement.addEventListener("pointerdown",et),e.domElement.addEventListener("pointercancel",tt),e.domElement.addEventListener("wheel",ot)},this.dispose=()=>{var o,u,P,M,B,ee;(o=e.domElement)==null||o.removeEventListener("contextmenu",nt),(u=e.domElement)==null||u.removeEventListener("pointerdown",et),(P=e.domElement)==null||P.removeEventListener("pointercancel",tt),(M=e.domElement)==null||M.removeEventListener("wheel",ot),(B=e.domElement)==null||B.ownerDocument.removeEventListener("pointermove",Ne),(ee=e.domElement)==null||ee.ownerDocument.removeEventListener("pointerup",_e),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",$e)};const e=this,c={type:"change"},a={type:"start"},f={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=l.NONE;const y=1e-6,i=new lt,h=new lt;let p=1;const b=new $,T=new Z,k=new Z,w=new Z,C=new Z,N=new Z,A=new Z,m=new Z,g=new Z,O=new Z,I=new $,L=new Z;let D=!1;const v=[],_={};function ie(){return 2*Math.PI/60/60*e.autoRotateSpeed}function ne(){return Math.pow(.95,e.zoomSpeed)}function G(o){e.reverseOrbit||e.reverseHorizontalOrbit?h.theta+=o:h.theta-=o}function K(o){e.reverseOrbit||e.reverseVerticalOrbit?h.phi+=o:h.phi-=o}const de=(()=>{const o=new $;return function(P,M){o.setFromMatrixColumn(M,0),o.multiplyScalar(-P),b.add(o)}})(),J=(()=>{const o=new $;return function(P,M){e.screenSpacePanning===!0?o.setFromMatrixColumn(M,1):(o.setFromMatrixColumn(M,0),o.crossVectors(e.object.up,o)),o.multiplyScalar(P),b.add(o)}})(),X=(()=>{const o=new $;return function(P,M){const B=e.domElement;if(B&&e.object instanceof ve&&e.object.isPerspectiveCamera){const ee=e.object.position;o.copy(ee).sub(e.target);let se=o.length();se*=Math.tan(e.object.fov/2*Math.PI/180),de(2*P*se/B.clientHeight,e.object.matrix),J(2*M*se/B.clientHeight,e.object.matrix)}else B&&e.object instanceof Ee&&e.object.isOrthographicCamera?(de(P*(e.object.right-e.object.left)/e.object.zoom/B.clientWidth,e.object.matrix),J(M*(e.object.top-e.object.bottom)/e.object.zoom/B.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function V(o){e.object instanceof ve&&e.object.isPerspectiveCamera||e.object instanceof Ee&&e.object.isOrthographicCamera?p/=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function S(o){e.object instanceof ve&&e.object.isPerspectiveCamera||e.object instanceof Ee&&e.object.isOrthographicCamera?p*=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function W(o){if(!e.zoomToCursor||!e.domElement)return;D=!0;const u=e.domElement.getBoundingClientRect(),P=o.clientX-u.left,M=o.clientY-u.top,B=u.width,ee=u.height;L.x=P/B*2-1,L.y=-(M/ee)*2+1,I.set(L.x,L.y,1).unproject(e.object).sub(e.object.position).normalize()}function U(o){return Math.max(e.minDistance,Math.min(e.maxDistance,o))}function ae(o){T.set(o.clientX,o.clientY)}function Bt(o){W(o),m.set(o.clientX,o.clientY)}function He(o){C.set(o.clientX,o.clientY)}function Ft(o){k.set(o.clientX,o.clientY),w.subVectors(k,T).multiplyScalar(e.rotateSpeed);const u=e.domElement;u&&(G(2*Math.PI*w.x/u.clientHeight),K(2*Math.PI*w.y/u.clientHeight)),T.copy(k),e.update()}function Vt(o){g.set(o.clientX,o.clientY),O.subVectors(g,m),O.y>0?V(ne()):O.y<0&&S(ne()),m.copy(g),e.update()}function Wt(o){N.set(o.clientX,o.clientY),A.subVectors(N,C).multiplyScalar(e.panSpeed),X(A.x,A.y),C.copy(N),e.update()}function Yt(o){W(o),o.deltaY<0?S(ne()):o.deltaY>0&&V(ne()),e.update()}function Ut(o){let u=!1;switch(o.code){case e.keys.UP:X(0,e.keyPanSpeed),u=!0;break;case e.keys.BOTTOM:X(0,-e.keyPanSpeed),u=!0;break;case e.keys.LEFT:X(e.keyPanSpeed,0),u=!0;break;case e.keys.RIGHT:X(-e.keyPanSpeed,0),u=!0;break}u&&(o.preventDefault(),e.update())}function Xe(){if(v.length==1)T.set(v[0].pageX,v[0].pageY);else{const o=.5*(v[0].pageX+v[1].pageX),u=.5*(v[0].pageY+v[1].pageY);T.set(o,u)}}function Ze(){if(v.length==1)C.set(v[0].pageX,v[0].pageY);else{const o=.5*(v[0].pageX+v[1].pageX),u=.5*(v[0].pageY+v[1].pageY);C.set(o,u)}}function Ke(){const o=v[0].pageX-v[1].pageX,u=v[0].pageY-v[1].pageY,P=Math.sqrt(o*o+u*u);m.set(0,P)}function Gt(){e.enableZoom&&Ke(),e.enablePan&&Ze()}function Ht(){e.enableZoom&&Ke(),e.enableRotate&&Xe()}function qe(o){if(v.length==1)k.set(o.pageX,o.pageY);else{const P=Le(o),M=.5*(o.pageX+P.x),B=.5*(o.pageY+P.y);k.set(M,B)}w.subVectors(k,T).multiplyScalar(e.rotateSpeed);const u=e.domElement;u&&(G(2*Math.PI*w.x/u.clientHeight),K(2*Math.PI*w.y/u.clientHeight)),T.copy(k)}function Qe(o){if(v.length==1)N.set(o.pageX,o.pageY);else{const u=Le(o),P=.5*(o.pageX+u.x),M=.5*(o.pageY+u.y);N.set(P,M)}A.subVectors(N,C).multiplyScalar(e.panSpeed),X(A.x,A.y),C.copy(N)}function Je(o){const u=Le(o),P=o.pageX-u.x,M=o.pageY-u.y,B=Math.sqrt(P*P+M*M);g.set(0,B),O.set(0,Math.pow(g.y/m.y,e.zoomSpeed)),V(O.y),m.copy(g)}function Xt(o){e.enableZoom&&Je(o),e.enablePan&&Qe(o)}function Zt(o){e.enableZoom&&Je(o),e.enableRotate&&qe(o)}function et(o){var u,P;e.enabled!==!1&&(v.length===0&&((u=e.domElement)==null||u.ownerDocument.addEventListener("pointermove",Ne),(P=e.domElement)==null||P.ownerDocument.addEventListener("pointerup",_e)),eo(o),o.pointerType==="touch"?Qt(o):Kt(o))}function Ne(o){e.enabled!==!1&&(o.pointerType==="touch"?Jt(o):qt(o))}function _e(o){var u,P,M;st(o),v.length===0&&((u=e.domElement)==null||u.releasePointerCapture(o.pointerId),(P=e.domElement)==null||P.ownerDocument.removeEventListener("pointermove",Ne),(M=e.domElement)==null||M.ownerDocument.removeEventListener("pointerup",_e)),e.dispatchEvent(f),d=l.NONE}function tt(o){st(o)}function Kt(o){let u;switch(o.button){case 0:u=e.mouseButtons.LEFT;break;case 1:u=e.mouseButtons.MIDDLE;break;case 2:u=e.mouseButtons.RIGHT;break;default:u=-1}switch(u){case ue.DOLLY:if(e.enableZoom===!1)return;Bt(o),d=l.DOLLY;break;case ue.ROTATE:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enablePan===!1)return;He(o),d=l.PAN}else{if(e.enableRotate===!1)return;ae(o),d=l.ROTATE}break;case ue.PAN:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enableRotate===!1)return;ae(o),d=l.ROTATE}else{if(e.enablePan===!1)return;He(o),d=l.PAN}break;default:d=l.NONE}d!==l.NONE&&e.dispatchEvent(a)}function qt(o){if(e.enabled!==!1)switch(d){case l.ROTATE:if(e.enableRotate===!1)return;Ft(o);break;case l.DOLLY:if(e.enableZoom===!1)return;Vt(o);break;case l.PAN:if(e.enablePan===!1)return;Wt(o);break}}function ot(o){e.enabled===!1||e.enableZoom===!1||d!==l.NONE&&d!==l.ROTATE||(o.preventDefault(),e.dispatchEvent(a),Yt(o),e.dispatchEvent(f))}function $e(o){e.enabled===!1||e.enablePan===!1||Ut(o)}function Qt(o){switch(rt(o),v.length){case 1:switch(e.touches.ONE){case pe.ROTATE:if(e.enableRotate===!1)return;Xe(),d=l.TOUCH_ROTATE;break;case pe.PAN:if(e.enablePan===!1)return;Ze(),d=l.TOUCH_PAN;break;default:d=l.NONE}break;case 2:switch(e.touches.TWO){case pe.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Gt(),d=l.TOUCH_DOLLY_PAN;break;case pe.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ht(),d=l.TOUCH_DOLLY_ROTATE;break;default:d=l.NONE}break;default:d=l.NONE}d!==l.NONE&&e.dispatchEvent(a)}function Jt(o){switch(rt(o),d){case l.TOUCH_ROTATE:if(e.enableRotate===!1)return;qe(o),e.update();break;case l.TOUCH_PAN:if(e.enablePan===!1)return;Qe(o),e.update();break;case l.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Xt(o),e.update();break;case l.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Zt(o),e.update();break;default:d=l.NONE}}function nt(o){e.enabled!==!1&&o.preventDefault()}function eo(o){v.push(o)}function st(o){delete _[o.pointerId];for(let u=0;u<v.length;u++)if(v[u].pointerId==o.pointerId){v.splice(u,1);return}}function rt(o){let u=_[o.pointerId];u===void 0&&(u=new Z,_[o.pointerId]=u),u.set(o.pageX,o.pageY)}function Le(o){const u=o.pointerId===v[0].pointerId?v[1]:v[0];return _[u.pointerId]}r!==void 0&&this.connect(r),this.update()}};const Ln=new $,jt=x.forwardRef(function({start:s=[0,0,0],end:r=[0,0,0],mid:e,segments:c=20,...a},f){const l=x.useRef(null),[d]=x.useState(()=>new uo(void 0,void 0,void 0)),y=x.useCallback((h,p,b,T=20)=>(h instanceof $?d.v0.copy(h):d.v0.set(...h),p instanceof $?d.v2.copy(p):d.v2.set(...p),b instanceof $?d.v1.copy(b):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(Ln.set(0,d.v0.y-d.v2.y,0))),d.getPoints(T)),[]);x.useLayoutEffect(()=>{l.current.setPoints=(h,p,b)=>{const T=y(h,p,b);l.current.geometry&&l.current.geometry.setPositions(T.map(k=>k.toArray()).flat())}},[]);const i=x.useMemo(()=>y(s,r,e,c),[s,r,e,c]);return x.createElement(_o,F({ref:$o([l,f]),points:i},a))}),Dn=x.forwardRef(({makeDefault:t,camera:s,regress:r,domElement:e,enableDamping:c=!0,onChange:a,onStart:f,onEnd:l,...d},y)=>{const i=q(g=>g.invalidate),h=q(g=>g.camera),p=q(g=>g.gl),b=q(g=>g.events),T=q(g=>g.setEvents),k=q(g=>g.set),w=q(g=>g.get),C=q(g=>g.performance),N=s||h,A=e||b.connected||p.domElement,m=x.useMemo(()=>new $n(N),[N]);return Ae(()=>{m.enabled&&m.update()},-1),x.useEffect(()=>(m.connect(A),()=>void m.dispose()),[A,r,m,i]),x.useEffect(()=>{const g=L=>{i(),r&&C.regress(),a&&a(L)},O=L=>{f&&f(L)},I=L=>{l&&l(L)};return m.addEventListener("change",g),m.addEventListener("start",O),m.addEventListener("end",I),()=>{m.removeEventListener("start",O),m.removeEventListener("end",I),m.removeEventListener("change",g)}},[a,f,l,m,i,T]),x.useEffect(()=>{if(t){const g=w().controls;return k({controls:m}),()=>k({controls:g})}},[t,m]),x.createElement("primitive",F({ref:y,object:m,enableDamping:c},d))});function In(t){const s=t+"Geometry";return x.forwardRef(({args:r,children:e,...c},a)=>x.createElement("mesh",F({ref:a},c),x.createElement(s,{attach:"geometry",args:r}),e))}const zn=In("circle"),vt=t=>{const s=x.useRef();return x.useEffect(()=>{s.current=t}),s.current},Q=10,Rn=2,Bn=2,Et=10,Pt=(t,s,r)=>{const a=new $().subVectors(s,t).normalize().multiplyScalar(r);return new $().addVectors(t,a)},zt=({links:t,nodes:s})=>{const r=x.useRef(null),{camera:e}=q(),c=new $,a=new $,f=new $,l=new $,d=new $,y=new $,i=new $,h=new $;return Ae(()=>{r.current&&s&&r.current.children.forEach((p,b)=>{var g,O,I,L;const T=t[b];if(!T)return;const k=s.find(D=>D.ref_id===T.source),w=s.find(D=>D.ref_id===T.target);c.set((w==null?void 0:w.x)||0,(w==null?void 0:w.y)||0,(w==null?void 0:w.z)||0),a.set((k==null?void 0:k.x)||0,(k==null?void 0:k.y)||0,(k==null?void 0:k.z)||0);const C=p.children[0],N=p.children[1],A=p.children[2],m=p.children[3];if((w==null?void 0:w.ref_id)===(k==null?void 0:k.ref_id)){const[D,v,_]=Mo(c);(g=C.setPoints)==null||g.call(C,c,_,D),(O=N.setPoints)==null||O.call(N,_,a,D),A.position.set(_.x,_.y,v.z),A.lookAt(D),A.rotateX(-Math.PI/2),m.position.set(_.x,_.y,v.z),m.lookAt(e.position)}else{h.copy(Pt(c,a,Q)),i.copy(Pt(a,c,Q+.5)),f.lerpVectors(h,i,.5);const D=30;l.subVectors(i,h).normalize().multiplyScalar(D/2),d.subVectors(f,l),y.addVectors(f,l),(I=C.setPoints)==null||I.call(C,h,d,f),(L=N.setPoints)==null||L.call(N,y,i,f),A.position.set(i.x,i.y,i.z),A.lookAt(h),A.rotateX(-Math.PI/2),m.position.set(f.x,f.y,f.z),m.lookAt(e.position);let v=Math.atan2(i.y-h.y,i.x-h.x);(v>Math.PI/2||v<-Math.PI/2)&&(v+=Math.PI),m.rotation.set(0,0,v);const _=h.distanceTo(i),ie=_<D?2:4;_<D?m.text=Re(T.edge_type,Et):m.text=T.edge_type,m.fontSize=ie}})}),n.jsx("group",{ref:r,children:t.map(p=>n.jsxs("group",{children:[n.jsx(jt,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),n.jsx(jt,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),n.jsxs("mesh",{position:new $(0,0,0),children:[n.jsx("coneGeometry",{args:[Rn,Bn,32]}),n.jsx("meshBasicMaterial",{color:"white"})]}),n.jsx(Lt,{anchorX:"center",anchorY:"middle",color:"white",fontSize:4,lineHeight:1,maxWidth:20,rotation:[0,0,0],textAlign:"center",children:Re(p.edge_type,Et)})]},p.ref_id))})};zt.displayName="Lines";const Fn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"],Vn=R.div`
  color: white;
  background: rgba(0, 0, 0, 1);
  padding: 2px 5px;
  border-radius: 4px;
  word-wrap: break-word;
  text-align: center;
  white-space: nowrap;
  visibility: visible;
  font-size: 12px;
  font-style: normal;
  font-weight: 400;
`,Wn=R(Lo)`
  position: absolute;
`;new po(2,2,2);const Rt=x.memo(({node:t,setSelectedNode:s,onSimulationUpdate:r,isSelected:e})=>{var k;const c=x.useRef(null),[a,f]=x.useState(!1);console.log(e);const{size:l,camera:d}=q(),y=vo(w=>{const{xy:[C,N],down:A,dragging:m,first:g,elapsedTime:O}=w;if(!(!m||g||O<100)&&A&&c.current){r();const I=(C-l.left)/window.innerWidth*l.width,L=(N-l.top)/window.innerHeight*l.height,_=new $(I/l.width*2-1,-L/l.height*2+1,0).unproject(d).multiply(new $(1,1,0)).clone();t.fx=_.x,t.fy=_.y}});Ae(()=>{c.current&&c.current.position.set(t.x||0,t.y||0,0)});const i=Fn[(k=t==null?void 0:t.children)==null?void 0:k.length]||"red",h=w=>{w.stopPropagation(),s()},p=Re(t.type||"",Q),b=()=>{f(!0)},T=()=>{f(!1)};return n.jsxs("mesh",{ref:c,onClick:h,...y(),onPointerOut:T,onPointerOver:b,position:new $(t.x,t.y,0),children:[n.jsx(zn,{args:[Q,30,20],children:n.jsx("meshStandardMaterial",{attach:"material",color:i})}),n.jsx(Lt,{...Io,clipRect:[-Q,-Q,Q,Q],color:"#000",fontSize:2,maxWidth:Q*2,textAlign:"center",children:p}),a&&n.jsx(Wn,{position:[0,5,0],zIndexRange:[100,0],children:n.jsx(Vn,{children:t.type})})]})});Rt.displayName="Node";const Yn=({simulation:t,setSelectedSchemaId:s,selectedId:r,setIsAddEdgeNode:e})=>{const[c]=It(f=>[f.schemas]),a=()=>{t&&(t.alpha(.05),t.restart())};return n.jsx(n.Fragment,{children:c.map((f,l)=>{const d=t.nodes()[l];return d?n.jsx(Rt,{isSelected:d.ref_id===r,node:d,onSimulationUpdate:a,setSelectedNode:()=>{e(!1),s(d.ref_id)}},d.ref_id):null})})},Un=({schemasWithPositions:t,filteredLinks:s,setSelectedSchemaId:r,selectedSchemaId:e,setIsAddEdgeNode:c})=>{const[a,f]=x.useState(null),l=vt(t),d=vt(s);return x.useEffect(()=>{if(!t.length||!s.length)return;const y=structuredClone(t),i=structuredClone(s);if(a){l&&l.length!==t.length&&d&&d.length!==s.length&&(a.nodes(y).force("link",dt(i).id(p=>p.ref_id)).force("charge",ut()).force("center",pt()).force("collide",ft(Q+1)).alpha(.5).restart(),f({...a}));return}const h=fo(y).force("link",dt(i).id(p=>p.ref_id)).force("charge",ut()).force("center",pt()).force("collide",ft(0));f(h)},[t,a,s,l,d]),Ae(()=>{}),a?n.jsxs(n.Fragment,{children:[n.jsx(zt,{links:s,nodes:a.nodes()}),n.jsx(Yn,{selectedId:e,setIsAddEdgeNode:c,setSelectedSchemaId:r,simulation:a})]}):null},ze=new ho(0),Gn=({selectedSchemaId:t,links:s,schemasWithPositions:r,setSelectedSchemaId:e,setIsAddEdgeNode:c})=>n.jsxs(Do,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[n.jsx("color",{args:[ze.r,ze.g,ze.b],attach:"background"}),mo&&n.jsx(zo,{position:"right-bottom"}),n.jsx(Dn,{enableRotate:!1,enableZoom:!0}),n.jsx(Ro,{}),n.jsx(Un,{filteredLinks:s,schemasWithPositions:r,selectedSchemaId:t,setIsAddEdgeNode:c,setSelectedSchemaId:e})]}),Hn=({onCreateNew:t,onAddEdgeNode:s})=>n.jsxs(Xn,{children:[n.jsx(Zn,{children:"BLUEPRINT"}),n.jsxs(kt,{"data-testid":"add-schema-type",onClick:t,children:[n.jsx(Ct,{children:n.jsx(gt,{})}),n.jsx(H,{children:"Add Type"})]}),n.jsxs(kt,{"data-testid":"add-edge",onClick:s,children:[n.jsx(Ct,{children:n.jsx(gt,{})}),n.jsx(H,{children:"Add Edge"})]})]}),Xn=R(j).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${z.BG2};
  max-height: 100vh;
  border-top-left-radius: 9px;
  border-bottom-left-radius: 9px;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,kt=R(j).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${z.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${H} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${z.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${z.primaryBlue};
    }

    ${H} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${z.white};
    background: ${z.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${z.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Zn=R(j)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${z.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${z.white};
`,Ct=R(j)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,Kn={type:"",parent:""},Tt=({onSelect:t,dataTestId:s})=>{const r=Ge({mode:"onChange",defaultValues:Kn}),{watch:e,setValue:c}=r,[a,f]=x.useState([]),[l,d]=x.useState(!1),y=b=>{c("parent",(b==null?void 0:b.value)||""),t(b==null?void 0:b.value)},i=b=>b.charAt(0).toUpperCase()+b.slice(1);x.useEffect(()=>{(async()=>{d(!0);try{const k=(await Nt()).schemas.filter(w=>!w.is_deleted&&w.type).map(w=>(w==null?void 0:w.type)==="thing"?{label:"No Parent",value:w.type}:{label:i(w.type),value:w.type});f(k)}catch(T){console.warn(T)}finally{d(!1)}})()},[]);const h=e("parent"),p=()=>a==null?void 0:a.find(b=>b.value===h);return n.jsx(Te,{dataTestId:s,isLoading:l,onSelect:y,options:a||ko,selectedValue:p()})},qn=({selectedType:t,setSelectedFromNode:s,setSelectedToNode:r})=>n.jsxs(j,{children:[n.jsx(j,{align:"center",direction:"row",justify:"space-between",mb:35,children:n.jsx(j,{align:"center",direction:"row",children:n.jsx(Qn,{children:"Add Edge"})})}),n.jsxs(j,{mb:25,children:[n.jsx(j,{mb:12,children:n.jsx(H,{children:"Source"})}),n.jsx(Tt,{dataTestId:"from_node",onSelect:s})]}),n.jsxs(j,{mb:10,children:[n.jsx(j,{mb:12,children:n.jsx(H,{children:"Edge Name"})}),n.jsx(j,{mb:12,children:n.jsx(Oe,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...ke},value:t})})]}),n.jsxs(j,{mb:25,children:[n.jsx(j,{mb:12,children:n.jsx(H,{children:"Destination"})}),n.jsx(Tt,{dataTestId:"to_node",onSelect:r})]})]}),Qn=R(H)`
  font-size: 22px;
  font-weight: 600;
`,Jn=({onCancel:t})=>{const s=Ge({mode:"onChange"}),[r,e]=x.useState(!1),[c,a]=x.useState(""),[f,l]=x.useState(""),[d,y]=x.useState(""),i=s.watch("type");x.useEffect(()=>{a(i)},[i]);const h=s.handleSubmit(async b=>{if(!d||!f)return;e(!0);const T={source:f,target:d,edge_type:b.type};try{await go(T)}catch(k){console.warn("API Error:",k)}finally{e(!1),t()}}),p=r||!d||!f||!c;return n.jsx($t,{...s,children:n.jsxs("form",{id:"add-type-form",onSubmit:h,children:[n.jsx(qn,{selectedType:c,setSelectedFromNode:l,setSelectedToNode:y}),n.jsxs(es,{color:"secondary",disabled:p,onClick:h,size:"large",variant:"contained",children:["Confirm",r&&n.jsxs(ts,{children:[" ",n.jsx(be,{color:z.lightGray,size:12})," "]})]})]})})},es=R(Me)`
  width: 293px !important;
  margin: 0 0 10px auto !important;
`,ts=R.span`
  margin-top: 2px;
`,os=({setIsAddEdgeNode:t})=>{const s=()=>{t(!1)};return n.jsxs(j,{children:[n.jsx(j,{direction:"row",justify:"flex-end",children:n.jsx(ns,{"data-testid":"close-sidebar-sub-view",onClick:s,children:n.jsx(_t,{})})}),n.jsx(Jn,{onCancel:s})]})},ns=R(j)`
  font-size: 32px;
  color: ${z.white};
  cursor: pointer;
`,ss=()=>{const[t,s]=x.useState(""),[r,e]=x.useState(!1),[c,a]=x.useState(!1),[f,l]=x.useState(!1),[d,y]=x.useState(!1),[i,h,p,b]=It(m=>[m.schemas,m.links,m.setSchemas,m.setSchemaLinks]);x.useEffect(()=>{(async()=>{a(!0);try{const g=await ht();p(g.schemas.filter(O=>O.ref_id&&!O.is_deleted&&O.ref_id)),b(g.edges),a(!1)}catch(g){console.error("Error fetching data:",g),a(!1)}})()},[p,b]);const T=m=>{if(i.some(O=>O.ref_id===m.ref_id))p(i.map(O=>O.ref_id===m.ref_id?{...m,children:[]}:O));else{p([...i,{...m,children:[]}]);const O=i.find(I=>m.parent===I.type);b([...h,{ref_id:`new-link-${h.length}`,edge_type:"CHILD_OF",source:m.ref_id||"new",target:(O==null?void 0:O.ref_id)||"new"}])}},k=async()=>{const m=await ht();p(m.schemas.filter(g=>g.ref_id&&!g.is_deleted&&g.ref_id)),b(m.edges)},w=m=>{p(i.filter(g=>g.type!==m))},C=i.map(m=>({...m,children:i.filter(g=>g.parent===m.type).map(g=>g.ref_id||"")})),N=h.filter(m=>m.edge_type==="CHILD_OF"&&C.some(g=>g.ref_id===m.source)&&C.some(g=>g.ref_id===m.target)),A=i.find(m=>m.ref_id===t)||null;return c?n.jsx(j,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(be,{color:z.white})}):n.jsx(n.Fragment,{children:n.jsxs(j,{align:"stretch",direction:"row",grow:1,children:[n.jsx(j,{ml:-20,my:-20,children:n.jsx(Hn,{onAddEdgeNode:()=>{l(!0),e(!1),s("")},onCreateNew:()=>{l(!1),e(!0),s("")}})}),n.jsx(j,{children:A||r?n.jsx(Ot,{children:n.jsx(St,{children:n.jsx(On,{graphLoading:d,onDelete:w,onSchemaCreate:T,onSchemaUpdate:k,selectedSchema:A,setGraphLoading:y,setIsCreateNew:e,setSelectedSchemaId:s})})}):null}),n.jsx(j,{children:f?n.jsx(Ot,{children:n.jsx(St,{children:n.jsx(os,{setIsAddEdgeNode:l})})}):null}),n.jsx(rs,{direction:"row",grow:1,children:n.jsx(is,{children:d?n.jsx(j,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(be,{color:z.white})}):n.jsx(Gn,{links:N,schemasWithPositions:C,selectedSchemaId:t,setIsAddEdgeNode:l,setSelectedSchemaId:s})})})]})})},rs=R(j)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  padding: 10px;
  max-height: 80vh;

  @media (max-width: 1440px) {
    max-height: 85vh;
  }

  @media (max-width: 1024px) {
    max-height: 70vh;
  }
`,Ot=R(j)`
  width: 100%;
  max-width: 400px;
  background: ${z.BG1};
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,St=R.div`
  height: 100%;
  overflow-y: auto;
  padding: 16px;
`,is=R(j)`
  flex: 1 1 100%;
`,as=()=>{const{close:t}=At("blueprintGraph"),s=()=>{t()};return n.jsx(xo,{background:"black",id:"blueprintGraph",kind:"full",onClose:s,preventOutsideClose:!0,children:n.jsx(ss,{})})},Ns=x.memo(as);export{Ns as BlueprintModal};
