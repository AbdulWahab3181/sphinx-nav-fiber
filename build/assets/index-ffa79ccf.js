import{g as Me,a as $e,s as oe,_ as N,a9 as It,r as w,b as De,j as s,d as Re,c as te,e as Ae,u as ft,aM as zt,b4 as ye,b5 as Ne,a7 as tt,b6 as Bt,b7 as Ft,a0 as Vt,f as V,F as S,h as I,D as mt,a_ as Yt,T as J,B as gt,aY as Te,N as Oe,a$ as Ut,b8 as Gt,b9 as Wt,ba as Ht,Z as M,bb as se,bc as ae,ap as ot,bd as ge,be,bf as nt,bg as U,bh as Zt,ar as Kt,bi as st,bj as at,bk as it,bl as rt,bm as Xt,am as qt,W as Qt,bn as Jt}from"./index-df064103.js";import{B as eo}from"./index-ff675c0b.js";import{q as to,r as oo,i as no,C as Le,I as so,B as _e,c as ao,b as io,F as ro,s as co}from"./react-toastify.esm-ce8a56f6.js";import{e as lo,A as bt}from"./index-27fd63f3.js";import{T as xt}from"./index-b470549c.js";import{c as ct,d as uo}from"./index-500704ab.js";import{D as po,P as ho}from"./PlusIcon-34289c21.js";import{p as fo,c as mo}from"./index-30d16895.js";import{u as go}from"./Popover-3af25b50.js";import{u as bo}from"./index-ad77e47a.js";import{L as xo,m as yo,u as X,b as we,T as wo,C as vo}from"./constant-729bf437.js";import{f as jo,P as Eo,L as ko}from"./constants-70ee225e.js";import{A as Po}from"./AddContentIcon-87897faa.js";import"./useSlotProps-53ce33e6.js";import"./Popper-4bfb7f91.js";import"./index.esm-df329d64.js";import"./InfoIcon-8635b005.js";import"./generateCategoricalChart-ab08e949.js";import"./NoFilterResultIcon-62294b14.js";import"./index-ec247264.js";import"./index-fb9d048b.js";import"./CheckIcon-393bd5e9.js";function Co(t){return Me("PrivateSwitchBase",t)}$e("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const So=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],To=t=>{const{classes:n,checked:i,disabled:e,edge:r}=t,c={root:["root",i&&"checked",e&&"disabled",r&&`edge${te(r)}`],input:["input"]};return Ae(c,Co,n)},Oo=oe(to)(({ownerState:t})=>N({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Mo=oe("input",{shouldForwardProp:It})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),$o=w.forwardRef(function(n,i){const{autoFocus:e,checked:r,checkedIcon:c,className:p,defaultChecked:a,disabled:u,disableFocusRipple:x=!1,edge:l=!1,icon:h,id:f,inputProps:k,inputRef:P,name:m,onBlur:j,onChange:v,onFocus:$,readOnly:L,required:T=!1,tabIndex:E,type:R,value:B}=n,D=De(n,So),[Y,g]=bo({controlled:r,default:!!a,name:"SwitchBase",state:"checked"}),O=go(),G=F=>{$&&$(F),O&&O.onFocus&&O.onFocus(F)},_=F=>{j&&j(F),O&&O.onBlur&&O.onBlur(F)},re=F=>{if(F.nativeEvent.defaultPrevented)return;const ce=F.target.checked;g(ce),v&&v(F,ce)};let q=u;O&&typeof q>"u"&&(q=O.disabled);const he=R==="checkbox"||R==="radio",ne=N({},n,{checked:Y,disabled:q,disableFocusRipple:x,edge:l}),W=To(ne);return s.jsxs(Oo,N({component:"span",className:Re(W.root,p),centerRipple:!0,focusRipple:!x,disabled:q,tabIndex:null,role:void 0,onFocus:G,onBlur:_,ownerState:ne,ref:i},D,{children:[s.jsx(Mo,N({autoFocus:e,checked:r,defaultChecked:a,className:W.input,disabled:q,id:he?f:void 0,name:m,onChange:re,readOnly:L,ref:P,required:T,ownerState:ne,tabIndex:E,type:R},R==="checkbox"&&B===void 0?{}:{value:B},k)),Y?c:h]}))}),Do=$o,Ro=w.createContext(),lt=Ro;function Ao(t){return Me("MuiGrid",t)}const No=[0,1,2,3,4,5,6,7,8,9,10],Lo=["column-reverse","column","row-reverse","row"],_o=["nowrap","wrap-reverse","wrap"],ue=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Io=$e("MuiGrid",["root","container","item","zeroMinWidth",...No.map(t=>`spacing-xs-${t}`),...Lo.map(t=>`direction-xs-${t}`),..._o.map(t=>`wrap-xs-${t}`),...ue.map(t=>`grid-xs-${t}`),...ue.map(t=>`grid-sm-${t}`),...ue.map(t=>`grid-md-${t}`),...ue.map(t=>`grid-lg-${t}`),...ue.map(t=>`grid-xl-${t}`)]),pe=Io,zo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function ie(t){const n=parseFloat(t);return`${n}${String(t).replace(String(n),"")||"px"}`}function Bo({theme:t,ownerState:n}){let i;return t.breakpoints.keys.reduce((e,r)=>{let c={};if(n[r]&&(i=n[r]),!i)return e;if(i===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(i==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=ye({values:n.columns,breakpoints:t.breakpoints.values}),a=typeof p=="object"?p[r]:p;if(a==null)return e;const u=`${Math.round(i/a*1e8)/1e6}%`;let x={};if(n.container&&n.item&&n.columnSpacing!==0){const l=t.spacing(n.columnSpacing);if(l!=="0px"){const h=`calc(${u} + ${ie(l)})`;x={flexBasis:h,maxWidth:h}}}c=N({flexBasis:u,flexGrow:0,maxWidth:u},x)}return t.breakpoints.values[r]===0?Object.assign(e,c):e[t.breakpoints.up(r)]=c,e},{})}function Fo({theme:t,ownerState:n}){const i=ye({values:n.direction,breakpoints:t.breakpoints.values});return Ne({theme:t},i,e=>{const r={flexDirection:e};return e.indexOf("column")===0&&(r[`& > .${pe.item}`]={maxWidth:"none"}),r})}function yt({breakpoints:t,values:n}){let i="";Object.keys(n).forEach(r=>{i===""&&n[r]!==0&&(i=r)});const e=Object.keys(t).sort((r,c)=>t[r]-t[c]);return e.slice(0,e.indexOf(i))}function Vo({theme:t,ownerState:n}){const{container:i,rowSpacing:e}=n;let r={};if(i&&e!==0){const c=ye({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=yt({breakpoints:t.breakpoints.values,values:c})),r=Ne({theme:t},c,(a,u)=>{var x;const l=t.spacing(a);return l!=="0px"?{marginTop:`-${ie(l)}`,[`& > .${pe.item}`]:{paddingTop:ie(l)}}:(x=p)!=null&&x.includes(u)?{}:{marginTop:0,[`& > .${pe.item}`]:{paddingTop:0}}})}return r}function Yo({theme:t,ownerState:n}){const{container:i,columnSpacing:e}=n;let r={};if(i&&e!==0){const c=ye({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=yt({breakpoints:t.breakpoints.values,values:c})),r=Ne({theme:t},c,(a,u)=>{var x;const l=t.spacing(a);return l!=="0px"?{width:`calc(100% + ${ie(l)})`,marginLeft:`-${ie(l)}`,[`& > .${pe.item}`]:{paddingLeft:ie(l)}}:(x=p)!=null&&x.includes(u)?{}:{width:"100%",marginLeft:0,[`& > .${pe.item}`]:{paddingLeft:0}}})}return r}function Uo(t,n,i={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[i[`spacing-xs-${String(t)}`]];const e=[];return n.forEach(r=>{const c=t[r];Number(c)>0&&e.push(i[`spacing-${r}-${String(c)}`])}),e}const Go=oe("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:i}=t,{container:e,direction:r,item:c,spacing:p,wrap:a,zeroMinWidth:u,breakpoints:x}=i;let l=[];e&&(l=Uo(p,x,n));const h=[];return x.forEach(f=>{const k=i[f];k&&h.push(n[`grid-${f}-${String(k)}`])}),[n.root,e&&n.container,c&&n.item,u&&n.zeroMinWidth,...l,r!=="row"&&n[`direction-xs-${String(r)}`],a!=="wrap"&&n[`wrap-xs-${String(a)}`],...h]}})(({ownerState:t})=>N({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Fo,Vo,Yo,Bo);function Wo(t,n){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const i=[];return n.forEach(e=>{const r=t[e];if(Number(r)>0){const c=`spacing-${e}-${String(r)}`;i.push(c)}}),i}const Ho=t=>{const{classes:n,container:i,direction:e,item:r,spacing:c,wrap:p,zeroMinWidth:a,breakpoints:u}=t;let x=[];i&&(x=Wo(c,u));const l=[];u.forEach(f=>{const k=t[f];k&&l.push(`grid-${f}-${String(k)}`)});const h={root:["root",i&&"container",r&&"item",a&&"zeroMinWidth",...x,e!=="row"&&`direction-xs-${String(e)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...l]};return Ae(h,Ao,n)},Zo=w.forwardRef(function(n,i){const e=ft({props:n,name:"MuiGrid"}),{breakpoints:r}=zt(),c=lo(e),{className:p,columns:a,columnSpacing:u,component:x="div",container:l=!1,direction:h="row",item:f=!1,rowSpacing:k,spacing:P=0,wrap:m="wrap",zeroMinWidth:j=!1}=c,v=De(c,zo),$=k||P,L=u||P,T=w.useContext(lt),E=l?a||12:T,R={},B=N({},v);r.keys.forEach(g=>{v[g]!=null&&(R[g]=v[g],delete B[g])});const D=N({},c,{columns:E,container:l,direction:h,item:f,rowSpacing:$,columnSpacing:L,wrap:m,zeroMinWidth:j,spacing:P},R,{breakpoints:r.keys}),Y=Ho(D);return s.jsx(lt.Provider,{value:E,children:s.jsx(Go,N({ownerState:D,className:Re(Y.root,p),as:x,ref:i},B))})}),ee=Zo;function Ko(t){return Me("MuiSwitch",t)}const Xo=$e("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),z=Xo,qo=["className","color","edge","size","sx"],Qo=t=>{const{classes:n,edge:i,size:e,color:r,checked:c,disabled:p}=t,a={root:["root",i&&`edge${te(i)}`,`size${te(e)}`],switchBase:["switchBase",`color${te(r)}`,c&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=Ae(a,Ko,n);return N({},n,u)},Jo=oe("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:i}=t;return[n.root,i.edge&&n[`edge${te(i.edge)}`],n[`size${te(i.size)}`]]}})(({ownerState:t})=>N({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${z.thumb}`]:{width:16,height:16},[`& .${z.switchBase}`]:{padding:4,[`&.${z.checked}`]:{transform:"translateX(16px)"}}})),en=oe(Do,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,n)=>{const{ownerState:i}=t;return[n.switchBase,{[`& .${z.input}`]:n.input},i.color!=="default"&&n[`color${te(i.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${z.checked}`]:{transform:"translateX(20px)"},[`&.${z.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${z.checked} + .${z.track}`]:{opacity:.5},[`&.${z.disabled} + .${z.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${z.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:n})=>N({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:tt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},n.color!=="default"&&{[`&.${z.checked}`]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:tt(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${z.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${n.color}DisabledColor`]:`${t.palette.mode==="light"?Bt(t.palette[n.color].main,.62):Ft(t.palette[n.color].main,.55)}`}},[`&.${z.checked} + .${z.track}`]:{backgroundColor:(t.vars||t).palette[n.color].main}})),tn=oe("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,n)=>n.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),on=oe("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,n)=>n.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),nn=w.forwardRef(function(n,i){const e=ft({props:n,name:"MuiSwitch"}),{className:r,color:c="primary",edge:p=!1,size:a="medium",sx:u}=e,x=De(e,qo),l=N({},e,{color:c,edge:p,size:a}),h=Qo(l),f=s.jsx(on,{className:h.thumb,ownerState:l});return s.jsxs(Jo,{className:Re(h.root,r),sx:u,ownerState:l,children:[s.jsx(en,N({type:"checkbox",icon:f,checkedIcon:f,ref:i,ownerState:l},x,{classes:N({},h,{root:h.switchBase})})),s.jsx(tn,{className:h.track,ownerState:l})]})}),sn=nn,an={schemas:[],links:[]},wt=Vt(t=>({...an,setSchemas:n=>{t({schemas:n})},setSchemaLinks:n=>{t({links:n})}})),rn=/^[a-z0-9_]+$/,cn=({parentParam:t})=>{const[n,i]=w.useState(!1),[e,r]=w.useState([]),{fields:c,append:p,replace:a,remove:u}=oo({name:"attributes"}),{setValue:x,watch:l}=no();return w.useEffect(()=>{const h=async()=>{try{let f=[{required:!1,type:"string",key:""}];if(t!==uo.value.toLowerCase()){i(!0);const k=await Yt(t);f=fo(k)}a(f),r(f)}catch(f){console.warn(f)}finally{i(!1)}};e.length===0&&h()},[t,x,a,e.length]),s.jsxs(s.Fragment,{children:[n?s.jsx(S,{align:"center",children:s.jsx(Le,{color:I.SECONDARY_BLUE,size:"30"})}):s.jsx(ln,{py:8,children:s.jsx(ee,{container:!0,spacing:2,children:c.map((h,f)=>{const k=l(`attributes[${f}].type`),P=l(`attributes[${f}].required`),m=h.isNew||!1,j=["name"].includes(l(`attributes[${f}].key`));return s.jsxs(w.Fragment,{children:[s.jsx(ee,{item:!0,xs:5,children:s.jsx(xt,{autoComplete:"off",className:"text-input",disabled:!m,id:"cy-item-name",maxLength:50,name:`attributes.${f}.key`,placeholder:"Enter value",rules:{...mt,pattern:{message:"Please avoid special characters, spaces and uppercase",value:rn}}})}),s.jsx(ee,{item:!0,xs:4,children:s.jsx(bt,{disabled:j,onSelect:v=>x(`attributes[${f}].type`,v==null?void 0:v.value),options:ct,selectedValue:ct.find(v=>v.value===k)})}),s.jsxs(ee,{item:!0,xs:3,children:[s.jsx(sn,{checked:P,disabled:j,name:`attributes.${f}.required`,onChange:v=>x(`attributes[${f}].required`,v.target.checked),size:"small"}),!j&&s.jsx(so,{onClick:()=>u(f),children:s.jsx(po,{})})]})]},h.id)})})}),s.jsx(S,{align:"flex-start",py:12,children:s.jsx(_e,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(ho,{}),variant:"contained",children:"Add Attribute"})})]})},ln=V(S)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,dn=({parent:t})=>{const n=t;return s.jsxs(S,{children:[s.jsx(S,{direction:"row",mb:10,children:s.jsxs(ee,{container:!0,spacing:2,children:[s.jsx(ee,{item:!0,xs:5,children:s.jsx(Ce,{style:{marginRight:180},children:"Attributes"})}),s.jsx(ee,{item:!0,xs:4,children:s.jsx(Ce,{style:{marginRight:130},children:"Type"})}),s.jsx(ee,{item:!0,xs:3,children:s.jsx(Ce,{children:"Required"})})]})}),n&&s.jsx(cn,{parentParam:n},n)]})},Ce=V(J)`
  font-size: 15px;
  color: gray;
`,un={type:"",parent:""},pn=async(t,n=!1)=>{try{const{attributes:i,...e}=t,r={...e,attributes:mo(i)};let c;if(n?c=await Oe.put("/schema",JSON.stringify(r),{}):c=await Oe.post("/schema",JSON.stringify({...r,node_key:"name"}),{}),c.status!=="success")throw new Error("error");return c==null?void 0:c.ref_id}catch(i){let e=Te;if(i.status===400){const r=await i.json();e=r.errorCode||(r==null?void 0:r.status)||Te}else i instanceof Error&&(e=i.message);throw new Error(e)}},hn=({onSchemaCreate:t,selectedSchema:n,onDelete:i,setSelectedSchemaId:e,setIsCreateNew:r})=>{const{close:c,visible:p}=gt("addType"),a=ao({mode:"onChange",defaultValues:n?{type:n.type,parent:n.parent}:un}),{watch:u,setValue:x,reset:l}=a,[h,f]=w.useState(!1),[k,P]=w.useState(!1),[m,j]=w.useState(null),[v,$]=w.useState(!1);w.useEffect(()=>()=>{l()},[p,l]);const L=()=>{r(!1),e("")},T=g=>g.charAt(0).toUpperCase()+g.slice(1);w.useEffect(()=>{n||(async()=>{P(!0);try{const G=(await Ut()).schemas.filter(_=>!_.is_deleted&&_.type).map(_=>(_==null?void 0:_.type)==="thing"?{label:"No Parent",value:_.type}:{label:T(_.type),value:_.type});j(G)}catch(O){console.warn(O)}finally{P(!1)}})()},[n]);const E=u("parent"),R=()=>{c()},B=async()=>{if(n!=null&&n.type)try{await Oe.delete(`/schema/${n.ref_id}`),i(n.type),c()}catch(g){console.warn(g)}finally{r(!1)}},D=a.handleSubmit(async g=>{if(!E){$(!0);return}f(!1);try{const O=await pn({...g,...n?{ref_id:n==null?void 0:n.ref_id}:{}},!!n);t({type:g.type,parent:E||"",ref_id:(n==null?void 0:n.ref_id)||O||"new"}),R()}catch(O){if((O==null?void 0:O.status)===400){const G=await O.json();G.errorCode||G!=null&&G.status||Te}else O instanceof Error&&O.message}finally{f(!1),r(!1)}}),Y=()=>m==null?void 0:m.find(g=>g.value===E);return s.jsxs(S,{children:[s.jsx(S,{direction:"row",justify:"flex-end",children:s.jsx(mn,{"data-testid":"close-sidebar-sub-view",onClick:L,children:s.jsx(io,{})})}),s.jsx(S,{children:s.jsx(ro,{...a,children:s.jsxs("form",{id:"add-type-form",onSubmit:D,children:[s.jsx(S,{children:n?s.jsxs(s.Fragment,{children:[n.parent?s.jsx(S,{mb:12,children:s.jsxs(J,{kind:"headingBold",children:["Parent: ",n.parent]})}):null,s.jsx(S,{mb:12,children:s.jsxs(J,{kind:"headingBold",children:["Type: ",n.type]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(S,{mb:12,children:[s.jsx(S,{mb:12,children:s.jsx(J,{children:"Select Parent"})}),s.jsx(bt,{isLoading:k,onSelect:g=>{x("parent",(g==null?void 0:g.value)||""),$(!1)},options:m,selectedValue:Y()}),v&&s.jsx(gn,{children:"A parent type must be selected"})]}),s.jsxs(S,{children:[s.jsx(S,{mb:12,children:s.jsx(J,{children:"Type name"})}),s.jsx(S,{mb:12,children:s.jsx(xt,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...mt},value:E})})]})]})}),s.jsx(dn,{parent:n?n.type:E}),s.jsxs(S,{direction:"row",justify:"space-between",mt:20,children:[n?s.jsx(fn,{color:"secondary",onClick:B,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}):null,s.jsx(_e,{color:"secondary",disabled:h||v,onClick:D,size:"large",startIcon:h?s.jsx(Le,{color:I.white,size:24}):null,variant:"contained",children:"Save"})]})]})})})]})},fn=V(_e)`
  && {
    color: ${I.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${I.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,mn=V(S)`
  font-size: 32px;
  color: ${I.white};
  cursor: pointer;
`,gn=V(S)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
`;var bn=Object.defineProperty,xn=(t,n,i)=>n in t?bn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,b=(t,n,i)=>(xn(t,typeof n!="symbol"?n+"":n,i),i);const xe=new Gt,dt=new Wt,yn=Math.cos(70*(Math.PI/180)),ut=(t,n)=>(t%n+n)%n;let wn=class extends Ht{constructor(n,i){super(),b(this,"object"),b(this,"domElement"),b(this,"enabled",!0),b(this,"target",new M),b(this,"minDistance",0),b(this,"maxDistance",1/0),b(this,"minZoom",0),b(this,"maxZoom",1/0),b(this,"minPolarAngle",0),b(this,"maxPolarAngle",Math.PI),b(this,"minAzimuthAngle",-1/0),b(this,"maxAzimuthAngle",1/0),b(this,"enableDamping",!1),b(this,"dampingFactor",.05),b(this,"enableZoom",!0),b(this,"zoomSpeed",1),b(this,"enableRotate",!0),b(this,"rotateSpeed",1),b(this,"enablePan",!0),b(this,"panSpeed",1),b(this,"screenSpacePanning",!0),b(this,"keyPanSpeed",7),b(this,"zoomToCursor",!1),b(this,"autoRotate",!1),b(this,"autoRotateSpeed",2),b(this,"reverseOrbit",!1),b(this,"reverseHorizontalOrbit",!1),b(this,"reverseVerticalOrbit",!1),b(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),b(this,"mouseButtons",{LEFT:se.ROTATE,MIDDLE:se.DOLLY,RIGHT:se.PAN}),b(this,"touches",{ONE:ae.ROTATE,TWO:ae.DOLLY_PAN}),b(this,"target0"),b(this,"position0"),b(this,"zoom0"),b(this,"_domElementKeyEvents",null),b(this,"getPolarAngle"),b(this,"getAzimuthalAngle"),b(this,"setPolarAngle"),b(this,"setAzimuthalAngle"),b(this,"getDistance"),b(this,"listenToKeyEvents"),b(this,"stopListenToKeyEvents"),b(this,"saveState"),b(this,"reset"),b(this,"update"),b(this,"connect"),b(this,"dispose"),this.object=n,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>l.phi,this.getAzimuthalAngle=()=>l.theta,this.setPolarAngle=o=>{let d=ut(o,2*Math.PI),y=l.phi;y<0&&(y+=2*Math.PI),d<0&&(d+=2*Math.PI);let C=Math.abs(d-y);2*Math.PI-C<C&&(d<y?d+=2*Math.PI:y+=2*Math.PI),h.phi=d-y,e.update()},this.setAzimuthalAngle=o=>{let d=ut(o,2*Math.PI),y=l.theta;y<0&&(y+=2*Math.PI),d<0&&(d+=2*Math.PI);let C=Math.abs(d-y);2*Math.PI-C<C&&(d<y?d+=2*Math.PI:y+=2*Math.PI),h.theta=d-y,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=o=>{o.addEventListener("keydown",ke),this._domElementKeyEvents=o},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ke),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(r),e.update(),u=a.NONE},this.update=(()=>{const o=new M,d=new M(0,1,0),y=new ot().setFromUnitVectors(n.up,d),C=y.clone().invert(),A=new M,H=new ot,Q=2*Math.PI;return function(){const et=e.object.position;y.setFromUnitVectors(n.up,d),C.copy(y).invert(),o.copy(et).sub(e.target),o.applyQuaternion(y),l.setFromVector3(o),e.autoRotate&&u===a.NONE&&re(G()),e.enableDamping?(l.theta+=h.theta*e.dampingFactor,l.phi+=h.phi*e.dampingFactor):(l.theta+=h.theta,l.phi+=h.phi);let Z=e.minAzimuthAngle,K=e.maxAzimuthAngle;isFinite(Z)&&isFinite(K)&&(Z<-Math.PI?Z+=Q:Z>Math.PI&&(Z-=Q),K<-Math.PI?K+=Q:K>Math.PI&&(K-=Q),Z<=K?l.theta=Math.max(Z,Math.min(K,l.theta)):l.theta=l.theta>(Z+K)/2?Math.max(Z,l.theta):Math.min(K,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(k,e.dampingFactor):e.target.add(k),e.zoomToCursor&&Y||e.object.isOrthographicCamera?l.radius=ve(l.radius):l.radius=ve(l.radius*f),o.setFromSpherical(l),o.applyQuaternion(C),et.copy(e.target).add(o),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(h.theta*=1-e.dampingFactor,h.phi*=1-e.dampingFactor,k.multiplyScalar(1-e.dampingFactor)):(h.set(0,0,0),k.set(0,0,0));let fe=!1;if(e.zoomToCursor&&Y){let le=null;if(e.object instanceof ge&&e.object.isPerspectiveCamera){const de=o.length();le=ve(de*f);const me=de-le;e.object.position.addScaledVector(B,me),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const de=new M(D.x,D.y,0);de.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),fe=!0;const me=new M(D.x,D.y,0);me.unproject(e.object),e.object.position.sub(me).add(de),e.object.updateMatrixWorld(),le=o.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;le!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(le).add(e.object.position):(xe.origin.copy(e.object.position),xe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(xe.direction))<yn?n.lookAt(e.target):(dt.setFromNormalAndCoplanarPoint(e.object.up,e.target),xe.intersectPlane(dt,e.target))))}else e.object instanceof be&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),fe=!0);return f=1,Y=!1,fe||A.distanceToSquared(e.object.position)>x||8*(1-H.dot(e.object.quaternion))>x?(e.dispatchEvent(r),A.copy(e.object.position),H.copy(e.object.quaternion),fe=!1,!0):!1}})(),this.connect=o=>{o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=o,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",qe),e.domElement.addEventListener("pointerdown",Ze),e.domElement.addEventListener("pointercancel",Ke),e.domElement.addEventListener("wheel",Xe)},this.dispose=()=>{var o,d,y,C,A,H;(o=e.domElement)==null||o.removeEventListener("contextmenu",qe),(d=e.domElement)==null||d.removeEventListener("pointerdown",Ze),(y=e.domElement)==null||y.removeEventListener("pointercancel",Ke),(C=e.domElement)==null||C.removeEventListener("wheel",Xe),(A=e.domElement)==null||A.ownerDocument.removeEventListener("pointermove",je),(H=e.domElement)==null||H.ownerDocument.removeEventListener("pointerup",Ee),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",ke)};const e=this,r={type:"change"},c={type:"start"},p={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let u=a.NONE;const x=1e-6,l=new nt,h=new nt;let f=1;const k=new M,P=new U,m=new U,j=new U,v=new U,$=new U,L=new U,T=new U,E=new U,R=new U,B=new M,D=new U;let Y=!1;const g=[],O={};function G(){return 2*Math.PI/60/60*e.autoRotateSpeed}function _(){return Math.pow(.95,e.zoomSpeed)}function re(o){e.reverseOrbit||e.reverseHorizontalOrbit?h.theta+=o:h.theta-=o}function q(o){e.reverseOrbit||e.reverseVerticalOrbit?h.phi+=o:h.phi-=o}const he=(()=>{const o=new M;return function(y,C){o.setFromMatrixColumn(C,0),o.multiplyScalar(-y),k.add(o)}})(),ne=(()=>{const o=new M;return function(y,C){e.screenSpacePanning===!0?o.setFromMatrixColumn(C,1):(o.setFromMatrixColumn(C,0),o.crossVectors(e.object.up,o)),o.multiplyScalar(y),k.add(o)}})(),W=(()=>{const o=new M;return function(y,C){const A=e.domElement;if(A&&e.object instanceof ge&&e.object.isPerspectiveCamera){const H=e.object.position;o.copy(H).sub(e.target);let Q=o.length();Q*=Math.tan(e.object.fov/2*Math.PI/180),he(2*y*Q/A.clientHeight,e.object.matrix),ne(2*C*Q/A.clientHeight,e.object.matrix)}else A&&e.object instanceof be&&e.object.isOrthographicCamera?(he(y*(e.object.right-e.object.left)/e.object.zoom/A.clientWidth,e.object.matrix),ne(C*(e.object.top-e.object.bottom)/e.object.zoom/A.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function F(o){e.object instanceof ge&&e.object.isPerspectiveCamera||e.object instanceof be&&e.object.isOrthographicCamera?f/=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ce(o){e.object instanceof ge&&e.object.isPerspectiveCamera||e.object instanceof be&&e.object.isOrthographicCamera?f*=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ze(o){if(!e.zoomToCursor||!e.domElement)return;Y=!0;const d=e.domElement.getBoundingClientRect(),y=o.clientX-d.left,C=o.clientY-d.top,A=d.width,H=d.height;D.x=y/A*2-1,D.y=-(C/H)*2+1,B.set(D.x,D.y,1).unproject(e.object).sub(e.object.position).normalize()}function ve(o){return Math.max(e.minDistance,Math.min(e.maxDistance,o))}function Be(o){P.set(o.clientX,o.clientY)}function Et(o){ze(o),T.set(o.clientX,o.clientY)}function Fe(o){v.set(o.clientX,o.clientY)}function kt(o){m.set(o.clientX,o.clientY),j.subVectors(m,P).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(re(2*Math.PI*j.x/d.clientHeight),q(2*Math.PI*j.y/d.clientHeight)),P.copy(m),e.update()}function Pt(o){E.set(o.clientX,o.clientY),R.subVectors(E,T),R.y>0?F(_()):R.y<0&&ce(_()),T.copy(E),e.update()}function Ct(o){$.set(o.clientX,o.clientY),L.subVectors($,v).multiplyScalar(e.panSpeed),W(L.x,L.y),v.copy($),e.update()}function St(o){ze(o),o.deltaY<0?ce(_()):o.deltaY>0&&F(_()),e.update()}function Tt(o){let d=!1;switch(o.code){case e.keys.UP:W(0,e.keyPanSpeed),d=!0;break;case e.keys.BOTTOM:W(0,-e.keyPanSpeed),d=!0;break;case e.keys.LEFT:W(e.keyPanSpeed,0),d=!0;break;case e.keys.RIGHT:W(-e.keyPanSpeed,0),d=!0;break}d&&(o.preventDefault(),e.update())}function Ve(){if(g.length==1)P.set(g[0].pageX,g[0].pageY);else{const o=.5*(g[0].pageX+g[1].pageX),d=.5*(g[0].pageY+g[1].pageY);P.set(o,d)}}function Ye(){if(g.length==1)v.set(g[0].pageX,g[0].pageY);else{const o=.5*(g[0].pageX+g[1].pageX),d=.5*(g[0].pageY+g[1].pageY);v.set(o,d)}}function Ue(){const o=g[0].pageX-g[1].pageX,d=g[0].pageY-g[1].pageY,y=Math.sqrt(o*o+d*d);T.set(0,y)}function Ot(){e.enableZoom&&Ue(),e.enablePan&&Ye()}function Mt(){e.enableZoom&&Ue(),e.enableRotate&&Ve()}function Ge(o){if(g.length==1)m.set(o.pageX,o.pageY);else{const y=Pe(o),C=.5*(o.pageX+y.x),A=.5*(o.pageY+y.y);m.set(C,A)}j.subVectors(m,P).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(re(2*Math.PI*j.x/d.clientHeight),q(2*Math.PI*j.y/d.clientHeight)),P.copy(m)}function We(o){if(g.length==1)$.set(o.pageX,o.pageY);else{const d=Pe(o),y=.5*(o.pageX+d.x),C=.5*(o.pageY+d.y);$.set(y,C)}L.subVectors($,v).multiplyScalar(e.panSpeed),W(L.x,L.y),v.copy($)}function He(o){const d=Pe(o),y=o.pageX-d.x,C=o.pageY-d.y,A=Math.sqrt(y*y+C*C);E.set(0,A),R.set(0,Math.pow(E.y/T.y,e.zoomSpeed)),F(R.y),T.copy(E)}function $t(o){e.enableZoom&&He(o),e.enablePan&&We(o)}function Dt(o){e.enableZoom&&He(o),e.enableRotate&&Ge(o)}function Ze(o){var d,y;e.enabled!==!1&&(g.length===0&&((d=e.domElement)==null||d.ownerDocument.addEventListener("pointermove",je),(y=e.domElement)==null||y.ownerDocument.addEventListener("pointerup",Ee)),_t(o),o.pointerType==="touch"?Nt(o):Rt(o))}function je(o){e.enabled!==!1&&(o.pointerType==="touch"?Lt(o):At(o))}function Ee(o){var d,y,C;Qe(o),g.length===0&&((d=e.domElement)==null||d.releasePointerCapture(o.pointerId),(y=e.domElement)==null||y.ownerDocument.removeEventListener("pointermove",je),(C=e.domElement)==null||C.ownerDocument.removeEventListener("pointerup",Ee)),e.dispatchEvent(p),u=a.NONE}function Ke(o){Qe(o)}function Rt(o){let d;switch(o.button){case 0:d=e.mouseButtons.LEFT;break;case 1:d=e.mouseButtons.MIDDLE;break;case 2:d=e.mouseButtons.RIGHT;break;default:d=-1}switch(d){case se.DOLLY:if(e.enableZoom===!1)return;Et(o),u=a.DOLLY;break;case se.ROTATE:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enablePan===!1)return;Fe(o),u=a.PAN}else{if(e.enableRotate===!1)return;Be(o),u=a.ROTATE}break;case se.PAN:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enableRotate===!1)return;Be(o),u=a.ROTATE}else{if(e.enablePan===!1)return;Fe(o),u=a.PAN}break;default:u=a.NONE}u!==a.NONE&&e.dispatchEvent(c)}function At(o){if(e.enabled!==!1)switch(u){case a.ROTATE:if(e.enableRotate===!1)return;kt(o);break;case a.DOLLY:if(e.enableZoom===!1)return;Pt(o);break;case a.PAN:if(e.enablePan===!1)return;Ct(o);break}}function Xe(o){e.enabled===!1||e.enableZoom===!1||u!==a.NONE&&u!==a.ROTATE||(o.preventDefault(),e.dispatchEvent(c),St(o),e.dispatchEvent(p))}function ke(o){e.enabled===!1||e.enablePan===!1||Tt(o)}function Nt(o){switch(Je(o),g.length){case 1:switch(e.touches.ONE){case ae.ROTATE:if(e.enableRotate===!1)return;Ve(),u=a.TOUCH_ROTATE;break;case ae.PAN:if(e.enablePan===!1)return;Ye(),u=a.TOUCH_PAN;break;default:u=a.NONE}break;case 2:switch(e.touches.TWO){case ae.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ot(),u=a.TOUCH_DOLLY_PAN;break;case ae.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Mt(),u=a.TOUCH_DOLLY_ROTATE;break;default:u=a.NONE}break;default:u=a.NONE}u!==a.NONE&&e.dispatchEvent(c)}function Lt(o){switch(Je(o),u){case a.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ge(o),e.update();break;case a.TOUCH_PAN:if(e.enablePan===!1)return;We(o),e.update();break;case a.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;$t(o),e.update();break;case a.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Dt(o),e.update();break;default:u=a.NONE}}function qe(o){e.enabled!==!1&&o.preventDefault()}function _t(o){g.push(o)}function Qe(o){delete O[o.pointerId];for(let d=0;d<g.length;d++)if(g[d].pointerId==o.pointerId){g.splice(d,1);return}}function Je(o){let d=O[o.pointerId];d===void 0&&(d=new U,O[o.pointerId]=d),d.set(o.pageX,o.pageY)}function Pe(o){const d=o.pointerId===g[0].pointerId?g[1]:g[0];return O[d.pointerId]}i!==void 0&&this.connect(i),this.update()}};const vn=new M,jn=w.forwardRef(function({start:n=[0,0,0],end:i=[0,0,0],mid:e,segments:r=20,...c},p){const a=w.useRef(null),[u]=w.useState(()=>new Zt(void 0,void 0,void 0)),x=w.useCallback((h,f,k,P=20)=>(h instanceof M?u.v0.copy(h):u.v0.set(...h),f instanceof M?u.v2.copy(f):u.v2.set(...f),k instanceof M?u.v1.copy(k):u.v1.copy(u.v0.clone().add(u.v2.clone().sub(u.v0)).add(vn.set(0,u.v0.y-u.v2.y,0))),u.getPoints(P)),[]);w.useLayoutEffect(()=>{a.current.setPoints=(h,f,k)=>{const P=x(h,f,k);a.current.geometry&&a.current.geometry.setPositions(P.map(m=>m.toArray()).flat())}},[]);const l=w.useMemo(()=>x(n,i,e,r),[n,i,e,r]);return w.createElement(xo,N({ref:yo([a,p]),points:l},c))}),En=w.forwardRef(({makeDefault:t,camera:n,regress:i,domElement:e,enableDamping:r=!0,onChange:c,onStart:p,onEnd:a,...u},x)=>{const l=X(E=>E.invalidate),h=X(E=>E.camera),f=X(E=>E.gl),k=X(E=>E.events),P=X(E=>E.setEvents),m=X(E=>E.set),j=X(E=>E.get),v=X(E=>E.performance),$=n||h,L=e||k.connected||f.domElement,T=w.useMemo(()=>new wn($),[$]);return we(()=>{T.enabled&&T.update()},-1),w.useEffect(()=>(T.connect(L),()=>void T.dispose()),[L,i,T,l]),w.useEffect(()=>{const E=D=>{l(),i&&v.regress(),c&&c(D)},R=D=>{p&&p(D)},B=D=>{a&&a(D)};return T.addEventListener("change",E),T.addEventListener("start",R),T.addEventListener("end",B),()=>{T.removeEventListener("start",R),T.removeEventListener("end",B),T.removeEventListener("change",E)}},[c,p,a,T,l,P]),w.useEffect(()=>{if(t){const E=j().controls;return m({controls:T}),()=>m({controls:E})}},[t,T]),w.createElement("primitive",N({ref:x,object:T,enableDamping:r},u))});function kn(t){const n=t+"Geometry";return w.forwardRef(({args:i,children:e,...r},c)=>w.createElement("mesh",N({ref:c},r),w.createElement(n,{attach:"geometry",args:i}),e))}const Pn=kn("circle"),pt=t=>{const n=w.useRef();return w.useEffect(()=>{n.current=t}),n.current},Ie=10,Cn=2,ht=2,Sn=(t,n,i)=>{const c=new M().subVectors(n,t).normalize().multiplyScalar(i);return new M().addVectors(t,c)},vt=({links:t,nodes:n})=>{const i=w.useRef(null);return we(()=>{i.current&&n&&i.current.children.forEach((e,r)=>{var m;const c=t[r];if(!c)return;const p=n.find(j=>j.ref_id===c.source),a=n.find(j=>j.ref_id===c.target),u=new M((a==null?void 0:a.x)||0,(a==null?void 0:a.y)||0,(a==null?void 0:a.z)||0),x=new M((p==null?void 0:p.x)||0,(p==null?void 0:p.y)||0,(p==null?void 0:p.z)||0),l=Sn(x,u,Ie+ht),h=u.clone(),f=new M().lerpVectors(h,l,0),k=e.children[0],P=e.children[1];P.position.set(l.x,l.y,l.z),P.lookAt(h),P.rotateX(-Math.PI/2),(m=k.setPoints)==null||m.call(k,h,l,f)})}),s.jsx("group",{ref:i,children:t.map(e=>s.jsxs("group",{children:[s.jsx(jn,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),s.jsxs("mesh",{position:new M(0,0,0),children:[s.jsx("coneGeometry",{args:[Cn,ht,32]}),s.jsx("meshBasicMaterial",{color:"white"})]})]},e.ref_id))})};vt.displayName="Lines";const Tn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"];new Kt(2,2,2);const jt=w.memo(({node:t,setSelectedNode:n,onSimulationUpdate:i,isSelected:e})=>{var l;const r=w.useRef(null);console.log(e);const{size:c,camera:p}=X(),a=co(h=>{const{xy:[f,k],down:P,dragging:m,first:j,elapsedTime:v}=h;if(!(!m||j||v<100)&&P&&r.current){i();const $=(f-c.left)/window.innerWidth*c.width,L=(k-c.top)/window.innerHeight*c.height,R=new M($/c.width*2-1,-L/c.height*2+1,0).unproject(p).multiply(new M(1,1,0)).clone();t.fx=R.x,t.fy=R.y}});we(()=>{r.current&&r.current.position.set(t.x||0,t.y||0,0)});const u=Tn[(l=t==null?void 0:t.children)==null?void 0:l.length]||"red",x=h=>{h.stopPropagation(),n()};return s.jsxs("mesh",{ref:r,onClick:x,...a(),position:new M(t.x,t.y,0),children:[s.jsx(Pn,{args:[Ie,30,20],children:s.jsx("meshStandardMaterial",{attach:"material",color:u})}),s.jsx(wo,{...jo,color:"#000",fontSize:2,children:t.type})]})});jt.displayName="Node";const On=({simulation:t,setSelectedSchemaId:n,selectedId:i})=>{const[e]=wt(c=>[c.schemas]),r=()=>{t&&(t.alpha(.05),t.restart())};return s.jsx(s.Fragment,{children:e.map((c,p)=>{const a=t.nodes()[p];return a?s.jsx(jt,{isSelected:a.ref_id===i,node:a,onSimulationUpdate:r,setSelectedNode:()=>n(a.ref_id)},a.ref_id):null})})},Mn=({schemasWithPositions:t,filteredLinks:n,setSelectedSchemaId:i,selectedSchemaId:e})=>{const[r,c]=w.useState(null),p=pt(t),a=pt(n);return w.useEffect(()=>{if(!t.length||!n.length)return;const u=structuredClone(t),x=structuredClone(n);if(r){p&&p.length!==t.length&&a&&a.length!==n.length&&(r.nodes(u).force("link",st(x).id(h=>h.ref_id)).force("charge",at()).force("center",it()).force("collide",rt(Ie+1)).alpha(.5).restart(),c({...r}));return}const l=Xt(u).force("link",st(x).id(h=>h.ref_id)).force("charge",at()).force("center",it()).force("collide",rt(0));c(l)},[t,r,n,p,a]),we(()=>{}),r?s.jsxs(s.Fragment,{children:[s.jsx(vt,{links:n,nodes:r.nodes()}),s.jsx(On,{selectedId:e,setSelectedSchemaId:i,simulation:r})]}):null},Se=new qt(0),$n=({selectedSchemaId:t,links:n,schemasWithPositions:i,setSelectedSchemaId:e})=>s.jsxs(vo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[s.jsx("color",{args:[Se.r,Se.g,Se.b],attach:"background"}),Qt&&s.jsx(Eo,{position:"right-bottom"}),s.jsx(En,{enableRotate:!1,enableZoom:!0}),s.jsx(ko,{}),s.jsx(Mn,{filteredLinks:n,schemasWithPositions:i,selectedSchemaId:t,setSelectedSchemaId:e})]}),Dn=({onCreateNew:t})=>s.jsxs(Rn,{children:[s.jsx(Nn,{children:"BLUEPRINT"}),s.jsxs(An,{"data-testid":"add-schema-type",onClick:t,children:[s.jsx(Ln,{children:s.jsx(Po,{})}),s.jsx(J,{children:"Add Type"})]})]}),Rn=V(S).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${I.BG2};
  overflow: hidden;
  max-height: 100vh;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,An=V(S).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${I.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${J} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${I.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${I.primaryBlue};
    }

    ${J} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${I.white};
    background: ${I.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${I.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Nn=V(S)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${I.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${I.white};
`,Ln=V(S)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,_n=()=>{const[t,n]=w.useState(""),[i,e]=w.useState(!1),[r,c]=w.useState(!1),[p,a,u,x]=wt(m=>[m.schemas,m.links,m.setSchemas,m.setSchemaLinks]);w.useEffect(()=>{(async()=>{c(!0);try{const j=await Jt();u(j.schemas.filter(v=>v.ref_id&&!v.is_deleted&&v.ref_id)),x(j.edges),c(!1)}catch(j){console.error("Error fetching data:",j),c(!1)}})()},[u,x]);const l=m=>{if(p.some(v=>v.ref_id===m.ref_id))u(p.map(v=>v.ref_id===m.ref_id?{...m,children:[]}:v));else{u([...p,{...m,children:[]}]);const v=p.find($=>m.parent===$.type);x([...a,{ref_id:`new-link-${a.length}`,edge_type:"CHILD_OF",source:m.ref_id||"new",target:(v==null?void 0:v.ref_id)||"new"}])}},h=m=>{u(p.filter(j=>j.type!==m))},f=p.map(m=>({...m,children:p.filter(j=>j.parent===m.type).map(j=>j.ref_id||"")})),k=a.filter(m=>m.edge_type==="CHILD_OF"&&f.some(j=>j.ref_id===m.source)&&f.some(j=>j.ref_id===m.target)),P=p.find(m=>m.ref_id===t)||null;return r?s.jsx(S,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:s.jsx(Le,{color:I.white})}):s.jsx(s.Fragment,{children:s.jsxs(S,{align:"stretch",direction:"row",grow:1,children:[s.jsx(S,{ml:-20,my:-20,children:s.jsx(Dn,{onCreateNew:()=>{e(!0),n("")}})}),s.jsx(S,{children:P||i?s.jsx(zn,{children:s.jsx(hn,{onDelete:h,onSchemaCreate:l,selectedSchema:P,setIsCreateNew:e,setSelectedSchemaId:n})}):null}),s.jsx(In,{direction:"row",grow:1,children:s.jsx(Bn,{children:s.jsx($n,{links:k,schemasWithPositions:f,selectedSchemaId:t,setSelectedSchemaId:n})})})]})})},In=V(S)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  padding: 10px;
  max-height: 80vh;

  @media (max-width: 1440px) {
    max-height: 85vh;
  }

  @media (max-width: 1024px) {
    max-height: 70vh;
  }
`,zn=V(S)`
  width: 100%;
  max-width: 400px;
  background: ${I.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: auto;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Bn=V(S)`
  flex: 1 1 100%;
`,Fn=()=>{const{close:t}=gt("blueprintGraph"),n=()=>{t()};return s.jsx(eo,{background:"black",id:"blueprintGraph",kind:"full",onClose:n,preventOutsideClose:!0,children:s.jsx(_n,{})})},ps=w.memo(Fn);export{ps as BlueprintModal};
