import{g as Me,a as $e,s as oe,_ as N,a9 as It,r as j,b as De,j as s,d as Re,c as te,e as Ae,u as ht,aM as zt,b4 as ye,b5 as Ne,a7 as tt,b6 as Bt,b7 as Ft,a0 as Vt,f as V,F as S,h as I,D as mt,a_ as Yt,T as J,B as gt,aY as Te,N as Oe,a$ as Ut,b8 as Gt,b9 as Wt,ba as Ht,Z as M,bb as se,bc as re,ap as ot,bd as ge,be,bf as nt,bg as U,bh as Zt,ar as Kt,bi as st,bj as rt,bk as at,bl as it,bm as Xt,am as qt,W as Qt,bn as Jt}from"./index-7acb9fa0.js";import{B as eo}from"./index-cbd06229.js";import{q as to,r as oo,i as no,C as Le,I as so,B as _e,c as ro,b as ao,F as io,s as co}from"./react-toastify.esm-3d0c63a1.js";import{e as lo,A as bt}from"./index-2446abda.js";import{T as xt}from"./index-5c00c1b5.js";import{c as ct,d as uo}from"./index-df344ec2.js";import{D as po,P as fo}from"./PlusIcon-9b6534e4.js";import{p as ho,c as mo}from"./index-30d16895.js";import{u as go}from"./Popover-74590c37.js";import{u as bo}from"./index-1d1a725d.js";import{L as xo,m as yo,u as X,b as we,T as wo,C as jo}from"./constant-e6fdae86.js";import{f as vo,P as Eo,L as ko}from"./constants-9d010700.js";import{A as Po}from"./AddContentIcon-f2c3e358.js";import"./useSlotProps-607947df.js";import"./Popper-5e055b47.js";import"./index.esm-2f7683c0.js";import"./InfoIcon-1e02f89b.js";import"./generateCategoricalChart-063792c5.js";import"./NoFilterResultIcon-dbda900b.js";import"./index-a2ca3f36.js";import"./index-4027d824.js";import"./CheckIcon-37b659fa.js";function Co(t){return Me("PrivateSwitchBase",t)}$e("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const So=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],To=t=>{const{classes:n,checked:a,disabled:e,edge:i}=t,c={root:["root",a&&"checked",e&&"disabled",i&&`edge${te(i)}`],input:["input"]};return Ae(c,Co,n)},Oo=oe(to)(({ownerState:t})=>N({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Mo=oe("input",{shouldForwardProp:It})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),$o=j.forwardRef(function(n,a){const{autoFocus:e,checked:i,checkedIcon:c,className:p,defaultChecked:r,disabled:d,disableFocusRipple:x=!1,edge:u=!1,icon:f,id:h,inputProps:E,inputRef:P,name:m,onBlur:w,onChange:k,onFocus:$,readOnly:L,required:T=!1,tabIndex:v,type:R,value:B}=n,D=De(n,So),[Y,g]=bo({controlled:i,default:!!r,name:"SwitchBase",state:"checked"}),O=go(),G=F=>{$&&$(F),O&&O.onFocus&&O.onFocus(F)},_=F=>{w&&w(F),O&&O.onBlur&&O.onBlur(F)},ie=F=>{if(F.nativeEvent.defaultPrevented)return;const ce=F.target.checked;g(ce),k&&k(F,ce)};let q=d;O&&typeof q>"u"&&(q=O.disabled);const fe=R==="checkbox"||R==="radio",ne=N({},n,{checked:Y,disabled:q,disableFocusRipple:x,edge:u}),W=To(ne);return s.jsxs(Oo,N({component:"span",className:Re(W.root,p),centerRipple:!0,focusRipple:!x,disabled:q,tabIndex:null,role:void 0,onFocus:G,onBlur:_,ownerState:ne,ref:a},D,{children:[s.jsx(Mo,N({autoFocus:e,checked:i,defaultChecked:r,className:W.input,disabled:q,id:fe?h:void 0,name:m,onChange:ie,readOnly:L,ref:P,required:T,ownerState:ne,tabIndex:v,type:R},R==="checkbox"&&B===void 0?{}:{value:B},E)),Y?c:f]}))}),Do=$o,Ro=j.createContext(),lt=Ro;function Ao(t){return Me("MuiGrid",t)}const No=[0,1,2,3,4,5,6,7,8,9,10],Lo=["column-reverse","column","row-reverse","row"],_o=["nowrap","wrap-reverse","wrap"],ue=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Io=$e("MuiGrid",["root","container","item","zeroMinWidth",...No.map(t=>`spacing-xs-${t}`),...Lo.map(t=>`direction-xs-${t}`),..._o.map(t=>`wrap-xs-${t}`),...ue.map(t=>`grid-xs-${t}`),...ue.map(t=>`grid-sm-${t}`),...ue.map(t=>`grid-md-${t}`),...ue.map(t=>`grid-lg-${t}`),...ue.map(t=>`grid-xl-${t}`)]),pe=Io,zo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function ae(t){const n=parseFloat(t);return`${n}${String(t).replace(String(n),"")||"px"}`}function Bo({theme:t,ownerState:n}){let a;return t.breakpoints.keys.reduce((e,i)=>{let c={};if(n[i]&&(a=n[i]),!a)return e;if(a===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(a==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=ye({values:n.columns,breakpoints:t.breakpoints.values}),r=typeof p=="object"?p[i]:p;if(r==null)return e;const d=`${Math.round(a/r*1e8)/1e6}%`;let x={};if(n.container&&n.item&&n.columnSpacing!==0){const u=t.spacing(n.columnSpacing);if(u!=="0px"){const f=`calc(${d} + ${ae(u)})`;x={flexBasis:f,maxWidth:f}}}c=N({flexBasis:d,flexGrow:0,maxWidth:d},x)}return t.breakpoints.values[i]===0?Object.assign(e,c):e[t.breakpoints.up(i)]=c,e},{})}function Fo({theme:t,ownerState:n}){const a=ye({values:n.direction,breakpoints:t.breakpoints.values});return Ne({theme:t},a,e=>{const i={flexDirection:e};return e.indexOf("column")===0&&(i[`& > .${pe.item}`]={maxWidth:"none"}),i})}function yt({breakpoints:t,values:n}){let a="";Object.keys(n).forEach(i=>{a===""&&n[i]!==0&&(a=i)});const e=Object.keys(t).sort((i,c)=>t[i]-t[c]);return e.slice(0,e.indexOf(a))}function Vo({theme:t,ownerState:n}){const{container:a,rowSpacing:e}=n;let i={};if(a&&e!==0){const c=ye({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=yt({breakpoints:t.breakpoints.values,values:c})),i=Ne({theme:t},c,(r,d)=>{var x;const u=t.spacing(r);return u!=="0px"?{marginTop:`-${ae(u)}`,[`& > .${pe.item}`]:{paddingTop:ae(u)}}:(x=p)!=null&&x.includes(d)?{}:{marginTop:0,[`& > .${pe.item}`]:{paddingTop:0}}})}return i}function Yo({theme:t,ownerState:n}){const{container:a,columnSpacing:e}=n;let i={};if(a&&e!==0){const c=ye({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=yt({breakpoints:t.breakpoints.values,values:c})),i=Ne({theme:t},c,(r,d)=>{var x;const u=t.spacing(r);return u!=="0px"?{width:`calc(100% + ${ae(u)})`,marginLeft:`-${ae(u)}`,[`& > .${pe.item}`]:{paddingLeft:ae(u)}}:(x=p)!=null&&x.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${pe.item}`]:{paddingLeft:0}}})}return i}function Uo(t,n,a={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[a[`spacing-xs-${String(t)}`]];const e=[];return n.forEach(i=>{const c=t[i];Number(c)>0&&e.push(a[`spacing-${i}-${String(c)}`])}),e}const Go=oe("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:a}=t,{container:e,direction:i,item:c,spacing:p,wrap:r,zeroMinWidth:d,breakpoints:x}=a;let u=[];e&&(u=Uo(p,x,n));const f=[];return x.forEach(h=>{const E=a[h];E&&f.push(n[`grid-${h}-${String(E)}`])}),[n.root,e&&n.container,c&&n.item,d&&n.zeroMinWidth,...u,i!=="row"&&n[`direction-xs-${String(i)}`],r!=="wrap"&&n[`wrap-xs-${String(r)}`],...f]}})(({ownerState:t})=>N({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Fo,Vo,Yo,Bo);function Wo(t,n){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const a=[];return n.forEach(e=>{const i=t[e];if(Number(i)>0){const c=`spacing-${e}-${String(i)}`;a.push(c)}}),a}const Ho=t=>{const{classes:n,container:a,direction:e,item:i,spacing:c,wrap:p,zeroMinWidth:r,breakpoints:d}=t;let x=[];a&&(x=Wo(c,d));const u=[];d.forEach(h=>{const E=t[h];E&&u.push(`grid-${h}-${String(E)}`)});const f={root:["root",a&&"container",i&&"item",r&&"zeroMinWidth",...x,e!=="row"&&`direction-xs-${String(e)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...u]};return Ae(f,Ao,n)},Zo=j.forwardRef(function(n,a){const e=ht({props:n,name:"MuiGrid"}),{breakpoints:i}=zt(),c=lo(e),{className:p,columns:r,columnSpacing:d,component:x="div",container:u=!1,direction:f="row",item:h=!1,rowSpacing:E,spacing:P=0,wrap:m="wrap",zeroMinWidth:w=!1}=c,k=De(c,zo),$=E||P,L=d||P,T=j.useContext(lt),v=u?r||12:T,R={},B=N({},k);i.keys.forEach(g=>{k[g]!=null&&(R[g]=k[g],delete B[g])});const D=N({},c,{columns:v,container:u,direction:f,item:h,rowSpacing:$,columnSpacing:L,wrap:m,zeroMinWidth:w,spacing:P},R,{breakpoints:i.keys}),Y=Ho(D);return s.jsx(lt.Provider,{value:v,children:s.jsx(Go,N({ownerState:D,className:Re(Y.root,p),as:x,ref:a},B))})}),ee=Zo;function Ko(t){return Me("MuiSwitch",t)}const Xo=$e("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),z=Xo,qo=["className","color","edge","size","sx"],Qo=t=>{const{classes:n,edge:a,size:e,color:i,checked:c,disabled:p}=t,r={root:["root",a&&`edge${te(a)}`,`size${te(e)}`],switchBase:["switchBase",`color${te(i)}`,c&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=Ae(r,Ko,n);return N({},n,d)},Jo=oe("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:a}=t;return[n.root,a.edge&&n[`edge${te(a.edge)}`],n[`size${te(a.size)}`]]}})(({ownerState:t})=>N({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${z.thumb}`]:{width:16,height:16},[`& .${z.switchBase}`]:{padding:4,[`&.${z.checked}`]:{transform:"translateX(16px)"}}})),en=oe(Do,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,n)=>{const{ownerState:a}=t;return[n.switchBase,{[`& .${z.input}`]:n.input},a.color!=="default"&&n[`color${te(a.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${z.checked}`]:{transform:"translateX(20px)"},[`&.${z.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${z.checked} + .${z.track}`]:{opacity:.5},[`&.${z.disabled} + .${z.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${z.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:n})=>N({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:tt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},n.color!=="default"&&{[`&.${z.checked}`]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:tt(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${z.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${n.color}DisabledColor`]:`${t.palette.mode==="light"?Bt(t.palette[n.color].main,.62):Ft(t.palette[n.color].main,.55)}`}},[`&.${z.checked} + .${z.track}`]:{backgroundColor:(t.vars||t).palette[n.color].main}})),tn=oe("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,n)=>n.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),on=oe("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,n)=>n.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),nn=j.forwardRef(function(n,a){const e=ht({props:n,name:"MuiSwitch"}),{className:i,color:c="primary",edge:p=!1,size:r="medium",sx:d}=e,x=De(e,qo),u=N({},e,{color:c,edge:p,size:r}),f=Qo(u),h=s.jsx(on,{className:f.thumb,ownerState:u});return s.jsxs(Jo,{className:Re(f.root,i),sx:d,ownerState:u,children:[s.jsx(en,N({type:"checkbox",icon:h,checkedIcon:h,ref:a,ownerState:u},x,{classes:N({},f,{root:f.switchBase})})),s.jsx(tn,{className:f.track,ownerState:u})]})}),sn=nn,rn={schemas:[],links:[]},wt=Vt(t=>({...rn,setSchemas:n=>{t({schemas:n})},setSchemaLinks:n=>{t({links:n})}})),an=/^[a-z0-9_]+$/,cn=({parentParam:t})=>{const[n,a]=j.useState(!1),[e,i]=j.useState([]),{fields:c,append:p,replace:r,remove:d}=oo({name:"attributes"}),{setValue:x,watch:u}=no();return j.useEffect(()=>{const f=async()=>{try{let h=[{required:!1,type:"string",key:""}];if(t!==uo.value.toLowerCase()){a(!0);const E=await Yt(t);h=ho(E)}r(h),i(h)}catch(h){console.warn(h)}finally{a(!1)}};e.length===0&&f()},[t,x,r,e.length]),s.jsxs(s.Fragment,{children:[n?s.jsx(S,{align:"center",children:s.jsx(Le,{color:I.SECONDARY_BLUE,size:"30"})}):s.jsx(ln,{py:8,children:s.jsx(ee,{container:!0,spacing:2,children:c.map((f,h)=>{const E=u(`attributes[${h}].type`),P=u(`attributes[${h}].required`),m=f.isNew||!1;return s.jsxs(j.Fragment,{children:[s.jsx(ee,{item:!0,xs:5,children:s.jsx(xt,{autoComplete:"off",className:"text-input",disabled:!m,id:"cy-item-name",maxLength:50,name:`attributes.${h}.key`,placeholder:"Enter value",rules:{...mt,pattern:{message:"Please avoid special characters, spaces and uppercase",value:an}}})}),s.jsx(ee,{item:!0,xs:4,children:s.jsx(bt,{onSelect:w=>x(`attributes[${h}].type`,w==null?void 0:w.value),options:ct,selectedValue:ct.find(w=>w.value===E)})}),s.jsxs(ee,{item:!0,xs:3,children:[s.jsx(sn,{checked:P,disabled:!1,name:`attributes.${h}.required`,onChange:w=>x(`attributes[${h}].required`,w.target.checked),size:"small"}),s.jsx(so,{onClick:()=>d(h),children:s.jsx(po,{})})]})]},f.id)})})}),s.jsx(S,{align:"flex-start",py:12,children:s.jsx(_e,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(fo,{}),variant:"contained",children:"Add Attribute"})})]})},ln=V(S)`
  max-height: 260px;
  overflow: auto;
  width: calc(100% + 20px);
`,dn=({parent:t})=>{const n=t;return s.jsxs(S,{children:[s.jsx(S,{direction:"row",mb:10,children:s.jsxs(ee,{container:!0,spacing:2,children:[s.jsx(ee,{item:!0,xs:5,children:s.jsx(Ce,{style:{marginRight:180},children:"Attributes"})}),s.jsx(ee,{item:!0,xs:4,children:s.jsx(Ce,{style:{marginRight:130},children:"Type"})}),s.jsx(ee,{item:!0,xs:3,children:s.jsx(Ce,{children:"Required"})})]})}),n&&s.jsx(cn,{parentParam:n},n)]})},Ce=V(J)`
  font-size: 15px;
  color: gray;
`,un={type:"",parent:""},pn=async(t,n=!1)=>{try{const{attributes:a,...e}=t,i={...e,attributes:mo(a)};let c;if(n?c=await Oe.put("/schema",JSON.stringify(i),{}):c=await Oe.post("/schema",JSON.stringify({...i,node_key:"name"}),{}),c.status!=="success")throw new Error("error");return c==null?void 0:c.ref_id}catch(a){let e=Te;if(a.status===400){const i=await a.json();e=i.errorCode||(i==null?void 0:i.status)||Te}else a instanceof Error&&(e=a.message);throw new Error(e)}},fn=({onSchemaCreate:t,selectedSchema:n,onDelete:a,setSelectedSchemaId:e,setIsCreateNew:i})=>{const{close:c,visible:p}=gt("addType"),r=ro({mode:"onChange",defaultValues:n?{type:n.type,parent:n.parent}:un}),{watch:d,setValue:x,reset:u}=r,[f,h]=j.useState(!1),[E,P]=j.useState(!1),[m,w]=j.useState(null),[k,$]=j.useState(!1);j.useEffect(()=>()=>{u()},[p,u]);const L=()=>{i(!1),e("")},T=g=>g.charAt(0).toUpperCase()+g.slice(1);j.useEffect(()=>{n||(async()=>{P(!0);try{const G=(await Ut()).schemas.filter(_=>!_.is_deleted&&_.type).map(_=>(_==null?void 0:_.type)==="thing"?{label:"No Parent",value:_.type}:{label:T(_.type),value:_.type});w(G)}catch(O){console.warn(O)}finally{P(!1)}})()},[n]);const v=d("parent"),R=()=>{c()},B=async()=>{if(n!=null&&n.type)try{await Oe.delete(`/schema/${n.ref_id}`),a(n.type),c()}catch(g){console.warn(g)}finally{i(!1)}},D=r.handleSubmit(async g=>{if(!v){$(!0);return}h(!1);try{const O=await pn({...g,...n?{ref_id:n==null?void 0:n.ref_id}:{}},!!n);t({type:g.type,parent:v||"",ref_id:(n==null?void 0:n.ref_id)||O||"new"}),R()}catch(O){if((O==null?void 0:O.status)===400){const G=await O.json();G.errorCode||G!=null&&G.status||Te}else O instanceof Error&&O.message}finally{h(!1),i(!1)}}),Y=()=>m==null?void 0:m.find(g=>g.value===v);return s.jsxs(S,{children:[s.jsx(S,{direction:"row",justify:"flex-end",children:s.jsx(mn,{"data-testid":"close-sidebar-sub-view",onClick:L,children:s.jsx(ao,{})})}),s.jsx(S,{children:s.jsx(io,{...r,children:s.jsxs("form",{id:"add-type-form",onSubmit:D,children:[s.jsx(S,{children:n?s.jsxs(s.Fragment,{children:[n.parent?s.jsx(S,{mb:12,children:s.jsxs(J,{kind:"headingBold",children:["Parent: ",n.parent]})}):null,s.jsx(S,{mb:12,children:s.jsxs(J,{kind:"headingBold",children:["Type: ",n.type]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(S,{mb:12,children:[s.jsx(S,{mb:12,children:s.jsx(J,{children:"Select Parent"})}),s.jsx(bt,{isLoading:E,onSelect:g=>{x("parent",(g==null?void 0:g.value)||""),$(!1)},options:m,selectedValue:Y()}),k&&s.jsx(gn,{children:"A parent type must be selected"})]}),s.jsxs(S,{children:[s.jsx(S,{mb:12,children:s.jsx(J,{children:"Type name"})}),s.jsx(S,{mb:12,children:s.jsx(xt,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...mt},value:v})})]})]})}),s.jsx(dn,{parent:n?n.type:v}),s.jsxs(S,{direction:"row",justify:"space-between",mt:20,children:[n?s.jsx(hn,{color:"secondary",onClick:B,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}):null,s.jsx(_e,{color:"secondary",disabled:f||k,onClick:D,size:"large",startIcon:f?s.jsx(Le,{color:I.white,size:24}):null,variant:"contained",children:"Save"})]})]})})})]})},hn=V(_e)`
  && {
    color: ${I.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${I.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,mn=V(S)`
  font-size: 32px;
  color: ${I.white};
  cursor: pointer;
`,gn=V(S)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
`;var bn=Object.defineProperty,xn=(t,n,a)=>n in t?bn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,b=(t,n,a)=>(xn(t,typeof n!="symbol"?n+"":n,a),a);const xe=new Gt,dt=new Wt,yn=Math.cos(70*(Math.PI/180)),ut=(t,n)=>(t%n+n)%n;let wn=class extends Ht{constructor(n,a){super(),b(this,"object"),b(this,"domElement"),b(this,"enabled",!0),b(this,"target",new M),b(this,"minDistance",0),b(this,"maxDistance",1/0),b(this,"minZoom",0),b(this,"maxZoom",1/0),b(this,"minPolarAngle",0),b(this,"maxPolarAngle",Math.PI),b(this,"minAzimuthAngle",-1/0),b(this,"maxAzimuthAngle",1/0),b(this,"enableDamping",!1),b(this,"dampingFactor",.05),b(this,"enableZoom",!0),b(this,"zoomSpeed",1),b(this,"enableRotate",!0),b(this,"rotateSpeed",1),b(this,"enablePan",!0),b(this,"panSpeed",1),b(this,"screenSpacePanning",!0),b(this,"keyPanSpeed",7),b(this,"zoomToCursor",!1),b(this,"autoRotate",!1),b(this,"autoRotateSpeed",2),b(this,"reverseOrbit",!1),b(this,"reverseHorizontalOrbit",!1),b(this,"reverseVerticalOrbit",!1),b(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),b(this,"mouseButtons",{LEFT:se.ROTATE,MIDDLE:se.DOLLY,RIGHT:se.PAN}),b(this,"touches",{ONE:re.ROTATE,TWO:re.DOLLY_PAN}),b(this,"target0"),b(this,"position0"),b(this,"zoom0"),b(this,"_domElementKeyEvents",null),b(this,"getPolarAngle"),b(this,"getAzimuthalAngle"),b(this,"setPolarAngle"),b(this,"setAzimuthalAngle"),b(this,"getDistance"),b(this,"listenToKeyEvents"),b(this,"stopListenToKeyEvents"),b(this,"saveState"),b(this,"reset"),b(this,"update"),b(this,"connect"),b(this,"dispose"),this.object=n,this.domElement=a,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=o=>{let l=ut(o,2*Math.PI),y=u.phi;y<0&&(y+=2*Math.PI),l<0&&(l+=2*Math.PI);let C=Math.abs(l-y);2*Math.PI-C<C&&(l<y?l+=2*Math.PI:y+=2*Math.PI),f.phi=l-y,e.update()},this.setAzimuthalAngle=o=>{let l=ut(o,2*Math.PI),y=u.theta;y<0&&(y+=2*Math.PI),l<0&&(l+=2*Math.PI);let C=Math.abs(l-y);2*Math.PI-C<C&&(l<y?l+=2*Math.PI:y+=2*Math.PI),f.theta=l-y,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=o=>{o.addEventListener("keydown",ke),this._domElementKeyEvents=o},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ke),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(i),e.update(),d=r.NONE},this.update=(()=>{const o=new M,l=new M(0,1,0),y=new ot().setFromUnitVectors(n.up,l),C=y.clone().invert(),A=new M,H=new ot,Q=2*Math.PI;return function(){const et=e.object.position;y.setFromUnitVectors(n.up,l),C.copy(y).invert(),o.copy(et).sub(e.target),o.applyQuaternion(y),u.setFromVector3(o),e.autoRotate&&d===r.NONE&&ie(G()),e.enableDamping?(u.theta+=f.theta*e.dampingFactor,u.phi+=f.phi*e.dampingFactor):(u.theta+=f.theta,u.phi+=f.phi);let Z=e.minAzimuthAngle,K=e.maxAzimuthAngle;isFinite(Z)&&isFinite(K)&&(Z<-Math.PI?Z+=Q:Z>Math.PI&&(Z-=Q),K<-Math.PI?K+=Q:K>Math.PI&&(K-=Q),Z<=K?u.theta=Math.max(Z,Math.min(K,u.theta)):u.theta=u.theta>(Z+K)/2?Math.max(Z,u.theta):Math.min(K,u.theta)),u.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,u.phi)),u.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(E,e.dampingFactor):e.target.add(E),e.zoomToCursor&&Y||e.object.isOrthographicCamera?u.radius=je(u.radius):u.radius=je(u.radius*h),o.setFromSpherical(u),o.applyQuaternion(C),et.copy(e.target).add(o),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,E.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),E.set(0,0,0));let he=!1;if(e.zoomToCursor&&Y){let le=null;if(e.object instanceof ge&&e.object.isPerspectiveCamera){const de=o.length();le=je(de*h);const me=de-le;e.object.position.addScaledVector(B,me),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const de=new M(D.x,D.y,0);de.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),he=!0;const me=new M(D.x,D.y,0);me.unproject(e.object),e.object.position.sub(me).add(de),e.object.updateMatrixWorld(),le=o.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;le!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(le).add(e.object.position):(xe.origin.copy(e.object.position),xe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(xe.direction))<yn?n.lookAt(e.target):(dt.setFromNormalAndCoplanarPoint(e.object.up,e.target),xe.intersectPlane(dt,e.target))))}else e.object instanceof be&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),he=!0);return h=1,Y=!1,he||A.distanceToSquared(e.object.position)>x||8*(1-H.dot(e.object.quaternion))>x?(e.dispatchEvent(i),A.copy(e.object.position),H.copy(e.object.quaternion),he=!1,!0):!1}})(),this.connect=o=>{o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=o,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",qe),e.domElement.addEventListener("pointerdown",Ze),e.domElement.addEventListener("pointercancel",Ke),e.domElement.addEventListener("wheel",Xe)},this.dispose=()=>{var o,l,y,C,A,H;(o=e.domElement)==null||o.removeEventListener("contextmenu",qe),(l=e.domElement)==null||l.removeEventListener("pointerdown",Ze),(y=e.domElement)==null||y.removeEventListener("pointercancel",Ke),(C=e.domElement)==null||C.removeEventListener("wheel",Xe),(A=e.domElement)==null||A.ownerDocument.removeEventListener("pointermove",ve),(H=e.domElement)==null||H.ownerDocument.removeEventListener("pointerup",Ee),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",ke)};const e=this,i={type:"change"},c={type:"start"},p={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=r.NONE;const x=1e-6,u=new nt,f=new nt;let h=1;const E=new M,P=new U,m=new U,w=new U,k=new U,$=new U,L=new U,T=new U,v=new U,R=new U,B=new M,D=new U;let Y=!1;const g=[],O={};function G(){return 2*Math.PI/60/60*e.autoRotateSpeed}function _(){return Math.pow(.95,e.zoomSpeed)}function ie(o){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=o:f.theta-=o}function q(o){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=o:f.phi-=o}const fe=(()=>{const o=new M;return function(y,C){o.setFromMatrixColumn(C,0),o.multiplyScalar(-y),E.add(o)}})(),ne=(()=>{const o=new M;return function(y,C){e.screenSpacePanning===!0?o.setFromMatrixColumn(C,1):(o.setFromMatrixColumn(C,0),o.crossVectors(e.object.up,o)),o.multiplyScalar(y),E.add(o)}})(),W=(()=>{const o=new M;return function(y,C){const A=e.domElement;if(A&&e.object instanceof ge&&e.object.isPerspectiveCamera){const H=e.object.position;o.copy(H).sub(e.target);let Q=o.length();Q*=Math.tan(e.object.fov/2*Math.PI/180),fe(2*y*Q/A.clientHeight,e.object.matrix),ne(2*C*Q/A.clientHeight,e.object.matrix)}else A&&e.object instanceof be&&e.object.isOrthographicCamera?(fe(y*(e.object.right-e.object.left)/e.object.zoom/A.clientWidth,e.object.matrix),ne(C*(e.object.top-e.object.bottom)/e.object.zoom/A.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function F(o){e.object instanceof ge&&e.object.isPerspectiveCamera||e.object instanceof be&&e.object.isOrthographicCamera?h/=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ce(o){e.object instanceof ge&&e.object.isPerspectiveCamera||e.object instanceof be&&e.object.isOrthographicCamera?h*=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ze(o){if(!e.zoomToCursor||!e.domElement)return;Y=!0;const l=e.domElement.getBoundingClientRect(),y=o.clientX-l.left,C=o.clientY-l.top,A=l.width,H=l.height;D.x=y/A*2-1,D.y=-(C/H)*2+1,B.set(D.x,D.y,1).unproject(e.object).sub(e.object.position).normalize()}function je(o){return Math.max(e.minDistance,Math.min(e.maxDistance,o))}function Be(o){P.set(o.clientX,o.clientY)}function Et(o){ze(o),T.set(o.clientX,o.clientY)}function Fe(o){k.set(o.clientX,o.clientY)}function kt(o){m.set(o.clientX,o.clientY),w.subVectors(m,P).multiplyScalar(e.rotateSpeed);const l=e.domElement;l&&(ie(2*Math.PI*w.x/l.clientHeight),q(2*Math.PI*w.y/l.clientHeight)),P.copy(m),e.update()}function Pt(o){v.set(o.clientX,o.clientY),R.subVectors(v,T),R.y>0?F(_()):R.y<0&&ce(_()),T.copy(v),e.update()}function Ct(o){$.set(o.clientX,o.clientY),L.subVectors($,k).multiplyScalar(e.panSpeed),W(L.x,L.y),k.copy($),e.update()}function St(o){ze(o),o.deltaY<0?ce(_()):o.deltaY>0&&F(_()),e.update()}function Tt(o){let l=!1;switch(o.code){case e.keys.UP:W(0,e.keyPanSpeed),l=!0;break;case e.keys.BOTTOM:W(0,-e.keyPanSpeed),l=!0;break;case e.keys.LEFT:W(e.keyPanSpeed,0),l=!0;break;case e.keys.RIGHT:W(-e.keyPanSpeed,0),l=!0;break}l&&(o.preventDefault(),e.update())}function Ve(){if(g.length==1)P.set(g[0].pageX,g[0].pageY);else{const o=.5*(g[0].pageX+g[1].pageX),l=.5*(g[0].pageY+g[1].pageY);P.set(o,l)}}function Ye(){if(g.length==1)k.set(g[0].pageX,g[0].pageY);else{const o=.5*(g[0].pageX+g[1].pageX),l=.5*(g[0].pageY+g[1].pageY);k.set(o,l)}}function Ue(){const o=g[0].pageX-g[1].pageX,l=g[0].pageY-g[1].pageY,y=Math.sqrt(o*o+l*l);T.set(0,y)}function Ot(){e.enableZoom&&Ue(),e.enablePan&&Ye()}function Mt(){e.enableZoom&&Ue(),e.enableRotate&&Ve()}function Ge(o){if(g.length==1)m.set(o.pageX,o.pageY);else{const y=Pe(o),C=.5*(o.pageX+y.x),A=.5*(o.pageY+y.y);m.set(C,A)}w.subVectors(m,P).multiplyScalar(e.rotateSpeed);const l=e.domElement;l&&(ie(2*Math.PI*w.x/l.clientHeight),q(2*Math.PI*w.y/l.clientHeight)),P.copy(m)}function We(o){if(g.length==1)$.set(o.pageX,o.pageY);else{const l=Pe(o),y=.5*(o.pageX+l.x),C=.5*(o.pageY+l.y);$.set(y,C)}L.subVectors($,k).multiplyScalar(e.panSpeed),W(L.x,L.y),k.copy($)}function He(o){const l=Pe(o),y=o.pageX-l.x,C=o.pageY-l.y,A=Math.sqrt(y*y+C*C);v.set(0,A),R.set(0,Math.pow(v.y/T.y,e.zoomSpeed)),F(R.y),T.copy(v)}function $t(o){e.enableZoom&&He(o),e.enablePan&&We(o)}function Dt(o){e.enableZoom&&He(o),e.enableRotate&&Ge(o)}function Ze(o){var l,y;e.enabled!==!1&&(g.length===0&&((l=e.domElement)==null||l.ownerDocument.addEventListener("pointermove",ve),(y=e.domElement)==null||y.ownerDocument.addEventListener("pointerup",Ee)),_t(o),o.pointerType==="touch"?Nt(o):Rt(o))}function ve(o){e.enabled!==!1&&(o.pointerType==="touch"?Lt(o):At(o))}function Ee(o){var l,y,C;Qe(o),g.length===0&&((l=e.domElement)==null||l.releasePointerCapture(o.pointerId),(y=e.domElement)==null||y.ownerDocument.removeEventListener("pointermove",ve),(C=e.domElement)==null||C.ownerDocument.removeEventListener("pointerup",Ee)),e.dispatchEvent(p),d=r.NONE}function Ke(o){Qe(o)}function Rt(o){let l;switch(o.button){case 0:l=e.mouseButtons.LEFT;break;case 1:l=e.mouseButtons.MIDDLE;break;case 2:l=e.mouseButtons.RIGHT;break;default:l=-1}switch(l){case se.DOLLY:if(e.enableZoom===!1)return;Et(o),d=r.DOLLY;break;case se.ROTATE:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enablePan===!1)return;Fe(o),d=r.PAN}else{if(e.enableRotate===!1)return;Be(o),d=r.ROTATE}break;case se.PAN:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enableRotate===!1)return;Be(o),d=r.ROTATE}else{if(e.enablePan===!1)return;Fe(o),d=r.PAN}break;default:d=r.NONE}d!==r.NONE&&e.dispatchEvent(c)}function At(o){if(e.enabled!==!1)switch(d){case r.ROTATE:if(e.enableRotate===!1)return;kt(o);break;case r.DOLLY:if(e.enableZoom===!1)return;Pt(o);break;case r.PAN:if(e.enablePan===!1)return;Ct(o);break}}function Xe(o){e.enabled===!1||e.enableZoom===!1||d!==r.NONE&&d!==r.ROTATE||(o.preventDefault(),e.dispatchEvent(c),St(o),e.dispatchEvent(p))}function ke(o){e.enabled===!1||e.enablePan===!1||Tt(o)}function Nt(o){switch(Je(o),g.length){case 1:switch(e.touches.ONE){case re.ROTATE:if(e.enableRotate===!1)return;Ve(),d=r.TOUCH_ROTATE;break;case re.PAN:if(e.enablePan===!1)return;Ye(),d=r.TOUCH_PAN;break;default:d=r.NONE}break;case 2:switch(e.touches.TWO){case re.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ot(),d=r.TOUCH_DOLLY_PAN;break;case re.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Mt(),d=r.TOUCH_DOLLY_ROTATE;break;default:d=r.NONE}break;default:d=r.NONE}d!==r.NONE&&e.dispatchEvent(c)}function Lt(o){switch(Je(o),d){case r.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ge(o),e.update();break;case r.TOUCH_PAN:if(e.enablePan===!1)return;We(o),e.update();break;case r.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;$t(o),e.update();break;case r.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Dt(o),e.update();break;default:d=r.NONE}}function qe(o){e.enabled!==!1&&o.preventDefault()}function _t(o){g.push(o)}function Qe(o){delete O[o.pointerId];for(let l=0;l<g.length;l++)if(g[l].pointerId==o.pointerId){g.splice(l,1);return}}function Je(o){let l=O[o.pointerId];l===void 0&&(l=new U,O[o.pointerId]=l),l.set(o.pageX,o.pageY)}function Pe(o){const l=o.pointerId===g[0].pointerId?g[1]:g[0];return O[l.pointerId]}a!==void 0&&this.connect(a),this.update()}};const jn=new M,vn=j.forwardRef(function({start:n=[0,0,0],end:a=[0,0,0],mid:e,segments:i=20,...c},p){const r=j.useRef(null),[d]=j.useState(()=>new Zt(void 0,void 0,void 0)),x=j.useCallback((f,h,E,P=20)=>(f instanceof M?d.v0.copy(f):d.v0.set(...f),h instanceof M?d.v2.copy(h):d.v2.set(...h),E instanceof M?d.v1.copy(E):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(jn.set(0,d.v0.y-d.v2.y,0))),d.getPoints(P)),[]);j.useLayoutEffect(()=>{r.current.setPoints=(f,h,E)=>{const P=x(f,h,E);r.current.geometry&&r.current.geometry.setPositions(P.map(m=>m.toArray()).flat())}},[]);const u=j.useMemo(()=>x(n,a,e,i),[n,a,e,i]);return j.createElement(xo,N({ref:yo([r,p]),points:u},c))}),En=j.forwardRef(({makeDefault:t,camera:n,regress:a,domElement:e,enableDamping:i=!0,onChange:c,onStart:p,onEnd:r,...d},x)=>{const u=X(v=>v.invalidate),f=X(v=>v.camera),h=X(v=>v.gl),E=X(v=>v.events),P=X(v=>v.setEvents),m=X(v=>v.set),w=X(v=>v.get),k=X(v=>v.performance),$=n||f,L=e||E.connected||h.domElement,T=j.useMemo(()=>new wn($),[$]);return we(()=>{T.enabled&&T.update()},-1),j.useEffect(()=>(T.connect(L),()=>void T.dispose()),[L,a,T,u]),j.useEffect(()=>{const v=D=>{u(),a&&k.regress(),c&&c(D)},R=D=>{p&&p(D)},B=D=>{r&&r(D)};return T.addEventListener("change",v),T.addEventListener("start",R),T.addEventListener("end",B),()=>{T.removeEventListener("start",R),T.removeEventListener("end",B),T.removeEventListener("change",v)}},[c,p,r,T,u,P]),j.useEffect(()=>{if(t){const v=w().controls;return m({controls:T}),()=>m({controls:v})}},[t,T]),j.createElement("primitive",N({ref:x,object:T,enableDamping:i},d))});function kn(t){const n=t+"Geometry";return j.forwardRef(({args:a,children:e,...i},c)=>j.createElement("mesh",N({ref:c},i),j.createElement(n,{attach:"geometry",args:a}),e))}const Pn=kn("circle"),pt=t=>{const n=j.useRef();return j.useEffect(()=>{n.current=t}),n.current},Ie=10,Cn=2,ft=2,Sn=(t,n,a)=>{const c=new M().subVectors(n,t).normalize().multiplyScalar(a);return new M().addVectors(t,c)},jt=({links:t,nodes:n})=>{const a=j.useRef(null);return we(()=>{a.current&&n&&a.current.children.forEach((e,i)=>{var m;const c=t[i];if(!c)return;const p=n.find(w=>w.ref_id===c.source),r=n.find(w=>w.ref_id===c.target),d=new M((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),x=new M((p==null?void 0:p.x)||0,(p==null?void 0:p.y)||0,(p==null?void 0:p.z)||0),u=Sn(x,d,Ie+ft),f=d.clone(),h=new M().lerpVectors(f,u,0),E=e.children[0],P=e.children[1];P.position.set(u.x,u.y,u.z),P.lookAt(f),P.rotateX(-Math.PI/2),(m=E.setPoints)==null||m.call(E,f,u,h)})}),s.jsx("group",{ref:a,children:t.map(e=>s.jsxs("group",{children:[s.jsx(vn,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),s.jsxs("mesh",{position:new M(0,0,0),children:[s.jsx("coneGeometry",{args:[Cn,ft,32]}),s.jsx("meshBasicMaterial",{color:"white"})]})]},e.ref_id))})};jt.displayName="Lines";const Tn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"];new Kt(2,2,2);const vt=j.memo(({node:t,setSelectedNode:n,onSimulationUpdate:a,isSelected:e})=>{var u;const i=j.useRef(null);console.log(e);const{size:c,camera:p}=X(),r=co(f=>{const{xy:[h,E],down:P,dragging:m,first:w,elapsedTime:k}=f;if(!(!m||w||k<100)&&P&&i.current){a();const $=(h-c.left)/window.innerWidth*c.width,L=(E-c.top)/window.innerHeight*c.height,R=new M($/c.width*2-1,-L/c.height*2+1,0).unproject(p).multiply(new M(1,1,0)).clone();t.fx=R.x,t.fy=R.y}});we(()=>{i.current&&i.current.position.set(t.x||0,t.y||0,0)});const d=Tn[(u=t==null?void 0:t.children)==null?void 0:u.length]||"red",x=f=>{f.stopPropagation(),n()};return s.jsxs("mesh",{ref:i,onClick:x,...r(),position:new M(t.x,t.y,0),children:[s.jsx(Pn,{args:[Ie,30,20],children:s.jsx("meshStandardMaterial",{attach:"material",color:d})}),s.jsx(wo,{...vo,color:"#000",fontSize:2,children:t.type})]})});vt.displayName="Node";const On=({simulation:t,setSelectedSchemaId:n,selectedId:a})=>{const[e]=wt(c=>[c.schemas]),i=()=>{t&&(t.alpha(.05),t.restart())};return s.jsx(s.Fragment,{children:e.map((c,p)=>{const r=t.nodes()[p];return r?s.jsx(vt,{isSelected:r.ref_id===a,node:r,onSimulationUpdate:i,setSelectedNode:()=>n(r.ref_id)},r.ref_id):null})})},Mn=({schemasWithPositions:t,filteredLinks:n,setSelectedSchemaId:a,selectedSchemaId:e})=>{const[i,c]=j.useState(null),p=pt(t),r=pt(n);return j.useEffect(()=>{if(!t.length||!n.length)return;const d=structuredClone(t),x=structuredClone(n);if(i){p&&p.length!==t.length&&r&&r.length!==n.length&&(i.nodes(d).force("link",st(x).id(f=>f.ref_id)).force("charge",rt()).force("center",at()).force("collide",it(Ie+1)).alpha(.5).restart(),c({...i}));return}const u=Xt(d).force("link",st(x).id(f=>f.ref_id)).force("charge",rt()).force("center",at()).force("collide",it(0));c(u)},[t,i,n,p,r]),we(()=>{}),i?s.jsxs(s.Fragment,{children:[s.jsx(jt,{links:n,nodes:i.nodes()}),s.jsx(On,{selectedId:e,setSelectedSchemaId:a,simulation:i})]}):null},Se=new qt(0),$n=({selectedSchemaId:t,links:n,schemasWithPositions:a,setSelectedSchemaId:e})=>s.jsxs(jo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[s.jsx("color",{args:[Se.r,Se.g,Se.b],attach:"background"}),Qt&&s.jsx(Eo,{position:"right-bottom"}),s.jsx(En,{enableRotate:!1,enableZoom:!0}),s.jsx(ko,{}),s.jsx(Mn,{filteredLinks:n,schemasWithPositions:a,selectedSchemaId:t,setSelectedSchemaId:e})]}),Dn=({onCreateNew:t})=>s.jsxs(Rn,{children:[s.jsx(Nn,{children:"BLUEPRINT"}),s.jsxs(An,{"data-testid":"add-schema-type",onClick:t,children:[s.jsx(Ln,{children:s.jsx(Po,{})}),s.jsx(J,{children:"Add Type"})]})]}),Rn=V(S).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 64px;
  z-index: 31;
  transition: opacity 1s;
  background: ${I.BG2};
`,An=V(S).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${I.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${J} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${I.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${I.primaryBlue};
    }

    ${J} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${I.white};
    background: ${I.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${I.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Nn=V(S)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${I.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${I.white};
`,Ln=V(S)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,_n=()=>{const[t,n]=j.useState(""),[a,e]=j.useState(!1),[i,c]=j.useState(!1),[p,r,d,x]=wt(m=>[m.schemas,m.links,m.setSchemas,m.setSchemaLinks]);j.useEffect(()=>{(async()=>{c(!0);try{const w=await Jt();d(w.schemas.filter(k=>k.ref_id&&!k.is_deleted&&k.ref_id)),x(w.edges),c(!1)}catch(w){console.error("Error fetching data:",w),c(!1)}})()},[d,x]);const u=m=>{if(p.some(k=>k.ref_id===m.ref_id))d(p.map(k=>k.ref_id===m.ref_id?{...m,children:[]}:k));else{d([...p,{...m,children:[]}]);const k=p.find($=>m.parent===$.type);x([...r,{ref_id:`new-link-${r.length}`,edge_type:"CHILD_OF",source:m.ref_id||"new",target:(k==null?void 0:k.ref_id)||"new"}])}},f=m=>{d(p.filter(w=>w.type!==m))},h=p.map(m=>({...m,children:p.filter(w=>w.parent===m.type).map(w=>w.ref_id||"")})),E=r.filter(m=>m.edge_type==="CHILD_OF"&&h.some(w=>w.ref_id===m.source)&&h.some(w=>w.ref_id===m.target)),P=p.find(m=>m.ref_id===t)||null;return i?s.jsx(S,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:s.jsx(Le,{color:I.white})}):s.jsx(s.Fragment,{children:s.jsxs(S,{align:"stretch",direction:"row",grow:1,children:[s.jsx(S,{ml:-20,my:-20,children:s.jsx(Dn,{onCreateNew:()=>{e(!0),n("")}})}),s.jsx(S,{children:P||a?s.jsx(zn,{children:s.jsx(fn,{onDelete:f,onSchemaCreate:u,selectedSchema:P,setIsCreateNew:e,setSelectedSchemaId:n})}):null}),s.jsx(In,{direction:"row",grow:1,children:s.jsx(Bn,{children:s.jsx($n,{links:E,schemasWithPositions:h,selectedSchemaId:t,setSelectedSchemaId:n})})})]})})},In=V(S)`
  flex: 1 1 100%;
  justify-content: center;
  position: relative;
`,zn=V(S)`
  width: 400px;
  background: ${I.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
`,Bn=V(S)`
  flex: 1 1 100%;
`,Fn=()=>{const{close:t}=gt("blueprintGraph"),n=()=>{t()};return s.jsx(eo,{background:"black",id:"blueprintGraph",kind:"full",onClose:n,preventOutsideClose:!0,children:s.jsx(_n,{})})},ps=j.memo(Fn);export{ps as BlueprintModal};
