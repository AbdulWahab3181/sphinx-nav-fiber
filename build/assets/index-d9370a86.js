import{g as te,a as se,s as A,_ as S,a8 as Ne,r as x,b as ne,j as s,d as oe,c as M,e as re,u as xe,aR as Pe,aZ as J,a_ as ae,a6 as pe,a$ as Fe,b0 as Ee,f as w,F as m,T as P,i as Me,k as me,L as Ae,C as ie,h as v,b1 as Ie,b2 as X,W as ee,b3 as Le,$ as De,V as T,b4 as Ge,ay as _e,H as Oe,b5 as We,x as Ve,J as Ue}from"./index-71ad60ec.js";import{B as ce}from"./index-3d2f1be5.js";import{u as E}from"./index-07b04513.js";import{o as qe,h as He,c as ge,F as ye,C as Y,p as Ke,i as Je,I as be,B as U,n as Ye}from"./react-toastify.esm-8ed8fc2c.js";import{B as we,T as Ze,a as Qe}from"./index-938c0cfc.js";import{T as K}from"./index-c8ba709b.js";import{e as Xe,A as je}from"./index-f8da00b2.js";import{p as et,c as tt}from"./index-30d16895.js";import{a as ue,N as st,S as nt,b as G,c as ot,E as rt}from"./index-ff8b274c.js";import{D as at,P as ve}from"./PlusIcon-d969b997.js";import{u as it,a as ct}from"./Popover-5748ef66.js";import{u as lt}from"./Select-820b3641.js";import{L as dt,m as pt,b as ut,S as ht,H as ft,C as xt,E as mt}from"./EditIcon-237190bb.js";import{L as gt}from"./index-1a9844f4.js";import{M as yt,a as bt}from"./NoFilterResultIcon-c8f415b8.js";import"./useSlotProps-4112a37d.js";import"./index.esm-6fcc3f86.js";import"./InfoIcon-83e27d87.js";import"./Popper-1794d9c9.js";import"./generateCategoricalChart-abd906df.js";import"./index-f5012762.js";import"./CheckIcon-0f52e962.js";import"./dividerClasses-c5bdc4dc.js";function wt(e){return te("PrivateSwitchBase",e)}se("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const jt=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],vt=e=>{const{classes:t,checked:o,disabled:n,edge:r}=e,a={root:["root",o&&"checked",n&&"disabled",r&&`edge${M(r)}`],input:["input"]};return re(a,wt,t)},St=A(qe)(({ownerState:e})=>S({padding:9,borderRadius:"50%"},e.edge==="start"&&{marginLeft:e.size==="small"?-3:-12},e.edge==="end"&&{marginRight:e.size==="small"?-3:-12})),kt=A("input",{shouldForwardProp:Ne})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),$t=x.forwardRef(function(t,o){const{autoFocus:n,checked:r,checkedIcon:a,className:p,defaultChecked:u,disabled:d,disableFocusRipple:h=!1,edge:c=!1,icon:i,id:l,inputProps:f,inputRef:g,name:B,onBlur:y,onChange:R,onFocus:I,readOnly:L,required:O=!1,tabIndex:b,type:j,value:C}=t,$=ne(t,jt),[H,D]=lt({controlled:r,default:!!u,name:"SwitchBase",state:"checked"}),N=it(),Be=z=>{I&&I(z),N&&N.onFocus&&N.onFocus(z)},ze=z=>{y&&y(z),N&&N.onBlur&&N.onBlur(z)},Te=z=>{if(z.nativeEvent.defaultPrevented)return;const de=z.target.checked;D(de),R&&R(z,de)};let W=d;N&&typeof W>"u"&&(W=N.disabled);const Re=j==="checkbox"||j==="radio",Z=S({},t,{checked:H,disabled:W,disableFocusRipple:h,edge:c}),le=vt(Z);return s.jsxs(St,S({component:"span",className:oe(le.root,p),centerRipple:!0,focusRipple:!h,disabled:W,tabIndex:null,role:void 0,onFocus:Be,onBlur:ze,ownerState:Z,ref:o},$,{children:[s.jsx(kt,S({autoFocus:n,checked:r,defaultChecked:u,className:le.input,disabled:W,id:Re?l:void 0,name:B,onChange:Te,readOnly:L,ref:g,required:O,ownerState:Z,tabIndex:b,type:j},j==="checkbox"&&C===void 0?{}:{value:C},f)),H?a:i]}))}),Ct=$t,Bt=x.createContext(),he=Bt;function zt(e){return te("MuiGrid",e)}const Tt=[0,1,2,3,4,5,6,7,8,9,10],Rt=["column-reverse","column","row-reverse","row"],Nt=["nowrap","wrap-reverse","wrap"],V=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Pt=se("MuiGrid",["root","container","item","zeroMinWidth",...Tt.map(e=>`spacing-xs-${e}`),...Rt.map(e=>`direction-xs-${e}`),...Nt.map(e=>`wrap-xs-${e}`),...V.map(e=>`grid-xs-${e}`),...V.map(e=>`grid-sm-${e}`),...V.map(e=>`grid-md-${e}`),...V.map(e=>`grid-lg-${e}`),...V.map(e=>`grid-xl-${e}`)]),q=Pt,Ft=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function _(e){const t=parseFloat(e);return`${t}${String(e).replace(String(t),"")||"px"}`}function Et({theme:e,ownerState:t}){let o;return e.breakpoints.keys.reduce((n,r)=>{let a={};if(t[r]&&(o=t[r]),!o)return n;if(o===!0)a={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(o==="auto")a={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=J({values:t.columns,breakpoints:e.breakpoints.values}),u=typeof p=="object"?p[r]:p;if(u==null)return n;const d=`${Math.round(o/u*1e8)/1e6}%`;let h={};if(t.container&&t.item&&t.columnSpacing!==0){const c=e.spacing(t.columnSpacing);if(c!=="0px"){const i=`calc(${d} + ${_(c)})`;h={flexBasis:i,maxWidth:i}}}a=S({flexBasis:d,flexGrow:0,maxWidth:d},h)}return e.breakpoints.values[r]===0?Object.assign(n,a):n[e.breakpoints.up(r)]=a,n},{})}function Mt({theme:e,ownerState:t}){const o=J({values:t.direction,breakpoints:e.breakpoints.values});return ae({theme:e},o,n=>{const r={flexDirection:n};return n.indexOf("column")===0&&(r[`& > .${q.item}`]={maxWidth:"none"}),r})}function Se({breakpoints:e,values:t}){let o="";Object.keys(t).forEach(r=>{o===""&&t[r]!==0&&(o=r)});const n=Object.keys(e).sort((r,a)=>e[r]-e[a]);return n.slice(0,n.indexOf(o))}function At({theme:e,ownerState:t}){const{container:o,rowSpacing:n}=t;let r={};if(o&&n!==0){const a=J({values:n,breakpoints:e.breakpoints.values});let p;typeof a=="object"&&(p=Se({breakpoints:e.breakpoints.values,values:a})),r=ae({theme:e},a,(u,d)=>{var h;const c=e.spacing(u);return c!=="0px"?{marginTop:`-${_(c)}`,[`& > .${q.item}`]:{paddingTop:_(c)}}:(h=p)!=null&&h.includes(d)?{}:{marginTop:0,[`& > .${q.item}`]:{paddingTop:0}}})}return r}function It({theme:e,ownerState:t}){const{container:o,columnSpacing:n}=t;let r={};if(o&&n!==0){const a=J({values:n,breakpoints:e.breakpoints.values});let p;typeof a=="object"&&(p=Se({breakpoints:e.breakpoints.values,values:a})),r=ae({theme:e},a,(u,d)=>{var h;const c=e.spacing(u);return c!=="0px"?{width:`calc(100% + ${_(c)})`,marginLeft:`-${_(c)}`,[`& > .${q.item}`]:{paddingLeft:_(c)}}:(h=p)!=null&&h.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${q.item}`]:{paddingLeft:0}}})}return r}function Lt(e,t,o={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[o[`spacing-xs-${String(e)}`]];const n=[];return t.forEach(r=>{const a=e[r];Number(a)>0&&n.push(o[`spacing-${r}-${String(a)}`])}),n}const Dt=A("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e,{container:n,direction:r,item:a,spacing:p,wrap:u,zeroMinWidth:d,breakpoints:h}=o;let c=[];n&&(c=Lt(p,h,t));const i=[];return h.forEach(l=>{const f=o[l];f&&i.push(t[`grid-${l}-${String(f)}`])}),[t.root,n&&t.container,a&&t.item,d&&t.zeroMinWidth,...c,r!=="row"&&t[`direction-xs-${String(r)}`],u!=="wrap"&&t[`wrap-xs-${String(u)}`],...i]}})(({ownerState:e})=>S({boxSizing:"border-box"},e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},e.item&&{margin:0},e.zeroMinWidth&&{minWidth:0},e.wrap!=="wrap"&&{flexWrap:e.wrap}),Mt,At,It,Et);function Gt(e,t){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[`spacing-xs-${String(e)}`];const o=[];return t.forEach(n=>{const r=e[n];if(Number(r)>0){const a=`spacing-${n}-${String(r)}`;o.push(a)}}),o}const _t=e=>{const{classes:t,container:o,direction:n,item:r,spacing:a,wrap:p,zeroMinWidth:u,breakpoints:d}=e;let h=[];o&&(h=Gt(a,d));const c=[];d.forEach(l=>{const f=e[l];f&&c.push(`grid-${l}-${String(f)}`)});const i={root:["root",o&&"container",r&&"item",u&&"zeroMinWidth",...h,n!=="row"&&`direction-xs-${String(n)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...c]};return re(i,zt,t)},Ot=x.forwardRef(function(t,o){const n=xe({props:t,name:"MuiGrid"}),{breakpoints:r}=Pe(),a=Xe(n),{className:p,columns:u,columnSpacing:d,component:h="div",container:c=!1,direction:i="row",item:l=!1,rowSpacing:f,spacing:g=0,wrap:B="wrap",zeroMinWidth:y=!1}=a,R=ne(a,Ft),I=f||g,L=d||g,O=x.useContext(he),b=c?u||12:O,j={},C=S({},R);r.keys.forEach(D=>{R[D]!=null&&(j[D]=R[D],delete C[D])});const $=S({},a,{columns:b,container:c,direction:i,item:l,rowSpacing:I,columnSpacing:L,wrap:B,zeroMinWidth:y,spacing:g},j,{breakpoints:r.keys}),H=_t($);return s.jsx(he.Provider,{value:b,children:s.jsx(Dt,S({ownerState:$,className:oe(H.root,p),as:h,ref:o},C))})}),F=Ot;function Wt(e){return te("MuiSwitch",e)}const Vt=se("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),k=Vt,Ut=["className","color","edge","size","sx"],qt=e=>{const{classes:t,edge:o,size:n,color:r,checked:a,disabled:p}=e,u={root:["root",o&&`edge${M(o)}`,`size${M(n)}`],switchBase:["switchBase",`color${M(r)}`,a&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=re(u,Wt,t);return S({},t,d)},Ht=A("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${M(o.edge)}`],t[`size${M(o.size)}`]]}})(({ownerState:e})=>S({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${k.thumb}`]:{width:16,height:16},[`& .${k.switchBase}`]:{padding:4,[`&.${k.checked}`]:{transform:"translateX(16px)"}}})),Kt=A(Ct,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${k.input}`]:t.input},o.color!=="default"&&t[`color${M(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${k.checked}`]:{transform:"translateX(20px)"},[`&.${k.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${k.checked} + .${k.track}`]:{opacity:.5},[`&.${k.disabled} + .${k.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${k.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>S({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:pe(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${k.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:pe(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${k.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?Fe(e.palette[t.color].main,.62):Ee(e.palette[t.color].main,.55)}`}},[`&.${k.checked} + .${k.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),Jt=A("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Yt=A("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),Zt=x.forwardRef(function(t,o){const n=xe({props:t,name:"MuiSwitch"}),{className:r,color:a="primary",edge:p=!1,size:u="medium",sx:d}=n,h=ne(n,Ut),c=S({},n,{color:a,edge:p,size:u}),i=qt(c),l=s.jsx(Yt,{className:i.thumb,ownerState:c});return s.jsxs(Ht,{className:oe(i.root,r),sx:d,ownerState:c,children:[s.jsx(Kt,S({type:"checkbox",icon:l,checkedIcon:l,ref:o,ownerState:c},h,{classes:S({},i,{root:i.switchBase})})),s.jsx(Jt,{className:i.track,ownerState:c})]})}),Qt=Zt,Xt=({onClose:e})=>{const[t]=Me(n=>[n.graphStyle]),o=()=>{localStorage.setItem("graphStyle",t),e()};return s.jsxs(es,{direction:"column",children:[s.jsx(ts,{children:"Default graph view:"}),s.jsx(He,{}),s.jsx(m,{mt:308,children:s.jsx(we,{kind:"big",onClick:o,children:"Save Changes"})})]})},es=w(m)`
  display: flex;
  gap: 10px;
  padding: 36px;
`,ts=w(P)`
  font-family: Barlow;
  font-size: 13px;
  font-weight: 400;
`,ss=({initialValues:e})=>{const t=ge({defaultValues:e,mode:"onSubmit"}),{isSubmitting:o}=t.formState,n=me(a=>a.setAppMetaData),r=t.handleSubmit(async a=>{try{(await Ae(a)).status==="success"&&n(a)}catch(p){console.log(p),console.warn(p)}});return s.jsx(ye,{...t,children:s.jsx(os,{id:"add-node-form",onSubmit:r,children:s.jsxs(s.Fragment,{children:[s.jsxs(m,{children:[s.jsx(m,{pt:20,children:s.jsx(K,{id:"cy-about-title-id",label:"Graph Title",maxLength:50,name:"title",placeholder:"Type graph title here...",rules:{...ie}})}),s.jsx(m,{pt:20,children:s.jsx(K,{id:"cy-about-id",label:"Graph Description",maxLength:100,name:"description",placeholder:"Type graph description here..."})})]}),s.jsx(m,{mt:210,py:24,children:o?s.jsx(ns,{children:s.jsx(Y,{color:v.white,size:20})}):s.jsx(we,{disabled:o,id:"add-node-submit-cta",kind:"big",type:"submit",children:"Save Changes"})})]})})})},ns=w(m).attrs({align:"center",background:"primaryButton",borderRadius:8,justify:"center"})`
  padding: 16px 24px;
  opacity: 0.5;
`,os=w.form`
  padding: 36px;
`,rs=/^[a-z0-9_]+$/,as=({parentParam:e})=>{const[t,o]=x.useState(!1),[n,r]=x.useState([]),{fields:a,append:p,replace:u,remove:d}=Ke({name:"attributes"}),{setValue:h,watch:c}=Je();return x.useEffect(()=>{const i=async()=>{try{let l=[{required:!1,type:"string",key:""}];if(e!==st.value.toLowerCase()){o(!0);const f=await Ie(e);l=et(f)}u(l),r(l)}catch(l){console.warn(l)}finally{o(!1)}};n.length===0&&i()},[e,h,u,n.length]),s.jsxs(s.Fragment,{children:[t?s.jsx(m,{align:"center",children:s.jsx(Y,{color:v.SECONDARY_BLUE,size:"30"})}):s.jsx(is,{py:8,children:s.jsx(F,{container:!0,spacing:2,children:a.map((i,l)=>{const f=c(`attributes[${l}].type`),g=c(`attributes[${l}].required`),B=i.isNew||!1;return s.jsxs(x.Fragment,{children:[s.jsx(F,{item:!0,xs:5,children:s.jsx(K,{autoComplete:"off",className:"text-input",disabled:!B,id:"cy-item-name",maxLength:50,name:`attributes.${l}.key`,placeholder:"Enter value",rules:{...ie,pattern:{message:"Please avoid special characters, spaces and uppercase",value:rs}}})}),s.jsx(F,{item:!0,xs:4,children:s.jsx(je,{onSelect:y=>h(`attributes[${l}].type`,y==null?void 0:y.value),options:ue,selectedValue:ue.find(y=>y.value===f)})}),s.jsxs(F,{item:!0,xs:3,children:[s.jsx(Qt,{checked:g,disabled:!1,name:`attributes.${l}.required`,onChange:y=>h(`attributes[${l}].required`,y.target.checked),size:"small"}),s.jsx(be,{onClick:()=>d(l),children:s.jsx(at,{})})]})]},i.id)})})}),s.jsx(m,{align:"flex-start",py:12,children:s.jsx(U,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(ve,{}),variant:"contained",children:"Add Attribute"})})]})},is=w(m)`
  max-height: 260px;
  overflow: auto;
  width: calc(100% + 20px);
`,cs=({parent:e})=>{const t=e;return s.jsxs(m,{children:[s.jsx(m,{direction:"row",mb:10,children:s.jsxs(F,{container:!0,spacing:2,children:[s.jsx(F,{item:!0,xs:5,children:s.jsx(Q,{style:{marginRight:180},children:"Attributes"})}),s.jsx(F,{item:!0,xs:4,children:s.jsx(Q,{style:{marginRight:130},children:"Type"})}),s.jsx(F,{item:!0,xs:3,children:s.jsx(Q,{children:"Required"})})]})}),t&&s.jsx(as,{parentParam:t},t)]})},Q=w(P)`
  font-size: 15px;
  color: gray;
`,ls={type:"",parent:""},ds=async(e,t=!1)=>{try{const{attributes:o,...n}=e,r={...n,...tt(o)};let a;if(t?a=await ee.put("/schema",JSON.stringify(r),{}):a=await ee.post("/schema",JSON.stringify(r),{}),a.error){const{message:p}=a.error;throw new Error(p)}}catch(o){let n=X;if(o.status===400){const r=await o.json();n=r.errorCode||(r==null?void 0:r.status)||X}else o instanceof Error&&(n=o.message);throw new Error(n)}},ps=({onSchemaCreate:e,selectedSchema:t,onDelete:o})=>{const{close:n,visible:r}=E("addType"),a=ge({mode:"onChange",defaultValues:t?{type:t.type,parent:t.parent}:ls}),{watch:p,setValue:u,reset:d}=a,[h,c]=x.useState(!1),[i,l]=x.useState(!1),[f,g]=x.useState(null);x.useEffect(()=>()=>{d()},[r,d]);const B=b=>b.charAt(0).toUpperCase()+b.slice(1);x.useEffect(()=>{t||(async()=>{l(!0);try{const C=(await Le()).schemas.filter($=>!$.is_deleted).map($=>($==null?void 0:$.type)==="thing"?{label:"No Parent",value:$.type}:{label:B($.type),value:$.type});g(C)}catch(j){console.warn(j)}finally{l(!1)}})()},[t]);const y=p("parent"),R=()=>{n()},I=async()=>{if(t!=null&&t.type)try{await ee.delete(`/schema/${t.type}`),o(t.type),n()}catch(b){console.warn(b)}},L=a.handleSubmit(async b=>{c(!1);try{await ds(b,!!t),e({type:b.type,parent:y||""}),R()}catch(j){if((j==null?void 0:j.status)===400){const C=await j.json();C.errorCode||C!=null&&C.status||X}else j instanceof Error&&j.message}finally{c(!1)}}),O=()=>f==null?void 0:f.find(b=>b.value===y);return s.jsx(ye,{...a,children:s.jsxs("form",{id:"add-type-form",onSubmit:L,children:[s.jsxs(m,{children:[s.jsx(m,{align:"center",direction:"row",justify:"space-between",mb:18,children:s.jsx(m,{align:"center",direction:"row",children:s.jsx(P,{children:"Enter details"})})}),t?s.jsx(m,{mb:20,children:s.jsxs(P,{kind:"headingBold",children:["Parent: ",t.parent]})}):s.jsxs(s.Fragment,{children:[s.jsx(m,{mb:20,children:s.jsx(P,{children:"Select Parent"})}),s.jsx(m,{direction:"row",mb:20,children:s.jsx(je,{autoFocus:!t,disabled:i,isLoading:i,onSelect:b=>u("parent",(b==null?void 0:b.value)||""),options:f,selectedValue:O()},y)})]}),t?s.jsx(m,{mb:20,children:s.jsxs(P,{kind:"headingBold",children:["Type: ",t.type]})}):s.jsxs(s.Fragment,{children:[s.jsx(m,{mb:4,children:s.jsx(P,{children:"Type name"})}),s.jsx(m,{mb:12,children:s.jsx(K,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...ie},value:y})})]})]}),s.jsx(cs,{parent:t?t.type:y}),s.jsxs(m,{direction:"row",justify:"space-between",mt:20,children:[t?s.jsx(us,{color:"secondary",onClick:I,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}):null,s.jsx(U,{color:"secondary",disabled:h,onClick:L,size:"large",startIcon:h?s.jsx(Y,{color:v.white,size:24}):null,variant:"contained",children:"Save"})]})]})})},us=w(U)`
  && {
    color: ${v.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${v.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,hs=({onSchemaCreate:e,selectedSchema:t,onDelete:o,onClose:n})=>{const{close:r}=E("blueprintGraph"),a=()=>{r(),n()};return s.jsx(ce,{id:"addType",kind:"regular",onClose:a,preventOutsideClose:!0,children:s.jsx(ps,{onDelete:o,onSchemaCreate:e,selectedSchema:t})})},fs={schemas:[],links:[]},ke=De(e=>({...fs,setSchemas:t=>{e({schemas:t})},setSchemaLinks:t=>{e({links:t})}})),xs=e=>{const t=e.find(a=>a.type==="Thing"),o=[],n=2,r=(a,p,u,d=0,h=0)=>{const c=e.find(i=>i.ref_id===a);if(c){const i=p?2*Math.PI/p:0,l=u*i+d,f=h*n*Math.cos(l),g=h*n*Math.sin(l);o.push({...c,x:f,y:g,z:0}),c.children.forEach((B,y)=>{r(B,c.children.length,y,l,h+1)})}};return t!=null&&t.ref_id&&r(t==null?void 0:t.ref_id,0,0),o},ms=new T,fe=x.forwardRef(function({start:t=[0,0,0],end:o=[0,0,0],mid:n,segments:r=20,...a},p){const u=x.useRef(null),[d]=x.useState(()=>new Ge(void 0,void 0,void 0)),h=x.useCallback((i,l,f,g=20)=>(i instanceof T?d.v0.copy(i):d.v0.set(...i),l instanceof T?d.v2.copy(l):d.v2.set(...l),f instanceof T?d.v1.copy(f):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(ms.set(0,d.v0.y-d.v2.y,0))),d.getPoints(g)),[]);x.useLayoutEffect(()=>{u.current.setPoints=(i,l,f)=>{const g=h(i,l,f);u.current.geometry&&u.current.geometry.setPositions(g.map(B=>B.toArray()).flat())}},[]);const c=x.useMemo(()=>h(t,o,n,r),[t,o,n,r]);return x.createElement(dt,S({ref:pt([u,p]),points:c},a))}),$e=({links:e})=>{const t=x.useRef(null),o=x.useMemo(()=>{const n=[];return e.forEach((r,a)=>{const p=a%2===0?1:-1,{start:u,end:d}=r,h=new T(u.x,u.y,u.z),c=new T(d.x,d.y,d.z),i=new T(0,p*.25,0),l=new T(0,p*.25,0),f=h.clone().add(i),g=c.clone().add(l);n.push({start:f,end:g})}),n},[e]);return ut((n,r)=>{t.current&&t.current.children.forEach(a=>{const u=a.material;u!=null&&u.uniforms&&"dashOffset"in u.uniforms&&(u.uniforms.dashOffset.value-=r*10)})}),s.jsx("group",{ref:t,children:o.map((n,r)=>s.jsxs(x.Fragment,{children:[s.jsx(fe,{...n,color:"white",dashed:!0,dashScale:50,gapSize:20}),s.jsx(fe,{...n,color:"white",lineWidth:.5,opacity:.1,transparent:!0})]},r))})};$e.displayName="Lines";const gs=new _e(4,4,4),Ce=x.memo(({node:e})=>{const[t]=x.useState(gs);return x.useEffect(()=>function(){t.dispose()},[t]),s.jsxs(ht,{children:[!1,s.jsx("group",{position:new T(e.x,e.y,e.z),children:s.jsx(ft,{center:!0,sprite:!0,zIndexRange:[0,0],children:s.jsx(ys,{children:e.type})})})]})});Ce.displayName="Node";const ys=w(m)`
  width: 50px;
  height: 50px;
  border-radius: 50%;
  color: ${v.white};
  border: 1px solid ${v.white};
  align-items: center;
  justify-content: center;
`,bs=({nodes:e})=>s.jsx(s.Fragment,{children:e.map(t=>s.jsx(Ce,{node:{x:t.x,y:t.y,z:t.z,id:t.ref_id||"",type:t.type||""}},t.ref_id))}),ws=({onSchemaCreate:e,selectedSchema:t,onDelete:o})=>{console.log(e,t,o);const[n,r]=ke(i=>[i.schemas,i.links]),a=n.filter(i=>i.ref_id&&!i.is_deleted),p=[];a.forEach(i=>{p.some(l=>l.ref_id===i.ref_id)||p.push(i)});const u=p.map(i=>({...i,children:p.filter(l=>l.parent===i.type).map(l=>l.ref_id||"")})),d=xs(u),c=r.filter(i=>i.edge_type==="CHILD_OF"&&d.some(l=>l.ref_id===i.source||l.ref_id===i.target)).map(i=>{const l=d.find(g=>g.ref_id===i.source)||{x:0,y:0,z:0},f=d.find(g=>g.ref_id===i.target)||{x:0,y:0,z:0};return{...i,start:{x:l.x,y:l.y,z:l.z},end:{x:f.x,y:f.y,z:f.z}}});return s.jsx(js,{children:s.jsxs(xt,{camera:{zoom:80},id:"schema-canvas",orthographic:!0,children:[s.jsx(gt,{}),s.jsx($e,{links:c}),s.jsx(s.Fragment,{children:s.jsx(bs,{nodes:d})})]})})},js=w(m)`
  flex: 1 1 100%;
  justify-content: center;
  align-items: center;
`,vs=({onSchemaCreate:e,selectedSchema:t,onDelete:o,onClose:n})=>{const{close:r}=E("blueprintGraph"),a=()=>{r(),n()};return s.jsx(ce,{id:"blueprintGraph",kind:"full",onClose:a,preventOutsideClose:!0,children:s.jsx(ws,{onDelete:o,onSchemaCreate:e,selectedSchema:t})})};function Ss(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}const ks=({schema:e,onOpenActions:t})=>s.jsxs(nt,{children:[s.jsx(G,{className:"empty"}),s.jsx(G,{children:Ss(e.type??"")}),s.jsx(G,{children:s.jsx(be,{disabled:(e==null?void 0:e.type)==="thing",onClick:()=>t(e),children:s.jsx(mt,{"data-testid":"EditIcon"})})})]}),$s=x.memo(ks),Cs=({schemas:e,setSelectedSchema:t})=>{const{open:o}=E("addType"),[n,r]=Oe.useState(null),a=async()=>{o()},p=x.useCallback(c=>{o(),t(c)},[o,t]),u=()=>{r(null)},d=()=>{r(null),a()},h=!!n;return s.jsxs(s.Fragment,{children:[s.jsxs(yt,{component:"table",children:[s.jsx(ot,{children:s.jsxs(bt,{component:"tr",children:[s.jsx(G,{className:"empty"}),s.jsx(G,{children:"Type"}),s.jsx(G,{className:"empty"})]})}),s.jsx("tbody",{children:e==null?void 0:e.map(c=>s.jsx($s,{onOpenActions:p,schema:c},c==null?void 0:c.type))})]}),s.jsx(zs,{anchorEl:n,anchorOrigin:{vertical:"bottom",horizontal:"right"},id:"schema-editor",onClose:u,open:h,transformOrigin:{vertical:"top",horizontal:"right"},children:s.jsxs(Bs,{onClick:d,children:[s.jsx(rt,{"data-testid":"EditTopicIcon"})," Edit"]})})]})},Bs=w(m).attrs({direction:"row",px:12,py:8})`
  display: flex;
  align-items: center;
  justify-content: start;
  gap: 12px;
  cursor: pointer;
  background: ${v.BUTTON1};
  color: ${v.white};

  &:hover {
    background: ${v.BUTTON1_HOVER};
    color: ${v.GRAY3};
  }
`,zs=w(ct)`
  && {
    z-index: 9999;
  }
  .MuiPaper-root {
    min-width: 149px;
    color: ${v.GRAY3};
    box-shadow: 0px 1px 6px 0px rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    z-index: 1;
    font-family: Barlow;
    font-size: 14px;
    font-weight: 500;
  }
`,Ts=()=>{const[e,t]=x.useState(!0),[o,n,r]=ke(i=>[i.schemas,i.setSchemas,i.setSchemaLinks]),[a,p]=x.useState(null),{open:u}=E("blueprintGraph"),{open:d}=E("addType");x.useEffect(()=>{(async()=>{try{const l=await We();n(l.schemas.filter(f=>f.ref_id&&!f.is_deleted)),r(l.edges),t(!1)}catch(l){console.error("Error fetching data:",l),t(!1)}})()},[n,r]);const h=i=>{const l=o.some(f=>f.type===i.type);n(l?o.map(f=>f.type===i.type?i:f):[...o,i])},c=i=>{n(o.filter(l=>l.type!==i))};return s.jsxs(m,{grow:1,shrink:1,children:[s.jsxs(m,{direction:"row",justify:"space-between",px:37,py:21,children:[s.jsx(U,{color:"primary",onClick:d,size:"medium",startIcon:s.jsx(ve,{}),type:"submit",variant:"contained",children:"Create New Type"}),s.jsx(U,{onClick:u,startIcon:s.jsx(Ye,{}),variant:"text",children:"Graph View"})]}),s.jsx(Rs,{align:e?"center":"flex-start",justify:e?"center":"flex-start",children:e?s.jsx(Y,{color:v.white}):s.jsx(s.Fragment,{children:s.jsx(Cs,{schemas:o,setSelectedSchema:p})})}),s.jsx(hs,{onClose:()=>p(null),onDelete:c,onSchemaCreate:h,selectedSchema:a}),s.jsx(vs,{onClose:()=>p(null),onDelete:c,onSchemaCreate:h,selectedSchema:a})]})},Rs=w(m)`
  min-height: 0;
  overflow: auto;
  flex: 1;
  width: 100%;
`,Ns=e=>{const{children:t,value:o,index:n,...r}=e;return o===n?s.jsx(Is,{"aria-labelledby":`simple-tab-${n}`,hidden:o!==n,id:`simple-tabpanel-${n}`,role:"tabpanel",...r,children:t}):null};function Ps(e){return{id:`simple-tab-${e}`,"aria-controls":`simple-tabpanel-${e}`}}const Fs=({onClose:e})=>{const[t,o]=x.useState(0),[n]=Ve(c=>[c.isAdmin,c.setPubKey]),r=Ue(c=>c.customSchemaFlag),a=me(c=>c.appMetaData),p=()=>n?"Admin Settings":"Settings",u=({children:c})=>s.jsxs(Ms,{children:[s.jsx(m,{direction:"row",pt:3,children:s.jsx(Ds,{"data-testid":"setting-label",children:p()})}),c]}),d=(c,i)=>{o(i)},h=[...n?[{label:"General",component:ss}]:[],{label:"Appearance",component:Xt},...n&&r?[{label:"Blueprint",component:Ts}]:[]];return s.jsxs(Ls,{direction:"column",children:[s.jsx(u,{children:s.jsx(Es,{"aria-label":"settings tabs",onChange:d,value:t,children:h.map((c,i)=>s.jsx(As,{disableRipple:!0,label:c.label,...Ps(i)},c.label))})}),h.map((c,i)=>s.jsx(Ns,{index:i,value:t,children:a&&s.jsx(c.component,{initialValues:a,onClose:e})},c.label))]})},Es=w(Ze)`
  && {
    .MuiTabs-indicator {
      background: ${v.primaryBlue};
    }
    padding-left: 34px;
  }
`,Ms=w(m)`
  border-radius: 9px 9px 0 0;
  background: rgb(22, 24, 30);
  padding: 40px 36px 0 0;
`,As=w(Qe)`
  && {
    min-width: 0;
    width: auto;
    padding: 30px 0 19px;
    color: ${v.GRAY6};
    margin-right: 87px;
    font-family: Barlow;
    font-size: 16px;
    font-style: normal;
    font-weight: 500;
    text-align: left;

    &.Mui-selected {
      color: ${v.white};
    }
  }
`,Is=w(m)`
  display: flex;
  flex: 1;
  min-height: 495px;
  max-height: 495px;
  height: fit-content;
  min-width: 480px;
  overflow: hidden;
  border-radius: 9px;
`,Ls=w(m)`
  min-height: 0;
  flex: 1;
`,Ds=w(P)`
  font-size: 22px;
  font-weight: 600;
  font-family: Barlow;
  padding: 0 0 0 36px;
`,dn=()=>{const{close:e}=E("settings"),{visible:t}=E("addItem");return t?null:s.jsx(ce,{background:"BG1",id:"settings",noWrap:!0,onClose:e,children:s.jsx(Fs,{onClose:e})})};export{dn as SettingsModal};
