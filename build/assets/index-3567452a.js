import{r as E,a as Xa,j as D,R as Zr,Y as uu,a1 as Jt,O as tt,M as oi,Q as Pt,S as _t,U as ai,b2 as Co,X as Zd,b3 as Xd,b4 as $d,b5 as Qd,b6 as Kd,b7 as Jd,b8 as ef,b9 as tf,a3 as hu,ba as sf,ac as Xo,N as nf,bb as rf,bc as of,aj as af,bd as cf,b1 as lf}from"./index-576d1075.js";import{u as ge,a as $a,e as Qa,b as kt,L as uf,c as hf,d as df,m as ff,f as pf,g as mf,h as du,H as dr,t as fu,T as _f,i as gf,j as vf,D as yf,C as Tf,P as xf,k as kf}from"./index-20e4ba32.js";import{D as Cr,F as wf,V as K,a as Ie,T as Eo,b as Sf,C as ds,W as bf,c as Cf,E as Ka,d as Tt,N as Gn,e as Ef,B as ci,U as _s,M as Of,f as Af,g as Mf,h as Df,i as Rf,j as Er,k as Ri,S as es,l as Pf,m as $,R as Nf,n as ks,o as xa,P as pu,p as Ja,q as el,r as If,L as Xr,s as Ff,t as mu,u as _u,v as gu,w as vu,x as tl,y as Uf,z as Lf,A as Or,H as zf,G as Bf,I as Vf,J as Hf,K as jf,O as qf,Q as fr}from"./three.module-a2e04964.js";import{_ as Fe,a as Ht,u as ec,T as sl,A as Wf,D as Gf,b as Yf,M as Zf,c as Xf,P as $f,d as Qf,e as Kf,f as Jf,g as ep,O as tp,h as sp}from"./index-21f1fa59.js";function np(n){let e;const t=new Set,s=(l,u)=>{const h=typeof l=="function"?l(e):l;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(f=>f(e,d))}},i=()=>e,r=(l,u=i,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const m=u(e);if(!h(d,m)){const p=d;l(d=m,p)}}return t.add(f),()=>t.delete(f)},c={setState:s,getState:i,subscribe:(l,u,h)=>u||h?r(l,u,h):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=n(s,i,c),c}const ip=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),nl=ip?E.useEffect:E.useLayoutEffect;function rp(n){const e=typeof n=="function"?np(n):n,t=(s=e.getState,i=Object.is)=>{const[,r]=E.useReducer(g=>g+1,0),o=e.getState(),a=E.useRef(o),c=E.useRef(s),l=E.useRef(i),u=E.useRef(!1),h=E.useRef();h.current===void 0&&(h.current=s(o));let d,f=!1;(a.current!==o||c.current!==s||l.current!==i||u.current)&&(d=s(o),f=!i(h.current,d)),nl(()=>{f&&(h.current=d),a.current=o,c.current=s,l.current=i,u.current=!1});const m=E.useRef(o);nl(()=>{const g=()=>{try{const w=e.getState(),S=c.current(w);l.current(h.current,S)||(a.current=w,h.current=S,r())}catch{u.current=!0,r()}},y=e.subscribe(g);return e.getState()!==m.current&&g(),y},[]);const p=f?d:h.current;return E.useDebugValue(p),p};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[t,e];return{next(){const i=s.length<=0;return{value:s.shift(),done:i}}}},t}let mi=0;const op=rp(n=>(Cr.onStart=(e,t,s)=>{n({active:!0,item:e,loaded:t,total:s,progress:(t-mi)/(s-mi)*100})},Cr.onLoad=()=>{n({active:!1})},Cr.onError=e=>n(t=>({errors:[...t.errors,e]})),Cr.onProgress=(e,t,s)=>{t===s&&(mi=s),n({active:!0,item:e,loaded:t,total:s,progress:(t-mi)/(s-mi)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),ap=n=>`Loading ${n.toFixed(2)}%`;function cp({containerStyles:n,innerStyles:e,barStyles:t,dataStyles:s,dataInterpolation:i=ap,initialState:r=o=>o}){const{active:o,progress:a}=op(),c=E.useRef(0),l=E.useRef(0),u=E.useRef(null),[h,d]=E.useState(r(o));E.useEffect(()=>{let m;return o!==h&&(m=setTimeout(()=>d(o),300)),()=>clearTimeout(m)},[h,o]);const f=E.useCallback(()=>{u.current&&(c.current+=(a-c.current)/2,(c.current>.95*a||a===100)&&(c.current=a),u.current.innerText=i(c.current),c.current<a&&(l.current=requestAnimationFrame(f)))},[i,a]);return E.useEffect(()=>(f(),()=>cancelAnimationFrame(l.current)),[f]),h?E.createElement("div",{style:{...Ar.container,opacity:o?1:0,...n}},E.createElement("div",null,E.createElement("div",{style:{...Ar.inner,...e}},E.createElement("div",{style:{...Ar.bar,transform:`scaleX(${a/100})`,...t}}),E.createElement("span",{ref:u,style:{...Ar.data,...s}})))):null}const Ar={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};let _i;function lp(){var n;if(_i!==void 0)return _i;try{let e;const t=document.createElement("canvas");return _i=!!(window.WebGL2RenderingContext&&(e=t.getContext("webgl2"))),e&&((n=e.getExtension("WEBGL_lose_context"))==null||n.loseContext()),_i}catch{return _i=!1}}const $o=new wf,Qo=new K,En=new K,Nt=new K,is=new K,Wt=new K,rs=new K,os=new K,gi=new K,vi=new K,yi=new K,Mr=new K,Ti=new K,xi=new K,ki=new K;class up{constructor(e,t,s){this.camera=e,this.scene=t,this.startPoint=new K,this.endPoint=new K,this.collection=[],this.deep=s||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum($o,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){En.copy(e),En.x=Math.min(e.x,t.x),En.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),Nt.setFromMatrixPosition(this.camera.matrixWorld),is.copy(En),Wt.set(t.x,En.y,0),rs.copy(t),os.set(En.x,t.y,0),is.unproject(this.camera),Wt.unproject(this.camera),rs.unproject(this.camera),os.unproject(this.camera),Ti.copy(is).sub(Nt),xi.copy(Wt).sub(Nt),ki.copy(rs).sub(Nt),Ti.normalize(),xi.normalize(),ki.normalize(),Ti.multiplyScalar(this.deep),xi.multiplyScalar(this.deep),ki.multiplyScalar(this.deep),Ti.add(Nt),xi.add(Nt),ki.add(Nt);var s=$o.planes;s[0].setFromCoplanarPoints(Nt,is,Wt),s[1].setFromCoplanarPoints(Nt,Wt,rs),s[2].setFromCoplanarPoints(rs,os,Nt),s[3].setFromCoplanarPoints(os,is,Nt),s[4].setFromCoplanarPoints(Wt,rs,os),s[5].setFromCoplanarPoints(ki,xi,Ti),s[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const i=Math.min(e.x,t.x),r=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);is.set(i,r,-1),Wt.set(o,r,-1),rs.set(o,a,-1),os.set(i,a,-1),gi.set(i,r,1),vi.set(o,r,1),yi.set(o,a,1),Mr.set(i,a,1),is.unproject(this.camera),Wt.unproject(this.camera),rs.unproject(this.camera),os.unproject(this.camera),gi.unproject(this.camera),vi.unproject(this.camera),yi.unproject(this.camera),Mr.unproject(this.camera);var s=$o.planes;s[0].setFromCoplanarPoints(is,gi,vi),s[1].setFromCoplanarPoints(Wt,vi,yi),s[2].setFromCoplanarPoints(yi,Mr,os),s[3].setFromCoplanarPoints(Mr,gi,is),s[4].setFromCoplanarPoints(Wt,rs,os),s[5].setFromCoplanarPoints(yi,vi,gi),s[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&t.material!==void 0&&(t.geometry.boundingSphere===null&&t.geometry.computeBoundingSphere(),Qo.copy(t.geometry.boundingSphere.center),Qo.applyMatrix4(t.matrixWorld),e.containsPoint(Qo)&&this.collection.push(t)),t.children.length>0)for(let s=0;s<t.children.length;s++)this.searchChildInFrustum(e,t.children[s])}}function hp(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let s=0;s<t.length;s++)if(!Object.prototype.hasOwnProperty.call(e,t[s])||!Object.is(n[t[s]],e[t[s]]))return!1;return!0}const dp=E.createContext([]);function fp({box:n,multiple:e,children:t,onChange:s,border:i="1px solid #55aaff",backgroundColor:r="rgba(75, 160, 255, 0.1)",filter:o=c=>c,...a}){const{setEvents:c,camera:l,raycaster:u,gl:h,controls:d,size:f,get:m}=ge(),[p,g]=E.useState(!1),[y,w]=E.useReducer((x,{object:T,shift:k})=>T===void 0?[]:Array.isArray(T)?T:k?x.includes(T)?x.filter(b=>b!==T):[T,...x]:x[0]===T?[]:[T],[]);E.useEffect(()=>void(s==null?void 0:s(y)),[y]);const S=E.useCallback(x=>{x.stopPropagation(),w({object:o([x.object])[0],shift:e&&x.shiftKey})},[]),v=E.useCallback(x=>!p&&w({}),[p]),_=E.useRef(null);return E.useEffect(()=>{if(!n||!e)return;const x=new up(l,_.current),T=document.createElement("div");T.style.pointerEvents="none",T.style.border=i,T.style.backgroundColor=r,T.style.position="fixed";const k=new Ie,b=new Ie,C=new Ie,O=m().events.enabled,A=d==null?void 0:d.enabled;let R=!1;function P(z,xe){const{offsetX:ae,offsetY:X}=z,{width:me,height:We}=f;xe.set(ae/me*2-1,-(X/We)*2+1)}function F(z){var xe;d&&(d.enabled=!1),c({enabled:!1}),R=!0,(xe=h.domElement.parentElement)==null||xe.appendChild(T),T.style.left=`${z.clientX}px`,T.style.top=`${z.clientY}px`,T.style.width="0px",T.style.height="0px",k.x=z.clientX,k.y=z.clientY}function I(z){C.x=Math.max(k.x,z.clientX),C.y=Math.max(k.y,z.clientY),b.x=Math.min(k.x,z.clientX),b.y=Math.min(k.y,z.clientY),T.style.left=`${b.x}px`,T.style.top=`${b.y}px`,T.style.width=`${C.x-b.x}px`,T.style.height=`${C.y-b.y}px`}function U(){if(R){var z;d&&(d.enabled=A),c({enabled:O}),R=!1,(z=T.parentElement)==null||z.removeChild(T)}}function V(z){z.shiftKey&&(F(z),P(z,x.startPoint))}let B=[];function q(z){if(R){I(z),P(z,x.endPoint);const xe=x.select().sort(ae=>ae.uuid).filter(ae=>ae.isMesh);hp(xe,B)||(B=xe,w({object:o(xe)}))}}function H(z){R&&U()}return document.addEventListener("pointerdown",V,{passive:!0}),document.addEventListener("pointermove",q,{passive:!0,capture:!0}),document.addEventListener("pointerup",H,{passive:!0}),()=>{document.removeEventListener("pointerdown",V),document.removeEventListener("pointermove",q),document.removeEventListener("pointerup",H)}},[f.width,f.height,u,l,d,h]),E.createElement("group",Xa({ref:_,onClick:S,onPointerOver:()=>g(!0),onPointerOut:()=>g(!1),onPointerMissed:v},a),E.createElement(dp.Provider,{value:y},t))}const il=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function an(n,e){const t=ge(i=>i.gl),s=$a(Eo,il(n)?Object.values(n):n);if(E.useLayoutEffect(()=>{e==null||e(s)},[e]),E.useEffect(()=>{(Array.isArray(s)?s:[s]).forEach(t.initTexture)},[t,s]),il(n)){const i=Object.keys(n),r={};return i.forEach(o=>Object.assign(r,{[o]:s[i.indexOf(o)]})),r}else return s}an.preload=n=>$a.preload(Eo,n);an.clear=n=>$a.clear(Eo,n);/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Z={LEFT:1,RIGHT:2,MIDDLE:4},M=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),On={NONE:0,IN:1,OUT:-1};function Ks(n){return n.isPerspectiveCamera}function Ms(n){return n.isOrthographicCamera}const An=Math.PI*2,rl=Math.PI/2,yu=1e-5,wi=Math.PI/180;function It(n,e,t){return Math.max(e,Math.min(t,n))}function _e(n,e=yu){return Math.abs(n)<e}function oe(n,e,t=yu){return _e(n-e,t)}function ol(n,e){return Math.round(n/e)*e}function Si(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function bi(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function Dr(n,e,t,s,i=1/0,r){s=Math.max(1e-4,s);const o=2/s,a=o*r,c=1/(1+a+.48*a*a+.235*a*a*a);let l=n-e;const u=e,h=i*s;l=It(l,-h,h),e=n-l;const d=(t.value+o*l)*r;t.value=(t.value-o*d)*c;let f=e+(l+d)*c;return u-n>0==f>u&&(f=u,t.value=(f-u)/r),f}function al(n,e,t,s,i=1/0,r,o){s=Math.max(1e-4,s);const a=2/s,c=a*r,l=1/(1+c+.48*c*c+.235*c*c*c);let u=e.x,h=e.y,d=e.z,f=n.x-u,m=n.y-h,p=n.z-d;const g=u,y=h,w=d,S=i*s,v=S*S,_=f*f+m*m+p*p;if(_>v){const F=Math.sqrt(_);f=f/F*S,m=m/F*S,p=p/F*S}u=n.x-f,h=n.y-m,d=n.z-p;const x=(t.x+a*f)*r,T=(t.y+a*m)*r,k=(t.z+a*p)*r;t.x=(t.x-a*x)*l,t.y=(t.y-a*T)*l,t.z=(t.z-a*k)*l,o.x=u+(f+x)*l,o.y=h+(m+T)*l,o.z=d+(p+k)*l;const b=g-n.x,C=y-n.y,O=w-n.z,A=o.x-g,R=o.y-y,P=o.z-w;return b*A+C*R+O*P>0&&(o.x=g,o.y=y,o.z=w,t.x=(o.x-g)/r,t.y=(o.y-y)/r,t.z=(o.z-w)/r),o}function Ko(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function Jo(n,e){return Ms(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class pp{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e)}}}const mp="2.7.3",Rr=1/8,Tu=typeof window<"u",_p=Tu&&/Mac/.test(navigator.platform),gp=!(Tu&&"PointerEvent"in window);let G,cl,Pr,ea,it,J,ne,Mn,Ci,Gt,Yt,Js,ll,ul,St,Ei,Dn,hl,ta,dl,sa,na,Nr,ia=class ka extends pp{static install(e){G=e.THREE,cl=Object.freeze(new G.Vector3(0,0,0)),Pr=Object.freeze(new G.Vector3(0,1,0)),ea=Object.freeze(new G.Vector3(0,0,1)),it=new G.Vector2,J=new G.Vector3,ne=new G.Vector3,Mn=new G.Vector3,Ci=new G.Vector3,Gt=new G.Vector3,Yt=new G.Vector3,Js=new G.Vector3,ll=new G.Vector3,ul=new G.Vector3,St=new G.Spherical,Ei=new G.Spherical,Dn=new G.Box3,hl=new G.Box3,ta=new G.Sphere,dl=new G.Quaternion,sa=new G.Quaternion,na=new G.Matrix4,Nr=new G.Raycaster}static get ACTION(){return M}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=M.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=On.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new G.Vector3,this._focalOffsetVelocity=new G.Vector3,this._zoomVelocity={value:0},this._truckInternal=(v,_,x)=>{let T,k;if(Ks(this._camera)){const b=J.copy(this._camera.position).sub(this._target),C=this._camera.getEffectiveFOV()*wi,O=b.length()*Math.tan(C*.5);T=this.truckSpeed*v*O/this._elementRect.height,k=this.truckSpeed*_*O/this._elementRect.height}else if(Ms(this._camera)){const b=this._camera;T=v*(b.right-b.left)/b.zoom/this._elementRect.width,k=_*(b.top-b.bottom)/b.zoom/this._elementRect.height}else return;this.verticalDragToForward?(x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(T,0,!0),this.forward(-k,!0)):x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y+k,this._focalOffsetEnd.z,!0):this.truck(T,k,!0)},this._rotateInternal=(v,_)=>{const x=An*this.azimuthRotateSpeed*v/this._elementRect.height,T=An*this.polarRotateSpeed*_/this._elementRect.height;this.rotate(x,T,!0)},this._dollyInternal=(v,_,x)=>{const T=Math.pow(.95,-v*this.dollySpeed),k=this._sphericalEnd.radius,b=this._sphericalEnd.radius*T,C=It(b,this.minDistance,this.maxDistance),O=C-b;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(b,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(O,!0),this._dollyToNoClamp(C,!0)):this._dollyToNoClamp(C,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?b:C)-k,this._dollyControlCoord.set(_,x)),this._lastDollyDirection=Math.sign(-v)},this._zoomInternal=(v,_,x)=>{const T=Math.pow(.95,v*this.dollySpeed),k=this._zoom,b=this._zoom*T;this.zoomTo(b,!0),this.dollyToCursor&&(this._changedZoom+=b-k,this._dollyControlCoord.set(_,x))},typeof G>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new G.Quaternion().setFromUnitVectors(this._camera.up,Pr),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=M.NONE,this._target=new G.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new G.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new G.Spherical().setFromVector3(J.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3],this._updateNearPlaneCorners(),this._boundary=new G.Box3(new G.Vector3(-1/0,-1/0,-1/0),new G.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new G.Vector2,this.mouseButtons={left:M.ROTATE,middle:M.DOLLY,right:M.TRUCK,wheel:Ks(this._camera)?M.DOLLY:Ms(this._camera)?M.ZOOM:M.NONE},this.touches={one:M.TOUCH_ROTATE,two:Ks(this._camera)?M.TOUCH_DOLLY_TRUCK:Ms(this._camera)?M.TOUCH_ZOOM_TRUCK:M.NONE,three:M.TOUCH_TRUCK};const s=new G.Vector2,i=new G.Vector2,r=new G.Vector2,o=v=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const T=this._domElement.getBoundingClientRect(),k=v.clientX/T.width,b=v.clientY/T.height;if(k<this._interactiveArea.left||k>this._interactiveArea.right||b<this._interactiveArea.top||b>this._interactiveArea.bottom)return}const _=v.pointerType!=="mouse"?null:(v.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(v.buttons&Z.MIDDLE)===Z.MIDDLE?Z.MIDDLE:(v.buttons&Z.RIGHT)===Z.RIGHT?Z.RIGHT:null;if(_!==null){const T=this._findPointerByMouseButton(_);T&&this._disposePointer(T)}if((v.buttons&Z.LEFT)===Z.LEFT&&this._lockedPointer)return;const x={pointerId:v.pointerId,clientX:v.clientX,clientY:v.clientY,deltaX:0,deltaY:0,mouseButton:_};this._activePointers.push(x),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),this._isDragging=!0,p(v)},a=v=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const T=this._domElement.getBoundingClientRect(),k=v.clientX/T.width,b=v.clientY/T.height;if(k<this._interactiveArea.left||k>this._interactiveArea.right||b<this._interactiveArea.top||b>this._interactiveArea.bottom)return}const _=(v.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(v.buttons&Z.MIDDLE)===Z.MIDDLE?Z.MIDDLE:(v.buttons&Z.RIGHT)===Z.RIGHT?Z.RIGHT:null;if(_!==null){const T=this._findPointerByMouseButton(_);T&&this._disposePointer(T)}const x={pointerId:1,clientX:v.clientX,clientY:v.clientY,deltaX:0,deltaY:0,mouseButton:(v.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(v.buttons&Z.MIDDLE)===Z.LEFT?Z.MIDDLE:(v.buttons&Z.RIGHT)===Z.LEFT?Z.RIGHT:null};this._activePointers.push(x),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",h),this._isDragging=!0,p(v)},c=v=>{v.cancelable&&v.preventDefault();const _=v.pointerId,x=this._lockedPointer||this._findPointerById(_);if(x){if(x.clientX=v.clientX,x.clientY=v.clientY,x.deltaX=v.movementX,x.deltaY=v.movementY,this._state=0,v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(v.buttons&Z.LEFT)===Z.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(v.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(v.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right);g()}},l=v=>{const _=this._lockedPointer||this._findPointerById(1);_&&(_.clientX=v.clientX,_.clientY=v.clientY,_.deltaX=v.movementX,_.deltaY=v.movementY,this._state=0,(this._lockedPointer||(v.buttons&Z.LEFT)===Z.LEFT)&&(this._state=this._state|this.mouseButtons.left),(v.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(v.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right),g())},u=v=>{const _=this._findPointerById(v.pointerId);if(!(_&&_===this._lockedPointer)){if(_&&this._disposePointer(_),v.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=M.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=M.NONE;y()}},h=()=>{const v=this._findPointerById(1);v&&v===this._lockedPointer||(v&&this._disposePointer(v),this._state=M.NONE,y())};let d=-1;const f=v=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===M.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const b=this._domElement.getBoundingClientRect(),C=v.clientX/b.width,O=v.clientY/b.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}if(v.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===M.ROTATE||this.mouseButtons.wheel===M.TRUCK){const b=performance.now();d-b<1e3&&this._getClientRect(this._elementRect),d=b}const _=_p?-1:-3,x=v.deltaMode===1?v.deltaY/_:v.deltaY/(_*10),T=this.dollyToCursor?(v.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,k=this.dollyToCursor?(v.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case M.ROTATE:{this._rotateInternal(v.deltaX,v.deltaY),this._isUserControllingRotate=!0;break}case M.TRUCK:{this._truckInternal(v.deltaX,v.deltaY,!1),this._isUserControllingTruck=!0;break}case M.OFFSET:{this._truckInternal(v.deltaX,v.deltaY,!0),this._isUserControllingOffset=!0;break}case M.DOLLY:{this._dollyInternal(-x,T,k),this._isUserControllingDolly=!0;break}case M.ZOOM:{this._zoomInternal(-x,T,k),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=v=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ka.ACTION.NONE){const _=v instanceof PointerEvent?v.pointerId:(v instanceof MouseEvent,0),x=this._findPointerById(_);x&&this._disposePointer(x),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h);return}v.preventDefault()}},p=v=>{if(!this._enabled)return;if(Ko(this._activePointers,it),this._getClientRect(this._elementRect),s.copy(it),i.copy(it),this._activePointers.length>=2){const x=it.x-this._activePointers[1].clientX,T=it.y-this._activePointers[1].clientY,k=Math.sqrt(x*x+T*T);r.set(0,k);const b=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,C=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(b,C)}if(this._state=0,!v)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in v&&v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(v.buttons&Z.LEFT)===Z.LEFT&&(this._state=this._state|this.mouseButtons.left),(v.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(v.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&M.ROTATE)===M.ROTATE||(this._state&M.TOUCH_ROTATE)===M.TOUCH_ROTATE||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&M.TRUCK)===M.TRUCK||(this._state&M.TOUCH_TRUCK)===M.TOUCH_TRUCK||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&M.DOLLY)===M.DOLLY||(this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&M.ZOOM)===M.ZOOM||(this._state&M.TOUCH_ZOOM)===M.TOUCH_ZOOM||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&M.OFFSET)===M.OFFSET||(this._state&M.TOUCH_OFFSET)===M.TOUCH_OFFSET||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Ko(this._activePointers,it);const _=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,x=_?-_.deltaX:i.x-it.x,T=_?-_.deltaY:i.y-it.y;if(i.copy(it),((this._state&M.ROTATE)===M.ROTATE||(this._state&M.TOUCH_ROTATE)===M.TOUCH_ROTATE||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(x,T),this._isUserControllingRotate=!0),(this._state&M.DOLLY)===M.DOLLY||(this._state&M.ZOOM)===M.ZOOM){const k=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,b=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,C=this.dollyDragInverted?-1:1;(this._state&M.DOLLY)===M.DOLLY?(this._dollyInternal(C*T*Rr,k,b),this._isUserControllingDolly=!0):(this._zoomInternal(C*T*Rr,k,b),this._isUserControllingZoom=!0)}if((this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_ZOOM)===M.TOUCH_ZOOM||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE){const k=it.x-this._activePointers[1].clientX,b=it.y-this._activePointers[1].clientY,C=Math.sqrt(k*k+b*b),O=r.y-C;r.set(0,C);const A=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET?(this._dollyInternal(O*Rr,A,R),this._isUserControllingDolly=!0):(this._zoomInternal(O*Rr,A,R),this._isUserControllingZoom=!0)}((this._state&M.TRUCK)===M.TRUCK||(this._state&M.TOUCH_TRUCK)===M.TOUCH_TRUCK||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(x,T,!1),this._isUserControllingTruck=!0),((this._state&M.OFFSET)===M.OFFSET||(this._state&M.TOUCH_OFFSET)===M.TOUCH_OFFSET||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(x,T,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{Ko(this._activePointers,it),i.copy(it),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",w),this._domElement.ownerDocument.addEventListener("pointerlockerror",S),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",w),this._domElement.ownerDocument.removeEventListener("pointerlockerror",S))};const w=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},S=()=>{this.unlockPointer()};this._addAllEventListeners=v=>{this._domElement=v,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),gp&&this._domElement.addEventListener("mousedown",a),this._domElement.addEventListener("pointercancel",u),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("mousedown",a),this._domElement.removeEventListener("pointercancel",u),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.removeEventListener("pointerlockchange",w),this._domElement.ownerDocument.removeEventListener("pointerlockerror",S))},this.cancel=()=>{this._state!==M.NONE&&(this._state=M.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=It(e.width,0,1),this._interactiveArea.height=It(e.height,0,1),this._interactiveArea.x=It(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=It(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=It(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=It(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||oe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&oe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0,this._dollyToNoClamp(It(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=oe(o,this._spherical.radius);if(!(s>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||oe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Ci).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=It(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||oe(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),Gt.setFromMatrixColumn(this._camera.matrix,0),Yt.setFromMatrixColumn(this._camera.matrix,1),Gt.multiplyScalar(e),Yt.multiplyScalar(-t);const i=J.copy(Gt).add(Yt),r=ne.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,s)}forward(e,t=!1){J.setFromMatrixColumn(this._camera.matrix,0),J.crossVectors(this._camera.up,J),J.multiplyScalar(e);const s=ne.copy(this._targetEnd).add(J);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return J.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+J.x,this._targetEnd.y+J.y,this._targetEnd.z+J.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const r=J.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,s,i=!1){const a=J.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(a.x,a.y,a.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const c=[],l=e.isBox3?Dn.copy(e):Dn.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=ol(this._sphericalEnd.theta,rl),h=ol(this._sphericalEnd.phi,rl);c.push(this.rotateTo(u,h,t));const d=J.setFromSpherical(this._sphericalEnd).normalize(),f=dl.setFromUnitVectors(d,ea),m=oe(Math.abs(d.y),1);m&&f.multiply(sa.setFromAxisAngle(Pr,u)),f.multiply(this._yAxisUpSpaceInverse);const p=hl.makeEmpty();ne.copy(l.min).applyQuaternion(f),p.expandByPoint(ne),ne.copy(l.min).setX(l.max.x).applyQuaternion(f),p.expandByPoint(ne),ne.copy(l.min).setY(l.max.y).applyQuaternion(f),p.expandByPoint(ne),ne.copy(l.max).setZ(l.min.z).applyQuaternion(f),p.expandByPoint(ne),ne.copy(l.min).setZ(l.max.z).applyQuaternion(f),p.expandByPoint(ne),ne.copy(l.max).setY(l.min.y).applyQuaternion(f),p.expandByPoint(ne),ne.copy(l.max).setX(l.min.x).applyQuaternion(f),p.expandByPoint(ne),ne.copy(l.max).applyQuaternion(f),p.expandByPoint(ne),p.min.x-=i,p.min.y-=o,p.max.x+=r,p.max.y+=a,f.setFromUnitVectors(ea,d),m&&f.premultiply(sa.invert()),f.premultiply(this._yAxisUpSpace);const g=p.getSize(J),y=p.getCenter(ne).applyQuaternion(f);if(Ks(this._camera)){const w=this.getDistanceToFitBox(g.x,g.y,g.z,s);c.push(this.moveTo(y.x,y.y,y.z,t)),c.push(this.dollyTo(w,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(Ms(this._camera)){const w=this._camera,S=w.right-w.left,v=w.top-w.bottom,_=s?Math.max(S/g.x,v/g.y):Math.min(S/g.x,v/g.y);c.push(this.moveTo(y.x,y.y,y.z,t)),c.push(this.zoomTo(_,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const s=[],r=e instanceof G.Sphere?ta.copy(e):ka.createBoundingSphere(e,ta);if(s.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),Ks(this._camera)){const o=this.getDistanceToFitSphere(r.radius);s.push(this.dollyTo(o,t))}else if(Ms(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*r.radius,l=Math.min(o/c,a/c);s.push(this.zoomTo(l,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const c=ne.set(i,r,o),l=J.set(e,t,s);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(l.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold)&&oe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&oe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&oe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,s,i,r,o,a,c,l,u,h,d,f,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const p=J.set(i,r,o),g=ne.set(e,t,s);St.setFromVector3(g.sub(p).applyQuaternion(this._yAxisUpSpace));const y=Mn.set(u,h,d),w=ne.set(a,c,l);Ei.setFromVector3(w.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(y,f));const S=Ei.theta-St.theta,v=Ei.phi-St.phi,_=Ei.radius-St.radius;this._sphericalEnd.set(St.radius+_*f,St.phi+v*f,St.theta+S*f),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const x=!m||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold)&&oe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&oe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&oe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(x)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const r=this.getPosition(J),o=this.setLookAt(r.x,r.y,r.z,e,t,s,i);return this._sphericalEnd.phi=It(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const r=!i||oe(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&oe(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&oe(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),Gt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Yt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Js.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=J.set(e,t,s),r=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);Gt.multiplyScalar(o.x),Yt.multiplyScalar(o.y),Js.multiplyScalar(o.z),J.copy(Gt).add(Yt).add(Js),J.z=J.z+r,this.dollyTo(r,!1),this.setFocalOffset(-J.x,J.y,-J.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new G.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Jo(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,o=this._camera.getEffectiveFOV()*wi,a=this._camera.aspect;return((i?r>a:r<a)?t:e/a)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(e){if(Jo(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*wi,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof G.Spherical?e:new G.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%An,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=An),this._spherical.theta+=An*Math.round((this._sphericalEnd.theta-this._spherical.theta)/An)}reset(e=!1){if(!oe(this._camera.up.x,this._cameraUp0.x)||!oe(this._camera.up.y,this._cameraUp0.y)||!oe(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(J);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Pr),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=J.subVectors(this._target,this._camera.position).normalize(),t=ne.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(J);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=ll.subVectors(this._targetEnd,this._target),o=ul.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(_e(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Dr(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(_e(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Dr(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(_e(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Dr(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(_e(r.x)&&_e(r.y)&&_e(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;al(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(_e(o.x)&&_e(o.y)&&_e(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;al(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(_e(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Dr(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Ks(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,d=this._camera,f=this._getCameraDirection(Ci),m=J.copy(f).cross(d.up).normalize();m.lengthSq()===0&&(m.x=1);const p=ne.crossVectors(m,f),g=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*wi*.5),w=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,S=Mn.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*g*d.aspect)).add(p.multiplyScalar(this._dollyControlCoord.y*g)),v=J.copy(this._targetEnd).lerp(S,w),_=this._lastDollyDirection===On.IN&&this._spherical.radius<=this.minDistance,x=this._lastDollyDirection===On.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(_||x)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const k=ne.copy(f).multiplyScalar(-h);v.add(k)}this._boundary.clampPoint(v,v);const T=ne.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(T),this._changedDolly-=h,_e(this._changedDolly)&&(this._changedDolly=0)}else if(Ms(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,d=this._camera,f=J.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),m=ne.set(0,0,-1).applyQuaternion(d.quaternion),p=Mn.copy(f).add(m.multiplyScalar(-f.dot(d.up))),y=-(this._zoom-h-this._zoom)/this._zoom,w=this._getCameraDirection(Ci),S=this._targetEnd.dot(w),v=J.copy(this._targetEnd).lerp(p,y),_=v.dot(w),x=w.multiplyScalar(_-S);v.sub(x),this._boundary.clampPoint(v,v);const T=ne.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(T),this._changedZoom-=h,_e(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!_e(this._focalOffset.x)||!_e(this._focalOffset.y)||!_e(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Gt.setFromMatrixColumn(this._camera.matrix,0),Yt.setFromMatrixColumn(this._camera.matrix,1),Js.setFromMatrixColumn(this._camera.matrix,2),Gt.multiplyScalar(this._focalOffset.x),Yt.multiplyScalar(-this._focalOffset.y),Js.multiplyScalar(this._focalOffset.z),J.copy(Gt).add(Yt).add(Js),this._camera.position.add(J)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),J.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),_e(t,this.restThreshold)&&_e(s,this.restThreshold)&&_e(i,this.restThreshold)&&_e(r.x,this.restThreshold)&&_e(r.y,this.restThreshold)&&_e(r.z,this.restThreshold)&&_e(o.x,this.restThreshold)&&_e(o.y,this.restThreshold)&&_e(o.z,this.restThreshold)&&_e(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Si(this.maxDistance),minZoom:this.minZoom,maxZoom:Si(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Si(this.maxPolarAngle),minAzimuthAngle:Si(this.minAzimuthAngle),maxAzimuthAngle:Si(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:J.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=bi(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=bi(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=bi(s.maxPolarAngle),this.minAzimuthAngle=bi(s.minAzimuthAngle),this.maxAzimuthAngle=bi(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),St.setFromVector3(J.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(St.theta,St.phi,t),this.dollyTo(St.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",mp),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const r=ne.copy(t).add(e),a=this._boundary.clampPoint(r,Mn).sub(r),c=a.lengthSq();if(c===0)return e.add(t);if(c===i)return e;if(s===0)return e.add(t).add(a);{const l=1+s*c/t.dot(a);return e.add(ne.copy(t).multiplyScalar(l)).add(a.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Ks(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*wi,i=Math.tan(s*.5)*t,r=i*e.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(Ms(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,r=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Jo(this._camera,"_collisionTest"))return e;const s=this._getTargetDirection(Ci);na.lookAt(cl,s,this._camera.up);for(let i=0;i<4;i++){const r=ne.copy(this._nearPlaneCorners[i]);r.applyMatrix4(na);const o=Mn.addVectors(this._target,r);Nr.set(o,s),Nr.far=this._spherical.radius+1;const a=Nr.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new G.Sphere){const s=t,i=s.center;Dn.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Dn.expandByObject(o)}),Dn.getCenter(i);let r=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const u=c.attributes.position;for(let h=0,d=u.count;h<d;h++)J.fromBufferAttribute(u,h),r=Math.max(r,i.distanceToSquared(J))}),s.radius=Math.sqrt(r),s}};const vp=E.forwardRef((n,e)=>{E.useMemo(()=>{ia.install({THREE:Sf}),Qa({CameraControlsImpl:ia})},[]);const{camera:t,domElement:s,makeDefault:i,onStart:r,onEnd:o,onChange:a,regress:c,...l}=n,u=ge(_=>_.camera),h=ge(_=>_.gl),d=ge(_=>_.invalidate),f=ge(_=>_.events),m=ge(_=>_.setEvents),p=ge(_=>_.set),g=ge(_=>_.get),y=ge(_=>_.performance),w=t||u,S=s||f.connected||h.domElement,v=E.useMemo(()=>new ia(w),[w]);return kt((_,x)=>{v.enabled&&v.update(x)},-1),E.useEffect(()=>(v.connect(S),()=>void v.disconnect()),[S,v]),E.useEffect(()=>{const _=k=>{d(),c&&y.regress(),a&&a(k)},x=k=>{r&&r(k)},T=k=>{o&&o(k)};return v.addEventListener("update",_),v.addEventListener("controlstart",x),v.addEventListener("controlend",T),()=>{v.removeEventListener("update",_),v.removeEventListener("controlstart",x),v.removeEventListener("controlend",T)}},[v,r,o,d,m,c,a]),E.useEffect(()=>{if(i){const _=g().controls;return p({controls:v}),()=>p({controls:_})}},[i,v]),E.createElement("primitive",Xa({ref:e,object:v},l))}),xu=E.createContext(null),yp=E.forwardRef((n,e)=>{E.useMemo(()=>Qa({SegmentObject:Tp}),[]);const{limit:t=1e3,lineWidth:s=1,children:i,...r}=n,[o,a]=E.useState([]),[c]=E.useState(()=>new uf),[l]=E.useState(()=>new hf),[u]=E.useState(()=>new df),[h]=E.useState(()=>new Ie(512,512)),[d]=E.useState(()=>Array(t*6).fill(0)),[f]=E.useState(()=>Array(t*6).fill(0)),m=E.useMemo(()=>({subscribe:p=>(a(g=>[...g,p]),()=>a(g=>g.filter(y=>y.current!==p.current)))}),[]);return kt(()=>{for(let g=0;g<t;g++){var p;const y=(p=o[g])==null?void 0:p.current;y&&(d[g*6+0]=y.start.x,d[g*6+1]=y.start.y,d[g*6+2]=y.start.z,d[g*6+3]=y.end.x,d[g*6+4]=y.end.y,d[g*6+5]=y.end.z,f[g*6+0]=y.color.r,f[g*6+1]=y.color.g,f[g*6+2]=y.color.b,f[g*6+3]=y.color.r,f[g*6+4]=y.color.g,f[g*6+5]=y.color.b)}u.setColors(f),u.setPositions(d),c.computeLineDistances()}),E.createElement("primitive",{object:c,ref:e},E.createElement("primitive",{object:u,attach:"geometry"}),E.createElement("primitive",Xa({object:l,attach:"material",vertexColors:!0,resolution:h,linewidth:s},r)),E.createElement(xu.Provider,{value:m},i))});class Tp{constructor(){this.color=new ds("white"),this.start=new K(0,0,0),this.end=new K(0,0,0)}}const fl=n=>n instanceof K?n:new K(...typeof n=="number"?[n,n,n]:n),xp=E.forwardRef(({color:n,start:e,end:t},s)=>{const i=E.useContext(xu);if(!i)throw"Segment must used inside Segments component.";const r=E.useRef(null);return E.useLayoutEffect(()=>i.subscribe(r),[]),E.createElement("segmentObject",{ref:ff([r,s]),color:n,start:fl(e),end:fl(t)})});function kp({all:n,scene:e,camera:t}){const s=ge(({gl:o})=>o),i=ge(({camera:o})=>o),r=ge(({scene:o})=>o);return E.useLayoutEffect(()=>{const o=[];n&&(e||r).traverse(l=>{l.visible===!1&&(o.push(l),l.visible=!0)}),s.compile(e||r,t||i);const a=new bf(128);new Cf(.01,1e5,a).update(s,e||r),a.dispose(),o.forEach(l=>l.visible=!1)},[]),null}function wp({pixelated:n}){const e=ge(o=>o.gl),t=ge(o=>o.internal.active),s=ge(o=>o.performance.current),i=ge(o=>o.viewport.initialDpr),r=ge(o=>o.setDpr);return E.useEffect(()=>{const o=e.domElement;return()=>{t&&r(i),n&&o&&(o.style.imageRendering="auto")}},[]),E.useEffect(()=>{r(s*i),n&&e.domElement&&(e.domElement.style.imageRendering=s===1?"auto":"pixelated")},[s]),null}function Sp(){const n=ge(s=>s.get),e=ge(s=>s.setEvents),t=ge(s=>s.performance.current);return E.useEffect(()=>{const s=n().events.enabled;return()=>e({enabled:s})},[]),E.useEffect(()=>e({enabled:t===1}),[t]),null}const tc=E.createContext(null);function bp({children:n,enabled:e=!0}){const[t,s]=E.useState([]),i=E.useMemo(()=>({selected:t,select:s,enabled:e}),[t,s,e]);return D.jsx(tc.Provider,{value:i,children:n})}function Cp({enabled:n=!1,children:e,...t}){const s=E.useRef(null),i=E.useContext(tc);return E.useEffect(()=>{if(i&&n){let r=!1;const o=[];if(s.current.traverse(a=>{a.type==="Mesh"&&o.push(a),i.selected.indexOf(a)===-1&&(r=!0)}),r)return i.select(a=>[...a,...o]),()=>{i.select(a=>a.filter(c=>!o.includes(c)))}}},[n,e,i]),D.jsx("group",{ref:s,...t,children:e})}/**
 * postprocessing v6.33.4 build Sat Dec 02 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rüschen
 * @license Zlib
 */var ku="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",ee={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},wu="",He="srgb",Oo="srgb-linear",fs={NONE:0,DEPTH:1,CONVOLUTION:2},ie={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Ao={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Ir={DEFAULT:0,ESKIL:1},Su=Number(Ja.replace(/\D+/g,"")),bu=Su>=152,Ep=new Map([[gu,Oo],[vu,He]]),Op=new Map([[Oo,gu],[He,vu]]);function Yn(n){return n===null?null:bu?n.outputColorSpace:Ep.get(n.outputEncoding)}function Is(n,e){n!==null&&(bu?n.colorSpace=e:n.encoding=Op.get(e))}function pr(n){return Su<154?n.replace("colorspace_fragment","encodings_fragment"):n}var Ap=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Mp="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Dp=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Rp=class extends es{constructor(n=new tl){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new $(null),texelSize:new $(new tl),scale:new $(1),kernel:new $(0)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ap,vertexShader:Mp}),this.fragmentShader=pr(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=Ao.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Dp[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,s=1/e;this.uniforms.texelSize.value.set(t,s,t*.5,s*.5)}},Pp=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Cu=class extends es{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new $(null),opacity:new $(1)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Pp,vertexShader:ku}),this.fragmentShader=pr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Np=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;centroid varying float vViewZ;centroid varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,Ip=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,Fp=class extends es{constructor(n=null,e){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),cameraNear:new $(.3),cameraFar:new $(1e3)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Np,vertexShader:Ip}),this.depthBuffer=n,this.depthPacking=xa,this.copyCameraSettings(e)}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=xa){this.depthBuffer=n,this.depthPacking=e}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof pu?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Up=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Lp="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",zp=class extends es{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),normalBuffer:new $(null),texelSize:new $(new Ie)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Up,vertexShader:Lp})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=ci){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Bp=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Vp="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Hp=class extends es{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new $(null),texelSize:new $(new Ie)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Bp,vertexShader:Vp}),this.fragmentShader=pr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},jp=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,qp="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Wp=class extends es{constructor(n,e,t,s,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Ja.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new $(null),depthBuffer:new $(null),resolution:new $(new Ie),texelSize:new $(new Ie),cameraNear:new $(.3),cameraFar:new $(1e3),aspect:new $(1),time:new $(0)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(s)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=ci){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=jp.replace(ie.FRAGMENT_HEAD,n.get(ie.FRAGMENT_HEAD)||"").replace(ie.FRAGMENT_MAIN_UV,n.get(ie.FRAGMENT_MAIN_UV)||"").replace(ie.FRAGMENT_MAIN_IMAGE,n.get(ie.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=qp.replace(ie.VERTEX_HEAD,n.get(ie.VERTEX_HEAD)||"").replace(ie.VERTEX_MAIN_SUPPORT,n.get(ie.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=pr(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof pu?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return ie}},Gp=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Yp=class extends es{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Ja.replace(/\D+/g,"")},uniforms:{inputBuffer:new $(null),threshold:new $(0),smoothing:new $(1),range:new $(null)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Gp,vertexShader:ku}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Zp="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",Xp="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",$p=class extends es{constructor(n=new Ie){super({name:"OutlineMaterial",uniforms:{inputBuffer:new $(null),texelSize:new $(new Ie)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Zp,vertexShader:Xp}),this.uniforms.texelSize.value.set(n.x,n.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Qp=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Kp="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Jp=class extends es{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new $(null),supportBuffer:new $(null),texelSize:new $(new Ie),radius:new $(.85)},blending:ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Qp,vertexShader:Kp}),this.fragmentShader=pr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},e0=new Uf,Es=null;function t0(){if(Es===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Es=new Lf,Es.setAttribute!==void 0?(Es.setAttribute("position",new Or(n,3)),Es.setAttribute("uv",new Or(e,2))):(Es.addAttribute("position",new Or(n,3)),Es.addAttribute("uv",new Or(e,2)))}return Es}var st=class Eu{constructor(e="Pass",t=new el,s=e0){this.name=e,this.renderer=null,this.scene=t,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new If(t0(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new el),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=ci){}render(e,t,s,i,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Tt||t instanceof mu||t instanceof _u||t instanceof Eu)&&this[e].dispose()}}},s0=class extends st{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Cu,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Xr,magFilter:Xr,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,s,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==_s?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Yn(n)===He&&Is(this.renderTarget.texture,He))}},n0=class extends st{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,s,i){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},pl=new ds,sc=class extends st{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,s,i){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=r!==null,l=o>=0;c?(n.getClearColor(pl),n.setClearColor(r,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(pl,a):l&&n.setClearAlpha(a)}},Mo=class extends st{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new sc,this.overrideMaterialManager=t===null?null:new _l(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new _l(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=r.background,u=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=c,r.background=l,n.shadowMap.autoUpdate=u}},i0=class extends st{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Ee.AUTO_SIZE,height:r=Ee.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Mo(n,e,new Ff({depthPacking:xa}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const l=c.clearPass;l.overrideClearColor=new ds(16777215),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Gn,magFilter:Gn}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Ee(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},r0=class extends st{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=Ee.AUTO_SIZE,height:s=Ee.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("DepthDownsamplingPass");const o=new zp;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Tt(1,1,{minFilter:Gn,magFilter:Gn,depthBuffer:!1,type:Ef}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Ee(this,i,r,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=ci){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,s,i){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const s=n.getContext();if(!(s.getExtension("EXT_color_buffer_float")||s.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function ml(n,e,t){for(const s of e){const i="$1"+n+s.charAt(0).toUpperCase()+s.slice(1),r=new RegExp("([^\\.])(\\b"+s+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,i))}}function o0(n,e,t){let s=e.getFragmentShader(),i=e.getVertexShader();const r=s!==void 0&&/mainImage/.test(s),o=s!==void 0&&/mainUv/.test(s);if(t.attributes|=e.getAttributes(),s===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&fs.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get(ie.FRAGMENT_HEAD)||"",u=c.get(ie.FRAGMENT_MAIN_UV)||"",h=c.get(ie.FRAGMENT_MAIN_IMAGE)||"",d=c.get(ie.VERTEX_HEAD)||"",f=c.get(ie.VERTEX_MAIN_SUPPORT)||"";const m=new Set,p=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const w=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);f+=`	${n}MainSupport(`,f+=w?`vUv);
`:`);
`;for(const S of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const v of S[1].split(/\s*,\s*/))t.varyings.add(v),m.add(v),p.add(v);for(const S of i.matchAll(a))p.add(S[1])}for(const w of s.matchAll(a))p.add(w[1]);for(const w of e.defines.keys())p.add(w.replace(/\([\w\s,]*\)/g,""));for(const w of e.uniforms.keys())p.add(w);p.delete("while"),p.delete("for"),p.delete("if"),e.uniforms.forEach((w,S)=>t.uniforms.set(n+S.charAt(0).toUpperCase()+S.slice(1),w)),e.defines.forEach((w,S)=>t.defines.set(n+S.charAt(0).toUpperCase()+S.slice(1),w));const g=new Map([["fragment",s],["vertex",i]]);ml(n,p,t.defines),ml(n,p,g),s=g.get("fragment"),i=g.get("vertex");const y=e.blendMode;if(t.blendModes.set(y.blendFunction,y),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===He?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==wu?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const w=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,t.attributes&fs.DEPTH&&w.test(s)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const S=n+"BlendOpacity";t.uniforms.set(S,y.opacity),h+=`color0 = blend${y.blendFunction}(color0, color1, ${S});

	`,l+=`uniform float ${S};

`}if(l+=s+`
`,i!==null&&(d+=i+`
`),c.set(ie.FRAGMENT_HEAD,l),c.set(ie.FRAGMENT_MAIN_UV,u),c.set(ie.FRAGMENT_MAIN_IMAGE,h),c.set(ie.VERTEX_HEAD,d),c.set(ie.VERTEX_MAIN_SUPPORT,f),e.extensions!==null)for(const w of e.extensions)t.extensions.add(w)}}var a0=class extends st{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new Wp(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new _0;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===ee.DST)n.attributes|=o.getAttributes()&fs.DEPTH;else{if(n.attributes&o.getAttributes()&fs.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);o0("e"+e++,o,n)}let t=n.shaderParts.get(ie.FRAGMENT_HEAD),s=n.shaderParts.get(ie.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(ie.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&fs.DEPTH?(n.readDepth&&(s=`float depth = readDepth(UV);

	`+s),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===He&&(s+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(ie.FRAGMENT_HEAD,t),n.shaderParts.set(ie.FRAGMENT_MAIN_IMAGE,s),n.shaderParts.set(ie.FRAGMENT_MAIN_UV,i);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=ci){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,s,i){for(const r of this.effects)r.update(n,e,s);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=s*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const s of this.effects)s.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==_s&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},Ou=class extends st{constructor({kernelSize:n=Ao.MEDIUM,resolutionScale:e=.5,width:t=Ee.AUTO_SIZE,height:s=Ee.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("KawaseBlurPass"),this.renderTargetA=new Tt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Ee(this,i,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new Rp,this._blurMaterial.kernelSize=n,this.copyMaterial=new Cu}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let d=0,f=u.length;d<f;++d){const m=d&1?c:a;l.kernel=u[d],l.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(r,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.renderTargetA.setSize(s,i),this.renderTargetB.setSize(s,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==_s?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Yn(n)===He&&(Is(this.renderTargetA.texture,He),Is(this.renderTargetB.texture,He)))}static get AUTO_SIZE(){return Ee.AUTO_SIZE}},c0=class extends st{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:s=1,width:i=Ee.AUTO_SIZE,height:r=Ee.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new Yp(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Ee(this,o,a,s);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,s,i){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==_s&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},l0=class extends st{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new sc(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,s,i){const r=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},u0=class extends st{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Hp,this.upsamplingMaterial=new Jp,this.resolution=new Ie}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const s=e.clone();s.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(s)}this.upsamplingMipmaps.push(e);for(let t=1,s=n-1;t<s;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,s,i){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let d=0,f=l.length;d<f;++d){const m=l[d];a.setSize(h.width,h.height),a.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=c;for(let d=u.length-1;d>=0;--d){const f=u[d];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[d].texture,n.setRenderTarget(f),n.render(r,o),h=f}}setSize(n,e){const t=this.resolution;t.set(n,e);let s=t.width,i=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)s=Math.round(s*.5),i=Math.round(i*.5),this.downsamplingMipmaps[r].setSize(s,i),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(s,i)}initialize(n,e,t){if(t!==void 0){const s=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of s)i.texture.type=t;if(t!==_s)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Yn(n)===He)for(const i of s)Is(i.texture,He)}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},h0=class extends st{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Ee.AUTO_SIZE,height:r=Ee.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Mo(n,e,new Of);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new ds(7829503),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Gn,magFilter:Gn}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Ee(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},d0=class extends st{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,s,i){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==_s&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ra=1/1e3,f0=1e3,p0=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*ra}get fixedDelta(){return this._fixedDelta*ra}set fixedDelta(n){this._fixedDelta=n*f0}get elapsed(){return this._elapsed*ra}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},m0=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:s=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,s,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new s0,this.depthTexture=null,this.passes=[],this.timer=new p0,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,s=this.multisampling;s>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):s!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new Ie),s=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===_s&&Yn(e)===He&&(Is(this.inputBuffer.texture,He),Is(this.outputBuffer.texture,He),this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(e,s,i)}}replaceRenderer(e,t=!0){const s=this.renderer,i=s.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(s.domElement),i.appendChild(e.domElement)),s}createDepthTexture(){const e=this.depthTexture=new Af;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=Mf,e.type=Df):e.type=Rf,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,s,i){const r=this.renderer,o=r===null?new Ie:r.getDrawingBufferSize(new Ie),a={minFilter:Xr,magFilter:Xr,stencilBuffer:t,depthBuffer:e,type:s},c=new Tt(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),s===_s&&Yn(r)===He&&Is(c.texture,He),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const s=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new Ie),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(r.width,r.height),e.initialize(i,o,a),this.autoRenderToScreen&&(s.length>0&&(s[s.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?s.splice(t,0,e):s.push(e),this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of s)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,s=t.indexOf(e);if(s!==-1&&t.splice(s,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&s===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,s=this.copyPass;let i=this.inputBuffer,r=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.delta);for(const u of this.passes)u.enabled&&(u.render(t,i,r,e,o),u.needsSwap&&(o&&(s.renderToScreen=u.renderToScreen,a=t.getContext(),c=t.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),s.render(t,i,r,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=r,r=l),u instanceof l0?o=!0:u instanceof n0&&(o=!1))}setSize(e,t,s){const i=this.renderer,r=i.getSize(new Ie);(e===void 0||t===void 0)&&(e=r.width,t=r.height),(r.width!==e||r.height!==t)&&i.setSize(e,t,s);const o=i.getDrawingBufferSize(new Ie);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){const e=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=e}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},_0=class{constructor(){this.shaderParts=new Map([[ie.FRAGMENT_HEAD,null],[ie.FRAGMENT_MAIN_UV,null],[ie.FRAGMENT_MAIN_IMAGE,null],[ie.VERTEX_HEAD,null],[ie.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=fs.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Oo}},oa=!1,_l=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Ri:t=this.materialsFlatShadedDoubleSide;break;case Er:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Ri:t=this.materialsDoubleSide;break;case Er:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof es))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const r=e[i].value;r.isRenderTargetTexture&&(e[i].value=null,t.set(i,r))}const s=n.clone();for(const i of t)e[i[0]].value=i[1],s.uniforms[i[0]].value=i[1];return s}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=Pf;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=Er,s}),this.materialsDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=Ri,s}),this.materialsFlatShaded=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=Er,s}),this.materialsFlatShadedDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=Ri,s})}}render(n,e,t){const s=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,oa){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const r of i)r[0].material=r[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return oa}static set workaroundEnabled(n){oa=n}},Os=-1,Ee=class extends Ka{constructor(n,e=Os,t=Os,s=1){super(),this.resizable=n,this.baseSize=new Ie(1,1),this.preferredSize=new Ie(e,t),this.target=this.preferredSize,this.s=s,this.effectiveSize=new Ie,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,s=this.scale;e.width!==Os?t.width=e.width:e.height!==Os?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*s),e.height!==Os?t.height=e.height:e.width!==Os?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*s)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Os),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Os}},g0=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},v0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",y0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",T0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",x0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",k0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",w0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",S0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",b0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",C0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",E0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",O0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",A0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",M0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",D0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",R0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",P0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",N0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",I0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",F0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",U0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",L0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",z0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",B0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",V0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",H0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",j0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",q0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",W0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",G0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Y0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Z0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",X0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",$0=new Map([[ee.ADD,v0],[ee.ALPHA,y0],[ee.AVERAGE,T0],[ee.COLOR,x0],[ee.COLOR_BURN,k0],[ee.COLOR_DODGE,w0],[ee.DARKEN,S0],[ee.DIFFERENCE,b0],[ee.DIVIDE,C0],[ee.DST,null],[ee.EXCLUSION,E0],[ee.HARD_LIGHT,O0],[ee.HARD_MIX,A0],[ee.HUE,M0],[ee.INVERT,D0],[ee.INVERT_RGB,R0],[ee.LIGHTEN,P0],[ee.LINEAR_BURN,N0],[ee.LINEAR_DODGE,I0],[ee.LINEAR_LIGHT,F0],[ee.LUMINOSITY,U0],[ee.MULTIPLY,L0],[ee.NEGATION,z0],[ee.NORMAL,B0],[ee.OVERLAY,V0],[ee.PIN_LIGHT,H0],[ee.REFLECT,j0],[ee.SATURATION,q0],[ee.SCREEN,W0],[ee.SOFT_LIGHT,G0],[ee.SRC,Y0],[ee.SUBTRACT,Z0],[ee.VIVID_LIGHT,X0]]),Q0=class extends Ka{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new $(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return $0.get(this.blendFunction)}},zi=class extends Ka{constructor(e,t,{attributes:s=fs.NONE,blendFunction:i=ee.NORMAL,defines:r=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:c=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=c,this.defines=r,this.uniforms=o,this.extensions=a,this.blendMode=new Q0(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Oo,this._outputColorSpace=wu}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=ci){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Tt||t instanceof mu||t instanceof _u||t instanceof st)&&this[e].dispose()}}},K0=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,J0=class extends zi{constructor({blendFunction:n=ee.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:t=.025,mipmapBlur:s=!1,intensity:i=1,radius:r=.85,levels:o=8,kernelSize:a=Ao.LARGE,resolutionScale:c=.5,width:l=Ee.AUTO_SIZE,height:u=Ee.AUTO_SIZE,resolutionX:h=l,resolutionY:d=u}={}){super("BloomEffect",K0,{blendFunction:n,uniforms:new Map([["map",new $(null)],["intensity",new $(i)]])}),this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Ou({kernelSize:a}),this.luminancePass=new c0({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new u0,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const f=this.resolution=new Ee(this,h,d,c);f.addEventListener("change",m=>this.setSize(f.baseWidth,f.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const s=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,Yn(n)===He&&Is(this.renderTarget.texture,He))}},em=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,tm="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",sm=class extends zi{constructor(n,e,{blendFunction:t=ee.SCREEN,patternTexture:s=null,patternScale:i=1,edgeStrength:r=1,pulseSpeed:o=0,visibleEdgeColor:a=16777215,hiddenEdgeColor:c=2230538,kernelSize:l=Ao.VERY_SMALL,blur:u=!1,xRay:h=!0,multisampling:d=0,resolutionScale:f=.5,width:m=Ee.AUTO_SIZE,height:p=Ee.AUTO_SIZE,resolutionX:g=m,resolutionY:y=p}={}){super("OutlineEffect",em,{uniforms:new Map([["maskTexture",new $(null)],["edgeTexture",new $(null)],["edgeStrength",new $(r)],["visibleEdgeColor",new $(new ds(a))],["hiddenEdgeColor",new $(new ds(c))],["pulse",new $(1)],["patternScale",new $(i)],["patternTexture",new $(null)]])}),this.blendMode.addEventListener("change",_=>{this.blendMode.blendFunction===ee.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=t,this.patternTexture=s,this.xRay=h,this.scene=n,this.camera=e,this.renderTargetMask=new Tt(1,1),this.renderTargetMask.samples=d,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new Tt(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new sc,this.clearPass.overrideClearColor=new ds(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new i0(n,e),this.maskPass=new Mo(n,e,new Fp(this.depthPass.texture,e));const w=this.maskPass.clearPass;w.overrideClearColor=new ds(16777215),w.overrideClearAlpha=1,this.blurPass=new Ou({resolutionScale:f,resolutionX:g,resolutionY:y,kernelSize:l}),this.blurPass.enabled=u;const S=this.blurPass.resolution;S.addEventListener("change",_=>this.setSize(S.baseWidth,S.baseHeight)),this.outlinePass=new d0(new $p);const v=this.outlinePass.fullscreenMaterial;v.inputBuffer=this.renderTargetMask.texture,this.time=0,this.forceUpdate=!0,this.selection=new g0,this.selection.layer=10,this.pulseSpeed=o}set mainScene(n){this.scene=n,this.depthPass.mainScene=n,this.maskPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.maskPass.mainCamera=n,this.maskPass.overrideMaterial.copyCameraSettings(n)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(n){this.renderTargetMask.samples=n,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(n){this.uniforms.get("patternScale").value=n}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(n){this.uniforms.get("edgeStrength").value=n}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(n){this.uniforms.get("visibleEdgeColor").value=n}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(n){this.uniforms.get("hiddenEdgeColor").value=n}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(n){this.pulseSpeed=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get selectionLayer(){return this.selection.layer}set selectionLayer(n){this.selection.layer=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get blur(){return this.blurPass.enabled}set blur(n){this.blurPass.enabled=n}get xRay(){return this.defines.has("X_RAY")}set xRay(n){this.xRay!==n&&(n?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(n){this.xRay=n}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(n){n!==null?(n.wrapS=n.wrapT=Nf,this.defines.set("USE_PATTERN","1"),this.setVertexShader(tm)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=n,this.setChanged()}setPatternTexture(n){this.patternTexture=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}setSelection(n){return this.selection.set(n),this}clearSelection(){return this.selection.clear(),this}selectObject(n){return this.selection.add(n),this}deselectObject(n){return this.selection.delete(n),this}update(n,e,t){const s=this.scene,i=this.camera,r=this.selection,a=this.uniforms.get("pulse"),c=s.background,l=i.layers.mask;(this.forceUpdate||r.size>0)&&(s.background=null,a.value=1,this.pulseSpeed>0&&(a.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.time+=t,r.setVisible(!1),this.depthPass.render(n),r.setVisible(!0),i.layers.set(r.layer),this.maskPass.render(n,this.renderTargetMask),i.layers.mask=l,s.background=c,this.outlinePass.render(n,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(n,this.renderTargetOutline,this.renderTargetOutline)),this.forceUpdate=r.size>0}setSize(n,e){this.blurPass.setSize(n,e),this.renderTargetMask.setSize(n,e);const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.depthPass.setSize(s,i),this.renderTargetOutline.setSize(s,i),this.outlinePass.fullscreenMaterial.setSize(s,i)}initialize(n,e,t){this.blurPass.initialize(n,e,_s),t!==void 0&&(this.depthPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.outlinePass.initialize(n,e,t))}},nm=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,im=class extends zi{constructor({blendFunction:n,technique:e=Ir.DEFAULT,eskil:t=!1,offset:s=.5,darkness:i=.5}={}){super("VignetteEffect",nm,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new $(s)],["darkness",new $(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Ir.ESKIL}set eskil(n){this.technique=n?Ir.ESKIL:Ir.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}};const Au=E.createContext(null),gl=n=>(n.getAttributes()&fs.CONVOLUTION)===fs.CONVOLUTION,rm=Zr.memo(E.forwardRef(({children:n,camera:e,scene:t,resolutionScale:s,enabled:i=!0,renderPriority:r=1,autoClear:o=!0,depthBuffer:a,disableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:h=zf},d)=>{const{gl:f,scene:m,camera:p,size:g}=ge(),y=t||m,w=e||p,[S,v,_]=E.useMemo(()=>{const b=lp(),C=new m0(f,{depthBuffer:a,stencilBuffer:l,multisampling:u>0&&b?u:0,frameBufferType:h});C.addPass(new Mo(y,w));let O=null,A=null;return c||(A=new h0(y,w),A.enabled=!1,C.addPass(A),s!==void 0&&b&&(O=new r0({normalBuffer:A.texture,resolutionScale:s}),O.enabled=!1,C.addPass(O))),[C,A,O]},[w,f,a,l,u,h,y,c,s]);E.useEffect(()=>S==null?void 0:S.setSize(g.width,g.height),[S,g]),kt((b,C)=>{if(i){const O=f.autoClear;f.autoClear=o,l&&!o&&f.clearStencil(),S.render(C),f.autoClear=O}},i?r:0);const x=E.useRef(null),T=pf(x);E.useLayoutEffect(()=>{const b=[];if(x.current&&T.current&&S){const C=T.current.objects;for(let O=0;O<C.length;O++){const A=C[O];if(A instanceof zi){const R=[A];if(!gl(A)){let F=null;for(;(F=C[O+1])instanceof zi&&!gl(F);)R.push(F),O++}const P=new a0(w,...R);b.push(P)}else A instanceof st&&b.push(A)}for(const O of b)S==null||S.addPass(O);v&&(v.enabled=!0),_&&(_.enabled=!0)}return()=>{for(const C of b)S==null||S.removePass(C);v&&(v.enabled=!1),_&&(_.enabled=!1)}},[S,n,w,v,_,T]);const k=E.useMemo(()=>({composer:S,normalPass:v,downSamplingPass:_,resolutionScale:s,camera:w,scene:y}),[S,v,_,s,w,y]);return E.useImperativeHandle(d,()=>S,[S]),D.jsx(Au.Provider,{value:k,children:D.jsx("group",{ref:x,children:n})})})),vl=n=>typeof n=="object"&&n!=null&&"current"in n?n.current:n;let om=0;const yl=new WeakMap,Mu=(n,e)=>Zr.forwardRef(function({blendFunction:s=e==null?void 0:e.blendFunction,opacity:i=e==null?void 0:e.opacity,...r},o){let a=yl.get(n);if(!a){const u=`@react-three/postprocessing/${n.name}-${om++}`;Qa({[u]:n}),yl.set(n,a=u)}const c=ge(u=>u.camera),l=Zr.useMemo(()=>{var u,h;return[...(u=e==null?void 0:e.args)!=null?u:[],...(h=r.args)!=null?h:[{...e,...r}]]},[JSON.stringify(r)]);return D.jsx(a,{camera:c,"blendMode-blendFunction":s,"blendMode-opacity-value":i,...r,ref:o,args:l})}),am=Mu(J0,{blendFunction:ee.ADD}),cm=E.forwardRef(function({selection:e=[],selectionLayer:t=10,blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:d,xRay:f,...m},p){const g=ge(_=>_.invalidate),{scene:y,camera:w}=E.useContext(Au),S=E.useMemo(()=>new sm(y,w,{blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:d,xRay:f,...m}),[s,d,w,r,u,c,h,i,o,y,a,l,f]),v=E.useContext(tc);return E.useEffect(()=>{if(!v&&e)return S.selection.set(Array.isArray(e)?e.map(vl):[vl(e)]),g(),()=>{S.selection.clear(),g()}},[S,e,v,g]),E.useEffect(()=>{S.selectionLayer=t,g()},[S,g,t]),E.useRef(),E.useEffect(()=>{var _;if(v&&v.enabled&&(_=v.selected)!=null&&_.length)return S.selection.set(v.selected),g(),()=>{S.selection.clear(),g()}},[v,S.selection,g]),E.useEffect(()=>()=>{S.dispose()},[S]),D.jsx("primitive",{ref:p,object:S})}),lm=Mu(im),um={isUserDragging:!1,isUserScrolling:!1,userMovedCamera:!1,isUserScrollingOnHtmlPanel:!1},Fs=uu(n=>({...um,setIsUserDragging:e=>n({isUserDragging:e}),setIsUserScrolling:e=>n({isUserScrolling:e}),setUserMovedCamera:e=>n({userMovedCamera:e}),setIsUserScrollingOnHtmlPanel:e=>n({isUserScrollingOnHtmlPanel:e})}));function ls(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Du(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.4
 * https://gsap.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var vt={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Zn={duration:.5,overwrite:!1,delay:0},nc,Ze,Ae,Et=1e8,fe=1/Et,wa=Math.PI*2,hm=wa/4,dm=0,Ru=Math.sqrt,fm=Math.cos,pm=Math.sin,qe=function(e){return typeof e=="string"},De=function(e){return typeof e=="function"},gs=function(e){return typeof e=="number"},ic=function(e){return typeof e>"u"},Qt=function(e){return typeof e=="object"},ot=function(e){return e!==!1},rc=function(){return typeof window<"u"},Fr=function(e){return De(e)||qe(e)},Pu=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Xe=Array.isArray,Sa=/(?:-?\.?\d|\.)+/gi,Nu=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Fn=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,aa=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Iu=/[+-]=-?[.\d]+/,Fu=/[^,'"\[\]\s]+/gi,mm=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,be,Ct,ba,oc,xt={},$r={},Uu,Lu=function(e){return($r=pn(e,xt))&&ht},ac=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Bi=function(e,t){return!t&&console.warn(e)},zu=function(e,t){return e&&(xt[e]=t)&&$r&&($r[e]=t)||xt},Vi=function(){return 0},_m={suppressEvents:!0,isStart:!0,kill:!1},jr={suppressEvents:!0,kill:!1},gm={suppressEvents:!0},cc={},Us=[],Ca={},Bu,pt={},ca={},Tl=30,qr=[],lc="",uc=function(e){var t=e[0],s,i;if(Qt(t)||De(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(i=qr.length;i--&&!qr[i].targetTest(t););s=qr[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new uh(e[i],s)))||e.splice(i,1);return e},cn=function(e){return e._gsap||uc(Ot(e))[0]._gsap},Vu=function(e,t,s){return(s=e[t])&&De(s)?e[t]():ic(s)&&e.getAttribute&&e.getAttribute(t)||s},at=function(e,t){return(e=e.split(",")).forEach(t)||e},Pe=function(e){return Math.round(e*1e5)/1e5||0},Ve=function(e){return Math.round(e*1e7)/1e7||0},Vn=function(e,t){var s=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+i:s==="-"?e-i:s==="*"?e*i:e/i},vm=function(e,t){for(var s=t.length,i=0;e.indexOf(t[i])<0&&++i<s;);return i<s},Qr=function(){var e=Us.length,t=Us.slice(0),s,i;for(Ca={},Us.length=0,s=0;s<e;s++)i=t[s],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Hu=function(e,t,s,i){Us.length&&!Ze&&Qr(),e.render(t,s,i||Ze&&t<0&&(e._initted||e._startAt)),Us.length&&!Ze&&Qr()},ju=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Fu).length<2?t:qe(e)?e.trim():e},qu=function(e){return e},Dt=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},ym=function(e){return function(t,s){for(var i in s)i in t||i==="duration"&&e||i==="ease"||(t[i]=s[i])}},pn=function(e,t){for(var s in t)e[s]=t[s];return e},xl=function n(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=Qt(t[s])?n(e[s]||(e[s]={}),t[s]):t[s]);return e},Kr=function(e,t){var s={},i;for(i in e)i in t||(s[i]=e[i]);return s},Ii=function(e){var t=e.parent||be,s=e.keyframes?ym(Xe(e.keyframes)):Dt;if(ot(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},Tm=function(e,t){for(var s=e.length,i=s===t.length;i&&s--&&e[s]===t[s];);return s<0},Wu=function(e,t,s,i,r){s===void 0&&(s="_first"),i===void 0&&(i="_last");var o=e[i],a;if(r)for(a=t[r];o&&o[r]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[i]=t,t._prev=o,t.parent=t._dp=e,t},Do=function(e,t,s,i){s===void 0&&(s="_first"),i===void 0&&(i="_last");var r=t._prev,o=t._next;r?r._next=o:e[s]===t&&(e[s]=o),o?o._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},Bs=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},ln=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},xm=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Ea=function(e,t,s,i){return e._startAt&&(Ze?e._startAt.revert(jr):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},km=function n(e){return!e||e._ts&&n(e.parent)},kl=function(e){return e._repeat?Xn(e._tTime,e=e.duration()+e._rDelay)*e:0},Xn=function(e,t){var s=Math.floor(e/=t);return e&&s===e?s-1:s},Jr=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Ro=function(e){return e._end=Ve(e._start+(e._tDur/Math.abs(e._ts||e._rts||fe)||0))},Po=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=Ve(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Ro(e),s._dirty||ln(s,e)),e},Gu=function(e,t){var s;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(s=Jr(e.rawTime(),t),(!t._dur||mr(0,t.totalDuration(),s)-t._tTime>fe)&&t.render(s,!0)),ln(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-fe}},Zt=function(e,t,s,i){return t.parent&&Bs(t),t._start=Ve((gs(s)?s:s||e!==be?bt(e,s,t):e._time)+t._delay),t._end=Ve(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Wu(e,t,"_first","_last",e._sort?"_start":0),Oa(t)||(e._recent=t),i||Gu(e,t),e._ts<0&&Po(e,e._tTime),e},Yu=function(e,t){return(xt.ScrollTrigger||ac("scrollTrigger",t))&&xt.ScrollTrigger.create(t,e)},Zu=function(e,t,s,i,r){if(dc(e,t,r),!e._initted)return 1;if(!s&&e._pt&&!Ze&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Bu!==mt.frame)return Us.push(e),e._lazy=[r,i],1},wm=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},Oa=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Sm=function(e,t,s,i){var r=e.ratio,o=t<0||!t&&(!e._start&&wm(e)&&!(!e._initted&&Oa(e))||(e._ts<0||e._dp._ts<0)&&!Oa(e))?0:1,a=e._rDelay,c=0,l,u,h;if(a&&e._repeat&&(c=mr(0,e._tDur,t),u=Xn(c,a),e._yoyo&&u&1&&(o=1-o),u!==Xn(e._tTime,a)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||Ze||i||e._zTime===fe||!t&&e._zTime){if(!e._initted&&Zu(e,t,i,s,c))return;for(h=e._zTime,e._zTime=t||(s?fe:0),s||(s=t&&!h),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=c,l=e._pt;l;)l.r(o,l.d),l=l._next;t<0&&Ea(e,t,s,!0),e._onUpdate&&!s&&gt(e,"onUpdate"),c&&e._repeat&&!s&&e.parent&&gt(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Bs(e,1),!s&&!Ze&&(gt(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},bm=function(e,t,s){var i;if(s>t)for(i=e._first;i&&i._start<=s;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=s;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},$n=function(e,t,s,i){var r=e._repeat,o=Ve(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:Ve(o*(r+1)+e._rDelay*r):o,a>0&&!i&&Po(e,e._tTime=e._tDur*a),e.parent&&Ro(e),s||ln(e.parent,e),e},wl=function(e){return e instanceof Je?ln(e):$n(e,e._dur)},Cm={_start:0,endTime:Vi,totalDuration:Vi},bt=function n(e,t,s){var i=e.labels,r=e._recent||Cm,o=e.duration()>=Et?r.endTime(!1):e._dur,a,c,l;return qe(t)&&(isNaN(t)||t in i)?(c=t.charAt(0),l=t.substr(-1)==="%",a=t.indexOf("="),c==="<"||c===">"?(a>=0&&(t=t.replace(/=/,"")),(c==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(l?(a<0?r:s).totalDuration()/100:1)):a<0?(t in i||(i[t]=o),i[t]):(c=parseFloat(t.charAt(a-1)+t.substr(a+1)),l&&s&&(c=c/100*(Xe(s)?s[0]:s).totalDuration()),a>1?n(e,t.substr(0,a-1),s)+c:o+c)):t==null?o:+t},Fi=function(e,t,s){var i=gs(t[1]),r=(i?2:1)+(e<2?0:1),o=t[r],a,c;if(i&&(o.duration=t[1]),o.parent=s,e){for(a=o,c=s;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=ot(c.vars.inherit)&&c.parent;o.immediateRender=ot(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new Le(t[0],o,t[r+1])},Ys=function(e,t){return e||e===0?t(e):t},mr=function(e,t,s){return s<e?e:s>t?t:s},Ye=function(e,t){return!qe(e)||!(t=mm.exec(e))?"":t[1]},Em=function(e,t,s){return Ys(s,function(i){return mr(e,t,i)})},Aa=[].slice,Xu=function(e,t){return e&&Qt(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Qt(e[0]))&&!e.nodeType&&e!==Ct},Om=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(i){var r;return qe(i)&&!t||Xu(i,1)?(r=s).push.apply(r,Ot(i)):s.push(i)})||s},Ot=function(e,t,s){return Ae&&!t&&Ae.selector?Ae.selector(e):qe(e)&&!s&&(ba||!Qn())?Aa.call((t||oc).querySelectorAll(e),0):Xe(e)?Om(e,s):Xu(e)?Aa.call(e,0):e?[e]:[]},Ma=function(e){return e=Ot(e)[0]||Bi("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return Ot(t,s.querySelectorAll?s:s===e?Bi("Invalid scope")||oc.createElement("div"):e)}},$u=function(e){return e.sort(function(){return .5-Math.random()})},Qu=function(e){if(De(e))return e;var t=Qt(e)?e:{each:e},s=un(t.ease),i=t.from||0,r=parseFloat(t.base)||0,o={},a=i>0&&i<1,c=isNaN(i)||a,l=t.axis,u=i,h=i;return qe(i)?u=h={center:.5,edges:.5,end:1}[i]||0:!a&&c&&(u=i[0],h=i[1]),function(d,f,m){var p=(m||t).length,g=o[p],y,w,S,v,_,x,T,k,b;if(!g){if(b=t.grid==="auto"?0:(t.grid||[1,Et])[1],!b){for(T=-Et;T<(T=m[b++].getBoundingClientRect().left)&&b<p;);b<p&&b--}for(g=o[p]=[],y=c?Math.min(b,p)*u-.5:i%b,w=b===Et?0:c?p*h/b-.5:i/b|0,T=0,k=Et,x=0;x<p;x++)S=x%b-y,v=w-(x/b|0),g[x]=_=l?Math.abs(l==="y"?v:S):Ru(S*S+v*v),_>T&&(T=_),_<k&&(k=_);i==="random"&&$u(g),g.max=T-k,g.min=k,g.v=p=(parseFloat(t.amount)||parseFloat(t.each)*(b>p?p-1:l?l==="y"?p/b:b:Math.max(b,p/b))||0)*(i==="edges"?-1:1),g.b=p<0?r-p:r,g.u=Ye(t.amount||t.each)||0,s=s&&p<0?ah(s):s}return p=(g[d]-g.min)/g.max||0,Ve(g.b+(s?s(p):p)*g.v)+g.u}},Da=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var i=Ve(Math.round(parseFloat(s)/e)*e*t);return(i-i%1)/t+(gs(s)?0:Ye(s))}},Ku=function(e,t){var s=Xe(e),i,r;return!s&&Qt(e)&&(i=s=e.radius||Et,e.values?(e=Ot(e.values),(r=!gs(e[0]))&&(i*=i)):e=Da(e.increment)),Ys(t,s?De(e)?function(o){return r=e(o),Math.abs(r-o)<=i?r:o}:function(o){for(var a=parseFloat(r?o.x:o),c=parseFloat(r?o.y:0),l=Et,u=0,h=e.length,d,f;h--;)r?(d=e[h].x-a,f=e[h].y-c,d=d*d+f*f):d=Math.abs(e[h]-a),d<l&&(l=d,u=h);return u=!i||l<=i?e[u]:o,r||u===o||gs(o)?u:u+Ye(o)}:Da(e))},Ju=function(e,t,s,i){return Ys(Xe(e)?!t:s===!0?!!(s=0):!i,function(){return Xe(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(i=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*i)/i})},Am=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(i){return t.reduce(function(r,o){return o(r)},i)}},Mm=function(e,t){return function(s){return e(parseFloat(s))+(t||Ye(s))}},Dm=function(e,t,s){return th(e,t,0,1,s)},eh=function(e,t,s){return Ys(s,function(i){return e[~~t(i)]})},Rm=function n(e,t,s){var i=t-e;return Xe(e)?eh(e,n(0,e.length),t):Ys(s,function(r){return(i+(r-e)%i)%i+e})},Pm=function n(e,t,s){var i=t-e,r=i*2;return Xe(e)?eh(e,n(0,e.length-1),t):Ys(s,function(o){return o=(r+(o-e)%r)%r||0,e+(o>i?r-o:o)})},Hi=function(e){for(var t=0,s="",i,r,o,a;~(i=e.indexOf("random(",t));)o=e.indexOf(")",i),a=e.charAt(i+7)==="[",r=e.substr(i+7,o-i-7).match(a?Fu:Sa),s+=e.substr(t,i-t)+Ju(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),t=o+1;return s+e.substr(t,e.length-t)},th=function(e,t,s,i,r){var o=t-e,a=i-s;return Ys(r,function(c){return s+((c-e)/o*a||0)})},Nm=function n(e,t,s,i){var r=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!r){var o=qe(e),a={},c,l,u,h,d;if(s===!0&&(i=1)&&(s=null),o)e={p:e},t={p:t};else if(Xe(e)&&!Xe(t)){for(u=[],h=e.length,d=h-2,l=1;l<h;l++)u.push(n(e[l-1],e[l]));h--,r=function(m){m*=h;var p=Math.min(d,~~m);return u[p](m-p)},s=t}else i||(e=pn(Xe(e)?[]:{},e));if(!u){for(c in t)hc.call(a,e,c,"get",t[c]);r=function(m){return mc(m,a)||(o?e.p:e)}}}return Ys(s,r)},Sl=function(e,t,s){var i=e.labels,r=Et,o,a,c;for(o in i)a=i[o]-t,a<0==!!s&&a&&r>(a=Math.abs(a))&&(c=o,r=a);return c},gt=function(e,t,s){var i=e.vars,r=i[t],o=Ae,a=e._ctx,c,l,u;if(r)return c=i[t+"Params"],l=i.callbackScope||e,s&&Us.length&&Qr(),a&&(Ae=a),u=c?r.apply(l,c):r.call(l),Ae=o,u},Pi=function(e){return Bs(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Ze),e.progress()<1&&gt(e,"onInterrupt"),e},Un,sh=[],nh=function(e){if(rc()&&e){e=!e.name&&e.default||e;var t=e.name,s=De(e),i=t&&!s&&e.init?function(){this._props=[]}:e,r={init:Vi,render:mc,add:hc,kill:$m,modifier:Xm,rawVars:0},o={targetTest:0,get:0,getSetter:pc,aliases:{},register:0};if(Qn(),e!==i){if(pt[t])return;Dt(i,Dt(Kr(e,r),o)),pn(i.prototype,pn(r,Kr(e,o))),pt[i.prop=t]=i,e.targetTest&&(qr.push(i),cc[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}zu(t,i),e.register&&e.register(ht,i,ct)}else e&&sh.push(e)},de=255,Ni={aqua:[0,de,de],lime:[0,de,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,de],navy:[0,0,128],white:[de,de,de],olive:[128,128,0],yellow:[de,de,0],orange:[de,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[de,0,0],pink:[de,192,203],cyan:[0,de,de],transparent:[de,de,de,0]},la=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*de+.5|0},ih=function(e,t,s){var i=e?gs(e)?[e>>16,e>>8&de,e&de]:0:Ni.black,r,o,a,c,l,u,h,d,f,m;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Ni[e])i=Ni[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+r+r+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&de,i&de,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&de,e&de]}else if(e.substr(0,3)==="hsl"){if(i=m=e.match(Sa),!t)c=+i[0]%360/360,l=+i[1]/100,u=+i[2]/100,o=u<=.5?u*(l+1):u+l-u*l,r=u*2-o,i.length>3&&(i[3]*=1),i[0]=la(c+1/3,r,o),i[1]=la(c,r,o),i[2]=la(c-1/3,r,o);else if(~e.indexOf("="))return i=e.match(Nu),s&&i.length<4&&(i[3]=1),i}else i=e.match(Sa)||Ni.transparent;i=i.map(Number)}return t&&!m&&(r=i[0]/de,o=i[1]/de,a=i[2]/de,h=Math.max(r,o,a),d=Math.min(r,o,a),u=(h+d)/2,h===d?c=l=0:(f=h-d,l=u>.5?f/(2-h-d):f/(h+d),c=h===r?(o-a)/f+(o<a?6:0):h===o?(a-r)/f+2:(r-o)/f+4,c*=60),i[0]=~~(c+.5),i[1]=~~(l*100+.5),i[2]=~~(u*100+.5)),s&&i.length<4&&(i[3]=1),i},rh=function(e){var t=[],s=[],i=-1;return e.split(Ls).forEach(function(r){var o=r.match(Fn)||[];t.push.apply(t,o),s.push(i+=o.length+1)}),t.c=s,t},bl=function(e,t,s){var i="",r=(e+i).match(Ls),o=t?"hsla(":"rgba(",a=0,c,l,u,h;if(!r)return e;if(r=r.map(function(d){return(d=ih(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),s&&(u=rh(e),c=s.c,c.join(i)!==u.c.join(i)))for(l=e.replace(Ls,"1").split(Fn),h=l.length-1;a<h;a++)i+=l[a]+(~c.indexOf(a)?r.shift()||o+"0,0,0,0)":(u.length?u:r.length?r:s).shift());if(!l)for(l=e.split(Ls),h=l.length-1;a<h;a++)i+=l[a]+r[a];return i+l[h]},Ls=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Ni)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),Im=/hsl[a]?\(/,oh=function(e){var t=e.join(" "),s;if(Ls.lastIndex=0,Ls.test(t))return s=Im.test(t),e[1]=bl(e[1],s),e[0]=bl(e[0],s,rh(e[1])),!0},ji,mt=function(){var n=Date.now,e=500,t=33,s=n(),i=s,r=1e3/240,o=r,a=[],c,l,u,h,d,f,m=function p(g){var y=n()-i,w=g===!0,S,v,_,x;if(y>e&&(s+=y-t),i+=y,_=i-s,S=_-o,(S>0||w)&&(x=++h.frame,d=_-h.time*1e3,h.time=_=_/1e3,o+=S+(S>=r?4:r-S),v=1),w||(c=l(p)),v)for(f=0;f<a.length;f++)a[f](_,d,x,g)};return h={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(g){return d/(1e3/(g||60))},wake:function(){Uu&&(!ba&&rc()&&(Ct=ba=window,oc=Ct.document||{},xt.gsap=ht,(Ct.gsapVersions||(Ct.gsapVersions=[])).push(ht.version),Lu($r||Ct.GreenSockGlobals||!Ct.gsap&&Ct||{}),u=Ct.requestAnimationFrame,sh.forEach(nh)),c&&h.sleep(),l=u||function(g){return setTimeout(g,o-h.time*1e3+1|0)},ji=1,m(2))},sleep:function(){(u?Ct.cancelAnimationFrame:clearTimeout)(c),ji=0,l=Vi},lagSmoothing:function(g,y){e=g||1/0,t=Math.min(y||33,e)},fps:function(g){r=1e3/(g||240),o=h.time*1e3+r},add:function(g,y,w){var S=y?function(v,_,x,T){g(v,_,x,T),h.remove(S)}:g;return h.remove(g),a[w?"unshift":"push"](S),Qn(),S},remove:function(g,y){~(y=a.indexOf(g))&&a.splice(y,1)&&f>=y&&f--},_listeners:a},h}(),Qn=function(){return!ji&&mt.wake()},se={},Fm=/^[\d.\-M][\d.\-,\s]/,Um=/["']/g,Lm=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),i=s[0],r=1,o=s.length,a,c,l;r<o;r++)c=s[r],a=r!==o-1?c.lastIndexOf(","):c.length,l=c.substr(0,a),t[i]=isNaN(l)?l.replace(Um,"").trim():+l,i=c.substr(a+1).trim();return t},zm=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<s?e.indexOf(")",s+1):s)},Bm=function(e){var t=(e+"").split("("),s=se[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[Lm(t[1])]:zm(e).split(",").map(ju)):se._CE&&Fm.test(e)?se._CE("",e):s},ah=function(e){return function(t){return 1-e(1-t)}},ch=function n(e,t){for(var s=e._first,i;s;)s instanceof Je?n(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?n(s.timeline,t):(i=s._ease,s._ease=s._yEase,s._yEase=i,s._yoyo=t)),s=s._next},un=function(e,t){return e&&(De(e)?e:se[e]||Bm(e))||t},xn=function(e,t,s,i){s===void 0&&(s=function(c){return 1-t(1-c)}),i===void 0&&(i=function(c){return c<.5?t(c*2)/2:1-t((1-c)*2)/2});var r={easeIn:t,easeOut:s,easeInOut:i},o;return at(e,function(a){se[a]=xt[a]=r,se[o=a.toLowerCase()]=s;for(var c in r)se[o+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=se[a+"."+c]=r[c]}),r},lh=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},ua=function n(e,t,s){var i=t>=1?t:1,r=(s||(e?.3:.45))/(t<1?t:1),o=r/wa*(Math.asin(1/i)||0),a=function(u){return u===1?1:i*Math.pow(2,-10*u)*pm((u-o)*r)+1},c=e==="out"?a:e==="in"?function(l){return 1-a(1-l)}:lh(a);return r=wa/r,c.config=function(l,u){return n(e,l,u)},c},ha=function n(e,t){t===void 0&&(t=1.70158);var s=function(o){return o?--o*o*((t+1)*o+t)+1:0},i=e==="out"?s:e==="in"?function(r){return 1-s(1-r)}:lh(s);return i.config=function(r){return n(e,r)},i};at("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;xn(n+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});se.Linear.easeNone=se.none=se.Linear.easeIn;xn("Elastic",ua("in"),ua("out"),ua());(function(n,e){var t=1/e,s=2*t,i=2.5*t,r=function(a){return a<t?n*a*a:a<s?n*Math.pow(a-1.5/e,2)+.75:a<i?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};xn("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);xn("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});xn("Circ",function(n){return-(Ru(1-n*n)-1)});xn("Sine",function(n){return n===1?1:-fm(n*hm)+1});xn("Back",ha("in"),ha("out"),ha());se.SteppedEase=se.steps=xt.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,i=e+(t?0:1),r=t?1:0,o=1-fe;return function(a){return((i*mr(0,o,a)|0)+r)*s}}};Zn.ease=se["quad.out"];at("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return lc+=n+","+n+"Params,"});var uh=function(e,t){this.id=dm++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Vu,this.set=t?t.getSetter:pc},qi=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,$n(this,+t.duration,1,1),this.data=t.data,Ae&&(this._ctx=Ae,Ae.data.push(this)),ji||mt.wake()}var e=n.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,$n(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,i){if(Qn(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(Po(this,s),!r._dp||r.parent||Gu(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&Zt(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===fe||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),Hu(this,s,i)),this},e.time=function(s,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+kl(this))%(this._dur+this._rDelay)||(s?this._dur:0),i):this._time},e.totalProgress=function(s,i){return arguments.length?this.totalTime(this.totalDuration()*s,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(s,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+kl(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,i){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*r,i):this._repeat?Xn(this._tTime,r)+1:1},e.timeScale=function(s,i){if(!arguments.length)return this._rts===-fe?0:this._rts;if(this._rts===s)return this;var r=this.parent&&this._ts?Jr(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-fe?0:this._rts,this.totalTime(mr(-Math.abs(this._delay),this._tDur,r),i!==!1),Ro(this),xm(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Qn(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==fe&&(this._tTime-=fe)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=s;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Zt(i,this,s-this._delay),this}return this._start},e.endTime=function(s){return this._start+(ot(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var i=this.parent||this._dp;return i?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Jr(i.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=gm);var i=Ze;return Ze=s,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),Ze=i,this},e.globalTime=function(s){for(var i=this,r=arguments.length?s:i.rawTime();i;)r=i._start+r/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(s):r},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,wl(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var i=this._time;return this._rDelay=s,wl(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,i){return this.totalTime(bt(this,s),ot(i))},e.restart=function(s,i){return this.play().totalTime(s?-this._delay:0,ot(i))},e.play=function(s,i){return s!=null&&this.seek(s,i),this.reversed(!1).paused(!1)},e.reverse=function(s,i){return s!=null&&this.seek(s||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(s,i){return s!=null&&this.seek(s,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-fe:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-fe,this},e.isActive=function(){var s=this.parent||this._dp,i=this._start,r;return!!(!s||this._ts&&this._initted&&s.isActive()&&(r=s.rawTime(!0))>=i&&r<this.endTime(!0)-fe)},e.eventCallback=function(s,i,r){var o=this.vars;return arguments.length>1?(i?(o[s]=i,r&&(o[s+"Params"]=r),s==="onUpdate"&&(this._onUpdate=i)):delete o[s],this):o[s]},e.then=function(s){var i=this;return new Promise(function(r){var o=De(s)?s:qu,a=function(){var l=i.then;i.then=null,De(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=l),r(o),i.then=l};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){Pi(this)},n}();Dt(qi.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-fe,_prom:0,_ps:!1,_rts:1});var Je=function(n){Du(e,n);function e(s,i){var r;return s===void 0&&(s={}),r=n.call(this,s)||this,r.labels={},r.smoothChildTiming=!!s.smoothChildTiming,r.autoRemoveChildren=!!s.autoRemoveChildren,r._sort=ot(s.sortChildren),be&&Zt(s.parent||be,ls(r),i),s.reversed&&r.reverse(),s.paused&&r.paused(!0),s.scrollTrigger&&Yu(ls(r),s.scrollTrigger),r}var t=e.prototype;return t.to=function(i,r,o){return Fi(0,arguments,this),this},t.from=function(i,r,o){return Fi(1,arguments,this),this},t.fromTo=function(i,r,o,a){return Fi(2,arguments,this),this},t.set=function(i,r,o){return r.duration=0,r.parent=this,Ii(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new Le(i,r,bt(this,o),1),this},t.call=function(i,r,o){return Zt(this,Le.delayedCall(0,i,r),o)},t.staggerTo=function(i,r,o,a,c,l,u){return o.duration=r,o.stagger=o.stagger||a,o.onComplete=l,o.onCompleteParams=u,o.parent=this,new Le(i,o,bt(this,c)),this},t.staggerFrom=function(i,r,o,a,c,l,u){return o.runBackwards=1,Ii(o).immediateRender=ot(o.immediateRender),this.staggerTo(i,r,o,a,c,l,u)},t.staggerFromTo=function(i,r,o,a,c,l,u,h){return a.startAt=o,Ii(a).immediateRender=ot(a.immediateRender),this.staggerTo(i,r,a,c,l,u,h)},t.render=function(i,r,o){var a=this._time,c=this._dirty?this.totalDuration():this._tDur,l=this._dur,u=i<=0?0:Ve(i),h=this._zTime<0!=i<0&&(this._initted||!l),d,f,m,p,g,y,w,S,v,_,x,T;if(this!==be&&u>c&&i>=0&&(u=c),u!==this._tTime||o||h){if(a!==this._time&&l&&(u+=this._time-a,i+=this._time-a),d=u,v=this._start,S=this._ts,y=!S,h&&(l||(a=this._zTime),(i||!r)&&(this._zTime=i)),this._repeat){if(x=this._yoyo,g=l+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(g*100+i,r,o);if(d=Ve(u%g),u===c?(p=this._repeat,d=l):(p=~~(u/g),p&&p===u/g&&(d=l,p--),d>l&&(d=l)),_=Xn(this._tTime,g),!a&&this._tTime&&_!==p&&this._tTime-_*g-this._dur<=0&&(_=p),x&&p&1&&(d=l-d,T=1),p!==_&&!this._lock){var k=x&&_&1,b=k===(x&&p&1);if(p<_&&(k=!k),a=k?0:u%l?l:u,this._lock=1,this.render(a||(T?0:Ve(p*g)),r,!l)._lock=0,this._tTime=u,!r&&this.parent&&gt(this,"onRepeat"),this.vars.repeatRefresh&&!T&&(this.invalidate()._lock=1),a&&a!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,c=this._tDur,b&&(this._lock=2,a=k?l:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!T&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;ch(this,T)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(w=bm(this,Ve(a),Ve(d)),w&&(u-=d-(d=w._start))),this._tTime=u,this._time=d,this._act=!S,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&d&&!r&&!p&&(gt(this,"onStart"),this._tTime!==u))return this;if(d>=a&&i>=0)for(f=this._first;f;){if(m=f._next,(f._act||d>=f._start)&&f._ts&&w!==f){if(f.parent!==this)return this.render(i,r,o);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,r,o),d!==this._time||!this._ts&&!y){w=0,m&&(u+=this._zTime=-fe);break}}f=m}else{f=this._last;for(var C=i<0?i:d;f;){if(m=f._prev,(f._act||C<=f._end)&&f._ts&&w!==f){if(f.parent!==this)return this.render(i,r,o);if(f.render(f._ts>0?(C-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(C-f._start)*f._ts,r,o||Ze&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!y){w=0,m&&(u+=this._zTime=C?-fe:fe);break}}f=m}}if(w&&!r&&(this.pause(),w.render(d>=a?0:-fe)._zTime=d>=a?1:-1,this._ts))return this._start=v,Ro(this),this.render(i,r,o);this._onUpdate&&!r&&gt(this,"onUpdate",!0),(u===c&&this._tTime>=this.totalDuration()||!u&&a)&&(v===this._start||Math.abs(S)!==Math.abs(this._ts))&&(this._lock||((i||!l)&&(u===c&&this._ts>0||!u&&this._ts<0)&&Bs(this,1),!r&&!(i<0&&!a)&&(u||a||!c)&&(gt(this,u===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,r){var o=this;if(gs(r)||(r=bt(this,r,i)),!(i instanceof qi)){if(Xe(i))return i.forEach(function(a){return o.add(a,r)}),this;if(qe(i))return this.addLabel(i,r);if(De(i))i=Le.delayedCall(0,i);else return this}return this!==i?Zt(this,i,r):this},t.getChildren=function(i,r,o,a){i===void 0&&(i=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),a===void 0&&(a=-Et);for(var c=[],l=this._first;l;)l._start>=a&&(l instanceof Le?r&&c.push(l):(o&&c.push(l),i&&c.push.apply(c,l.getChildren(!0,r,o)))),l=l._next;return c},t.getById=function(i){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===i)return r[o]},t.remove=function(i){return qe(i)?this.removeLabel(i):De(i)?this.killTweensOf(i):(Do(this,i),i===this._recent&&(this._recent=this._last),ln(this))},t.totalTime=function(i,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Ve(mt.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),n.prototype.totalTime.call(this,i,r),this._forcing=0,this):this._tTime},t.addLabel=function(i,r){return this.labels[i]=bt(this,r),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,r,o){var a=Le.delayedCall(0,r||Vi,o);return a.data="isPause",this._hasPause=1,Zt(this,a,bt(this,i))},t.removePause=function(i){var r=this._first;for(i=bt(this,i);r;)r._start===i&&r.data==="isPause"&&Bs(r),r=r._next},t.killTweensOf=function(i,r,o){for(var a=this.getTweensOf(i,o),c=a.length;c--;)Rs!==a[c]&&a[c].kill(i,r);return this},t.getTweensOf=function(i,r){for(var o=[],a=Ot(i),c=this._first,l=gs(r),u;c;)c instanceof Le?vm(c._targets,a)&&(l?(!Rs||c._initted&&c._ts)&&c.globalTime(0)<=r&&c.globalTime(c.totalDuration())>r:!r||c.isActive())&&o.push(c):(u=c.getTweensOf(a,r)).length&&o.push.apply(o,u),c=c._next;return o},t.tweenTo=function(i,r){r=r||{};var o=this,a=bt(o,i),c=r,l=c.startAt,u=c.onStart,h=c.onStartParams,d=c.immediateRender,f,m=Le.to(o,Dt({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale())||fe,onStart:function(){if(o.pause(),!f){var g=r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale());m._dur!==g&&$n(m,g,0,1).render(m._time,!0,!0),f=1}u&&u.apply(m,h||[])}},r));return d?m.render(0):m},t.tweenFromTo=function(i,r,o){return this.tweenTo(r,Dt({startAt:{time:bt(this,i)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),Sl(this,bt(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),Sl(this,bt(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+fe)},t.shiftChildren=function(i,r,o){o===void 0&&(o=0);for(var a=this._first,c=this.labels,l;a;)a._start>=o&&(a._start+=i,a._end+=i),a=a._next;if(r)for(l in c)c[l]>=o&&(c[l]+=i);return ln(this)},t.invalidate=function(i){var r=this._first;for(this._lock=0;r;)r.invalidate(i),r=r._next;return n.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),ln(this)},t.totalDuration=function(i){var r=0,o=this,a=o._last,c=Et,l,u,h;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-i:i));if(o._dirty){for(h=o.parent;a;)l=a._prev,a._dirty&&a.totalDuration(),u=a._start,u>c&&o._sort&&a._ts&&!o._lock?(o._lock=1,Zt(o,a,u-a._delay,1)._lock=0):c=u,u<0&&a._ts&&(r-=u,(!h&&!o._dp||h&&h.smoothChildTiming)&&(o._start+=u/o._ts,o._time-=u,o._tTime-=u),o.shiftChildren(-u,!1,-1/0),c=0),a._end>r&&a._ts&&(r=a._end),a=l;$n(o,o===be&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(i){if(be._ts&&(Hu(be,Jr(i,be)),Bu=mt.frame),mt.frame>=Tl){Tl+=vt.autoSleep||120;var r=be._first;if((!r||!r._ts)&&vt.autoSleep&&mt._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||mt.sleep()}}},e}(qi);Dt(Je.prototype,{_lock:0,_hasPause:0,_forcing:0});var Vm=function(e,t,s,i,r,o,a){var c=new ct(this._pt,e,t,0,1,_h,null,r),l=0,u=0,h,d,f,m,p,g,y,w;for(c.b=s,c.e=i,s+="",i+="",(y=~i.indexOf("random("))&&(i=Hi(i)),o&&(w=[s,i],o(w,e,t),s=w[0],i=w[1]),d=s.match(aa)||[];h=aa.exec(i);)m=h[0],p=i.substring(l,h.index),f?f=(f+1)%5:p.substr(-5)==="rgba("&&(f=1),m!==d[u++]&&(g=parseFloat(d[u-1])||0,c._pt={_next:c._pt,p:p||u===1?p:",",s:g,c:m.charAt(1)==="="?Vn(g,m)-g:parseFloat(m)-g,m:f&&f<4?Math.round:0},l=aa.lastIndex);return c.c=l<i.length?i.substring(l,i.length):"",c.fp=a,(Iu.test(i)||y)&&(c.e=0),this._pt=c,c},hc=function(e,t,s,i,r,o,a,c,l,u){De(i)&&(i=i(r||0,e,o));var h=e[t],d=s!=="get"?s:De(h)?l?e[t.indexOf("set")||!De(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,f=De(h)?l?Gm:ph:fc,m;if(qe(i)&&(~i.indexOf("random(")&&(i=Hi(i)),i.charAt(1)==="="&&(m=Vn(d,i)+(Ye(d)||0),(m||m===0)&&(i=m))),!u||d!==i||Ra)return!isNaN(d*i)&&i!==""?(m=new ct(this._pt,e,t,+d||0,i-(d||0),typeof h=="boolean"?Zm:mh,0,f),l&&(m.fp=l),a&&m.modifier(a,this,e),this._pt=m):(!h&&!(t in e)&&ac(t,i),Vm.call(this,e,t,d,i,f,c||vt.stringFilter,l))},Hm=function(e,t,s,i,r){if(De(e)&&(e=Ui(e,r,t,s,i)),!Qt(e)||e.style&&e.nodeType||Xe(e)||Pu(e))return qe(e)?Ui(e,r,t,s,i):e;var o={},a;for(a in e)o[a]=Ui(e[a],r,t,s,i);return o},hh=function(e,t,s,i,r,o){var a,c,l,u;if(pt[e]&&(a=new pt[e]).init(r,a.rawVars?t[e]:Hm(t[e],i,r,o,s),s,i,o)!==!1&&(s._pt=c=new ct(s._pt,r,e,0,1,a.render,a,0,a.priority),s!==Un))for(l=s._ptLookup[s._targets.indexOf(r)],u=a._props.length;u--;)l[a._props[u]]=c;return a},Rs,Ra,dc=function n(e,t,s){var i=e.vars,r=i.ease,o=i.startAt,a=i.immediateRender,c=i.lazy,l=i.onUpdate,u=i.runBackwards,h=i.yoyoEase,d=i.keyframes,f=i.autoRevert,m=e._dur,p=e._startAt,g=e._targets,y=e.parent,w=y&&y.data==="nested"?y.vars.targets:g,S=e._overwrite==="auto"&&!nc,v=e.timeline,_,x,T,k,b,C,O,A,R,P,F,I,U;if(v&&(!d||!r)&&(r="none"),e._ease=un(r,Zn.ease),e._yEase=h?ah(un(h===!0?r:h,Zn.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!v&&!!i.runBackwards,!v||d&&!i.stagger){if(A=g[0]?cn(g[0]).harness:0,I=A&&i[A.prop],_=Kr(i,cc),p&&(p._zTime<0&&p.progress(1),t<0&&u&&a&&!f?p.render(-1,!0):p.revert(u&&m?jr:_m),p._lazy=0),o){if(Bs(e._startAt=Le.set(g,Dt({data:"isStart",overwrite:!1,parent:y,immediateRender:!0,lazy:!p&&ot(c),startAt:null,delay:0,onUpdate:l&&function(){return gt(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ze||!a&&!f)&&e._startAt.revert(jr),a&&m&&t<=0&&s<=0){t&&(e._zTime=t);return}}else if(u&&m&&!p){if(t&&(a=!1),T=Dt({overwrite:!1,data:"isFromStart",lazy:a&&!p&&ot(c),immediateRender:a,stagger:0,parent:y},_),I&&(T[A.prop]=I),Bs(e._startAt=Le.set(g,T)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ze?e._startAt.revert(jr):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,fe,fe);else if(!t)return}for(e._pt=e._ptCache=0,c=m&&ot(c)||c&&!m,x=0;x<g.length;x++){if(b=g[x],O=b._gsap||uc(g)[x]._gsap,e._ptLookup[x]=P={},Ca[O.id]&&Us.length&&Qr(),F=w===g?x:w.indexOf(b),A&&(R=new A).init(b,I||_,e,F,w)!==!1&&(e._pt=k=new ct(e._pt,b,R.name,0,1,R.render,R,0,R.priority),R._props.forEach(function(V){P[V]=k}),R.priority&&(C=1)),!A||I)for(T in _)pt[T]&&(R=hh(T,_,e,F,b,w))?R.priority&&(C=1):P[T]=k=hc.call(e,b,T,"get",_[T],F,w,0,i.stringFilter);e._op&&e._op[x]&&e.kill(b,e._op[x]),S&&e._pt&&(Rs=e,be.killTweensOf(b,P,e.globalTime(t)),U=!e.parent,Rs=0),e._pt&&c&&(Ca[O.id]=1)}C&&gh(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!U,d&&t<=0&&v.render(Et,!0,!0)},jm=function(e,t,s,i,r,o,a,c){var l=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,d,f;if(!l)for(l=e._ptCache[t]=[],d=e._ptLookup,f=e._targets.length;f--;){if(u=d[f][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return Ra=1,e.vars[t]="+=0",dc(e,a),Ra=0,c?Bi(t+" not eligible for reset"):1;l.push(u)}for(f=l.length;f--;)h=l[f],u=h._pt||h,u.s=(i||i===0)&&!r?i:u.s+(i||0)+o*u.c,u.c=s-u.s,h.e&&(h.e=Pe(s)+Ye(h.e)),h.b&&(h.b=u.s+Ye(h.b))},qm=function(e,t){var s=e[0]?cn(e[0]).harness:0,i=s&&s.aliases,r,o,a,c;if(!i)return t;r=pn({},t);for(o in i)if(o in r)for(c=i[o].split(","),a=c.length;a--;)r[c[a]]=r[o];return r},Wm=function(e,t,s,i){var r=t.ease||i||"power1.inOut",o,a;if(Xe(t))a=s[e]||(s[e]=[]),t.forEach(function(c,l){return a.push({t:l/(t.length-1)*100,v:c,e:r})});else for(o in t)a=s[o]||(s[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:r})},Ui=function(e,t,s,i,r){return De(e)?e.call(t,s,i,r):qe(e)&&~e.indexOf("random(")?Hi(e):e},dh=lc+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",fh={};at(dh+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return fh[n]=1});var Le=function(n){Du(e,n);function e(s,i,r,o){var a;typeof i=="number"&&(r.duration=i,i=r,r=null),a=n.call(this,o?i:Ii(i))||this;var c=a.vars,l=c.duration,u=c.delay,h=c.immediateRender,d=c.stagger,f=c.overwrite,m=c.keyframes,p=c.defaults,g=c.scrollTrigger,y=c.yoyoEase,w=i.parent||be,S=(Xe(s)||Pu(s)?gs(s[0]):"length"in i)?[s]:Ot(s),v,_,x,T,k,b,C,O;if(a._targets=S.length?uc(S):Bi("GSAP target "+s+" not found. https://gsap.com",!vt.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,m||d||Fr(l)||Fr(u)){if(i=a.vars,v=a.timeline=new Je({data:"nested",defaults:p||{},targets:w&&w.data==="nested"?w.vars.targets:S}),v.kill(),v.parent=v._dp=ls(a),v._start=0,d||Fr(l)||Fr(u)){if(T=S.length,C=d&&Qu(d),Qt(d))for(k in d)~dh.indexOf(k)&&(O||(O={}),O[k]=d[k]);for(_=0;_<T;_++)x=Kr(i,fh),x.stagger=0,y&&(x.yoyoEase=y),O&&pn(x,O),b=S[_],x.duration=+Ui(l,ls(a),_,b,S),x.delay=(+Ui(u,ls(a),_,b,S)||0)-a._delay,!d&&T===1&&x.delay&&(a._delay=u=x.delay,a._start+=u,x.delay=0),v.to(b,x,C?C(_,b,S):0),v._ease=se.none;v.duration()?l=u=0:a.timeline=0}else if(m){Ii(Dt(v.vars.defaults,{ease:"none"})),v._ease=un(m.ease||i.ease||"none");var A=0,R,P,F;if(Xe(m))m.forEach(function(I){return v.to(S,I,">")}),v.duration();else{x={};for(k in m)k==="ease"||k==="easeEach"||Wm(k,m[k],x,m.easeEach);for(k in x)for(R=x[k].sort(function(I,U){return I.t-U.t}),A=0,_=0;_<R.length;_++)P=R[_],F={ease:P.e,duration:(P.t-(_?R[_-1].t:0))/100*l},F[k]=P.v,v.to(S,F,A),A+=F.duration;v.duration()<l&&v.to({},{duration:l-v.duration()})}}l||a.duration(l=v.duration())}else a.timeline=0;return f===!0&&!nc&&(Rs=ls(a),be.killTweensOf(S),Rs=0),Zt(w,ls(a),r),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(h||!l&&!m&&a._start===Ve(w._time)&&ot(h)&&km(ls(a))&&w.data!=="nested")&&(a._tTime=-fe,a.render(Math.max(0,-u)||0)),g&&Yu(ls(a),g),a}var t=e.prototype;return t.render=function(i,r,o){var a=this._time,c=this._tDur,l=this._dur,u=i<0,h=i>c-fe&&!u?c:i<fe?0:i,d,f,m,p,g,y,w,S,v;if(!l)Sm(this,i,r,o);else if(h!==this._tTime||!i||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u){if(d=h,S=this.timeline,this._repeat){if(p=l+this._rDelay,this._repeat<-1&&u)return this.totalTime(p*100+i,r,o);if(d=Ve(h%p),h===c?(m=this._repeat,d=l):(m=~~(h/p),m&&m===Ve(h/p)&&(d=l,m--),d>l&&(d=l)),y=this._yoyo&&m&1,y&&(v=this._yEase,d=l-d),g=Xn(this._tTime,p),d===a&&!o&&this._initted&&m===g)return this._tTime=h,this;m!==g&&(S&&this._yEase&&ch(S,y),this.vars.repeatRefresh&&!y&&!this._lock&&this._time!==l&&this._initted&&(this._lock=o=1,this.render(Ve(p*m),!0).invalidate()._lock=0))}if(!this._initted){if(Zu(this,u?i:d,o,r,h))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&m!==g))return this;if(l!==this._dur)return this.render(i,r,o)}if(this._tTime=h,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=w=(v||this._ease)(d/l),this._from&&(this.ratio=w=1-w),d&&!a&&!r&&!m&&(gt(this,"onStart"),this._tTime!==h))return this;for(f=this._pt;f;)f.r(w,f.d),f=f._next;S&&S.render(i<0?i:!d&&y?-fe:S._dur*S._ease(d/this._dur),r,o)||this._startAt&&(this._zTime=i),this._onUpdate&&!r&&(u&&Ea(this,i,r,o),gt(this,"onUpdate")),this._repeat&&m!==g&&this.vars.onRepeat&&!r&&this.parent&&gt(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&Ea(this,i,!0,!0),(i||!l)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&Bs(this,1),!r&&!(u&&!a)&&(h||a||y)&&(gt(this,h===c?"onComplete":"onReverseComplete",!0),this._prom&&!(h<c&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),n.prototype.invalidate.call(this,i)},t.resetTo=function(i,r,o,a,c){ji||mt.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||dc(this,l),u=this._ease(l/this._dur),jm(this,i,r,o,a,u,l,c)?this.resetTo(i,r,o,a,1):(Po(this,0),this.parent||Wu(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,r){if(r===void 0&&(r="all"),!i&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Pi(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(i,r,Rs&&Rs.vars.overwrite!==!0)._first||Pi(this),this.parent&&o!==this.timeline.totalDuration()&&$n(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,c=i?Ot(i):a,l=this._ptLookup,u=this._pt,h,d,f,m,p,g,y;if((!r||r==="all")&&Tm(a,c))return r==="all"&&(this._pt=0),Pi(this);for(h=this._op=this._op||[],r!=="all"&&(qe(r)&&(p={},at(r,function(w){return p[w]=1}),r=p),r=qm(a,r)),y=a.length;y--;)if(~c.indexOf(a[y])){d=l[y],r==="all"?(h[y]=r,m=d,f={}):(f=h[y]=h[y]||{},m=r);for(p in m)g=d&&d[p],g&&((!("kill"in g.d)||g.d.kill(p)===!0)&&Do(this,g,"_pt"),delete d[p]),f!=="all"&&(f[p]=1)}return this._initted&&!this._pt&&u&&Pi(this),this},e.to=function(i,r){return new e(i,r,arguments[2])},e.from=function(i,r){return Fi(1,arguments)},e.delayedCall=function(i,r,o,a){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(i,r,o){return Fi(2,arguments)},e.set=function(i,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(i,r)},e.killTweensOf=function(i,r,o){return be.killTweensOf(i,r,o)},e}(qi);Dt(Le.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});at("staggerTo,staggerFrom,staggerFromTo",function(n){Le[n]=function(){var e=new Je,t=Aa.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var fc=function(e,t,s){return e[t]=s},ph=function(e,t,s){return e[t](s)},Gm=function(e,t,s,i){return e[t](i.fp,s)},Ym=function(e,t,s){return e.setAttribute(t,s)},pc=function(e,t){return De(e[t])?ph:ic(e[t])&&e.setAttribute?Ym:fc},mh=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Zm=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},_h=function(e,t){var s=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;s;)i=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+i,s=s._next;i+=t.c}t.set(t.t,t.p,i,t)},mc=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},Xm=function(e,t,s,i){for(var r=this._pt,o;r;)o=r._next,r.p===i&&r.modifier(e,t,s),r=o},$m=function(e){for(var t=this._pt,s,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?Do(this,t,"_pt"):t.dep||(s=1),t=i;return!s},Qm=function(e,t,s,i){i.mSet(e,t,i.m.call(i.tween,s,i.mt),i)},gh=function(e){for(var t=e._pt,s,i,r,o;t;){for(s=t._next,i=r;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:o)?t._prev._next=t:r=t,(t._next=i)?i._prev=t:o=t,t=s}e._pt=r},ct=function(){function n(t,s,i,r,o,a,c,l,u){this.t=s,this.s=r,this.c=o,this.p=i,this.r=a||mh,this.d=c||this,this.set=l||fc,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(s,i,r){this.mSet=this.mSet||this.set,this.set=Qm,this.m=s,this.mt=r,this.tween=i},n}();at(lc+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return cc[n]=1});xt.TweenMax=xt.TweenLite=Le;xt.TimelineLite=xt.TimelineMax=Je;be=new Je({sortChildren:!1,defaults:Zn,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});vt.stringFilter=oh;var hn=[],Wr={},Km=[],Cl=0,Jm=0,da=function(e){return(Wr[e]||Km).map(function(t){return t()})},Pa=function(){var e=Date.now(),t=[];e-Cl>2&&(da("matchMediaInit"),hn.forEach(function(s){var i=s.queries,r=s.conditions,o,a,c,l;for(a in i)o=Ct.matchMedia(i[a]).matches,o&&(c=1),o!==r[a]&&(r[a]=o,l=1);l&&(s.revert(),c&&t.push(s))}),da("matchMediaRevert"),t.forEach(function(s){return s.onMatch(s,function(i){return s.add(null,i)})}),Cl=e,da("matchMedia"))},vh=function(){function n(t,s){this.selector=s&&Ma(s),this.data=[],this._r=[],this.isReverted=!1,this.id=Jm++,t&&this.add(t)}var e=n.prototype;return e.add=function(s,i,r){De(s)&&(r=i,i=s,s=De);var o=this,a=function(){var l=Ae,u=o.selector,h;return l&&l!==o&&l.data.push(o),r&&(o.selector=Ma(r)),Ae=o,h=i.apply(o,arguments),De(h)&&o._r.push(h),Ae=l,o.selector=u,o.isReverted=!1,h};return o.last=a,s===De?a(o,function(c){return o.add(null,c)}):s?o[s]=a:a},e.ignore=function(s){var i=Ae;Ae=null,s(this),Ae=i},e.getTweens=function(){var s=[];return this.data.forEach(function(i){return i instanceof n?s.push.apply(s,i.getTweens()):i instanceof Le&&!(i.parent&&i.parent.data==="nested")&&s.push(i)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,i){var r=this;if(s?function(){for(var a=r.getTweens(),c=r.data.length,l;c--;)l=r.data[c],l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(u){return a.splice(a.indexOf(u),1)}));for(a.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(s)}),c=r.data.length;c--;)l=r.data[c],l instanceof Je?l.data!=="nested"&&(l.scrollTrigger&&l.scrollTrigger.revert(),l.kill()):!(l instanceof Le)&&l.revert&&l.revert(s);r._r.forEach(function(u){return u(s,r)}),r.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var o=hn.length;o--;)hn[o].id===this.id&&hn.splice(o,1)},e.revert=function(s){this.kill(s||{})},n}(),e_=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(s,i,r){Qt(s)||(s={matches:s});var o=new vh(0,r||this.scope),a=o.conditions={},c,l,u;Ae&&!o.selector&&(o.selector=Ae.selector),this.contexts.push(o),i=o.add("onMatch",i),o.queries=s;for(l in s)l==="all"?u=1:(c=Ct.matchMedia(s[l]),c&&(hn.indexOf(o)<0&&hn.push(o),(a[l]=c.matches)&&(u=1),c.addListener?c.addListener(Pa):c.addEventListener("change",Pa)));return u&&i(o,function(h){return o.add(null,h)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(i){return i.kill(s,!0)})},n}(),eo={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(i){return nh(i)})},timeline:function(e){return new Je(e)},getTweensOf:function(e,t){return be.getTweensOf(e,t)},getProperty:function(e,t,s,i){qe(e)&&(e=Ot(e)[0]);var r=cn(e||{}).get,o=s?qu:ju;return s==="native"&&(s=""),e&&(t?o((pt[t]&&pt[t].get||r)(e,t,s,i)):function(a,c,l){return o((pt[a]&&pt[a].get||r)(e,a,c,l))})},quickSetter:function(e,t,s){if(e=Ot(e),e.length>1){var i=e.map(function(u){return ht.quickSetter(u,t,s)}),r=i.length;return function(u){for(var h=r;h--;)i[h](u)}}e=e[0]||{};var o=pt[t],a=cn(e),c=a.harness&&(a.harness.aliases||{})[t]||t,l=o?function(u){var h=new o;Un._pt=0,h.init(e,s?u+s:u,Un,0,[e]),h.render(1,h),Un._pt&&mc(1,Un)}:a.set(e,c);return o?l:function(u){return l(e,c,s?u+s:u,a,1)}},quickTo:function(e,t,s){var i,r=ht.to(e,pn((i={},i[t]="+=0.1",i.paused=!0,i),s||{})),o=function(c,l,u){return r.resetTo(t,c,l,u)};return o.tween=r,o},isTweening:function(e){return be.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=un(e.ease,Zn.ease)),xl(Zn,e||{})},config:function(e){return xl(vt,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,i=e.plugins,r=e.defaults,o=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!pt[a]&&!xt[a]&&Bi(t+" effect requires "+a+" plugin.")}),ca[t]=function(a,c,l){return s(Ot(a),Dt(c||{},r),l)},o&&(Je.prototype[t]=function(a,c,l){return this.add(ca[t](a,Qt(c)?c:(l=c)&&{},this),l)})},registerEase:function(e,t){se[e]=un(t)},parseEase:function(e,t){return arguments.length?un(e,t):se},getById:function(e){return be.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new Je(e),i,r;for(s.smoothChildTiming=ot(e.smoothChildTiming),be.remove(s),s._dp=0,s._time=s._tTime=be._time,i=be._first;i;)r=i._next,(t||!(!i._dur&&i instanceof Le&&i.vars.onComplete===i._targets[0]))&&Zt(s,i,i._start-i._delay),i=r;return Zt(be,s,0),s},context:function(e,t){return e?new vh(e,t):Ae},matchMedia:function(e){return new e_(e)},matchMediaRefresh:function(){return hn.forEach(function(e){var t=e.conditions,s,i;for(i in t)t[i]&&(t[i]=!1,s=1);s&&e.revert()})||Pa()},addEventListener:function(e,t){var s=Wr[e]||(Wr[e]=[]);~s.indexOf(t)||s.push(t)},removeEventListener:function(e,t){var s=Wr[e],i=s&&s.indexOf(t);i>=0&&s.splice(i,1)},utils:{wrap:Rm,wrapYoyo:Pm,distribute:Qu,random:Ju,snap:Ku,normalize:Dm,getUnit:Ye,clamp:Em,splitColor:ih,toArray:Ot,selector:Ma,mapRange:th,pipe:Am,unitize:Mm,interpolate:Nm,shuffle:$u},install:Lu,effects:ca,ticker:mt,updateRoot:Je.updateRoot,plugins:pt,globalTimeline:be,core:{PropTween:ct,globals:zu,Tween:Le,Timeline:Je,Animation:qi,getCache:cn,_removeLinkedListItem:Do,reverting:function(){return Ze},context:function(e){return e&&Ae&&(Ae.data.push(e),e._ctx=Ae),Ae},suppressOverwrites:function(e){return nc=e}}};at("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return eo[n]=Le[n]});mt.add(Je.updateRoot);Un=eo.to({},{duration:0});var t_=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},s_=function(e,t){var s=e._targets,i,r,o;for(i in t)for(r=s.length;r--;)o=e._ptLookup[r][i],o&&(o=o.d)&&(o._pt&&(o=t_(o,i)),o&&o.modifier&&o.modifier(t[i],e,s[r],i))},fa=function(e,t){return{name:e,rawVars:1,init:function(i,r,o){o._onInit=function(a){var c,l;if(qe(r)&&(c={},at(r,function(u){return c[u]=1}),r=c),t){c={};for(l in r)c[l]=t(r[l]);r=c}s_(a,r)}}}},ht=eo.registerPlugin({name:"attr",init:function(e,t,s,i,r){var o,a,c;this.tween=s;for(o in t)c=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(c||0)+"",t[o],i,r,0,0,o),a.op=o,a.b=c,this._props.push(o)},render:function(e,t){for(var s=t._pt;s;)Ze?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s],0,0,0,0,0,1)}},fa("roundProps",Da),fa("modifiers"),fa("snap",Ku))||eo;Le.version=Je.version=ht.version="3.12.4";Uu=1;rc()&&Qn();se.Power0;se.Power1;se.Power2;se.Power3;se.Power4;se.Linear;se.Quad;se.Cubic;se.Quart;se.Quint;se.Strong;se.Elastic;se.Back;se.SteppedEase;se.Bounce;se.Sine;se.Expo;se.Circ;/*!
 * CSSPlugin 3.12.4
 * https://gsap.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var El,Ps,Hn,_c,rn,Ol,gc,n_=function(){return typeof window<"u"},vs={},sn=180/Math.PI,jn=Math.PI/180,Rn=Math.atan2,Al=1e8,vc=/([A-Z])/g,i_=/(left|right|width|margin|padding|x)/i,r_=/[\s,\(]\S/,Xt={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Na=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},o_=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},a_=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},c_=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},yh=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Th=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},l_=function(e,t,s){return e.style[t]=s},u_=function(e,t,s){return e.style.setProperty(t,s)},h_=function(e,t,s){return e._gsap[t]=s},d_=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},f_=function(e,t,s,i,r){var o=e._gsap;o.scaleX=o.scaleY=s,o.renderTransform(r,o)},p_=function(e,t,s,i,r){var o=e._gsap;o[t]=s,o.renderTransform(r,o)},Ce="transform",lt=Ce+"Origin",m_=function n(e,t){var s=this,i=this.target,r=i.style,o=i._gsap;if(e in vs&&r){if(this.tfm=this.tfm||{},e!=="transform")e=Xt[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return s.tfm[a]=hs(i,a)}):this.tfm[e]=o.x?o[e]:hs(i,e),e===lt&&(this.tfm.zOrigin=o.zOrigin);else return Xt.transform.split(",").forEach(function(a){return n.call(s,a,t)});if(this.props.indexOf(Ce)>=0)return;o.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(lt,t,"")),e=Ce}(r||t)&&this.props.push(e,t,r[e])},xh=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},__=function(){var e=this.props,t=this.target,s=t.style,i=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?t[e[r]]=e[r+2]:e[r+2]?s[e[r]]=e[r+2]:s.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(vc,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)i[o]=this.tfm[o];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=gc(),(!r||!r.isStart)&&!s[Ce]&&(xh(s),i.zOrigin&&s[lt]&&(s[lt]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},kh=function(e,t){var s={target:e,props:[],revert:__,save:m_};return e._gsap||ht.core.getCache(e),t&&t.split(",").forEach(function(i){return s.save(i)}),s},wh,Ia=function(e,t){var s=Ps.createElementNS?Ps.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Ps.createElement(e);return s&&s.style?s:Ps.createElement(e)},$t=function n(e,t,s){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(vc,"-$1").toLowerCase())||i.getPropertyValue(t)||!s&&n(e,Kn(t)||t,1)||""},Ml="O,Moz,ms,Ms,Webkit".split(","),Kn=function(e,t,s){var i=t||rn,r=i.style,o=5;if(e in r&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(Ml[o]+e in r););return o<0?null:(o===3?"ms":o>=0?Ml[o]:"")+e},Fa=function(){n_()&&window.document&&(El=window,Ps=El.document,Hn=Ps.documentElement,rn=Ia("div")||{style:{}},Ia("div"),Ce=Kn(Ce),lt=Ce+"Origin",rn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",wh=!!Kn("perspective"),gc=ht.core.reverting,_c=1)},pa=function n(e){var t=Ia("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,i=this.nextSibling,r=this.style.cssText,o;if(Hn.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(o=this._gsapBBox());return s&&(i?s.insertBefore(this,i):s.appendChild(this)),Hn.removeChild(t),this.style.cssText=r,o},Dl=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},Sh=function(e){var t;try{t=e.getBBox()}catch{t=pa.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===pa||(t=pa.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Dl(e,["x","cx","x1"])||0,y:+Dl(e,["y","cy","y1"])||0,width:0,height:0}:t},bh=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Sh(e))},mn=function(e,t){if(t){var s=e.style,i;t in vs&&t!==lt&&(t=Ce),s.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(i==="--"?t:t.replace(vc,"-$1").toLowerCase())):s.removeAttribute(t)}},Ns=function(e,t,s,i,r,o){var a=new ct(e._pt,t,s,0,1,o?Th:yh);return e._pt=a,a.b=i,a.e=r,e._props.push(s),a},Rl={deg:1,rad:1,turn:1},g_={grid:1,flex:1},Vs=function n(e,t,s,i){var r=parseFloat(s)||0,o=(s+"").trim().substr((r+"").length)||"px",a=rn.style,c=i_.test(t),l=e.tagName.toLowerCase()==="svg",u=(l?"client":"offset")+(c?"Width":"Height"),h=100,d=i==="px",f=i==="%",m,p,g,y;if(i===o||!r||Rl[i]||Rl[o])return r;if(o!=="px"&&!d&&(r=n(e,t,s,"px")),y=e.getCTM&&bh(e),(f||o==="%")&&(vs[t]||~t.indexOf("adius")))return m=y?e.getBBox()[c?"width":"height"]:e[u],Pe(f?r/m*h:r/100*m);if(a[c?"width":"height"]=h+(d?o:i),p=~t.indexOf("adius")||i==="em"&&e.appendChild&&!l?e:e.parentNode,y&&(p=(e.ownerSVGElement||{}).parentNode),(!p||p===Ps||!p.appendChild)&&(p=Ps.body),g=p._gsap,g&&f&&g.width&&c&&g.time===mt.time&&!g.uncache)return Pe(r/g.width*h);if(f&&(t==="height"||t==="width")){var w=e.style[t];e.style[t]=h+i,m=e[u],w?e.style[t]=w:mn(e,t)}else(f||o==="%")&&!g_[$t(p,"display")]&&(a.position=$t(e,"position")),p===e&&(a.position="static"),p.appendChild(rn),m=rn[u],p.removeChild(rn),a.position="absolute";return c&&f&&(g=cn(p),g.time=mt.time,g.width=p[u]),Pe(d?m*r/h:m&&r?h/m*r:0)},hs=function(e,t,s,i){var r;return _c||Fa(),t in Xt&&t!=="transform"&&(t=Xt[t],~t.indexOf(",")&&(t=t.split(",")[0])),vs[t]&&t!=="transform"?(r=Gi(e,i),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:so($t(e,lt))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||i||~(r+"").indexOf("calc("))&&(r=to[t]&&to[t](e,t,s)||$t(e,t)||Vu(e,t)||(t==="opacity"?1:0))),s&&!~(r+"").trim().indexOf(" ")?Vs(e,t,r,s)+s:r},v_=function(e,t,s,i){if(!s||s==="none"){var r=Kn(t,e,1),o=r&&$t(e,r,1);o&&o!==s?(t=r,s=o):t==="borderColor"&&(s=$t(e,"borderTopColor"))}var a=new ct(this._pt,e.style,t,0,1,_h),c=0,l=0,u,h,d,f,m,p,g,y,w,S,v,_;if(a.b=s,a.e=i,s+="",i+="",i==="auto"&&(p=e.style[t],e.style[t]=i,i=$t(e,t)||i,p?e.style[t]=p:mn(e,t)),u=[s,i],oh(u),s=u[0],i=u[1],d=s.match(Fn)||[],_=i.match(Fn)||[],_.length){for(;h=Fn.exec(i);)g=h[0],w=i.substring(c,h.index),m?m=(m+1)%5:(w.substr(-5)==="rgba("||w.substr(-5)==="hsla(")&&(m=1),g!==(p=d[l++]||"")&&(f=parseFloat(p)||0,v=p.substr((f+"").length),g.charAt(1)==="="&&(g=Vn(f,g)+v),y=parseFloat(g),S=g.substr((y+"").length),c=Fn.lastIndex-S.length,S||(S=S||vt.units[t]||v,c===i.length&&(i+=S,a.e+=S)),v!==S&&(f=Vs(e,t,p,S)||0),a._pt={_next:a._pt,p:w||l===1?w:",",s:f,c:y-f,m:m&&m<4||t==="zIndex"?Math.round:0});a.c=c<i.length?i.substring(c,i.length):""}else a.r=t==="display"&&i==="none"?Th:yh;return Iu.test(i)&&(a.e=0),this._pt=a,a},Pl={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},y_=function(e){var t=e.split(" "),s=t[0],i=t[1]||"50%";return(s==="top"||s==="bottom"||i==="left"||i==="right")&&(e=s,s=i,i=e),t[0]=Pl[s]||s,t[1]=Pl[i]||i,t.join(" ")},T_=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,i=s.style,r=t.u,o=s._gsap,a,c,l;if(r==="all"||r===!0)i.cssText="",c=1;else for(r=r.split(","),l=r.length;--l>-1;)a=r[l],vs[a]&&(c=1,a=a==="transformOrigin"?lt:Ce),mn(s,a);c&&(mn(s,Ce),o&&(o.svg&&s.removeAttribute("transform"),Gi(s,1),o.uncache=1,xh(i)))}},to={clearProps:function(e,t,s,i,r){if(r.data!=="isFromStart"){var o=e._pt=new ct(e._pt,t,s,0,0,T_);return o.u=i,o.pr=-10,o.tween=r,e._props.push(s),1}}},Wi=[1,0,0,1,0,0],Ch={},Eh=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Nl=function(e){var t=$t(e,Ce);return Eh(t)?Wi:t.substr(7).match(Nu).map(Pe)},yc=function(e,t){var s=e._gsap||cn(e),i=e.style,r=Nl(e),o,a,c,l;return s.svg&&e.getAttribute("transform")?(c=e.transform.baseVal.consolidate().matrix,r=[c.a,c.b,c.c,c.d,c.e,c.f],r.join(",")==="1,0,0,1,0,0"?Wi:r):(r===Wi&&!e.offsetParent&&e!==Hn&&!s.svg&&(c=i.display,i.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(l=1,a=e.nextElementSibling,Hn.appendChild(e)),r=Nl(e),c?i.display=c:mn(e,"display"),l&&(a?o.insertBefore(e,a):o?o.appendChild(e):Hn.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},Ua=function(e,t,s,i,r,o){var a=e._gsap,c=r||yc(e,!0),l=a.xOrigin||0,u=a.yOrigin||0,h=a.xOffset||0,d=a.yOffset||0,f=c[0],m=c[1],p=c[2],g=c[3],y=c[4],w=c[5],S=t.split(" "),v=parseFloat(S[0])||0,_=parseFloat(S[1])||0,x,T,k,b;s?c!==Wi&&(T=f*g-m*p)&&(k=v*(g/T)+_*(-p/T)+(p*w-g*y)/T,b=v*(-m/T)+_*(f/T)-(f*w-m*y)/T,v=k,_=b):(x=Sh(e),v=x.x+(~S[0].indexOf("%")?v/100*x.width:v),_=x.y+(~(S[1]||S[0]).indexOf("%")?_/100*x.height:_)),i||i!==!1&&a.smooth?(y=v-l,w=_-u,a.xOffset=h+(y*f+w*p)-y,a.yOffset=d+(y*m+w*g)-w):a.xOffset=a.yOffset=0,a.xOrigin=v,a.yOrigin=_,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!s,e.style[lt]="0px 0px",o&&(Ns(o,a,"xOrigin",l,v),Ns(o,a,"yOrigin",u,_),Ns(o,a,"xOffset",h,a.xOffset),Ns(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",v+" "+_)},Gi=function(e,t){var s=e._gsap||new uh(e);if("x"in s&&!t&&!s.uncache)return s;var i=e.style,r=s.scaleX<0,o="px",a="deg",c=getComputedStyle(e),l=$t(e,lt)||"0",u,h,d,f,m,p,g,y,w,S,v,_,x,T,k,b,C,O,A,R,P,F,I,U,V,B,q,H,z,xe,ae,X;return u=h=d=p=g=y=w=S=v=0,f=m=1,s.svg=!!(e.getCTM&&bh(e)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(i[Ce]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+(c[Ce]!=="none"?c[Ce]:"")),i.scale=i.rotate=i.translate="none"),T=yc(e,s.svg),s.svg&&(s.uncache?(V=e.getBBox(),l=s.xOrigin-V.x+"px "+(s.yOrigin-V.y)+"px",U=""):U=!t&&e.getAttribute("data-svg-origin"),Ua(e,U||l,!!U||s.originIsAbsolute,s.smooth!==!1,T)),_=s.xOrigin||0,x=s.yOrigin||0,T!==Wi&&(O=T[0],A=T[1],R=T[2],P=T[3],u=F=T[4],h=I=T[5],T.length===6?(f=Math.sqrt(O*O+A*A),m=Math.sqrt(P*P+R*R),p=O||A?Rn(A,O)*sn:0,w=R||P?Rn(R,P)*sn+p:0,w&&(m*=Math.abs(Math.cos(w*jn))),s.svg&&(u-=_-(_*O+x*R),h-=x-(_*A+x*P))):(X=T[6],xe=T[7],q=T[8],H=T[9],z=T[10],ae=T[11],u=T[12],h=T[13],d=T[14],k=Rn(X,z),g=k*sn,k&&(b=Math.cos(-k),C=Math.sin(-k),U=F*b+q*C,V=I*b+H*C,B=X*b+z*C,q=F*-C+q*b,H=I*-C+H*b,z=X*-C+z*b,ae=xe*-C+ae*b,F=U,I=V,X=B),k=Rn(-R,z),y=k*sn,k&&(b=Math.cos(-k),C=Math.sin(-k),U=O*b-q*C,V=A*b-H*C,B=R*b-z*C,ae=P*C+ae*b,O=U,A=V,R=B),k=Rn(A,O),p=k*sn,k&&(b=Math.cos(k),C=Math.sin(k),U=O*b+A*C,V=F*b+I*C,A=A*b-O*C,I=I*b-F*C,O=U,F=V),g&&Math.abs(g)+Math.abs(p)>359.9&&(g=p=0,y=180-y),f=Pe(Math.sqrt(O*O+A*A+R*R)),m=Pe(Math.sqrt(I*I+X*X)),k=Rn(F,I),w=Math.abs(k)>2e-4?k*sn:0,v=ae?1/(ae<0?-ae:ae):0),s.svg&&(U=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!Eh($t(e,Ce)),U&&e.setAttribute("transform",U))),Math.abs(w)>90&&Math.abs(w)<270&&(r?(f*=-1,w+=p<=0?180:-180,p+=p<=0?180:-180):(m*=-1,w+=w<=0?180:-180)),t=t||s.uncache,s.x=u-((s.xPercent=u&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+o,s.y=h-((s.yPercent=h&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+o,s.z=d+o,s.scaleX=Pe(f),s.scaleY=Pe(m),s.rotation=Pe(p)+a,s.rotationX=Pe(g)+a,s.rotationY=Pe(y)+a,s.skewX=w+a,s.skewY=S+a,s.transformPerspective=v+o,(s.zOrigin=parseFloat(l.split(" ")[2])||!t&&s.zOrigin||0)&&(i[lt]=so(l)),s.xOffset=s.yOffset=0,s.force3D=vt.force3D,s.renderTransform=s.svg?k_:wh?Oh:x_,s.uncache=0,s},so=function(e){return(e=e.split(" "))[0]+" "+e[1]},ma=function(e,t,s){var i=Ye(t);return Pe(parseFloat(t)+parseFloat(Vs(e,"x",s+"px",i)))+i},x_=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Oh(e,t)},en="0deg",Oi="0px",tn=") ",Oh=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.z,l=s.rotation,u=s.rotationY,h=s.rotationX,d=s.skewX,f=s.skewY,m=s.scaleX,p=s.scaleY,g=s.transformPerspective,y=s.force3D,w=s.target,S=s.zOrigin,v="",_=y==="auto"&&e&&e!==1||y===!0;if(S&&(h!==en||u!==en)){var x=parseFloat(u)*jn,T=Math.sin(x),k=Math.cos(x),b;x=parseFloat(h)*jn,b=Math.cos(x),o=ma(w,o,T*b*-S),a=ma(w,a,-Math.sin(x)*-S),c=ma(w,c,k*b*-S+S)}g!==Oi&&(v+="perspective("+g+tn),(i||r)&&(v+="translate("+i+"%, "+r+"%) "),(_||o!==Oi||a!==Oi||c!==Oi)&&(v+=c!==Oi||_?"translate3d("+o+", "+a+", "+c+") ":"translate("+o+", "+a+tn),l!==en&&(v+="rotate("+l+tn),u!==en&&(v+="rotateY("+u+tn),h!==en&&(v+="rotateX("+h+tn),(d!==en||f!==en)&&(v+="skew("+d+", "+f+tn),(m!==1||p!==1)&&(v+="scale("+m+", "+p+tn),w.style[Ce]=v||"translate(0, 0)"},k_=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.rotation,l=s.skewX,u=s.skewY,h=s.scaleX,d=s.scaleY,f=s.target,m=s.xOrigin,p=s.yOrigin,g=s.xOffset,y=s.yOffset,w=s.forceCSS,S=parseFloat(o),v=parseFloat(a),_,x,T,k,b;c=parseFloat(c),l=parseFloat(l),u=parseFloat(u),u&&(u=parseFloat(u),l+=u,c+=u),c||l?(c*=jn,l*=jn,_=Math.cos(c)*h,x=Math.sin(c)*h,T=Math.sin(c-l)*-d,k=Math.cos(c-l)*d,l&&(u*=jn,b=Math.tan(l-u),b=Math.sqrt(1+b*b),T*=b,k*=b,u&&(b=Math.tan(u),b=Math.sqrt(1+b*b),_*=b,x*=b)),_=Pe(_),x=Pe(x),T=Pe(T),k=Pe(k)):(_=h,k=d,x=T=0),(S&&!~(o+"").indexOf("px")||v&&!~(a+"").indexOf("px"))&&(S=Vs(f,"x",o,"px"),v=Vs(f,"y",a,"px")),(m||p||g||y)&&(S=Pe(S+m-(m*_+p*T)+g),v=Pe(v+p-(m*x+p*k)+y)),(i||r)&&(b=f.getBBox(),S=Pe(S+i/100*b.width),v=Pe(v+r/100*b.height)),b="matrix("+_+","+x+","+T+","+k+","+S+","+v+")",f.setAttribute("transform",b),w&&(f.style[Ce]=b)},w_=function(e,t,s,i,r){var o=360,a=qe(r),c=parseFloat(r)*(a&&~r.indexOf("rad")?sn:1),l=c-i,u=i+l+"deg",h,d;return a&&(h=r.split("_")[1],h==="short"&&(l%=o,l!==l%(o/2)&&(l+=l<0?o:-o)),h==="cw"&&l<0?l=(l+o*Al)%o-~~(l/o)*o:h==="ccw"&&l>0&&(l=(l-o*Al)%o-~~(l/o)*o)),e._pt=d=new ct(e._pt,t,s,i,l,o_),d.e=u,d.u="deg",e._props.push(s),d},Il=function(e,t){for(var s in t)e[s]=t[s];return e},S_=function(e,t,s){var i=Il({},s._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=s.style,a,c,l,u,h,d,f,m;i.svg?(l=s.getAttribute("transform"),s.setAttribute("transform",""),o[Ce]=t,a=Gi(s,1),mn(s,Ce),s.setAttribute("transform",l)):(l=getComputedStyle(s)[Ce],o[Ce]=t,a=Gi(s,1),o[Ce]=l);for(c in vs)l=i[c],u=a[c],l!==u&&r.indexOf(c)<0&&(f=Ye(l),m=Ye(u),h=f!==m?Vs(s,c,l,m):parseFloat(l),d=parseFloat(u),e._pt=new ct(e._pt,a,c,h,d-h,Na),e._pt.u=m||0,e._props.push(c));Il(a,i)};at("padding,margin,Width,Radius",function(n,e){var t="Top",s="Right",i="Bottom",r="Left",o=(e<3?[t,s,i,r]:[t+r,t+s,i+s,i+r]).map(function(a){return e<2?n+a:"border"+a+n});to[e>1?"border"+n:n]=function(a,c,l,u,h){var d,f;if(arguments.length<4)return d=o.map(function(m){return hs(a,m,l)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(u+"").split(" "),f={},o.forEach(function(m,p){return f[m]=d[p]=d[p]||d[(p-1)/2|0]}),a.init(c,f,h)}});var Ah={name:"css",register:Fa,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,i,r){var o=this._props,a=e.style,c=s.vars.startAt,l,u,h,d,f,m,p,g,y,w,S,v,_,x,T,k;_c||Fa(),this.styles=this.styles||kh(e),k=this.styles.props,this.tween=s;for(p in t)if(p!=="autoRound"&&(u=t[p],!(pt[p]&&hh(p,t,s,i,e,r)))){if(f=typeof u,m=to[p],f==="function"&&(u=u.call(s,i,e,r),f=typeof u),f==="string"&&~u.indexOf("random(")&&(u=Hi(u)),m)m(this,e,p,u,s)&&(T=1);else if(p.substr(0,2)==="--")l=(getComputedStyle(e).getPropertyValue(p)+"").trim(),u+="",Ls.lastIndex=0,Ls.test(l)||(g=Ye(l),y=Ye(u)),y?g!==y&&(l=Vs(e,p,l,y)+y):g&&(u+=g),this.add(a,"setProperty",l,u,i,r,0,0,p),o.push(p),k.push(p,0,a[p]);else if(f!=="undefined"){if(c&&p in c?(l=typeof c[p]=="function"?c[p].call(s,i,e,r):c[p],qe(l)&&~l.indexOf("random(")&&(l=Hi(l)),Ye(l+"")||l==="auto"||(l+=vt.units[p]||Ye(hs(e,p))||""),(l+"").charAt(1)==="="&&(l=hs(e,p))):l=hs(e,p),d=parseFloat(l),w=f==="string"&&u.charAt(1)==="="&&u.substr(0,2),w&&(u=u.substr(2)),h=parseFloat(u),p in Xt&&(p==="autoAlpha"&&(d===1&&hs(e,"visibility")==="hidden"&&h&&(d=0),k.push("visibility",0,a.visibility),Ns(this,a,"visibility",d?"inherit":"hidden",h?"inherit":"hidden",!h)),p!=="scale"&&p!=="transform"&&(p=Xt[p],~p.indexOf(",")&&(p=p.split(",")[0]))),S=p in vs,S){if(this.styles.save(p),v||(_=e._gsap,_.renderTransform&&!t.parseTransform||Gi(e,t.parseTransform),x=t.smoothOrigin!==!1&&_.smooth,v=this._pt=new ct(this._pt,a,Ce,0,1,_.renderTransform,_,0,-1),v.dep=1),p==="scale")this._pt=new ct(this._pt,_,"scaleY",_.scaleY,(w?Vn(_.scaleY,w+h):h)-_.scaleY||0,Na),this._pt.u=0,o.push("scaleY",p),p+="X";else if(p==="transformOrigin"){k.push(lt,0,a[lt]),u=y_(u),_.svg?Ua(e,u,0,x,0,this):(y=parseFloat(u.split(" ")[2])||0,y!==_.zOrigin&&Ns(this,_,"zOrigin",_.zOrigin,y),Ns(this,a,p,so(l),so(u)));continue}else if(p==="svgOrigin"){Ua(e,u,1,x,0,this);continue}else if(p in Ch){w_(this,_,p,d,w?Vn(d,w+u):u);continue}else if(p==="smoothOrigin"){Ns(this,_,"smooth",_.smooth,u);continue}else if(p==="force3D"){_[p]=u;continue}else if(p==="transform"){S_(this,u,e);continue}}else p in a||(p=Kn(p)||p);if(S||(h||h===0)&&(d||d===0)&&!r_.test(u)&&p in a)g=(l+"").substr((d+"").length),h||(h=0),y=Ye(u)||(p in vt.units?vt.units[p]:g),g!==y&&(d=Vs(e,p,l,y)),this._pt=new ct(this._pt,S?_:a,p,d,(w?Vn(d,w+h):h)-d,!S&&(y==="px"||p==="zIndex")&&t.autoRound!==!1?c_:Na),this._pt.u=y||0,g!==y&&y!=="%"&&(this._pt.b=l,this._pt.r=a_);else if(p in a)v_.call(this,e,p,l,w?w+u:u);else if(p in e)this.add(e,p,l||e[p],w?w+u:u,i,r);else if(p!=="parseTransform"){ac(p,u);continue}S||(p in a?k.push(p,0,a[p]):k.push(p,1,l||e[p])),o.push(p)}}T&&gh(this)},render:function(e,t){if(t.tween._time||!gc())for(var s=t._pt;s;)s.r(e,s.d),s=s._next;else t.styles.revert()},get:hs,aliases:Xt,getSetter:function(e,t,s){var i=Xt[t];return i&&i.indexOf(",")<0&&(t=i),t in vs&&t!==lt&&(e._gsap.x||hs(e,"x"))?s&&Ol===s?t==="scale"?d_:h_:(Ol=s||{})&&(t==="scale"?f_:p_):e.style&&!ic(e.style[t])?l_:~t.indexOf("-")?u_:pc(e,t)},core:{_removeProperty:mn,_getMatrix:yc}};ht.utils.checkPrefix=Kn;ht.core.getStyleSaver=kh;(function(n,e,t,s){var i=at(n+","+e+","+t,function(r){vs[r]=1});at(e,function(r){vt.units[r]="deg",Ch[r]=1}),Xt[i[13]]=n+","+e,at(s,function(r){var o=r.split(":");Xt[o[1]]=i[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");at("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){vt.units[n]="px"});ht.registerPlugin(Ah);var Tc=ht.registerPlugin(Ah)||ht;Tc.core.Tween;const b_=(n,e,t,s,i)=>{const r=new Vf,o=1e-5;r.absarc(o,o,o,-Math.PI/2,-Math.PI,!0),r.absarc(o,e-s*2,o,Math.PI,Math.PI/2,!0),r.absarc(n-s*2,e-s*2,o,Math.PI/2,0,!0),r.absarc(n-s*2,o,o,0,-Math.PI/2,!0);const a=new Hf(r,{depth:t-s*2,bevelEnabled:!0,bevelSegments:i,steps:2,bevelSize:s,bevelThickness:s,curveSegments:i});a.center();const c=[],l=a.getAttribute("normal"),u=a.getAttribute("position");for(let h=0;h<u.count;h+=1){const d=new K(l.getX(h),l.getY(h),l.getZ(h)),f=new K(u.getX(h),u.getY(h),u.getZ(h));let m=0,p=0;Math.abs(d.y)>.9?(m=f.x/n+.5,p=1-(f.z/t+.5)):Math.abs(d.x)>.9?(m=-f.z/t+.5,p=1-(-f.y/e+.5)):Math.abs(d.z)>.9&&(m=f.x/n+.5,p=1-(-f.y/e+.5)),c.push(m,p)}return a.setAttribute("uv",new jf(c,2)),a};b_(10,10,10,2,10);const Fl=new Bf(10,10,10),C_=500,E_=800,O_=new K(0,0,0),A_=16777215,M_=20,D_=(n,e)=>{var r,o;if(!(n!=null&&n.ref_id)||!(e!=null&&e.ref_id))return!1;let t=!1;const s=n.guests,i=e.guests;return((r=n.children)!=null&&r.includes(e.ref_id)||(o=e.children)!=null&&o.includes(n.ref_id))&&(t=!0),(s!=null&&s.find(a=>a.ref_id===e.ref_id)||i!=null&&i.find(a=>a.ref_id===n.ref_id))&&(t=!0),t};let Ai=null;const R_=500,xc=(n,e)=>{if(Ai)return null;Ai=setTimeout(()=>{Ai&&(clearTimeout(Ai),Ai=null)},R_);const t=[];return n.forEach(i=>{const r=e.position.distanceTo(O_.set(i.x,i.y,i.z));r<E_&&t.push({id:i.ref_id||"",distance:r})}),t.sort((i,r)=>i.distance-r.distance).slice(0,C_).map(i=>i.id)},ps=new K(5e3,600,1600),Ul=100,P_=600,N_=2e3,_a={x:172.7392402058252,y:-239.04675366094037,z:-2e3},Mh="14.8.49",Ll=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),zl=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),La=(n,e)=>({startTime:e,type:"setValue",value:n}),Dh=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),Rh=(n,e,{startTime:t,target:s,timeConstant:i})=>s+(e-s)*Math.exp((t-n)/i),Ln=n=>n.type==="exponentialRampToValue",no=n=>n.type==="linearRampToValue",Ds=n=>Ln(n)||no(n),kc=n=>n.type==="setValue",us=n=>n.type==="setValueCurve",io=(n,e,t,s)=>{const i=n[e];return i===void 0?s:Ds(i)||kc(i)?i.value:us(i)?i.values[i.values.length-1]:Rh(t,io(n,e-1,i.startTime,s),i)},Bl=(n,e,t,s,i)=>t===void 0?[s.insertTime,i]:Ds(t)?[t.endTime,t.value]:kc(t)?[t.startTime,t.value]:us(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,io(n,e-1,t.startTime,i)],za=n=>n.type==="cancelAndHold",Ba=n=>n.type==="cancelScheduledValues",As=n=>za(n)||Ba(n)?n.cancelTime:Ln(n)||no(n)?n.endTime:n.startTime,Vl=(n,e,t,{endTime:s,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(s-e)):0,Hl=(n,e,t,{endTime:s,value:i})=>t+(n-e)/(s-e)*(i-t),I_=(n,e)=>{const t=Math.floor(e),s=Math.ceil(e);return t===s?n[t]:(1-(e-t))*n[t]+(1-(s-e))*n[s]},F_=(n,{duration:e,startTime:t,values:s})=>{const i=(n-t)/e*(s.length-1);return I_(s,i)},Ur=n=>n.type==="setTarget";class U_{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=As(e);if(za(e)||Ba(e)){const s=this._automationEvents.findIndex(r=>Ba(e)&&us(r)?r.startTime+r.duration>=t:As(r)>=t),i=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),za(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Ds(i)){if(r!==void 0&&Ur(r))throw new Error("The internal list is malformed.");const o=r===void 0?i.insertTime:us(r)?r.startTime+r.duration:As(r),a=r===void 0?this._defaultValue:us(r)?r.values[r.values.length-1]:r.value,c=Ln(i)?Vl(t,o,a,i):Hl(t,o,a,i),l=Ln(i)?Ll(c,t,this._currenTime):zl(c,t,this._currenTime);this._automationEvents.push(l)}if(r!==void 0&&Ur(r)&&this._automationEvents.push(La(this.getValue(t),t)),r!==void 0&&us(r)&&r.startTime+r.duration>t){const o=t-r.startTime,a=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=r.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=r.values[h-1]*(1-d)+r.values[h]*d}this._automationEvents[this._automationEvents.length-1]=Dh(u,r.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>As(o)>t),i=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(i!==void 0&&us(i)&&As(i)+i.duration>t)return!1;const r=Ln(e)?Ll(e.value,e.endTime,this._currenTime):no(e)?zl(e.value,t,this._currenTime):e;if(s===-1)this._automationEvents.push(r);else{if(us(e)&&t+e.duration>As(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,r)}}return!0}flush(e){const t=this._automationEvents.findIndex(s=>As(s)>e);if(t>1){const s=this._automationEvents.slice(t-1),i=s[0];Ur(i)&&s.unshift(La(io(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=s}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>As(o)>e),s=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,r=this._automationEvents[i];if(r!==void 0&&Ur(r)&&(s===void 0||!Ds(s)||s.insertTime>e))return Rh(e,io(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&kc(r)&&(s===void 0||!Ds(s)))return r.value;if(r!==void 0&&us(r)&&(s===void 0||!Ds(s)||r.startTime+r.duration>e))return e<r.startTime+r.duration?F_(e,r):r.values[r.values.length-1];if(r!==void 0&&Ds(r)&&(s===void 0||!Ds(s)))return r.value;if(s!==void 0&&Ln(s)){const[o,a]=Bl(this._automationEvents,i,r,s,this._defaultValue);return Vl(e,o,a,s)}if(s!==void 0&&no(s)){const[o,a]=Bl(this._automationEvents,i,r,s,this._defaultValue);return Hl(e,o,a,s)}return this._defaultValue}}const L_=n=>({cancelTime:n,type:"cancelAndHold"}),z_=n=>({cancelTime:n,type:"cancelScheduledValues"}),B_=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),V_=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),H_=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),j_=()=>new DOMException("","AbortError"),q_=n=>(e,t,[s,i,r],o)=>{n(e[i],[t,s,r],a=>a[0]===t&&a[1]===s,o)},W_=n=>(e,t,s)=>{const i=[];for(let r=0;r<s.numberOfInputs;r+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},G_=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Jn=new WeakSet,Ph=new WeakMap,wc=new WeakMap,Nh=new WeakMap,Sc=new WeakMap,No=new WeakMap,Ih=new WeakMap,Va=new WeakMap,Ha=new WeakMap,ja=new WeakMap,Fh={construct(){return Fh}},Y_=n=>{try{const e=new Proxy(n,Fh);new e}catch{return!1}return!0},jl=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,ql=(n,e)=>{const t=[];let s=n.replace(/^[\s]+/,""),i=s.match(jl);for(;i!==null;){const r=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());t.push(o),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(jl)}return[t.join(";"),s]},Wl=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Gl=n=>{if(!Y_(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Z_=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{let f=0;return(m,p,g={credentials:"omit"})=>{const y=u.get(m);if(y!==void 0&&y.has(p))return Promise.resolve();const w=l.get(m);if(w!==void 0){const _=w.get(p);if(_!==void 0)return _}const S=r(m),v=S.audioWorklet===void 0?i(p).then(([_,x])=>{const[T,k]=ql(_,x),b=`${T};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${k}
})})(window,'_AWGS')`;return t(b)}).then(()=>{const _=d._AWGS.pop();if(_===void 0)throw new SyntaxError;s(S.currentTime,S.sampleRate,()=>_(class{},void 0,(x,T)=>{if(x.trim()==="")throw e();const k=Ha.get(S);if(k!==void 0){if(k.has(x))throw e();Gl(T),Wl(T.parameterDescriptors),k.set(x,T)}else Gl(T),Wl(T.parameterDescriptors),Ha.set(S,new Map([[x,T]]))},S.sampleRate,void 0,void 0))}):Promise.all([i(p),Promise.resolve(n(h,h))]).then(([[_,x],T])=>{const k=f+1;f=k;const[b,C]=ql(_,x),P=`${b};((AudioWorkletProcessor,registerProcessor)=>{${C}
})(${T?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${T?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${T?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${k}',class extends AudioWorkletProcessor{process(){return !1}})`,F=new Blob([P],{type:"application/javascript; charset=utf-8"}),I=URL.createObjectURL(F);return S.audioWorklet.addModule(I,g).then(()=>{if(a(S))return S;const U=o(S);return U.audioWorklet.addModule(I,g).then(()=>U)}).then(U=>{if(c===null)throw new SyntaxError;try{new c(U,`__sac${k}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(I))});return w===void 0?l.set(m,new Map([[p,v]])):w.set(p,v),v.then(()=>{const _=u.get(m);_===void 0?u.set(m,new Set([p])):_.add(p)}).finally(()=>{const _=l.get(m);_!==void 0&&_.delete(p)}),v}},Bt=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},Io=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[s]=t;return n.delete(s),s},Uh=(n,e,t,s)=>{const i=Bt(n,e),r=Io(i,o=>o[0]===t&&o[1]===s);return i.size===0&&n.delete(e),r},_r=n=>Bt(Ih,n),ei=n=>{if(Jn.has(n))throw new Error("The AudioNode is already stored.");Jn.add(n),_r(n).forEach(e=>e(!0))},Lh=n=>"port"in n,gr=n=>{if(!Jn.has(n))throw new Error("The AudioNode is not stored.");Jn.delete(n),_r(n).forEach(e=>e(!1))},qa=(n,e)=>{!Lh(n)&&e.every(t=>t.size===0)&&gr(n)},X_=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{const f=new WeakMap;return(m,p,g,y,w)=>{const{activeInputs:S,passiveInputs:v}=r(p),{outputs:_}=r(m),x=a(m),T=k=>{const b=c(p),C=c(m);if(k){const O=Uh(v,m,g,y);n(S,m,O,!1),!w&&!h(m)&&t(C,b,g,y),d(p)&&ei(p)}else{const O=s(S,m,g,y);e(v,y,O,!1),!w&&!h(m)&&i(C,b,g,y);const A=o(p);if(A===0)u(p)&&qa(p,S);else{const R=f.get(p);R!==void 0&&clearTimeout(R),f.set(p,setTimeout(()=>{u(p)&&qa(p,S)},A*1e3))}}};return l(_,[p,g,y],k=>k[0]===p&&k[1]===g&&k[2]===y,!0)?(x.add(T),u(m)?n(S,m,[g,y,T],!0):e(v,y,[m,g,T],!0),!0):!1}},$_=n=>(e,t,[s,i,r],o)=>{const a=e.get(s);a===void 0?e.set(s,new Set([[i,t,r]])):n(a,[i,t,r],c=>c[0]===i&&c[1]===t,o)},Q_=n=>(e,t)=>{const s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(s).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(s),s.disconnect()};t.addEventListener("ended",i)},K_=n=>(e,t)=>{n(e).add(t)},J_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},eg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...J_,...c},h=s(l,u),d=r(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},Qe=(n,e)=>n.context===e,tg=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Qe(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},ro=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},ts=()=>new DOMException("","IndexSizeError"),bc=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(s){throw s.code===12?ts():s}})(n.getChannelData)},sg={numberOfChannels:1},ng=(n,e,t,s,i,r,o,a)=>{let c=null;return class zh{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...sg,...u};c===null&&(c=new i(1,1,44100));const m=s!==null&&e(r,r)?new s({length:h,numberOfChannels:d,sampleRate:f}):c.createBuffer(d,h,f);if(m.numberOfChannels===0)throw t();return typeof m.copyFromChannel!="function"?(o(m),bc(m)):e(ro,()=>ro(m))||a(m),n.add(m),m}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===zh.prototype||n.has(u)}}},rt=-34028234663852886e22,Ke=-rt,ms=n=>Jn.has(n),ig={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},rg=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...ig,...u},f=i(h,d),m=o(h),p=m?e():null;super(l,!1,f,p),this._audioBufferSourceNodeRenderer=p,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=t(this,m,f.playbackRate,Ke,rt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){ei(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),ms(this)&&gr(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},og=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Qe(h,u);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,f),o!==null&&h.start(...o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.playbackRate,h.playbackRate):await s(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},ag=n=>"playbackRate"in n,cg=n=>"frequency"in n&&"gain"in n,lg=n=>"offset"in n,ug=n=>!("frequency"in n)&&"gain"in n,hg=n=>"detune"in n&&"frequency"in n,dg=n=>"pan"in n,et=n=>Bt(Ph,n),vr=n=>Bt(Nh,n),Wa=(n,e)=>{const{activeInputs:t}=et(n);t.forEach(i=>i.forEach(([r])=>{e.includes(n)||Wa(r,[...e,n])}));const s=ag(n)?[n.playbackRate]:Lh(n)?Array.from(n.parameters.values()):cg(n)?[n.Q,n.detune,n.frequency,n.gain]:lg(n)?[n.offset]:ug(n)?[n.gain]:hg(n)?[n.detune,n.frequency]:dg(n)?[n.pan]:[];for(const i of s){const r=vr(i);r!==void 0&&r.activeInputs.forEach(([o])=>Wa(o,e))}ms(n)&&gr(n)},Bh=n=>{Wa(n.destination,[])},fg=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),pg=(n,e,t,s,i,r,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(m){throw m.code===12&&m.message==="sampleRate is not in range"?t():m}if(h===null)throw s();if(!fg(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const m=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",m)};h.addEventListener("statechange",m)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Bh(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},mg=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d=o(h),f=i(h,u,d),m=d?e(a):null;super(l,!1,f,m),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},_g=n=>{const e=new WeakMap,t=async(s,i)=>{const r=i.destination;return e.set(i,r),await n(s,i,r),r};return{render(s,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):t(s,i)}}},gg=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const _=new Float32Array(1),x=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),T=o(l);let k=!1,b=[0,0,-1,0,1,0],C=[0,0,0];const O=()=>{if(k)return;k=!0;const F=s(l,256,9,0);F.onaudioprocess=({inputBuffer:I})=>{const U=[r(I,_,0),r(I,_,1),r(I,_,2),r(I,_,3),r(I,_,4),r(I,_,5)];U.some((B,q)=>B!==b[q])&&(u.setOrientation(...U),b=U);const V=[r(I,_,6),r(I,_,7),r(I,_,8)];V.some((B,q)=>B!==C[q])&&(u.setPosition(...V),C=V)},x.connect(F)},A=F=>I=>{I!==b[F]&&(b[F]=I,u.setOrientation(...b))},R=F=>I=>{I!==C[F]&&(C[F]=I,u.setPosition(...C))},P=(F,I,U)=>{const V=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:I});V.connect(x,0,F),V.start(),Object.defineProperty(V.offset,"defaultValue",{get(){return I}});const B=n({context:c},T,V.offset,Ke,rt);return a(B,"value",q=>()=>q.call(B),q=>H=>{try{q.call(B,H)}catch(z){if(z.code!==9)throw z}O(),T&&U(H)}),B.cancelAndHoldAtTime=(q=>T?()=>{throw i()}:(...H)=>{const z=q.apply(B,H);return O(),z})(B.cancelAndHoldAtTime),B.cancelScheduledValues=(q=>T?()=>{throw i()}:(...H)=>{const z=q.apply(B,H);return O(),z})(B.cancelScheduledValues),B.exponentialRampToValueAtTime=(q=>T?()=>{throw i()}:(...H)=>{const z=q.apply(B,H);return O(),z})(B.exponentialRampToValueAtTime),B.linearRampToValueAtTime=(q=>T?()=>{throw i()}:(...H)=>{const z=q.apply(B,H);return O(),z})(B.linearRampToValueAtTime),B.setTargetAtTime=(q=>T?()=>{throw i()}:(...H)=>{const z=q.apply(B,H);return O(),z})(B.setTargetAtTime),B.setValueAtTime=(q=>T?()=>{throw i()}:(...H)=>{const z=q.apply(B,H);return O(),z})(B.setValueAtTime),B.setValueCurveAtTime=(q=>T?()=>{throw i()}:(...H)=>{const z=q.apply(B,H);return O(),z})(B.setValueCurveAtTime),B};return{forwardX:P(0,0,A(0)),forwardY:P(1,0,A(1)),forwardZ:P(2,-1,A(2)),positionX:P(6,0,R(0)),positionY:P(7,0,R(1)),positionZ:P(8,0,R(2)),upX:P(3,0,A(3)),upY:P(4,1,A(4)),upZ:P(5,0,A(5))}},{forwardX:d,forwardY:f,forwardZ:m,positionX:p,positionY:g,positionZ:y,upX:w,upY:S,upZ:v}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return m},get positionX(){return p},get positionY(){return g},get positionZ(){return y},get upX(){return w},get upY(){return S},get upZ(){return v}}},oo=n=>"context"in n,yr=n=>oo(n[0]),kn=(n,e,t,s)=>{for(const i of n)if(t(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},Yl=(n,e,[t,s],i)=>{kn(n,[e,t,s],r=>r[0]===e&&r[1]===t,i)},Zl=(n,[e,t,s],i)=>{const r=n.get(e);r===void 0?n.set(e,new Set([[t,s]])):kn(r,[t,s],o=>o[0]===t,i)},li=n=>"inputs"in n,ao=(n,e,t,s)=>{if(li(e)){const i=e.inputs[s];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,s),[e,t,s]},Vh=(n,e,t)=>{for(const s of n)if(s[0]===e&&s[1]===t)return n.delete(s),s;return null},vg=(n,e,t)=>Io(n,s=>s[0]===e&&s[1]===t),Hh=(n,e)=>{if(!_r(n).delete(e))throw new Error("Missing the expected event listener.")},jh=(n,e,t)=>{const s=Bt(n,e),i=Io(s,r=>r[0]===t);return s.size===0&&n.delete(e),i},co=(n,e,t,s)=>{li(e)?n.disconnect(e.inputs[s],t,0):n.disconnect(e,t,s)},ke=n=>Bt(wc,n),Yi=n=>Bt(Sc,n),_n=n=>Va.has(n),Gr=n=>!Jn.has(n),Xl=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const s=n.createScriptProcessor(256,1,1),i=n.createGain(),r=n.createBuffer(1,2,44100),o=r.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=r,a.loop=!0,a.connect(s).connect(n.destination),a.connect(i),a.disconnect(i),s.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),s.onaudioprocess=null,a.disconnect(s),s.disconnect(n.destination)},a.start()}}),ga=(n,e)=>{const t=new Map;for(const s of n)for(const i of s){const r=t.get(i);t.set(i,r===void 0?1:r+1)}t.forEach((s,i)=>e(i,s))},lo=n=>"context"in n,yg=n=>{const e=new Map;n.connect=(t=>(s,i=0,r=0)=>{const o=lo(s)?t(s,i,r):t(s,i),a=e.get(s);return a===void 0?e.set(s,[{input:r,output:i}]):a.every(c=>c.input!==r||c.output!==i)&&a.push({input:r,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(s,i,r)=>{if(t.apply(n),s===void 0)e.clear();else if(typeof s=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==s);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(s))if(i===void 0)e.delete(s);else{const o=e.get(s);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==r||r===void 0));a.length===0?e.delete(s):e.set(s,a)}}for(const[o,a]of e)a.forEach(c=>{lo(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},Tg=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=vr(e),{outputs:o}=et(n),a=_r(n),c=l=>{const u=ke(n),h=Yi(e);if(l){const d=jh(r,n,t);Yl(i,n,d,!1),!s&&!_n(n)&&u.connect(h,t)}else{const d=vg(i,n,t);Zl(r,d,!1),!s&&!_n(n)&&u.disconnect(h,t)}};return kn(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),ms(n)?Yl(i,n,[t,c],!0):Zl(r,[n,t,c],!0),!0):!1},xg=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=et(e),o=Vh(i[s],n,t);return o===null?[Uh(r,n,t,s)[2],!1]:[o[2],!0]},kg=(n,e,t)=>{const{activeInputs:s,passiveInputs:i}=vr(e),r=Vh(s,n,t);return r===null?[jh(i,n,t)[1],!1]:[r[2],!0]},Cc=(n,e,t,s,i)=>{const[r,o]=xg(n,t,s,i);if(r!==null&&(Hh(n,r),o&&!e&&!_n(n)&&co(ke(n),ke(t),s,i)),ms(t)){const{activeInputs:a}=et(t);qa(t,a)}},Ec=(n,e,t,s)=>{const[i,r]=kg(n,t,s);i!==null&&(Hh(n,i),r&&!e&&!_n(n)&&ke(n).disconnect(Yi(t),s))},wg=(n,e)=>{const t=et(n),s=[];for(const i of t.outputs)yr(i)?Cc(n,e,...i):Ec(n,e,...i),s.push(i[0]);return t.outputs.clear(),s},Sg=(n,e,t)=>{const s=et(n),i=[];for(const r of s.outputs)r[1]===t&&(yr(r)?Cc(n,e,...r):Ec(n,e,...r),i.push(r[0]),s.outputs.delete(r));return i},bg=(n,e,t,s,i)=>{const r=et(n);return Array.from(r.outputs).filter(o=>o[0]===t&&(s===void 0||o[1]===s)&&(i===void 0||o[2]===i)).map(o=>(yr(o)?Cc(n,e,...o):Ec(n,e,...o),r.outputs.delete(o),o[0]))},Cg=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p)=>class extends l{constructor(y,w,S,v){super(S),this._context=y,this._nativeAudioNode=S;const _=u(y);h(_)&&t(Xl,()=>Xl(_,p))!==!0&&yg(S),wc.set(this,S),Ih.set(this,new Set),y.state!=="closed"&&w&&ei(this),n(this,v,S)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,w=0,S=0){if(w<0||w>=this._nativeAudioNode.numberOfOutputs)throw i();const v=u(this._context),_=m(v);if(d(y)||f(y))throw r();if(oo(y)){const k=ke(y);try{const C=ao(this._nativeAudioNode,k,w,S),O=Gr(this);(_||O)&&this._nativeAudioNode.disconnect(...C),this.context.state!=="closed"&&!O&&Gr(y)&&ei(y)}catch(C){throw C.code===12?r():C}if(e(this,y,w,S,_)){const C=c([this],y);ga(C,s(_))}return y}const x=Yi(y);if(x.name==="playbackRate"&&x.maxValue===1024)throw o();try{this._nativeAudioNode.connect(x,w),(_||Gr(this))&&this._nativeAudioNode.disconnect(x,w)}catch(k){throw k.code===12?r():k}if(Tg(this,y,w,_)){const k=c([this],y);ga(k,s(_))}}disconnect(y,w,S){let v;const _=u(this._context),x=m(_);if(y===void 0)v=wg(this,x);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw i();v=Sg(this,x,y)}else{if(w!==void 0&&(w<0||w>=this.numberOfOutputs)||oo(y)&&S!==void 0&&(S<0||S>=y.numberOfInputs))throw i();if(v=bg(this,x,y,w,S),v.length===0)throw r()}for(const T of v){const k=c([this],T);ga(k,a)}}},Eg=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,m,p,g=null,y=null)=>{const w=p.value,S=new U_(w),v=m?s(S):null,_={get defaultValue(){return w},get maxValue(){return g===null?p.maxValue:g},get minValue(){return y===null?p.minValue:y},get value(){return p.value},set value(x){p.value=x,_.setValueAtTime(x,f.context.currentTime)},cancelAndHoldAtTime(x){if(typeof p.cancelAndHoldAtTime=="function")v===null&&S.flush(f.context.currentTime),S.add(i(x)),p.cancelAndHoldAtTime(x);else{const T=Array.from(S).pop();v===null&&S.flush(f.context.currentTime),S.add(i(x));const k=Array.from(S).pop();p.cancelScheduledValues(x),T!==k&&k!==void 0&&(k.type==="exponentialRampToValue"?p.exponentialRampToValueAtTime(k.value,k.endTime):k.type==="linearRampToValue"?p.linearRampToValueAtTime(k.value,k.endTime):k.type==="setValue"?p.setValueAtTime(k.value,k.startTime):k.type==="setValueCurve"&&p.setValueCurveAtTime(k.values,k.startTime,k.duration))}return _},cancelScheduledValues(x){return v===null&&S.flush(f.context.currentTime),S.add(r(x)),p.cancelScheduledValues(x),_},exponentialRampToValueAtTime(x,T){if(x===0)throw new RangeError;if(!Number.isFinite(T)||T<0)throw new RangeError;const k=f.context.currentTime;return v===null&&S.flush(k),Array.from(S).length===0&&(S.add(l(w,k)),p.setValueAtTime(w,k)),S.add(o(x,T)),p.exponentialRampToValueAtTime(x,T),_},linearRampToValueAtTime(x,T){const k=f.context.currentTime;return v===null&&S.flush(k),Array.from(S).length===0&&(S.add(l(w,k)),p.setValueAtTime(w,k)),S.add(a(x,T)),p.linearRampToValueAtTime(x,T),_},setTargetAtTime(x,T,k){return v===null&&S.flush(f.context.currentTime),S.add(c(x,T,k)),p.setTargetAtTime(x,T,k),_},setValueAtTime(x,T){return v===null&&S.flush(f.context.currentTime),S.add(l(x,T)),p.setValueAtTime(x,T),_},setValueCurveAtTime(x,T,k){const b=x instanceof Float32Array?x:new Float32Array(x);if(h!==null&&h.name==="webkitAudioContext"){const C=T+k,O=f.context.sampleRate,A=Math.ceil(T*O),R=Math.floor(C*O),P=R-A,F=new Float32Array(P);for(let U=0;U<P;U+=1){const V=(b.length-1)/k*((A+U)/O-T),B=Math.floor(V),q=Math.ceil(V);F[U]=B===q?b[B]:(1-(V-B))*b[B]+(1-(q-V))*b[q]}v===null&&S.flush(f.context.currentTime),S.add(u(F,T,k)),p.setValueCurveAtTime(F,T,k);const I=R/O;I<C&&d(_,F[F.length-1],I),d(_,b[b.length-1],C)}else v===null&&S.flush(f.context.currentTime),S.add(u(b,T,k)),p.setValueCurveAtTime(b,T,k);return _}};return t.set(_,p),e.set(_,f),n(_,v),_},Og=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:s,value:i}=t;e.exponentialRampToValueAtTime(i,s)}else if(t.type==="linearRampToValue"){const{endTime:s,value:i}=t;e.linearRampToValueAtTime(i,s)}else if(t.type==="setTarget"){const{startTime:s,target:i,timeConstant:r}=t;e.setTargetAtTime(i,s,r)}else if(t.type==="setValue"){const{startTime:s,value:i}=t;e.setValueAtTime(i,s)}else if(t.type==="setValueCurve"){const{duration:s,startTime:i,values:r}=t;e.setValueCurveAtTime(r,i,s)}else throw new Error("Can't apply an unknown automation.")}});class qh{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((s,i)=>e.call(t,s,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Ag={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},Mg=(n,e,t,s,i,r,o,a,c,l,u,h,d,f)=>class extends e{constructor(p,g,y){var w;const S=a(p),v=c(S),_=u({...Ag,...y});d(_);const x=Ha.get(S),T=x==null?void 0:x.get(g),k=v||S.state!=="closed"?S:(w=o(S))!==null&&w!==void 0?w:S,b=i(k,v?null:p.baseLatency,l,g,T,_),C=v?s(g,_,T):null;super(p,!0,b,C);const O=[];b.parameters.forEach((R,P)=>{const F=t(this,v,R);O.push([P,F])}),this._nativeAudioWorkletNode=b,this._onprocessorerror=null,this._parameters=new qh(O),v&&n(S,this);const{activeInputs:A}=r(this);h(b,A)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(p){const g=typeof p=="function"?f(this,p):null;this._nativeAudioWorkletNode.onprocessorerror=g;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===g?p:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function uo(n,e,t,s,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],s,i);else{const r=n.getChannelData(s);if(e[t].byteLength===0)e[t]=r.slice(i,i+128);else{const o=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const Wh=(n,e,t,s,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],s,i):e[t].byteLength!==0&&n.getChannelData(s).set(e[t],i)},ho=(n,e)=>{const t=[];for(let s=0;s<n;s+=1){const i=[],r=typeof e=="number"?e:e[s];for(let o=0;o<r;o+=1)i.push(new Float32Array(128));t.push(i)}return t},Dg=(n,e)=>{const t=Bt(ja,n),s=ke(e);return Bt(t,s)},Rg=async(n,e,t,s,i,r,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=s.channelCount*s.numberOfInputs,l=i.reduce((g,y)=>g+y,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=et(n),d=await Dg(t,n),f=ho(s.numberOfInputs,s.channelCount),m=ho(s.numberOfOutputs,i),p=Array.from(n.parameters.keys()).reduce((g,y)=>({...g,[y]:new Float32Array(128)}),{});for(let g=0;g<a;g+=128){if(s.numberOfInputs>0&&e!==null)for(let y=0;y<s.numberOfInputs;y+=1)for(let w=0;w<s.channelCount;w+=1)uo(e,f[y],w,w,g);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:y},w)=>{uo(e,p,y,c+w,g)});for(let y=0;y<s.numberOfInputs;y+=1)for(let w=0;w<i[y];w+=1)m[y][w].byteLength===0&&(m[y][w]=new Float32Array(128));try{const y=f.map((S,v)=>h.activeInputs[v].size===0?[]:S),w=o(g/t.sampleRate,t.sampleRate,()=>d.process(y,m,p));if(u!==null)for(let S=0,v=0;S<s.numberOfOutputs;S+=1){for(let _=0;_<i[S];_+=1)Wh(u,m[S],_,v+_,g);v+=i[S]}if(!w)break}catch(y){n.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},Pg=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p)=>(g,y,w)=>{const S=new WeakMap;let v=null;const _=async(x,T)=>{let k=u(x),b=null;const C=Qe(k,T),O=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){const A=O.reduce((I,U)=>I+U,0),R=i(T,{channelCount:Math.max(1,A),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,A)}),P=[];for(let I=0;I<x.numberOfOutputs;I+=1)P.push(s(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:O[I]}));const F=o(T,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});F.connect=e.bind(null,P),F.disconnect=c.bind(null,P),b=[R,P,F]}else C||(k=new h(T,g));if(S.set(T,b===null?k:b[2]),b!==null){if(v===null){if(w===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const U=x.channelCount*x.numberOfInputs,V=w.parameterDescriptors===void 0?0:w.parameterDescriptors.length,B=U+V;v=Rg(x,B===0?null:await(async()=>{const H=new d(B,Math.ceil(x.context.length/128)*128,T.sampleRate),z=[],xe=[];for(let me=0;me<y.numberOfInputs;me+=1)z.push(o(H,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),xe.push(i(H,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const ae=await Promise.all(Array.from(x.parameters.values()).map(async me=>{const We=r(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:me.value});return await f(H,me,We.offset),We})),X=s(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,U+V)});for(let me=0;me<y.numberOfInputs;me+=1){z[me].connect(xe[me]);for(let We=0;We<y.channelCount;We+=1)xe[me].connect(X,We,me*y.channelCount+We)}for(const[me,We]of ae.entries())We.connect(X,0,U+me),We.start(0);return X.connect(H.destination),await Promise.all(z.map(me=>m(x,H,me))),p(H)})(),T,y,O,w,l)}const A=await v,R=t(T,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[P,F,I]=b;A!==null&&(R.buffer=A,R.start(0)),R.connect(P);for(let U=0,V=0;U<x.numberOfOutputs;U+=1){const B=F[U];for(let q=0;q<O[U];q+=1)P.connect(B,V+q,q);V+=O[U]}return I}if(C)for(const[A,R]of x.parameters.entries())await n(T,R,k.parameters.get(A));else for(const[A,R]of x.parameters.entries())await f(T,R,k.parameters.get(A));return await m(x,T,k),k};return{render(x,T){a(T,x);const k=S.get(T);return k!==void 0?Promise.resolve(k):_(x,T)}}},Ng=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p,g,y,w,S)=>class extends m{constructor(_,x){super(_,x),this._nativeContext=_,this._audioWorklet=n===void 0?void 0:{addModule:(T,k)=>n(this,T,k)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(_,x,T){return new t({length:x,numberOfChannels:_,sampleRate:T})}createBufferSource(){return new s(this)}createChannelMerger(_=6){return new r(this,{numberOfInputs:_})}createChannelSplitter(_=6){return new o(this,{numberOfOutputs:_})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(_=1){return new u(this,{maxDelayTime:_})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(_,x){return new f(this,{feedback:x,feedforward:_})}createOscillator(){return new p(this)}createPanner(){return new g(this)}createPeriodicWave(_,x,T={disableNormalization:!1}){return new y(this,{...T,imag:x,real:_})}createStereoPanner(){return new w(this)}createWaveShaper(){return new S(this)}decodeAudioData(_,x,T){return l(this._nativeContext,_).then(k=>(typeof x=="function"&&x(k),k),k=>{throw typeof T=="function"&&T(k),k})}},Ig={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Fg=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...Ig,...u},f=i(h,d),m=o(h),p=m?t():null;super(l,!1,f,p),this._Q=e(this,m,f.Q,Ke,rt),this._detune=e(this,m,f.detune,1200*Math.log2(Ke),-1200*Math.log2(Ke)),this._frequency=e(this,m,f.frequency,l.sampleRate/2,0),this._gain=e(this,m,f.gain,40*Math.log10(Ke),rt),this._nativeBiquadFilterNode=f,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?s():d}if(l.length!==u.length||u.length!==h.length)throw s()}},Ug=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Qe(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return r.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Lg=(n,e)=>(t,s)=>{const i=e.get(t);if(i!==void 0)return i;const r=n.get(t);if(r!==void 0)return r;try{const o=s();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},zg={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Bg=(n,e,t,s,i)=>class extends n{constructor(o,a){const c=s(o),l={...zg,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},Vg=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Qe(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},Hg={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},jg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=r({...Hg,...c}),h=t(l,u),d=i(l)?e():null;super(a,!1,h,d)}},qg=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Qe(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},Wg=n=>(e,t,s)=>n(t,e,s),Gg=n=>(e,t,s=0,i=0)=>{const r=e[s];if(r===void 0)throw n();return lo(t)?r.connect(t,0,i):r.connect(t,0)},Yg=n=>(e,t)=>{const s=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(t),s.start(),()=>{s.stop(),s.disconnect(t)}},Zg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Xg=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...Zg,...l},d=s(u,h),f=r(u),m=f?t():null;super(c,!1,d,m),this._constantSourceNodeRenderer=m,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,Ke,rt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){ei(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),ms(this)&&gr(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},$g=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Qe(h,u);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,f),o!==null&&h.start(o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.offset,h.offset):await s(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Qg=n=>e=>(n[0]=e,n[0]),Kg={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Jg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u={...Kg,...c},h=t(l,u),f=i(l)?e():null;super(a,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},ev=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Qe(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return s.set(o,a),li(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},tv=(n,e)=>(t,s,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,s,i)}catch(r){throw r.name==="SyntaxError"?n():r}},sv=()=>new DOMException("","DataCloneError"),$l=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(s=>{const i=()=>{t.onmessage=null,e.close(),t.close(),s()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},nv=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=o(h)?h:r(h);if(i.has(d)){const m=t();return Promise.reject(m)}try{i.add(d)}catch{}return e(c,()=>c(f))?f.decodeAudioData(d).then(m=>($l(d).catch(()=>{}),e(a,()=>a(m))||u(m),n.add(m),m)):new Promise((m,p)=>{const g=async()=>{try{await $l(d)}catch{}},y=w=>{p(w),g()};try{f.decodeAudioData(d,w=>{typeof w.copyFromChannel!="function"&&(l(w),bc(w)),n.add(w),g().then(()=>m(w))},w=>{y(w===null?s():w)})}catch(w){y(w)}})},iv=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const f=s(c),{outputs:m}=t(c);for(const p of m)if(yr(p)){const g=s(p[0]);n(f,g,p[1],p[2])}else{const g=i(p[0]);f.connect(g,p[1])}}}else e.set(c,u-l)},rv={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},ov=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...rv,...l},d=s(u,h),f=r(u),m=f?t(h.maxDelayTime):null;super(c,!1,d,m),this._delayTime=e(this,f,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},av=(n,e,t,s,i)=>r=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=Qe(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,d)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await s(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},cv=n=>(e,t,s,i)=>n(e[i],r=>r[0]===t&&r[1]===s),lv=n=>(e,t)=>{n(e).delete(t)},uv=n=>"delayTime"in n,hv=(n,e,t)=>function s(i,r){const o=oo(r)?r:t(n,r);if(uv(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>s([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},Lr=(n,e,t)=>{const s=e[t];if(s===void 0)throw n();return s},dv=n=>(e,t=void 0,s=void 0,i=0)=>t===void 0?e.forEach(r=>r.disconnect()):typeof t=="number"?Lr(n,e,t).disconnect():lo(t)?s===void 0?e.forEach(r=>r.disconnect(t)):i===void 0?Lr(n,e,s).disconnect(t,0):Lr(n,e,s).disconnect(t,0,i):s===void 0?e.forEach(r=>r.disconnect(t)):Lr(n,e,s).disconnect(t,0),fv={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},pv=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...fv,...u},f=s(h,d),m=o(h),p=m?t():null;super(l,!1,f,p),this._attack=e(this,m,f.attack),this._knee=e(this,m,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,m,f.ratio),this._release=e(this,m,f.release),this._threshold=e(this,m,f.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},mv=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Qe(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return r.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},_v=()=>new DOMException("","EncodingError"),gv=n=>e=>new Promise((t,s)=>{if(n===null){s(new SyntaxError);return}const i=n.document.head;if(i===null)s(new SyntaxError);else{const r=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,d,f,m)=>{if(h===a||h===n.location.href&&d===1&&f===1)return l(),s(m),!1;if(c!==null)return c(u,h,d,f,m)},r.onerror=()=>{l(),s(new SyntaxError)},r.onload=()=>{l(),t()},r.src=a,r.type="module",i.appendChild(r)}}),vv=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,s,i){if(s!==null){let r=this._listeners.get(s);r===void 0&&(r=n(this,s),typeof s=="function"&&this._listeners.set(s,r)),this._nativeEventTarget.addEventListener(t,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,s,i){const r=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(t,r===void 0?null:r,i)}},yv=n=>(e,t,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},Tv=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},xv={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},kv=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...xv,...c},h=s(l,u),d=r(l),f=d?t():null;super(a,!1,h,f),this._gain=e(this,d,h.gain,Ke,rt)}get gain(){return this._gain}},wv=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Qe(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.gain,l.gain):await s(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Sv=(n,e)=>t=>e(n,t),bv=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},Cv=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},Ev=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},Ov=n=>e=>n.get(e),je=()=>new DOMException("","InvalidStateError"),Av=n=>e=>{const t=n.get(e);if(t===void 0)throw je();return t},Mv=(n,e)=>t=>{let s=n.get(t);if(s!==void 0)return s;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),n.set(t,s),s},Dv=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},Fo=()=>new DOMException("","InvalidAccessError"),Rv=n=>{n.getFrequencyResponse=(e=>(t,s,i)=>{if(t.length!==s.length||s.length!==i.length)throw Fo();return e.call(n,t,s,i)})(n.getFrequencyResponse)},Pv={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Nv=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=i(l),h={...Pv,...c},d=e(l,u?null:a.baseLatency,h),f=u?t(h.feedback,h.feedforward):null;super(a,!1,d,f),Rv(d),this._nativeIIRFilterNode=d,r(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},Gh=(n,e,t,s,i,r,o,a,c,l,u)=>{const h=l.length;let d=a;for(let f=0;f<h;f+=1){let m=t[0]*l[f];for(let p=1;p<i;p+=1){const g=d-p&c-1;m+=t[p]*r[g],m-=n[p]*o[g]}for(let p=i;p<s;p+=1)m+=t[p]*r[d-p&c-1];for(let p=i;p<e;p+=1)m-=n[p]*o[d-p&c-1];r[d]=l[f],o[d]=m,d=d+1&c-1,u[f]=m}return d},Iv=(n,e,t,s)=>{const i=t instanceof Float64Array?t:new Float64Array(t),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(i[0]!==1){for(let m=0;m<o;m+=1)r[m]/=i[0];for(let m=1;m<a;m+=1)i[m]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),f=n.numberOfChannels;for(let m=0;m<f;m+=1){const p=n.getChannelData(m),g=d.getChannelData(m);u.fill(0),h.fill(0),Gh(i,o,r,a,c,u,h,0,l,p,g)}return d},Fv=(n,e,t,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,f=e(u);const m=Qe(f,h);if(h.createIIRFilter===void 0?d=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(f=h.createIIRFilter(o,r)),a.set(h,d===null?f:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await s(u,g,g.destination);const y=await i(g);return Iv(y,h,r,o)})()}const p=await c;return d.buffer=p,d.start(0),d}return await s(u,h,f),f};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Uv=(n,e,t,s,i,r)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&r(a)){const u=s(a),{outputs:h}=t(a);for(const d of h)if(yr(d)){const f=s(d[0]);e(u,f,d[1],d[2])}else{const f=i(d[0]);u.disconnect(f,d[1])}}n.set(a,c)}else n.set(a,l+c)},Lv=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},zv=(n,e)=>t=>n.has(t)||e(t),Bv=(n,e)=>t=>n.has(t)||e(t),Vv=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},Hv=n=>e=>n!==null&&e instanceof n,jv=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,qv=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,Wv=(n,e)=>t=>n(t)||e(t),Gv=n=>e=>n!==null&&e instanceof n,Yv=n=>n!==null&&n.isSecureContext,Zv=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Xv={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},$v=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r);if(s(a))throw new TypeError;const c={...Xv,...o},l=e(a,c);super(r,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Qv=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},Kv=(n,e,t)=>class extends n{constructor(i,r){const o=t(i),a=e(o,r);super(i,!0,a,null)}},Jv=(n,e,t,s,i,r)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,No.set(this,a),s(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?r(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Zi=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},ey=(n,e)=>(t,s,i)=>{const r=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=r.size===0;if(e(a))return o.call(t,a,c,l),n(r,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&s(),a;o.call(t,a,c),n(r,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&s()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=r.size>0;if(a===void 0)o.apply(t),r.clear();else if(typeof a=="number"){o.call(t,a);for(const d of r)d[1]===a&&r.delete(d)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const d of r)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&r.delete(d)}const h=r.size===0;u&&h&&i()})(t.disconnect),t},we=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t]&&(n[t]=s)},Be=(n,e)=>{we(n,e,"channelCount"),we(n,e,"channelCountMode"),we(n,e,"channelInterpretation")},Ql=n=>typeof n.getFloatTimeDomainData=="function",ty=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const s=Math.max(t.length,n.fftSize);for(let i=0;i<s;i+=1)e[i]=(t[i]-128)*.0078125;return e}},sy=(n,e)=>(t,s)=>{const i=t.createAnalyser();if(Be(i,s),!(s.maxDecibels>s.minDecibels))throw e();return we(i,s,"fftSize"),we(i,s,"maxDecibels"),we(i,s,"minDecibels"),we(i,s,"smoothingTimeConstant"),n(Ql,()=>Ql(i))||ty(i),i},ny=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,Me=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t].value&&(n[t].value=s)},iy=n=>{n.start=(e=>{let t=!1;return(s=0,i=0,r)=>{if(t)throw je();e.call(n,s,i,r),t=!0}})(n.start)},Oc=n=>{n.start=(e=>(t=0,s=0,i)=>{if(typeof i=="number"&&i<0||s<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,s,i)})(n.start)},Ac=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},ry=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=h.createBufferSource();return Be(f,d),Me(f,d,"playbackRate"),we(f,d,"buffer"),we(f,d,"loop"),we(f,d,"loopEnd"),we(f,d,"loopStart"),e(t,()=>t(h))||iy(f),e(s,()=>s(h))||c(f),e(i,()=>i(h))||l(f,h),e(r,()=>r(h))||Oc(f),e(o,()=>o(h))||u(f,h),e(a,()=>a(h))||Ac(f),n(h,f),f},oy=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,ay=(n,e)=>(t,s,i)=>{const r=t.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=n(t,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{r.channelCount=c}catch(l){if(c>r.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o},cy=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,ly=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},uy=(n,e,t,s,i)=>(r,o,a,c,l,u)=>{if(a!==null)try{const h=new a(r,c,u),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>f,set:m=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof m=="function"?m:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const g=typeof p[1]=="function"?p[1]:typeof p[1]=="object"&&p[1]!==null&&typeof p[1].handleEvent=="function"?p[1].handleEvent:null;if(g!==null){const y=d.get(p[1]);y!==void 0?p[1]=y:(p[1]=w=>{w.type==="error"?(Object.defineProperties(w,{type:{value:"processorerror"}}),g(w)):g(new ErrorEvent(p[0],{...w}))},d.set(g,p[1]))}}return m.call(h,"error",p[1],p[2]),m.call(h,...p)})(h.addEventListener),h.removeEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const g=d.get(p[1]);g!==void 0&&(d.delete(p[1]),p[1]=g)}return m.call(h,"error",p[1],p[2]),m.call(h,p[0],p[1],p[2])})(h.removeEventListener),u.numberOfOutputs!==0){const m=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(m).connect(r.destination),i(h,()=>m.disconnect(),()=>m.connect(r.destination))}return h}catch(h){throw h.code===11?s():h}if(l===void 0)throw s();return ly(u),e(r,o,l,u)},Yh=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),hy=n=>new Promise((e,t)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:r})=>{s.close(),i.close(),e(r)},s.onmessageerror=({data:r})=>{s.close(),i.close(),t(r)},i.postMessage(n)}),dy=async(n,e)=>{const t=await hy(e);return new n(t)},fy=(n,e,t,s)=>{let i=ja.get(n);i===void 0&&(i=new WeakMap,ja.set(n,i));const r=dy(t,s);return i.set(e,r),r},py=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,m,p,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();const y=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(y.some(L=>L<1))throw c();if(y.length!==g.numberOfOutputs)throw e();if(g.channelCountMode!=="explicit")throw c();const w=g.channelCount*g.numberOfInputs,S=y.reduce((L,Y)=>L+Y,0),v=p.parameterDescriptors===void 0?0:p.parameterDescriptors.length;if(w+v>6||S>6)throw c();const _=new MessageChannel,x=[],T=[];for(let L=0;L<g.numberOfInputs;L+=1)x.push(o(f,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(i(f,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const k=[];if(p.parameterDescriptors!==void 0)for(const{defaultValue:L,maxValue:Y,minValue:ze,name:Se}of p.parameterDescriptors){const re=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[Se]!==void 0?g.parameterData[Se]:L===void 0?0:L});Object.defineProperties(re.offset,{defaultValue:{get:()=>L===void 0?0:L},maxValue:{get:()=>Y===void 0?Ke:Y},minValue:{get:()=>ze===void 0?rt:ze}}),k.push(re)}const b=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,w+v)}),C=Yh(m,f.sampleRate),O=a(f,C,w+v,Math.max(1,S)),A=i(f,{channelCount:Math.max(1,S),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,S)}),R=[];for(let L=0;L<g.numberOfOutputs;L+=1)R.push(s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[L]}));for(let L=0;L<g.numberOfInputs;L+=1){x[L].connect(T[L]);for(let Y=0;Y<g.channelCount;Y+=1)T[L].connect(b,Y,L*g.channelCount+Y)}const P=new qh(p.parameterDescriptors===void 0?[]:p.parameterDescriptors.map(({name:L},Y)=>{const ze=k[Y];return ze.connect(b,0,w+Y),ze.start(0),[L,ze.offset]}));b.connect(O);let F=g.channelInterpretation,I=null;const U=g.numberOfOutputs===0?[O]:R,V={get bufferSize(){return C},get channelCount(){return g.channelCount},set channelCount(L){throw t()},get channelCountMode(){return g.channelCountMode},set channelCountMode(L){throw t()},get channelInterpretation(){return F},set channelInterpretation(L){for(const Y of x)Y.channelInterpretation=L;F=L},get context(){return O.context},get inputs(){return x},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return I},set onprocessorerror(L){typeof I=="function"&&V.removeEventListener("processorerror",I),I=typeof L=="function"?L:null,typeof I=="function"&&V.addEventListener("processorerror",I)},get parameters(){return P},get port(){return _.port2},addEventListener(...L){return O.addEventListener(L[0],L[1],L[2])},connect:n.bind(null,U),disconnect:l.bind(null,U),dispatchEvent(...L){return O.dispatchEvent(L[0])},removeEventListener(...L){return O.removeEventListener(L[0],L[1],L[2])}},B=new Map;_.port1.addEventListener=(L=>(...Y)=>{if(Y[0]==="message"){const ze=typeof Y[1]=="function"?Y[1]:typeof Y[1]=="object"&&Y[1]!==null&&typeof Y[1].handleEvent=="function"?Y[1].handleEvent:null;if(ze!==null){const Se=B.get(Y[1]);Se!==void 0?Y[1]=Se:(Y[1]=re=>{u(f.currentTime,f.sampleRate,()=>ze(re))},B.set(ze,Y[1]))}}return L.call(_.port1,Y[0],Y[1],Y[2])})(_.port1.addEventListener),_.port1.removeEventListener=(L=>(...Y)=>{if(Y[0]==="message"){const ze=B.get(Y[1]);ze!==void 0&&(B.delete(Y[1]),Y[1]=ze)}return L.call(_.port1,Y[0],Y[1],Y[2])})(_.port1.removeEventListener);let q=null;Object.defineProperty(_.port1,"onmessage",{get:()=>q,set:L=>{typeof q=="function"&&_.port1.removeEventListener("message",q),q=typeof L=="function"?L:null,typeof q=="function"&&(_.port1.addEventListener("message",q),_.port1.start())}}),p.prototype.port=_.port1;let H=null;fy(f,V,p,g).then(L=>H=L);const xe=ho(g.numberOfInputs,g.channelCount),ae=ho(g.numberOfOutputs,y),X=p.parameterDescriptors===void 0?[]:p.parameterDescriptors.reduce((L,{name:Y})=>({...L,[Y]:new Float32Array(128)}),{});let me=!0;const We=()=>{g.numberOfOutputs>0&&O.disconnect(A);for(let L=0,Y=0;L<g.numberOfOutputs;L+=1){const ze=R[L];for(let Se=0;Se<y[L];Se+=1)A.disconnect(ze,Y+Se,Se);Y+=y[L]}},j=new Map;O.onaudioprocess=({inputBuffer:L,outputBuffer:Y})=>{if(H!==null){const ze=h(V);for(let Se=0;Se<C;Se+=128){for(let re=0;re<g.numberOfInputs;re+=1)for(let Oe=0;Oe<g.channelCount;Oe+=1)uo(L,xe[re],Oe,Oe,Se);p.parameterDescriptors!==void 0&&p.parameterDescriptors.forEach(({name:re},Oe)=>{uo(L,X,re,w+Oe,Se)});for(let re=0;re<g.numberOfInputs;re+=1)for(let Oe=0;Oe<y[re];Oe+=1)ae[re][Oe].byteLength===0&&(ae[re][Oe]=new Float32Array(128));try{const re=xe.map((wt,Cs)=>{if(ze[Cs].size>0)return j.set(Cs,C/128),wt;const Zo=j.get(Cs);return Zo===void 0?[]:(wt.every(Gd=>Gd.every(Yd=>Yd===0))&&(Zo===1?j.delete(Cs):j.set(Cs,Zo-1)),wt)});me=u(f.currentTime+Se/f.sampleRate,f.sampleRate,()=>H.process(re,ae,X));for(let wt=0,Cs=0;wt<g.numberOfOutputs;wt+=1){for(let pi=0;pi<y[wt];pi+=1)Wh(Y,ae[wt],pi,Cs+pi,Se);Cs+=y[wt]}}catch(re){me=!1,V.dispatchEvent(new ErrorEvent("processorerror",{colno:re.colno,filename:re.filename,lineno:re.lineno,message:re.message}))}if(!me){for(let re=0;re<g.numberOfInputs;re+=1){x[re].disconnect(T[re]);for(let Oe=0;Oe<g.channelCount;Oe+=1)T[Se].disconnect(b,Oe,re*g.channelCount+Oe)}if(p.parameterDescriptors!==void 0){const re=p.parameterDescriptors.length;for(let Oe=0;Oe<re;Oe+=1){const wt=k[Oe];wt.disconnect(b,0,w+Oe),wt.stop()}}b.disconnect(O),O.onaudioprocess=null,$s?We():Cn();break}}}};let $s=!1;const Qs=o(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),bn=()=>O.connect(Qs).connect(f.destination),Cn=()=>{O.disconnect(Qs),Qs.disconnect()},qd=()=>{if(me){Cn(),g.numberOfOutputs>0&&O.connect(A);for(let L=0,Y=0;L<g.numberOfOutputs;L+=1){const ze=R[L];for(let Se=0;Se<y[L];Se+=1)A.connect(ze,Y+Se,Se);Y+=y[L]}}$s=!0},Wd=()=>{me&&(bn(),We()),$s=!1};return bn(),d(V,qd,Wd)},Zh=(n,e)=>{const t=n.createBiquadFilter();return Be(t,e),Me(t,e,"Q"),Me(t,e,"detune"),Me(t,e,"frequency"),Me(t,e,"gain"),we(t,e,"type"),t},my=(n,e)=>(t,s)=>{const i=t.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),Be(i,s),i},_y=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw je()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw je()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw je()}})},Tr=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return Be(t,e),_y(t),t},gy=(n,e,t,s,i)=>(r,o)=>{if(r.createConstantSource===void 0)return t(r,o);const a=r.createConstantSource();return Be(a,o),Me(a,o,"offset"),e(s,()=>s(r))||Oc(a),e(i,()=>i(r))||Ac(a),n(r,a),a},ui=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),vy=(n,e,t,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(m){l.channelCount=m},get channelCountMode(){return l.channelCountMode},set channelCountMode(m){l.channelCountMode=m},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(m){l.channelInterpretation=m},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(m){c.onended=m},addEventListener(...m){return c.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return c.dispatchEvent(m[0])},removeEventListener(...m){return c.removeEventListener(m[0],m[1],m[2])},start(m=0){c.start.call(c,m)},stop(m=0){c.stop.call(c,m)}},d=()=>c.connect(l),f=()=>c.disconnect(l);return n(i,c),s(ui(h,l),d,f)},yy=(n,e)=>(t,s)=>{const i=t.createConvolver();if(Be(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),we(i,s,"buffer"),s.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>o=>{if(o>2)throw n();return r.call(i,o)}),s.channelCountMode==="max"))throw n();return e(i,"channelCountMode",r=>()=>r.call(i),r=>o=>{if(o==="max")throw n();return r.call(i,o)}),i},Xh=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return Be(t,e),Me(t,e,"delayTime"),t},Ty=n=>(e,t)=>{const s=e.createDynamicsCompressor();if(Be(s,t),t.channelCount>2||t.channelCountMode==="max")throw n();return Me(s,t,"attack"),Me(s,t,"knee"),Me(s,t,"ratio"),Me(s,t,"release"),Me(s,t,"threshold"),s},dt=(n,e)=>{const t=n.createGain();return Be(t,e),Me(t,e,"gain"),t},xy=n=>(e,t,s)=>{if(e.createIIRFilter===void 0)return n(e,t,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return Be(i,s),i};function ky(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function wy(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function Kl(n,e){let t=[0,0];for(let s=n.length-1;s>=0;s-=1)t=wy(t,e),t[0]+=n[s];return t}const Sy=(n,e,t,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Yh(r,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),m=d.length,p=f.length,g=Math.min(m,p);if(m===0||m>20)throw s();if(d[0]===0)throw e();if(p===0||p>20)throw s();if(f[0]===0)throw e();if(d[0]!==1){for(let k=0;k<p;k+=1)f[k]/=d[0];for(let k=1;k<m;k+=1)d[k]/=d[0]}const y=t(i,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=c;const w=32,S=[],v=[],_=[];for(let k=0;k<o;k+=1){S.push(0);const b=new Float32Array(w),C=new Float32Array(w);b.fill(0),C.fill(0),v.push(b),_.push(C)}y.onaudioprocess=k=>{const b=k.inputBuffer,C=k.outputBuffer,O=b.numberOfChannels;for(let A=0;A<O;A+=1){const R=b.getChannelData(A),P=C.getChannelData(A);S[A]=Gh(d,m,f,p,g,v[A],_[A],S[A],w,R,P)}};const x=i.sampleRate/2;return ui({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(k){y.channelCount=k},get channelCountMode(){return y.channelCountMode},set channelCountMode(k){y.channelCountMode=k},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(k){y.channelInterpretation=k},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...k){return y.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return y.dispatchEvent(k[0])},getFrequencyResponse(k,b,C){if(k.length!==b.length||b.length!==C.length)throw n();const O=k.length;for(let A=0;A<O;A+=1){const R=-Math.PI*(k[A]/x),P=[Math.cos(R),Math.sin(R)],F=Kl(f,P),I=Kl(d,P),U=ky(F,I);b[A]=Math.sqrt(U[0]*U[0]+U[1]*U[1]),C[A]=Math.atan2(U[1],U[0])}},removeEventListener(...k){return y.removeEventListener(k[0],k[1],k[2])}},y)},by=(n,e)=>n.createMediaElementSource(e.mediaElement),Cy=(n,e)=>{const t=n.createMediaStreamDestination();return Be(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},Ey=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((r,o)=>r.id<o.id?-1:r.id>o.id?1:0);const s=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i},Oy=(n,e)=>(t,{mediaStreamTrack:s})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=t.createMediaStreamSource(i);if(s.kind!=="audio")throw n();if(e(t))throw new TypeError;return r},Ay=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,My=(n,e,t,s,i,r)=>(o,a)=>{const c=o.createOscillator();return Be(c,a),Me(c,a,"detune"),Me(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):we(c,a,"type"),e(t,()=>t(o))||Oc(c),e(s,()=>s(o))||r(c,o),e(i,()=>i(o))||Ac(c),n(o,c),c},Dy=n=>(e,t)=>{const s=e.createPanner();return s.orientationX===void 0?n(e,t):(Be(s,t),Me(s,t,"orientationX"),Me(s,t,"orientationY"),Me(s,t,"orientationZ"),Me(s,t,"positionX"),Me(s,t,"positionY"),Me(s,t,"positionZ"),we(s,t,"coneInnerAngle"),we(s,t,"coneOuterAngle"),we(s,t,"coneOuterGain"),we(s,t,"distanceModel"),we(s,t,"maxDistance"),we(s,t,"panningModel"),we(s,t,"refDistance"),we(s,t,"rolloffFactor"),s)},Ry=(n,e,t,s,i,r,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:m,maxDistance:p,orientationX:g,orientationY:y,orientationZ:w,panningModel:S,positionX:v,positionY:_,positionZ:x,refDistance:T,rolloffFactor:k,...b})=>{const C=u.createPanner();if(b.channelCount>2||b.channelCountMode==="max")throw o();Be(C,b);const O={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=t(u,{...O,channelInterpretation:"speakers",numberOfInputs:6}),R=s(u,{...b,gain:1}),P=s(u,{...O,gain:1}),F=s(u,{...O,gain:0}),I=s(u,{...O,gain:0}),U=s(u,{...O,gain:0}),V=s(u,{...O,gain:0}),B=s(u,{...O,gain:0}),q=i(u,256,6,1),H=r(u,{...O,curve:new Float32Array([1,1]),oversample:"none"});let z=[g,y,w],xe=[v,_,x];const ae=new Float32Array(1);q.onaudioprocess=({inputBuffer:j})=>{const $s=[c(j,ae,0),c(j,ae,1),c(j,ae,2)];$s.some((bn,Cn)=>bn!==z[Cn])&&(C.setOrientation(...$s),z=$s);const Qs=[c(j,ae,3),c(j,ae,4),c(j,ae,5)];Qs.some((bn,Cn)=>bn!==xe[Cn])&&(C.setPosition(...Qs),xe=Qs)},Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(U.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(B.gain,"defaultValue",{get:()=>0});const X={get bufferSize(){},get channelCount(){return C.channelCount},set channelCount(j){if(j>2)throw o();R.channelCount=j,C.channelCount=j},get channelCountMode(){return C.channelCountMode},set channelCountMode(j){if(j==="max")throw o();R.channelCountMode=j,C.channelCountMode=j},get channelInterpretation(){return C.channelInterpretation},set channelInterpretation(j){R.channelInterpretation=j,C.channelInterpretation=j},get coneInnerAngle(){return C.coneInnerAngle},set coneInnerAngle(j){C.coneInnerAngle=j},get coneOuterAngle(){return C.coneOuterAngle},set coneOuterAngle(j){C.coneOuterAngle=j},get coneOuterGain(){return C.coneOuterGain},set coneOuterGain(j){if(j<0||j>1)throw e();C.coneOuterGain=j},get context(){return C.context},get distanceModel(){return C.distanceModel},set distanceModel(j){C.distanceModel=j},get inputs(){return[R]},get maxDistance(){return C.maxDistance},set maxDistance(j){if(j<0)throw new RangeError;C.maxDistance=j},get numberOfInputs(){return C.numberOfInputs},get numberOfOutputs(){return C.numberOfOutputs},get orientationX(){return P.gain},get orientationY(){return F.gain},get orientationZ(){return I.gain},get panningModel(){return C.panningModel},set panningModel(j){C.panningModel=j},get positionX(){return U.gain},get positionY(){return V.gain},get positionZ(){return B.gain},get refDistance(){return C.refDistance},set refDistance(j){if(j<0)throw new RangeError;C.refDistance=j},get rolloffFactor(){return C.rolloffFactor},set rolloffFactor(j){if(j<0)throw new RangeError;C.rolloffFactor=j},addEventListener(...j){return R.addEventListener(j[0],j[1],j[2])},dispatchEvent(...j){return R.dispatchEvent(j[0])},removeEventListener(...j){return R.removeEventListener(j[0],j[1],j[2])}};h!==X.coneInnerAngle&&(X.coneInnerAngle=h),d!==X.coneOuterAngle&&(X.coneOuterAngle=d),f!==X.coneOuterGain&&(X.coneOuterGain=f),m!==X.distanceModel&&(X.distanceModel=m),p!==X.maxDistance&&(X.maxDistance=p),g!==X.orientationX.value&&(X.orientationX.value=g),y!==X.orientationY.value&&(X.orientationY.value=y),w!==X.orientationZ.value&&(X.orientationZ.value=w),S!==X.panningModel&&(X.panningModel=S),v!==X.positionX.value&&(X.positionX.value=v),_!==X.positionY.value&&(X.positionY.value=_),x!==X.positionZ.value&&(X.positionZ.value=x),T!==X.refDistance&&(X.refDistance=T),k!==X.rolloffFactor&&(X.rolloffFactor=k),(z[0]!==1||z[1]!==0||z[2]!==0)&&C.setOrientation(...z),(xe[0]!==0||xe[1]!==0||xe[2]!==0)&&C.setPosition(...xe);const me=()=>{R.connect(C),n(R,H,0,0),H.connect(P).connect(A,0,0),H.connect(F).connect(A,0,1),H.connect(I).connect(A,0,2),H.connect(U).connect(A,0,3),H.connect(V).connect(A,0,4),H.connect(B).connect(A,0,5),A.connect(q).connect(u.destination)},We=()=>{R.disconnect(C),a(R,H,0,0),H.disconnect(P),P.disconnect(A),H.disconnect(F),F.disconnect(A),H.disconnect(I),I.disconnect(A),H.disconnect(U),U.disconnect(A),H.disconnect(V),V.disconnect(A),H.disconnect(B),B.disconnect(A),A.disconnect(q),q.disconnect(u.destination)};return l(ui(X,C),me,We)},Py=n=>(e,{disableNormalization:t,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:t});if(Array.from(s).length<2)throw n();return a},xr=(n,e,t,s)=>n.createScriptProcessor(e,t,s),Ny=(n,e)=>(t,s)=>{const i=s.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,s);const r=t.createStereoPanner();return Be(r,s),Me(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),r},Iy=(n,e,t,s,i,r)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(m,p,g,y)=>{const w=new Float32Array(16385),S=new Float32Array(16385);for(let b=0;b<16385;b+=1){const C=b/16384*c;w[b]=Math.cos(C),S[b]=Math.sin(C)}const v=t(m,{...l,gain:0}),_=s(m,{...u,curve:w}),x=s(m,{...u,curve:a}),T=t(m,{...l,gain:0}),k=s(m,{...u,curve:S});return{connectGraph(){p.connect(v),p.connect(x.inputs===void 0?x:x.inputs[0]),p.connect(T),x.connect(g),g.connect(_.inputs===void 0?_:_.inputs[0]),g.connect(k.inputs===void 0?k:k.inputs[0]),_.connect(v.gain),k.connect(T.gain),v.connect(y,0,0),T.connect(y,0,1)},disconnectGraph(){p.disconnect(v),p.disconnect(x.inputs===void 0?x:x.inputs[0]),p.disconnect(T),x.disconnect(g),g.disconnect(_.inputs===void 0?_:_.inputs[0]),g.disconnect(k.inputs===void 0?k:k.inputs[0]),_.disconnect(v.gain),k.disconnect(T.gain),v.disconnect(y,0,0),T.disconnect(y,0,1)}}},d=(m,p,g,y)=>{const w=new Float32Array(16385),S=new Float32Array(16385),v=new Float32Array(16385),_=new Float32Array(16385),x=Math.floor(16385/2);for(let U=0;U<16385;U+=1)if(U>x){const V=(U-x)/(16384-x)*c;w[U]=Math.cos(V),S[U]=Math.sin(V),v[U]=0,_[U]=1}else{const V=U/(16384-x)*c;w[U]=1,S[U]=0,v[U]=Math.cos(V),_[U]=Math.sin(V)}const T=e(m,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),k=t(m,{...l,gain:0}),b=s(m,{...u,curve:w}),C=t(m,{...l,gain:0}),O=s(m,{...u,curve:S}),A=s(m,{...u,curve:a}),R=t(m,{...l,gain:0}),P=s(m,{...u,curve:v}),F=t(m,{...l,gain:0}),I=s(m,{...u,curve:_});return{connectGraph(){p.connect(T),p.connect(A.inputs===void 0?A:A.inputs[0]),T.connect(k,0),T.connect(C,0),T.connect(R,1),T.connect(F,1),A.connect(g),g.connect(b.inputs===void 0?b:b.inputs[0]),g.connect(O.inputs===void 0?O:O.inputs[0]),g.connect(P.inputs===void 0?P:P.inputs[0]),g.connect(I.inputs===void 0?I:I.inputs[0]),b.connect(k.gain),O.connect(C.gain),P.connect(R.gain),I.connect(F.gain),k.connect(y,0,0),R.connect(y,0,0),C.connect(y,0,1),F.connect(y,0,1)},disconnectGraph(){p.disconnect(T),p.disconnect(A.inputs===void 0?A:A.inputs[0]),T.disconnect(k,0),T.disconnect(C,0),T.disconnect(R,1),T.disconnect(F,1),A.disconnect(g),g.disconnect(b.inputs===void 0?b:b.inputs[0]),g.disconnect(O.inputs===void 0?O:O.inputs[0]),g.disconnect(P.inputs===void 0?P:P.inputs[0]),g.disconnect(I.inputs===void 0?I:I.inputs[0]),b.disconnect(k.gain),O.disconnect(C.gain),P.disconnect(R.gain),I.disconnect(F.gain),k.disconnect(y,0,0),R.disconnect(y,0,0),C.disconnect(y,0,1),F.disconnect(y,0,1)}}},f=(m,p,g,y,w)=>{if(p===1)return h(m,g,y,w);if(p===2)return d(m,g,y,w);throw i()};return(m,{channelCount:p,channelCountMode:g,pan:y,...w})=>{if(g==="max")throw i();const S=n(m,{...w,channelCount:1,channelCountMode:g,numberOfInputs:2}),v=t(m,{...w,channelCount:p,channelCountMode:g,gain:1}),_=t(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:x,disconnectGraph:T}=f(m,p,v,_,S);Object.defineProperty(_.gain,"defaultValue",{get:()=>0}),Object.defineProperty(_.gain,"maxValue",{get:()=>1}),Object.defineProperty(_.gain,"minValue",{get:()=>-1});const k={get bufferSize(){},get channelCount(){return v.channelCount},set channelCount(A){v.channelCount!==A&&(b&&T(),{connectGraph:x,disconnectGraph:T}=f(m,A,v,_,S),b&&x()),v.channelCount=A},get channelCountMode(){return v.channelCountMode},set channelCountMode(A){if(A==="clamped-max"||A==="max")throw i();v.channelCountMode=A},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(A){v.channelInterpretation=A},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get pan(){return _.gain},addEventListener(...A){return v.addEventListener(A[0],A[1],A[2])},dispatchEvent(...A){return v.dispatchEvent(A[0])},removeEventListener(...A){return v.removeEventListener(A[0],A[1],A[2])}};let b=!1;const C=()=>{x(),b=!0},O=()=>{T(),b=!1};return r(ui(k,S),C,O)}},Fy=(n,e,t,s,i,r,o)=>(a,c)=>{const l=a.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);Be(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();we(l,{curve:u},"curve"),we(l,c,"oversample");let h=null,d=!1;return o(l,"curve",p=>()=>p.call(l),p=>g=>(p.call(l,g),d&&(s(g)&&h===null?h=n(a,l):!s(g)&&h!==null&&(h(),h=null)),g)),i(l,()=>{d=!0,s(l.curve)&&(h=n(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},Uy=(n,e,t,s,i)=>(r,{curve:o,oversample:a,...c})=>{const l=r.createWaveShaper(),u=r.createWaveShaper();Be(l,c),Be(u,c);const h=t(r,{...c,gain:1}),d=t(r,{...c,gain:-1}),f=t(r,{...c,gain:1}),m=t(r,{...c,gain:-1});let p=null,g=!1,y=null;const w={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(_){h.channelCount=_,d.channelCount=_,l.channelCount=_,f.channelCount=_,u.channelCount=_,m.channelCount=_},get channelCountMode(){return l.channelCountMode},set channelCountMode(_){h.channelCountMode=_,d.channelCountMode=_,l.channelCountMode=_,f.channelCountMode=_,u.channelCountMode=_,m.channelCountMode=_},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(_){h.channelInterpretation=_,d.channelInterpretation=_,l.channelInterpretation=_,f.channelInterpretation=_,u.channelInterpretation=_,m.channelInterpretation=_},get context(){return l.context},get curve(){return y},set curve(_){if(_!==null&&_.length<2)throw e();if(_===null)l.curve=_,u.curve=_;else{const x=_.length,T=new Float32Array(x+2-x%2),k=new Float32Array(x+2-x%2);T[0]=_[0],k[0]=-_[x-1];const b=Math.ceil((x+1)/2),C=(x+1)/2-1;for(let O=1;O<b;O+=1){const A=O/b*C,R=Math.floor(A),P=Math.ceil(A);T[O]=R===P?_[R]:(1-(A-R))*_[R]+(1-(P-A))*_[P],k[O]=R===P?-_[x-1-R]:-((1-(A-R))*_[x-1-R])-(1-(P-A))*_[x-1-P]}T[b]=x%2===1?_[b-1]:(_[b-2]+_[b-1])/2,l.curve=T,u.curve=k}y=_,g&&(s(y)&&p===null?p=n(r,h):p!==null&&(p(),p=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(_){l.oversample=_,u.oversample=_},addEventListener(..._){return h.addEventListener(_[0],_[1],_[2])},dispatchEvent(..._){return h.dispatchEvent(_[0])},removeEventListener(..._){return h.removeEventListener(_[0],_[1],_[2])}};o!==null&&(w.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==w.oversample&&(w.oversample=a);const S=()=>{h.connect(l).connect(f),h.connect(d).connect(u).connect(m).connect(f),g=!0,s(y)&&(p=n(r,h))},v=()=>{h.disconnect(l),l.disconnect(f),h.disconnect(d),d.disconnect(u),u.disconnect(m),m.disconnect(f),g=!1,p!==null&&(p(),p=null)};return i(ui(w,f),S,v)},nt=()=>new DOMException("","NotSupportedError"),Ly={numberOfChannels:1},zy=(n,e,t,s,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...Ly,...l},f=s(h,u,d);e(Zi,()=>Zi(f))||f.addEventListener("statechange",(()=>{let m=0;const p=g=>{this._state==="running"&&(m>0?(f.removeEventListener("statechange",p),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):m+=1)};return p})()),super(f,h),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Bh(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},By={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Vy=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...By,...l},d=t(u,h),f=r(u),m=f?s():null,p=c.sampleRate/2;super(c,!1,d,m),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,p,-p),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=m,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){ei(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),ms(this)&&gr(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},Hy=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=t(u);const f=Qe(d,h);if(!f){const m={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,m),a!==null&&d.start(a),c!==null&&d.stop(c)}return r.set(h,d),f?(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)):(await s(h,u.detune,d.detune),await s(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=r.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},jy={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},qy=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...jy,...l},d=t(u,h),f=r(u),m=f?s():null;super(c,!1,d,m),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,Ke,rt),this._orientationY=e(this,f,d.orientationY,Ke,rt),this._orientationZ=e(this,f,d.orientationZ,Ke,rt),this._positionX=e(this,f,d.positionX,Ke,rt),this._positionY=e(this,f,d.positionY,Ke,rt),this._positionZ=e(this,f,d.positionZ,Ke,rt),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Wy=(n,e,t,s,i,r,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(f,m)=>{let p=null,g=r(f);const y={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},w={...y,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},S=Qe(g,m);if("bufferSize"in g)p=s(m,{...y,gain:1});else if(!S){const v={...w,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(m,v)}if(u.set(m,p===null?g:p),p!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const O=new o(6,f.context.length,m.sampleRate),A=e(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});A.connect(O.destination),h=(async()=>{const R=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(P,F)=>{const I=t(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:F===0?1:0});return await a(O,P,I.offset),I}));for(let P=0;P<6;P+=1)R[P].connect(A,0,P),R[P].start(0);return l(O)})()}const v=await h,_=s(m,{...y,gain:1});await c(f,m,_);const x=[];for(let O=0;O<v.numberOfChannels;O+=1)x.push(v.getChannelData(O));let T=[x[0][0],x[1][0],x[2][0]],k=[x[3][0],x[4][0],x[5][0]],b=s(m,{...y,gain:1}),C=i(m,{...w,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:k[0],positionY:k[1],positionZ:k[2]});_.connect(b).connect(C.inputs[0]),C.connect(p);for(let O=128;O<v.length;O+=128){const A=[x[0][O],x[1][O],x[2][O]],R=[x[3][O],x[4][O],x[5][O]];if(A.some((P,F)=>P!==T[F])||R.some((P,F)=>P!==k[F])){T=A,k=R;const P=O/m.sampleRate;b.gain.setValueAtTime(0,P),b=s(m,{...y,gain:0}),C=i(m,{...w,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:k[0],positionY:k[1],positionZ:k[2]}),b.gain.setValueAtTime(1,P),_.connect(b).connect(C.inputs[0]),C.connect(p)}}return p}return S?(await n(m,f.orientationX,g.orientationX),await n(m,f.orientationY,g.orientationY),await n(m,f.orientationZ,g.orientationZ),await n(m,f.positionX,g.positionX),await n(m,f.positionY,g.positionY),await n(m,f.positionZ,g.positionZ)):(await a(m,f.orientationX,g.orientationX),await a(m,f.orientationY,g.orientationY),await a(m,f.orientationZ,g.orientationZ),await a(m,f.positionX,g.positionX),await a(m,f.positionY,g.positionY),await a(m,f.positionZ,g.positionZ)),li(g)?await c(f,m,g.inputs[0]):await c(f,m,g),g};return{render(f,m){const p=u.get(m);return p!==void 0?Promise.resolve(p):d(f,m)}}},Gy={disableNormalization:!1},Yy=(n,e,t,s)=>class $h{constructor(r,o){const a=e(r),c=s({...Gy,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===$h.prototype||t.has(r)}},Zy=(n,e)=>(t,s,i)=>(n(s).replay(i),e(s,t,i)),Xy=(n,e,t)=>async(s,i,r)=>{const o=n(s);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,i),f=s.context.destination;!t(l)&&(s!==f||!t(s))&&d.connect(r,u,c)})).reduce((a,c)=>[...a,...c],[]))},$y=(n,e,t)=>async(s,i,r)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(r,c)}))},Qy=(n,e,t,s)=>i=>n(Zi,()=>Zi(i))?Promise.resolve(n(s,s)).then(r=>{if(!r){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),r(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),Ky=n=>(e,t)=>{n.set(e,t)},Jy=n=>(e,t)=>n.set(e,t),e1=(n,e,t,s,i,r,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(s(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),bc(u)):e(r,()=>r(u))||a(u),n.add(u),u)),t1={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},s1=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...t1,...c},h=t(l,u),d=r(l),f=d?s():null;super(a,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},n1=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Qe(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.pan,l.pan):await s(c,a.pan,l.pan),li(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},i1=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},r1=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(t);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const a=new n(s,"a",{numberOfOutputs:0}),c=s.createOscillator();a.port.onmessage=()=>r=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o},o1=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{s.disconnect(),i(t.currentTime!==0)},t.startRendering()})},a1=()=>new DOMException("","UnknownError"),c1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},l1=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...c1,...l},d=t(u,h),m=r(u)?s():null;super(c,!0,d,m),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},u1=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Qe(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return s.set(o,a),li(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},h1=()=>typeof window>"u"?null:window,d1=(n,e)=>t=>{t.copyFromChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)s[h]=l[h+o]},t.copyToChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=s[h]}},f1=n=>e=>{e.copyFromChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyToChannel)},p1=n=>(e,t)=>{const s=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=s),n(e,"buffer",i=>()=>{const r=i.call(e);return r===s?null:r},i=>r=>i.call(e,r===null?s:r))},m1=(n,e)=>(t,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(s,()=>{const a=s.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(s,0,c)},()=>i.disconnect(s))},Qh=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),Kh=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},kr=(n,e,t,s)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(r),set:s(o)})},_1=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),g1=n=>({...n,channelCount:n.numberOfOutputs}),v1=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},Jh=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(s){if(s.code!==9)throw s;Jh(n,e,t+1e-7)}},y1=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},T1=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},x1=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Mc=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},ed=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},Dc=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},k1=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},w1=n=>{n.start=(e=>(t=0,s=0,i)=>{const r=n.buffer,o=r===null?s:Math.min(r.duration,s);r!==null&&o>r.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},td=(n,e)=>{const t=e.createGain();n.connect(t);const s=(i=>()=>{i.call(n,t),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),ui(n,t),n.stop=(i=>{let r=!1;return(o=0)=>{if(r)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),r=!0}})(n.stop)},hi=(n,e)=>t=>{const s={value:n};return Object.defineProperties(t,{currentTarget:s,target:s}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},S1=q_(kn),b1=$_(kn),C1=cv(Io),sd=new WeakMap,E1=Cv(sd),jt=Lg(new Map,new WeakMap),Kt=h1(),nd=sy(jt,ts),Rc=bv(et),Ge=Xy(et,Rc,_n),O1=tg(nd,ke,Ge),ye=Av(No),ws=Ay(Kt),he=Gv(ws),id=new WeakMap,rd=vv(hi),wr=oy(Kt),Pc=Hv(wr),Nc=jv(Kt),od=qv(Kt),Xi=cy(Kt),Ue=Cg(W_(Ph),X_(S1,b1,ao,C1,co,et,E1,_r,ke,kn,ms,_n,Gr),jt,Uv(Va,co,et,ke,Yi,ms),ts,Fo,nt,iv(ao,Va,et,ke,Yi,ye,ms,he),hv(id,et,Bt),rd,ye,Pc,Nc,od,he,Xi),A1=eg(Ue,O1,ts,nd,ye,he),Ic=new WeakSet,Jl=ny(Kt),ad=Qg(new Uint32Array(1)),Fc=d1(ad,ts),Uc=f1(ad),cd=ng(Ic,jt,nt,Jl,ws,i1(Jl),Fc,Uc),Uo=Q_(dt),ld=$y(Rc,vr,_n),ss=Wg(ld),di=ry(Uo,jt,y1,T1,x1,Mc,ed,Dc,w1,p1(kr),td),ns=Zy(Ev(vr),ld),M1=og(ss,di,ke,ns,Ge),qt=Eg(G_(Nh),id,Sc,Og,L_,z_,B_,V_,H_,La,Dh,wr,Jh),D1=rg(Ue,M1,qt,je,di,ye,he,hi),R1=mg(Ue,_g,ts,je,ay(dt,kr),ye,he,Ge),P1=Ug(ss,Zh,ke,ns,Ge),wn=Jy(sd),N1=Fg(Ue,qt,P1,Fo,Zh,ye,he,wn),Zs=ey(kn,Nc),I1=m1(je,Zs),Xs=my(wr,I1),F1=Vg(Xs,ke,Ge),U1=Bg(Ue,F1,Xs,ye,he),L1=qg(Tr,ke,Ge),z1=jg(Ue,L1,Tr,ye,he,g1),B1=vy(Uo,di,dt,Zs),fi=gy(Uo,jt,B1,Mc,Dc),V1=$g(ss,fi,ke,ns,Ge),H1=Xg(Ue,qt,V1,fi,ye,he,hi),ud=yy(nt,kr),j1=ev(ud,ke,Ge),q1=Jg(Ue,j1,ud,ye,he,wn),W1=av(ss,Xh,ke,ns,Ge),G1=ov(Ue,qt,W1,Xh,ye,he,wn),hd=Ty(nt),Y1=mv(ss,hd,ke,ns,Ge),Z1=pv(Ue,qt,Y1,hd,nt,ye,he,wn),X1=wv(ss,dt,ke,ns,Ge),$1=kv(Ue,qt,X1,dt,ye,he),Q1=Sy(Fo,je,xr,nt),Lo=Qy(jt,dt,xr,o1(dt,ws)),K1=Fv(di,ke,ws,Ge,Lo),J1=xy(Q1),eT=Nv(Ue,J1,K1,ye,he,wn),tT=gg(qt,Xs,fi,xr,nt,Qh,he,kr),dd=new WeakMap,sT=Jv(R1,tT,rd,he,dd,hi),fd=My(Uo,jt,Mc,ed,Dc,td),nT=Hy(ss,fd,ke,ns,Ge),iT=Vy(Ue,qt,fd,nT,ye,he,hi),pd=Yg(di),rT=Uy(pd,je,dt,Kh,Zs),zo=Fy(pd,je,rT,Kh,Zs,wr,kr),oT=Ry(ao,je,Xs,dt,xr,zo,nt,co,Qh,Zs),md=Dy(oT),aT=Wy(ss,Xs,fi,dt,md,ke,ws,ns,Ge,Lo),cT=qy(Ue,qt,md,aT,ye,he,wn),lT=Py(ts),uT=Yy(lT,ye,new WeakSet,v1),hT=Iy(Xs,Tr,dt,zo,nt,Zs),_d=Ny(hT,nt),dT=n1(ss,_d,ke,ns,Ge),fT=s1(Ue,qt,_d,dT,ye,he),pT=u1(zo,ke,Ge),mT=l1(Ue,je,zo,pT,ye,he,wn),gd=Yv(Kt),Lc=yv(Kt),vd=new WeakMap,_T=Mv(vd,ws),gT=gd?Z_(jt,nt,gv(Kt),Lc,Tv(j_),ye,_T,he,Xi,new WeakMap,new WeakMap,r1(Xi,ws),Kt):void 0,vT=Wv(Pc,he),yT=nv(Ic,jt,sv,_v,new WeakSet,ye,vT,ro,Zi,Fc,Uc),yd=Ng(gT,A1,cd,D1,N1,U1,z1,H1,q1,yT,G1,Z1,$1,eT,sT,iT,cT,uT,fT,mT),TT=Zv(Ue,by,ye,he),xT=$v(Ue,Cy,ye,he),kT=Qv(Ue,Ey,ye,he),wT=Oy(je,he),ST=Kv(Ue,wT,ye),bT=pg(yd,je,nt,a1,TT,xT,kT,ST,wr),zc=Dv(dd),CT=K_(zc),Td=Gg(ts),ET=lv(zc),xd=dv(ts),kd=new WeakMap,OT=Sv(kd,Bt),AT=py(Td,ts,je,Xs,Tr,fi,dt,xr,nt,xd,Lc,OT,Zs),MT=uy(je,AT,dt,nt,Zs),DT=Pg(ss,Td,di,Xs,Tr,fi,dt,ET,xd,Lc,ke,Xi,ws,ns,Ge,Lo),RT=Ov(vd),PT=Ky(kd),eu=gd?Mg(CT,Ue,qt,DT,MT,et,RT,ye,he,Xi,_1,PT,k1,hi):void 0,NT=tv(nt,ws),IT=e1(Ic,jt,Rc,zc,Lo,ro,Fc,Uc),FT=zy(yd,jt,je,NT,IT),UT=Lv(No,Pc),LT=zv(wc,Nc),zT=Bv(Sc,od),BT=Vv(No,he);function yt(n){return typeof n>"u"}function te(n){return!yt(n)}function VT(n){return typeof n=="function"}function Hs(n){return typeof n=="number"}function dn(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function HT(n){return typeof n=="boolean"}function zt(n){return Array.isArray(n)}function ys(n){return typeof n=="string"}function zr(n){return ys(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function Q(n,e){if(!n)throw new Error(e)}function Vt(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function wd(n){!n.isOffline&&n.state!=="running"&&Bc('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Sd=!1,tu=!1;function su(n){Sd=n}function jT(n){yt(n)&&Sd&&!tu&&(tu=!0,Bc("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let bd=console;function qT(...n){bd.log(...n)}function Bc(...n){bd.warn(...n)}function WT(n){return new bT(n)}function GT(n,e,t){return new FT(n,e,t)}const fn=typeof self=="object"?self:null,YT=fn&&(fn.hasOwnProperty("AudioContext")||fn.hasOwnProperty("webkitAudioContext"));function ZT(n,e,t){return Q(te(eu),"This node only works in a secure context (https or localhost)"),new eu(n,e,t)}class XT{constructor(e,t,s,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),s=new Worker(t);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function gn(n){return zT(n)}function zs(n){return LT(n)}function Yr(n){return BT(n)}function In(n){return UT(n)}function $T(n){return n instanceof cd}function QT(n,e){return n==="value"||gn(e)||zs(e)||$T(e)}function qn(n,...e){if(!e.length)return n;const t=e.shift();if(dn(n)&&dn(t))for(const s in t)QT(s,t[s])?n[s]=t[s]:dn(t[s])?(n[s]||Object.assign(n,{[s]:{}}),qn(n[s],t[s])):Object.assign(n,{[s]:t[s]});return qn(n,...e)}function KT(n,e){return n.length===e.length&&n.every((t,s)=>e[s]===t)}function N(n,e,t=[],s){const i={},r=Array.from(e);if(dn(r[0])&&s&&!Reflect.has(r[0],s)&&(Object.keys(r[0]).some(a=>Reflect.has(n,a))||(qn(i,{[s]:r[0]}),t.splice(t.indexOf(s),1),r.shift())),r.length===1&&dn(r[0]))qn(i,r[0]);else for(let o=0;o<t.length;o++)te(r[o])&&(i[t[o]]=r[o]);return qn(n,i)}function JT(n){return n.constructor.getDefaults()}function Wn(n,e){return yt(n)?e:n}function zn(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Ss{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||fn&&this.toString()===fn.TONE_DEBUG_CLASS)&&qT(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Ss.version=Mh;const Vc=1e-6;function ti(n,e){return n>e+Vc}function Ga(n,e){return ti(n,e)||Ft(n,e)}function fo(n,e){return n+Vc<e}function Ft(n,e){return Math.abs(n-e)<Vc}function ex(n,e,t){return Math.max(Math.min(n,t),e)}class Mt extends Ss{constructor(){super(),this.name="Timeline",this._timeline=[];const e=N(Mt.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Q(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];Q(Ga(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const s=this._search(e,t);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const s=this._search(e,t);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const s=this._search(e);return s-1>=0?this._timeline[s-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Ft(this._timeline[t].time,e)){for(let s=t;s>=0&&Ft(this._timeline[s].time,e);s--)t=s;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&Ga(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let s=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;s<r;){let o=Math.floor(s+(r-s)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Ft(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Ft(u[t],e))o=l;else break}return o}else{if(fo(a[t],e)&&ti(c[t],e))return o;ti(a[t],e)?r=o:s=o+1}}return-1}_iterate(e,t=0,s=this._timeline.length-1){this._timeline.slice(t,s+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const s=this._search(e);return s!==-1&&this._iterate(t,0,s),this}forEachAfter(e,t){const s=this._search(e);return this._iterate(t,s+1),this}forEachBetween(e,t,s){let i=this._search(e),r=this._search(t);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===t&&(r-=1),this._iterate(s,i,r)):i===-1&&this._iterate(s,0,r),this}forEachFrom(e,t){let s=this._search(e);for(;s>=0&&this._timeline[s].time>=e;)s--;return this._iterate(t,s+1),this}forEachAtTime(e,t){const s=this._search(e);if(s!==-1&&Ft(this._timeline[s].time,e)){let i=s;for(let r=s;r>=0&&Ft(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{t(r)},i,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Cd=[];function Bo(n){Cd.push(n)}function tx(n){Cd.forEach(e=>e(n))}const Ed=[];function Vo(n){Ed.push(n)}function sx(n){Ed.forEach(e=>e(n))}class Sr extends Ss{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{yt(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const s=(...i)=>{t(...i),this.off(e,s)};return this.on(e,s),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(yt(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(yt(t))this._events[i]=[];else{const r=this._events[i];for(let o=r.length-1;o>=0;o--)r[o]===t&&r.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const s=this._events[e].slice(0);for(let i=0,r=s.length;i<r;i++)s[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const s=Object.getOwnPropertyDescriptor(Sr.prototype,t);Object.defineProperty(e.prototype,t,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class Od extends Sr{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class br extends Od{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Mt,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=N(br.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=WT({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new XT(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(tx(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,s){return this._context.createBuffer(e,t,s)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,s){return this._context.createPeriodicWave(e,t,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return Q(In(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return Q(In(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return Q(In(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Q(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Q(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Q(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Q(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return ZT(this.rawContext,e,t)}addAudioWorkletModule(e){return Fe(this,void 0,void 0,function*(){Q(te(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Fe(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return In(this._context)?this._context.resume():Promise.resolve()}close(){return Fe(this,void 0,void 0,function*(){In(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&sx(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),s=t.getChannelData(0);for(let r=0;r<s.length;r++)s[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:s+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const s=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:s,time:r+t})};return i(),s}}class nx extends Od{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,s){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Fe(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Te(n,e){zt(e)?e.forEach(t=>Te(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function Hc(n,e){zt(e)?e.forEach(t=>Hc(n,t)):Object.defineProperty(n,e,{writable:!0})}const ce=()=>{};class le extends Ss{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ce;const e=N(le.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,ys(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:ce,onload:ce,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ut().sampleRate}set(e){return e instanceof le?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Fe(this,void 0,void 0,function*(){const t=le.load(e).then(s=>{this.set(s),this.onload(this)});le.downloads.push(t);try{yield t}finally{const s=le.downloads.indexOf(t);le.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=zt(e)&&e[0].length>0,s=t?e.length:1,i=t?e[0].length:e.length,r=Ut(),o=r.createBuffer(s,i,r.sampleRate),a=!t&&s===1?[e]:e;for(let c=0;c<s;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(Hs(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const s=this.numberOfChannels;for(let i=0;i<s;i++){const r=this.toArray(i);for(let o=0;o<r.length;o++)t[o]+=r[o]}t=t.map(i=>i/s),this.fromArray(t)}return this}toArray(e){if(Hs(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let s=0;s<this.numberOfChannels;s++)t[s]=this.getChannelData(s);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){Q(this.loaded,"Buffer is not loaded");const s=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);Q(s<i,"The start time must be less than the end time");const r=i-s,o=Ut().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,i),a);return new le(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new le().fromArray(e)}static fromUrl(e){return Fe(this,void 0,void 0,function*(){return yield new le().load(e)})}static load(e){return Fe(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let l=c[0];for(const u of c)if(le.supportsType(u)){l=u;break}e=e.replace(t[0],l)}const s=le.baseUrl===""||le.baseUrl.endsWith("/")?le.baseUrl:le.baseUrl+"/",i=document.createElement("a");i.href=s+e,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const r=yield fetch(i.href);if(!r.ok)throw new Error(`could not load url: ${e}`);const o=yield r.arrayBuffer();return yield Ut().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),s=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return Fe(this,void 0,void 0,function*(){for(yield Promise.resolve();le.downloads.length;)yield le.downloads[0]})}}le.baseUrl="";le.downloads=[];class Ho extends br{constructor(){super({clockSource:"offline",context:Yr(arguments[0])?arguments[0]:GT(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Yr(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Yr(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Fe(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const s=Math.floor(this.sampleRate/128);e&&t%s===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(e=!0){return Fe(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new le(t)})}close(){return Promise.resolve()}}const Ad=new nx;let on=Ad;function Ut(){return on===Ad&&YT&&ix(new br),on}function ix(n,e=!1){e&&on.dispose(),In(n)?on=new br(n):Yr(n)?on=new Ho(n):on=n}function rx(){return on.resume()}if(fn&&!fn.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Mh} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function ox(n){return Math.pow(10,n/20)}function ax(n){return 20*(Math.log(n)/Math.LN10)}function Md(n){return Math.pow(2,n/12)}let jo=440;function cx(){return jo}function lx(n){jo=n}function Ya(n){return Math.round(Dd(n))}function Dd(n){return 69+12*Math.log2(n/jo)}function ux(n){return jo*Math.pow(2,(n-69)/12)}class jc extends Ss{constructor(e,t,s){super(),this.defaultUnits="s",this._val=t,this._units=s,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const s=parseInt(e,10),i=t==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/s)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,s)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof jc&&this.fromType(this._val),yt(this._val))return this._noArg();if(ys(this._val)&&yt(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(dn(this._val)){let e=0;for(const t in this._val)if(te(this._val[t])){const s=this._val[t],i=new this.constructor(this.context,t).valueOf()*s;e+=i}return e}if(te(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return ys(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Lt extends jc{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Lt(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const s=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/s)*s-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let r=1;r<9;r++){const o=Math.pow(2,r);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let s=t[0],i=new Lt(this.context,t[0]).toSeconds();return t.forEach(r=>{const o=new Lt(this.context,r).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(s=r,i=o)}),s}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const s=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[s,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Ya(this.toFrequency())}_now(){return this.context.now()}}class At extends Lt{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return cx()}static set A4(e){lx(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:At.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=hx[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:At.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,s){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s)/4)),i}}})}transpose(e){return new At(this.context,this.valueOf()*Md(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return Ya(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/At.A4);let s=Math.round(12*t)+57;const i=Math.floor(s/12);return i<0&&(s+=-12*i),dx[s%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return ux(e)}static ftom(e){return Ya(e)}}const hx={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},dx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Li extends Lt{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ut extends Ss{constructor(){super();const e=N(ut.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Ut()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return jT(e),new Lt(this.context,e).toSeconds()}toFrequency(e){return new At(this.context,e).toFrequency()}toTicks(e){return new Li(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(s=>{yt(e[s])&&delete t[s]}),t}get(){const e=JT(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const s=this[t];te(s)&&te(s.value)&&te(s.setValueAtTime)?e[t]=s.value:s instanceof ut?e[t]=s._getPartialProperties(e[t]):zt(s)||Hs(s)||ys(s)||HT(s)?e[t]=s:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&te(this[t])&&(this[t]&&te(this[t].value)&&te(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ut?this[t].set(e[t]):this[t]=e[t])}),this}}class qc extends Mt{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,s){return Vt(t,0),this.add(Object.assign({},s,{state:e,time:t})),this}getLastState(e,t){const s=this._search(t);for(let i=s;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,t){const s=this._search(t);if(s!==-1)for(let i=s;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class ue extends ut{constructor(){super(N(ue.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=N(ue.getDefaults(),arguments,["param","units","convert"]);for(Q(te(e.param)&&(gn(e.param)||e.param instanceof ue),"param must be an AudioParam");!gn(e.param);)e.param=e.param._param;this._swappable=te(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Mt(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,te(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ut.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return te(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return te(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return te(this.maxValue)&&te(this.minValue)&&Vt(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?ox(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?ax(e):e}setValueAtTime(e,t){const s=this.toSeconds(t),i=this._fromType(e);return Q(isFinite(i)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,s),this._events.add({time:s,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,s),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),s=this._events.getAfter(t),i=this._events.get(t);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(s===null)r=i.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}s.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,o,s.time,s.value,t):r=this._exponentialInterpolate(i.time,o,s.time,s.value,t)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const s=this._fromType(e),i=this.toSeconds(t);return Q(isFinite(s)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this._events.add({time:i,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(s,i),this}exponentialRampToValueAtTime(e,t){let s=this._fromType(e);s=Ft(s,0)?this._minOutput:s,this._assertRange(s);const i=this.toSeconds(t);return Q(isFinite(s)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(s,i),this}exponentialRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(e,s+this.toSeconds(t)),this}linearRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(e,s+this.toSeconds(t)),this}targetRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(e,s,t),this}exponentialApproachValueAtTime(e,t,s){t=this.toSeconds(t),s=this.toSeconds(s);const i=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+s*.9),this.linearRampToValueAtTime(e,t+s),this}setTargetAtTime(e,t,s){const i=this._fromType(e);Q(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(t);return this._assertRange(i),Q(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:s,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,s),this._param.setTargetAtTime(i,r,s),this}setValueCurveAtTime(e,t,s,i=1){s=this.toSeconds(s),t=this.toSeconds(t);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),t);const o=s/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return Q(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),s=this._fromType(this.getValueAtTime(t));Q(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+s);const i=this._events.get(t),r=this._events.getAfter(t);return i&&Ft(i.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),t):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),t)),this._events.add({time:t,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,t),this}rampTo(e,t=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,s):this.linearRampTo(e,t,s),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const s=this._events.get(t);if(s&&s.type==="setTargetAtTime"){const i=this._events.getAfter(s.time),r=i?i.time:t+2,o=(r-t)/10;for(let a=t;a<r;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){Q(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,s,i,r){return s+(t-s)*Math.exp(-(r-e)/i)}_linearInterpolate(e,t,s,i,r){return t+(i-t)*((r-e)/(s-e))}_exponentialInterpolate(e,t,s,i,r){return t*Math.pow(i/t,(r-e)/(s-e))}}class W extends ut{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return te(this.input)?gn(this.input)||this.input instanceof ue?1:this.input.numberOfInputs:0}get numberOfOutputs(){return te(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return te(e)&&(e instanceof W||zs(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(s=>{s.channelCount=e.channelCount,s.channelCountMode=e.channelCountMode,s.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();Q(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,s=0){return js(this,e,t,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Bc("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,s=0){return fx(this,e,t,s),this}chain(...e){return $i(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),te(this.input)&&(this.input instanceof W?this.input.dispose():zs(this.input)&&this.input.disconnect()),te(this.output)&&(this.output instanceof W?this.output.dispose():zs(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function $i(...n){const e=n.shift();n.reduce((t,s)=>(t instanceof W?t.connect(s):zs(t)&&js(t,s),s),e)}function js(n,e,t=0,s=0){for(Q(te(n),"Cannot connect from undefined node"),Q(te(e),"Cannot connect to undefined node"),(e instanceof W||zs(e))&&Q(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Q(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof W||e instanceof ue;)te(e.input)&&(e=e.input);for(;n instanceof W;)te(n.output)&&(n=n.output);gn(e)?n.connect(e,t):n.connect(e,t,s)}function fx(n,e,t=0,s=0){if(te(e))for(;e instanceof W;)e=e.input;for(;!zs(n);)te(n.output)&&(n=n.output);gn(e)?n.disconnect(e,t):zs(e)?n.disconnect(e,t,s):n.disconnect()}class pe extends W{constructor(){super(N(pe.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=N(pe.getDefaults(),arguments,["gain","units"]);this.gain=new ue({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Te(this,"gain")}static getDefaults(){return Object.assign(W.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class si extends W{constructor(e){super(e),this.onended=ce,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new pe({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const s=this.toSeconds(t);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(W.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ce})}_startGain(e,t=1){Q(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=e+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+s):this._gainNode.gain.exponentialApproachValueAtTime(t,e,s)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Q(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ce&&(this.onended(this),this.onended=ce,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Q(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=ce,this}}class po extends si{constructor(){super(N(po.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=N(po.getDefaults(),arguments,["offset"]);js(this._source,this._gainNode),this.offset=new ue({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(si.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ve extends W{constructor(){super(N(ve.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=N(ve.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new po({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(W.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,s=0){return Wc(this,e,t,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,s){return this._param.exponentialRampTo(e,t,s),this}linearRampTo(e,t,s){return this._param.linearRampTo(e,t,s),this}targetRampTo(e,t,s){return this._param.targetRampTo(e,t,s),this}exponentialApproachValueAtTime(e,t,s){return this._param.exponentialApproachValueAtTime(e,t,s),this}setTargetAtTime(e,t,s){return this._param.setTargetAtTime(e,t,s),this}setValueCurveAtTime(e,t,s,i){return this._param.setValueCurveAtTime(e,t,s,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,s){return this._param.rampTo(e,t,s),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Wc(n,e,t,s){(e instanceof ue||gn(e)||e instanceof ve&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ve&&(e.overridden=!0)),js(n,e,t,s)}class mo extends ue{constructor(){super(N(mo.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Mt(1/0),this._multiplier=1;const e=N(mo.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ue.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,s){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),r=this._events.get(t),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const c=s*a+t,l=this._exponentialApproach(r.time,r.value,i,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const s=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const s=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const s=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/r;for(let a=0;a<=r;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(yt(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const s=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const r=this._events.get(t);return r&&r.time===t&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(s+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),s=this._events.get(t);return Math.max(this._getTicksUntilEvent(s,t),0)}getDurationOfTicks(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-s}getTimeOfTick(e){const t=this._events.get(e,"ticks"),s=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&s&&s.type==="linearRampToValueAtTime"&&t.value!==s.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(s.time))-i)/(s.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const s=this.toSeconds(t),i=this.toSeconds(e),r=this.getTicksAtTime(s);return this.getTicksAtTime(s+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class _o extends ve{constructor(){super(N(_o.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=N(_o.getDefaults(),arguments,["value"]);this.input=this._param=new mo({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ve.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class go extends ut{constructor(){super(N(go.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new qc,this._tickOffset=new Mt,this._ticksAtTime=new Mt,this._secondsAtTime=new Mt;const e=N(go.getDefaults(),arguments,["frequency"]);this.frequency=new _o({context:this.context,units:e.units,value:e.frequency}),Te(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ut.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const s=this.toSeconds(e);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),te(t)&&this.setTicksAtTime(t,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const s=this._state.get(t);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),s=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),r={state:"paused",time:t};this._state.add(r);let o=i||s,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!=r.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(r),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),s=this.frequency.timeToTicks(e,t);this.setTicksAtTime(s,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);const i=this._secondsAtTime.get(e);let r=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(r.time,e+this.sampleTime,c=>{let l=r.time;const u=this._tickOffset.get(c.time);u&&u.time>=r.time&&(o=u.seconds,l=u.time),r.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!=s.time&&(a={state:c.state,time:c.time,seconds:o})),r=c}),this._state.remove(s),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const s=this._tickOffset.get(t),i=this._state.get(t),r=Math.max(s.time,i.time),o=this.frequency.getTicksAtTime(r)+e-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,s){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,s),i=o});let r=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Ft(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(d){r=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Qi extends ut{constructor(){super(N(Qi.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=ce,this._lastUpdate=0,this._state=new qc("stopped"),this._boundLoop=this._loop.bind(this);const e=N(Qi.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new go({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Te(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ut.getDefaults(),{callback:ce,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){wd(this.context);const s=this.toSeconds(e);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,t),s<this._lastUpdate&&this.emit("start",s,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(i+e,s)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,s=>{switch(s.state){case"started":const i=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,i);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(e,t,(s,i)=>{this.callback(s,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Sr.mixin(Qi);class Gc extends Ss{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=N(Gc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const s=e.urls[t];this.add(t,s,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:ce,onload:ce,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Q(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,s=ce,i=ce){return ys(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new le(this.baseUrl+t,s,i))):this._buffers.set(e.toString(),new le(t,s,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Bn extends Li{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class px extends ut{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Mt,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Bo(n=>{n.draw=new px({context:n})});Vo(n=>{n.draw.dispose()});class mx extends Ss{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Q(te(e.time),"Events must have a time property"),Q(te(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new _x(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const s of t)if(s.event===e){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let s,i=null;if(t>0)if(e.left.right===null)s=e.left,s.right=e.right,i=s;else{for(s=e.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,i=s.parent,s.left=e.left,s.right=e.right)}else if(e.right.left===null)s=e.right,s.left=e.left,i=s;else{for(s=e.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,i=s.parent,s.left=e.left,s.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=s:e.parent.right=s:this._setRoot(s),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,s=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,s=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let s=t[0];for(let i=1;i<t.length;i++)t[i].low>s.low&&(s=t[i]);return s.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(s=>t.push(s)),t.forEach(s=>{s.event&&e(s.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const s=[];this._root.search(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const s=[];this._root.searchAfter(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class _x{constructor(e,t,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class qs extends W{constructor(){super(N(qs.getDefaults(),arguments,["volume"])),this.name="Volume";const e=N(qs.getDefaults(),arguments,["volume"]);this.input=this.output=new pe({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Te(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}let gx=class Za extends W{constructor(){super(N(Za.getDefaults(),arguments)),this.name="Destination",this.input=new qs({context:this.context}),this.output=new pe({context:this.context}),this.volume=this.input.volume;const e=N(Za.getDefaults(),arguments);$i(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),$i(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};Bo(n=>{n.destination=new gx({context:n})});Vo(n=>{n.destination.dispose()});class vx extends Ss{constructor(e){super(),this.name="TimelineValue",this._timeline=new Mt({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Ts extends W{constructor(){super(Object.assign(N(Ts.getDefaults(),arguments,["context"])))}connect(e,t=0,s=0){return Wc(this,e,t,s),this}}class vn extends Ts{constructor(){super(Object.assign(N(vn.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=N(vn.getDefaults(),arguments,["mapping","length"]);zt(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):VT(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ve.getDefaults(),{length:1024})}setMap(e,t=1024){const s=new Float32Array(t);for(let i=0,r=t;i<r;i++){const o=i/(r-1)*2-1;s[i]=e(o,i)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(s=>s.includes(e));Q(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Ki extends Ts{constructor(){super(Object.assign(N(Ki.getDefaults(),arguments,["value"]))),this.name="Pow";const e=N(Ki.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new vn({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Ts.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Ws{constructor(e,t){this.id=Ws._eventId++,this._remainderTime=0;const s=Object.assign(Ws.getDefaults(),t);this.transport=e,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:ce,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Ws._eventId=0;class Yc extends Ws{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(Yc.getDefaults(),t);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Ws.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return fo(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Bn(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){fo(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Bn(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);ti(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Ji extends ut{constructor(){super(N(Ji.getDefaults(),arguments)),this.name="Transport",this._loop=new vx(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Mt,this._repeatedEvents=new mx,this._syncedSignals=[],this._swingAmount=0;const e=N(Ji.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Qi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Te(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ut.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const s=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(s*Math.PI)*this._swingAmount;e+=new Bn(this.context,this._swingTicks*2/3).toSeconds()*i}su(!0),this._timeline.forEachAtTime(t,s=>s.invoke(e)),su(!1)}schedule(e,t){const s=new Ws(this,{callback:e,time:new Li(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(e,t,s,i=1/0){const r=new Yc(this,{callback:e,duration:new Lt(this.context,i).toTicks(),interval:new Lt(this.context,t).toTicks(),time:new Li(this.context,s).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,t){const s=new Ws(this,{callback:e,once:!0,time:new Li(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(t,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new Bn(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let s;return te(t)&&(s=this.toTicks(t)),this._clock.start(e,s),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){zt(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Lt(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Lt(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Bn(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Bn(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),s=this._clock.frequency.timeToTicks(e,t);this.ticks=s}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,t),r=t+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),s=this.getTicksAtTime(t),i=e-s%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const s=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(s)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/r,l=new pe(c),u=new Ki(-1),h=new pe(c);i.chain(l,u,h),i=h,r=1/r,o=[l,u,h]}t||(e.getValueAtTime(s)!==0?t=e.getValueAtTime(s)/r:t=0);const a=new pe(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const s=this._syncedSignals[t];s.signal===e&&(s.nodes.forEach(i=>i.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Hc(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Sr.mixin(Ji);Bo(n=>{n.transport=new Ji({context:n})});Vo(n=>{n.transport.dispose()});class $e extends W{constructor(e){super(e),this.input=void 0,this._state=new qc("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ce,this._syncedStop=ce,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new qs({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Te(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,onstop:ce,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,s){let i=yt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")Q(ti(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,s);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(Wn(t,0)),r.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,s)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else wd(this.context),this._start(i,t,s);return this}stop(e){let t=yt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||te(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const s=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(s)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,s){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(ti(t,0)){const s=this._state.get(t);if(s&&s.state==="started"&&s.time!==t){const i=t-this.toSeconds(s.time);let r;s.duration&&(r=this.toSeconds(s.duration)-i),this._start(e,this.toSeconds(s.offset)+i,r)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ce,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ni extends si{constructor(){super(N(ni.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=N(ni.getDefaults(),arguments,["url","onload"]);js(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ue({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new le(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(si.getDefaults(),{url:new le,loop:!1,loopEnd:0,loopStart:0,onload:ce,onerror:ce,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,s,i=1){Q(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?t=Wn(t,this.loopStart):t=Wn(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;Ga(o,a)&&(o=(o-c)%l+c),Ft(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,fo(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,o)),te(s)){let a=this.toSeconds(s);a=Math.max(a,0),this.stop(r+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class er extends $e{constructor(){super(N(er.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=N(er.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign($e.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(Q(e in nu,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=nu[this._type];this._source=new ni({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Pn=44100*5,va=2,as={brown:null,pink:null,white:null},nu={get brown(){if(!as.brown){const n=[];for(let e=0;e<va;e++){const t=new Float32Array(Pn);n[e]=t;let s=0;for(let i=0;i<Pn;i++){const r=Math.random()*2-1;t[i]=(s+.02*r)/1.02,s=t[i],t[i]*=3.5}}as.brown=new le().fromArray(n)}return as.brown},get pink(){if(!as.pink){const n=[];for(let e=0;e<va;e++){const t=new Float32Array(Pn);n[e]=t;let s,i,r,o,a,c,l;s=i=r=o=a=c=l=0;for(let u=0;u<Pn;u++){const h=Math.random()*2-1;s=.99886*s+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=s+i+r+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}as.pink=new le().fromArray(n)}return as.pink},get white(){if(!as.white){const n=[];for(let e=0;e<va;e++){const t=new Float32Array(Pn);n[e]=t;for(let s=0;s<Pn;s++)t[s]=Math.random()*2-1}as.white=new le().fromArray(n)}return as.white}};function Sn(n,e){return Fe(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,s=new Ho(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class vo extends si{constructor(){super(N(vo.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=N(vo.getDefaults(),arguments,["frequency","type"]);js(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new ue({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new ue({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Te(this,["frequency","detune"])}static getDefaults(){return Object.assign(si.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Ne extends $e{constructor(){super(N(Ne.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=N(Ne.getDefaults(),arguments,["frequency","type"]);this.frequency=new ve({context:this.context,units:"frequency",value:e.frequency}),Te(this,"frequency"),this.detune=new ve({context:this.context,units:"cents",value:e.detune}),Te(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign($e.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),s=new vo({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Ne._periodicWaveCache.find(t=>t.phase===this._phase&&KT(t.partials,this._partials));{const e=Ne._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const s=this._getCachedPeriodicWave();if(te(s)){const{partials:i,wave:r}=s;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,r);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Ne._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Ne._periodicWaveCache.length>100&&Ne._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Vt(e,0);let t=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(t=s[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,o)=>i[o]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const r=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[r,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(r[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(r[c]=0,o[c]=0)}return[r,o]}_inverseFFT(e,t,s){let i=0;const r=e.length;for(let o=0;o<r;o++)i+=e[o]*Math.cos(o*s)+t[o]*Math.sin(o*s);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let s=0;const i=Math.PI*2,r=32;for(let o=0;o<r;o++)s=Math.max(this._inverseFFT(e,t,o/r*i),s);return ex(-this._inverseFFT(e,t,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return Fe(this,void 0,void 0,function*(){return Sn(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Ne._periodicWaveCache=[];class yx extends Ts{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new vn({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Gs extends ve{constructor(){super(Object.assign(N(Gs.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=N(Gs.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new pe({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ve.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class tr extends $e{constructor(){super(N(tr.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new yx({context:this.context}),this._modulationNode=new pe({context:this.context});const e=N(tr.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ne({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Ne({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Gs({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Te(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ne.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Fe(this,void 0,void 0,function*(){return Sn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class sr extends $e{constructor(){super(N(sr.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new pe({context:this.context,gain:0});const e=N(sr.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ne({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ve({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Ne({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Gs({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Gs({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Te(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ne.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Fe(this,void 0,void 0,function*(){return Sn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class ii extends $e{constructor(){super(N(ii.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new pe({context:this.context,gain:0}),this._thresh=new vn({context:this.context,mapping:t=>t<=0?-1:1});const e=N(ii.getDefaults(),arguments,["frequency","width"]);this.width=new ve({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Ne({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Te(this,["width","frequency","detune"])}static getDefaults(){return Object.assign($e.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return Fe(this,void 0,void 0,function*(){return Sn(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class nr extends $e{constructor(){super(N(nr.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=N(nr.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new ve({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ve({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Te(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ne.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,s=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=t+s*r)}}get count(){return this._oscillators.length}set count(e){if(Vt(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const s=new Ne({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):ce});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[t]=s}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,s)=>t.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return Fe(this,void 0,void 0,function*(){return Sn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class ir extends $e{constructor(){super(N(ir.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Gs({context:this.context,value:2});const e=N(ir.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new ii({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Ne({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Te(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign($e.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return Fe(this,void 0,void 0,function*(){return Sn(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const iu={am:tr,fat:nr,fm:sr,oscillator:Ne,pulse:ii,pwm:ir};class yn extends $e{constructor(){super(N(yn.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=N(yn.getDefaults(),arguments,["frequency","type"]);this.frequency=new ve({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ve({context:this.context,units:"cents",value:e.detune}),Te(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Ne.getDefaults(),sr.getDefaults(),tr.getDefaults(),nr.getDefaults(),ii.getDefaults(),ir.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=iu[e],s=this.now();if(this._oscillator){const i=this._oscillator;i.stop(s),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof iu[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Hs(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Hs(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&ys(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return Fe(this,void 0,void 0,function*(){return Sn(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Zc extends ve{constructor(){super(Object.assign(N(Zc.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new pe({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,$i(this._constantSource,this._sum)}static getDefaults(){return Object.assign(ve.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class yo extends Ts{constructor(){super(Object.assign(N(yo.getDefaults(),arguments,["min","max"]))),this.name="Scale";const e=N(yo.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Gs({context:this.context,value:e.max-e.min}),this._add=this.output=new Zc({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ts.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}function Rd(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){Vt(r,n,e),t.set(this,r)}})}}function bs(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){Vt(this.toSeconds(r),n,e),t.set(this,r)}})}}class rr extends $e{constructor(){super(N(rr.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=N(rr.getDefaults(),arguments,["url","onload"]);this._buffer=new le({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign($e.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ce,onerror:ce,playbackRate:1,reverse:!1})}load(e){return Fe(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=ce){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,s){return super.start(e,t,s),this}_start(e,t,s){this._loop?t=Wn(t,this._loopStart):t=Wn(t,0);const i=this.toSeconds(t),r=s;s=Wn(s,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(s);o=o/this._playbackRate,e=this.toSeconds(e);const a=new ni({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&yt(r)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(s=>s.stop(t))}restart(e,t,s){return super.restart(e,t,s),this}_restart(e,t,s){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,s)}seek(e,t){const s=this.toSeconds(t);if(this._state.getValueAtTime(s)==="started"){const i=this.toSeconds(e);this._stop(s),this._start(s,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Vt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Vt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),s=this._state.getNextState("stopped",t);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Ht([bs(0)],rr.prototype,"fadeIn",void 0);Ht([bs(0)],rr.prototype,"fadeOut",void 0);class Tx extends Ts{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new vn({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Rt extends W{constructor(){super(N(Rt.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new ve({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=N(Rt.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(W.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(ys(e))return e;{let s;for(s in Br)if(Br[s][t]===e)return s;return e}}_setCurve(e,t,s){if(ys(s)&&Reflect.has(Br,s)){const i=Br[s];dn(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(zt(s)&&e!=="_decayCurve")this[e]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(r&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,r+c):this._sig.exponentialApproachValueAtTime(a,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,e):(Q(zt(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,s,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,s=1){return t=this.toSeconds(t),this.triggerAttack(t,s),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,s=0){return Wc(this,e,t,s),this}asArray(e=1024){return Fe(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,s=new Ho(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),o=r*.1,a=r+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:s}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Ht([bs(0)],Rt.prototype,"attack",void 0);Ht([bs(0)],Rt.prototype,"decay",void 0);Ht([Rd(0,1)],Rt.prototype,"sustain",void 0);Ht([bs(0)],Rt.prototype,"release",void 0);const Br=(()=>{let e,t;const s=[];for(e=0;e<128;e++)s[e]=Math.sin(e/(128-1)*(Math.PI/2));const i=[],r=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const d=Math.sin(t*(Math.PI*2)*r-Math.PI/2)+1;i[e]=d/10+t*.83}i[128-1]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/(128-1)*a)/a;const c=[];for(e=0;e<128;e++)t=e/(128-1),c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/(128-1);const d=Math.pow(t,3)*4+.2,f=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(f*(1-t))}function u(d){const f=new Array(d.length);for(let m=0;m<d.length;m++)f[m]=1-d[m];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class Tn extends W{constructor(){super(N(Tn.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t);const e=N(Tn.getDefaults(),arguments);this._volume=this.output=new qs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Te(this,"volume")}static getDefaults(){return Object.assign(W.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const s=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[t],o=this.context.transport.schedule(a=>{i[t]=a,s.apply(this,i)},r);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,s,i){const r=this.toSeconds(s),o=this.toSeconds(t);return this.triggerAttack(e,r,i),this.triggerRelease(r+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class xs extends Tn{constructor(){super(N(xs.getDefaults(),arguments));const e=N(xs.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Tn.getDefaults(),{detune:0,onsilence:ce,portamento:0})}triggerAttack(e,t,s=1){this.log("triggerAttack",e,t,s);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,s),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const s=this.toSeconds(t),i=e instanceof At?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,s)}else this.frequency.setValueAtTime(i,s);return this}}Ht([bs(0)],xs.prototype,"portamento",void 0);class qo extends Rt{constructor(){super(N(qo.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new pe({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class or extends xs{constructor(){super(N(or.getDefaults(),arguments)),this.name="Synth";const e=N(or.getDefaults(),arguments);this.oscillator=new yn(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new qo(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Te(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(xs.getDefaults(),{envelope:Object.assign(zn(Rt.getDefaults(),Object.keys(W.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(zn(yn.getDefaults(),[...Object.keys($e.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class ar extends W{constructor(){super(N(ar.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const e=N(ar.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new ue({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new ue({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new ue({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new ue({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(W.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){Q(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*(2e4-20)+20;t[o]=c}const s=new Float32Array(e),i=new Float32Array(e),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(t,s,i),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class ri extends W{constructor(){super(N(ri.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new pe({context:this.context}),this.output=new pe({context:this.context}),this._filters=[];const e=N(ri.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new ve({context:this.context,units:"positive",value:e.Q}),this.frequency=new ve({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ve({context:this.context,units:"cents",value:e.detune}),this.gain=new ve({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Te(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(W.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){Q(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(s=>s.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=Hs(e)?e:parseInt(e,10),s=[-12,-24,-48,-96];let i=s.indexOf(t);Q(i!==-1,`rolloff can only be ${s.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(r=>r.disconnect()),this._filters=new Array(i);for(let r=0;r<i;r++){const o=new ar({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[r]=o}this._internalChannels=this._filters,$i(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new ar({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((r,o)=>s[o]*=r)}),t.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),Hc(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class cr extends Rt{constructor(){super(N(cr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const e=N(cr.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new Ki({context:this.context,value:e.exponent}),this._scale=this.output=new yo({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Rt.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const t=this.toFrequency(e);Vt(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class lr extends xs{constructor(){super(N(lr.getDefaults(),arguments)),this.name="MonoSynth";const e=N(lr.getDefaults(),arguments);this.oscillator=new yn(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new ri(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new cr(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new qo(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Te(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(xs.getDefaults(),{envelope:Object.assign(zn(Rt.getDefaults(),Object.keys(W.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(zn(ri.getDefaults(),Object.keys(W.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(zn(cr.getDefaults(),Object.keys(W.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(zn(yn.getDefaults(),Object.keys($e.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,t=1){if(this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class ur extends or{constructor(){super(N(ur.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=N(ur.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Te(this,["oscillator","envelope"])}static getDefaults(){return qn(xs.getDefaults(),or.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const s=this.toSeconds(t),i=this.toFrequency(e instanceof At?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,s),this.oscillator.frequency.exponentialRampToValueAtTime(i,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Ht([Rd(0)],ur.prototype,"octaves",void 0);Ht([bs(0)],ur.prototype,"pitchDecay",void 0);const Pd=new Set;function Xc(n){Pd.add(n)}function Nd(n,e){const t=`registerProcessor("${n}", ${e})`;Pd.add(t)}const xx=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;Xc(xx);const kx=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;Xc(kx);const wx=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;Xc(wx);const Sx="feedback-comb-filter",bx=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Nd(Sx,bx);class hr extends Tn{constructor(){super(N(hr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=N(hr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(s=>{const i=parseInt(s,10);if(Q(zr(s)||Hs(i)&&isFinite(i),`url key is neither a note or midi pitch: ${s}`),zr(s)){const r=new At(this.context,s).toMidi();t[r]=e.urls[s]}else Hs(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new Gc({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Tn.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ce,onerror:ce,release:.1,urls:{}})}_findClosest(e){let s=0;for(;s<96;){if(this._buffers.has(e+s))return-s;if(this._buffers.has(e-s))return s;s++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,s=1){return this.log("triggerAttack",e,t,s),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=Dd(new At(this.context,i).toFrequency()),o=Math.round(r),a=r-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=Md(c+a),d=new ni({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,s),zt(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const f=this._activeSources.get(o),m=f.indexOf(d);m!==-1&&f.splice(m,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(s=>{const i=new At(this.context,s).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);t=this.toSeconds(t),r.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,s,i=1){const r=this.toSeconds(s);return this.triggerAttack(e,r,i),zt(t)?(Q(zt(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(t)),this}add(e,t,s){if(Q(zr(e)||isFinite(e),`note must be a pitch or midi: ${e}`),zr(e)){const i=new At(this.context,e).toMidi();this._buffers.add(i,t,s)}else this._buffers.add(e,t,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Ht([bs(0)],hr.prototype,"attack",void 0);Ht([bs(0)],hr.prototype,"release",void 0);class To extends W{constructor(){super(Object.assign(N(To.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Tx({context:this.context}),this.a=new pe({context:this.context,gain:0}),this.b=new pe({context:this.context,gain:0}),this.output=new pe({context:this.context}),this._internalChannels=[this.a,this.b];const e=N(To.getDefaults(),arguments,["fade"]);this.fade=new ve({context:this.context,units:"normalRange",value:e.fade}),Te(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",js(this._split,this.a.gain,0),js(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(W.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class ru extends W{constructor(e){super(e),this.name="Effect",this._dryWet=new To({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new pe({context:this.context}),this.effectReturn=new pe({context:this.context}),this.input=new pe({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Te(this,"wet")}static getDefaults(){return Object.assign(W.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class xo extends W{constructor(){super(Object.assign(N(xo.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=N(xo.getDefaults(),arguments,["pan"]);this.pan=new ue({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Te(this,"pan")}static getDefaults(){return Object.assign(W.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const Cx="bit-crusher",Ex=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Nd(Cx,Ex);class ko extends W{constructor(){super(N(ko.getDefaults(),arguments,["channels"])),this.name="Merge";const e=N(ko.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(W.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class wo extends ru{constructor(){super(N(wo.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=N(wo.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(ru.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Vt(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Vt(e,0),this._preDelay=e,this.generate()}generate(){return Fe(this,void 0,void 0,function*(){const e=this.ready,t=new Ho(2,this._decay+this._preDelay,this.context.sampleRate),s=new er({context:t}),i=new er({context:t}),r=new ko({context:t});s.connect(r,0,0),i.connect(r,0,1);const o=new pe({context:t}).toDestination();r.connect(o),s.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(ce),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Re extends W{constructor(){super(N(Re.getDefaults(),arguments,["solo"])),this.name="Solo";const e=N(Re.getDefaults(),arguments,["solo"]);this.input=this.output=new pe({context:this.context}),Re._allSolos.has(this.context)||Re._allSolos.set(this.context,new Set),Re._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(W.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Re._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Re._soloed.has(this.context)||Re._soloed.set(this.context,new Set),Re._soloed.get(this.context).add(this)}_removeSolo(){Re._soloed.has(this.context)&&Re._soloed.get(this.context).delete(this)}_isSoloed(){return Re._soloed.has(this.context)&&Re._soloed.get(this.context).has(this)}_noSolos(){return!Re._soloed.has(this.context)||Re._soloed.has(this.context)&&Re._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Re._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Re._allSolos=new Map;Re._soloed=new Map;class So extends W{constructor(){super(N(So.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=N(So.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new xo({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new qs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Te(this,["pan","volume"])}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class nn extends W{constructor(){super(N(nn.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=N(nn.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Re({solo:e.solo,context:this.context}),this._panVol=this.output=new So({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Te(this,["pan","volume"])}static getDefaults(){return Object.assign(W.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return nn.buses.has(e)||nn.buses.set(e,new pe({context:this.context})),nn.buses.get(e)}send(e,t=0){const s=this._getBus(e),i=new pe({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(s),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}nn.buses=new Map;class Ox extends W{constructor(){super(...arguments),this.name="Listener",this.positionX=new ue({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ue({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ue({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ue({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ue({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ue({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ue({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ue({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ue({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(W.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Bo(n=>{n.listener=new Ox({context:n})});Vo(n=>{n.listener.dispose()});Ut().transport;const $c=Ut().destination;Ut().destination;Ut().listener;Ut().draw;Ut();const Qc=new ri(900,"highpass"),Id=new qs(-6);Id.chain(Qc,$c);const Ax=new wo(3).connect(Id),Wo=new lr({envelope:{attack:0,decay:.9,sustain:.2,release:.1}});Wo.oscillator.type="triangle2";Wo.volume.value=-6;Wo.chain(Qc,$c);const Go=new lr({envelope:{attack:.4,decay:.9,sustain:.7,release:.6}}).connect(Ax);Go.oscillator.type="triangle";Go.volume.value=-6;Go.chain(Qc,$c);function Mx(){return Math.floor((Math.random()-.5)*20)}let ou=!1;const Dx=async(n=0)=>{ou||(await rx(),ou=!0);try{if(n>2e3)Go.triggerAttackRelease(60,.3);else if(n>1e3){let e=310;e+=Mx(),Wo.triggerAttackRelease(e,.001)}}catch(e){console.warn(e)}},Vr=1800,Rx=(n,e)=>n.clone().normalize().clone().negate().normalize().multiplyScalar(e).add(n);let Nn,Mi;const Px=4e3,Nx=2e3,Ix=n=>{const e=Jt(),t=Fs(T=>T.isUserDragging),s=Fs(T=>T.isUserScrolling),i=Fs(T=>T.setUserMovedCamera),{data:r,graphStyle:o,showSelectionGraph:a,setNearbyNodeIds:c,cameraFocusTrigger:l}=tt(T=>T),{camera:u}=ge(),[h,d]=E.useState(!1),[f,m]=E.useState(!1),[p,g]=E.useState(Ul),y=E.useMemo(()=>{if(a)return new K(0,0,0);const T=r==null?void 0:r.nodes.find(b=>b.ref_id===(e==null?void 0:e.ref_id));let k=new K(2e3,2e3,3e3);if(T&&r){const b=r==null?void 0:r.nodes.filter(P=>{var F;return(F=T.children)==null?void 0:F.find(I=>I===P.id)}),C=new K(T.x,T.y,T.z);let O=new K(0,0,0);b.map(P=>(O=O.add(new K(P.x,P.y,P.z).normalize()),P));const A=T.scale?1-1/(T.scale+10):1,R=C.sub(O).multiplyScalar(.8*A);k=C.add(R)}return k},[a,e,r]),w=E.useMemo(()=>{if(a)return new K(0,0,0);const T=r==null?void 0:r.nodes.find(k=>k.ref_id===(e==null?void 0:e.ref_id));return new K((T==null?void 0:T.x)||0,(T==null?void 0:T.y)||0,(T==null?void 0:T.z)||0)},[a,e,r]);E.useEffect(()=>{var T;a&&((T=n.current)==null||T.setLookAt(_a.x,_a.y,_a.z,0,0,0,!1)),S()},[a]),E.useEffect(()=>{a?g(N_):(e==null?void 0:e.node_type)==="topic"?g(P_):g(Ul)},[e,g,a]),E.useEffect(()=>{v()},[l]),E.useEffect(()=>{(t||s)&&(d(!0),m(!0))},[t,s,d,m]),E.useEffect(()=>{if(e)if(!a&&o==="earth"&&(n!=null&&n.current)){const T=n.current.camera.position.distanceTo(new K),k=Rx(w,-T/2);n.current.setLookAt(k.x,k.y,k.z,0,0,0,!0)}else Nn&&clearTimeout(Nn),Nn=setTimeout(()=>{m(!0),clearTimeout(Nn)},Nx),S();return()=>{Nn&&clearTimeout(Nn),Mi&&clearTimeout(Mi)}},[e]),kt(T=>{n.current&&(h||_(y,T.camera),f||x(w,T.camera))});const S=()=>{if(e){const T=u.position.distanceTo(y);Dx(T)}v()},v=()=>{d(!1),m(!1),i(!1),Mi&&clearTimeout(Mi),Mi=setTimeout(()=>{d(!0),m(!0)},Px)},_=(T,k)=>{if(k.position.distanceTo(T)<p)d(!0);else{k.position.lerp(T,.5);const C=xc((r==null?void 0:r.nodes)||[],u);C&&c(C)}},x=(T,k)=>{var b;(b=n==null?void 0:n.current)==null||b.setLookAt(k.position.x,k.position.y,k.position.z,T.x,T.y,T.z,!0)};return null},Fx=1;let cs=null;const Ux=(n,{enabled:e})=>{const t=Jt();Ix(n);const s=Fs(u=>u.isUserDragging),{graphStyle:i,data:r,setNearbyNodeIds:o,graphRadius:a,disableCameraRotation:c}=tt(u=>u);E.useEffect(()=>{e||(cs==null||cs.kill(),cs=null)},[e]);const l=E.useCallback(()=>{cs==null||cs.kill();const u={value:-244},h=Tc.to(u,{duration:5,keyframes:{"0%":{value:10},"100%":{delay:2,ease:"Power4.easeIn",value:-200}},onComplete:()=>{cs=null},onInterrupt(){h.kill()},onUpdate:()=>{var f;const{value:d}=u;if(n.current){const m=xc((r==null?void 0:r.nodes)||[],n.current.camera);m&&o(m),(f=n.current)==null||f.dolly(d,!1)}}});h.play(),cs=h},[]);return E.useEffect(()=>{n.current&&a&&(i==="sphere"?(n.current.maxDistance=8e3,n.current.minDistance=200,n.current.setTarget(0,0,500,!0)):(n.current.maxDistance=n.current.getDistanceToFitSphere(a+200),n.current.minDistance=100))},[a,i,n]),E.useEffect(()=>{l()},[l,i]),E.useEffect(()=>{!t&&n.current&&n.current.setLookAt(ps.x,ps.y,ps.z,0,0,0,!0)},[t]),kt((u,h)=>{n.current&&(!c&&!s&&(n.current.azimuthAngle+=Fx*h*qf.DEG2RAD),n.current.update(h))}),null},Lx=({disableAnimations:n})=>{const e=E.useRef(null),{graphStyle:t,data:s,setNearbyNodeIds:i,setDisableCameraRotation:r}=tt(d=>d),[o]=E.useState(.8),{camera:a}=ge(),[c,l,u,h]=Fs(d=>[d.isUserDragging,d.setIsUserDragging,d.isUserScrolling,d.isUserScrollingOnHtmlPanel]);return Ux(e,{enabled:!n&&!u&&!c}),E.useEffect(()=>{e.current&&e.current.setLookAt(ps.x,ps.y,ps.z,0,0,0,!0)},[t]),E.useEffect(()=>{if(!c){const d=xc((s==null?void 0:s.nodes)||[],a);d&&i(d)}},[a,a.position,a.position.x,a.position.y,a.position.z,s==null?void 0:s.nodes,i,c]),E.useEffect(()=>{c&&r(!0)},[c,r]),D.jsx(vp,{ref:e,boundaryEnclosesCamera:!0,enabled:!h,makeDefault:!0,maxDistance:12e3,minDistance:100,onEnd:()=>l(!1),onStart:()=>l(!0),smoothTime:o})},Fd=E.memo(({linksPositions:n})=>{const e=oi(r=>r.dataInitial),{showSelectionGraph:t}=tt(r=>r),s=Jt(),i=E.useRef([]);return E.useEffect(()=>{i.current.forEach((r,o)=>{if(r){const a=s?0:.5,c=(s==null?void 0:s.ref_id)===(e==null?void 0:e.links[o].source)||(s==null?void 0:s.ref_id)===(e==null?void 0:e.links[o].target);Tc.fromTo(r.material,{linewidth:5},{linewidth:c?2:a,duration:1})}})},[e,s]),D.jsx("group",{name:"simulation-3d-group__connections",children:e==null?void 0:e.links.map((r,o)=>{var l,u,h,d,f,m;const a=new K(((l=n[o])==null?void 0:l.sx)||0,((u=n[o])==null?void 0:u.sy)||0,((h=n[o])==null?void 0:h.sz)||0),c=new K(((d=n[o])==null?void 0:d.tx)||0,((f=n[o])==null?void 0:f.ty)||0,((m=n[o])==null?void 0:m.tz)||0);return D.jsx(mf,{ref:p=>{i.current[o]=p},color:"rgba(136, 136, 136, 1)",isLine2:!0,lineWidth:1,opacity:1,points:[a,c],transparent:!0,visible:!t},r.ref_id)})})});Fd.displayName="Connections";const Yo={metalness:.9,roughness:0},zx={...Yo};new fr(zx);const Ud=new Eo,bo=Ud.load("noimage.jpeg"),au=new fr({...Yo,map:bo}),Ld=.4,Bx=new fr({...Yo,map:bo,transparent:!0,opacity:Ld}),Hr={},Vx=(n,e)=>{const[t,s]=E.useState(bo),[i,r]=E.useState(au);return E.useEffect(()=>{const o=`${n}${e&&"-transparent"}`;if(Hr[o]){s(Hr[o].texture),r(Hr[o].material);return}Ud.load(n,a=>{const c=new fr({map:a,transparent:e,opacity:e?Ld:1,...Yo});Hr[o]={texture:a,material:c},s(a),r(c)},void 0,()=>{s(bo),r(e?Bx:au)})},[n,e]),E.useEffect(()=>function(){t.dispose(),i.dispose()},[t,i]),i},Kc=E.memo(({node:n,hide:e,animated:t})=>{const s=E.useRef(null),[i]=E.useState(Fl),r=Jt(),{showSelectionGraph:o}=tt(u=>u),a=!!r&&n.ref_id===r.ref_id,c=Vx(n.image_url||"noimage.jpeg",!1);kt((u,h)=>{t&&s.current&&a&&(s.current.rotation.y+=h*1,s.current.rotation.x-=h*.6)}),E.useEffect(()=>function(){i.dispose()},[i]);const l=E.useMemo(()=>o&&a?20:a?(n.scale||1)*1.2:n.scale,[n,a,o]);return D.jsx(Cp,{enabled:!!a,children:D.jsx("mesh",{ref:s,geometry:Fl,material:c,name:n.id,scale:l,userData:n,visible:!e})})});Kc.displayName="Cube";const Hx=Pt(ai)`
  text-align: center;
  width: ${n=>n.type==="topic"?"auto":`${n.size}px`};
  height: ${n=>n.type==="topic"?"auto":`${n.size}px`};
  outline: 1px solid ${n=>_t.white||n.color};
  outline-offset: 0px;
  background: rgba(0, 0, 0, 0.75);
  color: ${n=>n.fontColor};
  border-radius: ${n=>`${n.type==="guest"?"100%":"6px"}`};
  font-size: ${n=>`${n.fontSize}px`};
  cursor: pointer;
  transition: font-size 0.4s, outline 0.4s;
  transform: scale(${n=>n.scale});
  align-items: center;
  justify-content: center;
  font-family: Barlow;
  font-size: 26px;
  font-style: normal;
  font-weight: 700;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);

  &:hover {
    outline-offset: 4px;
  }

  &.selected {
    .badge-wrapper {
      top: 0;
    }

    font-size: 36px;

    &:hover {
      outline-offset: 0px;
    }
  }

  &.topic {
    outline: none;
    background: none;
    &:hover {
      font-size: 36px;
    }
    white-space: nowrap;
    .badge-wrapper {
      display: none;
    }
  }

  .badge-wrapper {
    position: absolute;
    top: -7px;
    left: -14px;
  }
`,jx=Pt(ai)`
  text-align: center;
  outline: 1px solid ${_t.white};
  outline-offset: 0px;
  white-space: nowrap;
  padding: 4px;
  background: rgba(0, 0, 0, 0.75);
  color: ${_t.white};
  border-radius: 6px;
  font-size: 20px;
  cursor: pointer;
  transition: font-size 0.4s, outline 0.4s;
  align-items: center;
  justify-content: flex-start;
  font-family: Barlow;
  font-size: 26px;
  font-style: normal;
  font-weight: 700;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  max-width: 100px;
  max-height: 100px;
  white-space: normal;
  font-size: 16px;

  &:hover {
    outline-offset: 4px;
  }

  &.selected {
    .badge-wrapper {
      top: 0;
    }

    font-size: 36px;

    &:hover {
      outline-offset: 0px;
    }
  }

  &.topic {
    outline: none;
    background: none;
    &:hover {
      font-size: 36px;
    }
    white-space: nowrap;
    .badge-wrapper {
      display: none;
    }
  }

  .badge-wrapper {
    position: absolute;
    top: -7px;
    left: -14px;
  }
`;Pt.img`
  background-image: ${({src:n})=>`url(${n})`};
  background-size: contain;
  background-repeat: no-repeat;
  width: ${n=>n.size}px;
  height: ${n=>n.size}px;
  border-radius: ${n=>n.borderRadius};
`;Pt.div`
  display: flex;
  position: absolute;
  bottom: -14px;
  left: -5px;
  width: auto;
  justify-content: center;
  align-items: center;
`;Pt.div`
  display: flex;
  justify-content: center;
  align-items: center;
  background: ${_t.transparentBlack};
  border: 2px solid ${n=>n.color};
  color: #fff;
  padding: 0 4px;
  min-width: 30px;
  height: 26px;
  font-size: 12px;
  font-weight: 500;
  border-radius: 6px;
  margin-right: 5px;
`;Pt.div`
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid ${n=>n.color}44;
  background: ${_t.transparentBlack};
  padding: 0 4px;
  color: ${n=>n.color};
  min-width: 30px;
  height: 26px;
  font-size: 12px;
  font-weight: 500;
  border-radius: 6px;
  margin-right: 5px;
`;const qx=new K,Wx=({position:n,userData:e,color:t})=>{const s=E.useRef(null),{selectedNode:i,setSelectedNode:r,showSelectionGraph:o,hoveredNode:a,setHoveredNode:c}=tt(ec(f=>f)),l=((e==null?void 0:e.node_type)||"")==="Topic"||!!e.name,u=((e==null?void 0:e.node_type)||"")==="Guest"||((e==null?void 0:e.node_type)||"")==="Person";kt(()=>{if(o&&s.current){const f=qx.set((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0);s.current.position.copy(f)}}),E.useEffect(()=>function(){s.current&&s.current.clear()},[s]);const h=E.useMemo(()=>(a==null?void 0:a.ref_id)===(e==null?void 0:e.ref_id),[a==null?void 0:a.ref_id,e==null?void 0:e.ref_id]),d=(i==null?void 0:i.ref_id)===(e==null?void 0:e.ref_id);return l||d&&o||!d?D.jsx("group",{ref:s,position:n,children:D.jsx(dr,{center:!0,sprite:!0,zIndexRange:[0,0],children:l?D.jsxs(jx,{direction:"column",onClick:f=>{f.stopPropagation(),e&&r(e)},onPointerOut:f=>{f.stopPropagation()},onPointerOver:f=>{f.stopPropagation()},children:[D.jsx("div",{className:"badge-wrapper",children:D.jsx(sl,{type:(e==null?void 0:e.node_type)||""})}),fu(e==null?void 0:e.name,20)]}):D.jsxs(Hx,{className:Zd(e==null?void 0:e.node_type,{selected:d}),color:t,fontColor:_t.white,fontSize:l?64:20,onClick:f=>{f.stopPropagation(),e&&r(e)},onPointerOut:f=>{f.stopPropagation()},onPointerOver:f=>{f.stopPropagation()},scale:h?1.05:1,selected:!1,size:d?68:40,type:(e==null?void 0:e.node_type)||"",children:[!u&&!l?D.jsx("div",{className:"badge-wrapper",children:D.jsx(sl,{type:(e==null?void 0:e.node_type)||""})}):null,e!=null&&e.name?e==null?void 0:e.name:D.jsx(Wf,{rounded:u,size:d?60:52,src:(e==null?void 0:e.image_url)||"audio_default.svg",type:e==null?void 0:e.node_type})]})})}):null},zd=E.memo(()=>{const{simulation:n,showSelectionGraph:e,selectedNode:t,selectionGraphData:s}=tt(ec(o=>o)),i=Co(),r=E.useMemo(()=>{const o=(n==null?void 0:n.nodes())||[];return(e?s.nodes:o).filter(u=>i.includes((u==null?void 0:u.ref_id)||"")||(t==null?void 0:t.ref_id)===(u==null?void 0:u.ref_id)).slice(0,M_).map(u=>{const h=du(u.node_type||"",!0),d=new K((u==null?void 0:u.x)||0,(u==null?void 0:u.y)||0,(u==null?void 0:u.z)||0),f=o.filter(m=>m.ref_id&&D_(m,u)).map(m=>(m==null?void 0:m.ref_id)||"")||[];return D.jsx(Wx,{color:h,position:d,relativeIds:f,userData:u},`node-badge-${u.ref_id}`)})},[n,e,s.nodes,i,t==null?void 0:t.ref_id]);return D.jsx(E.Fragment,{children:r.length?r:null},"node-badges")});zd.displayName="RelevanceBadges";const cu=Xd().stop(),ft={numDimensions:3,velocityDecay:.9,forceChargeStrength:-20,forceChargeMinDistance:10,forceChargeMaxDistance:8e3,forceLinkStrength:.04,forceCenterStrength:.85,disableCollide:!1,disableCenter:!1,disableLink:!1,disableCharge:!1,forceCollideRadiusMethod:n=>(n.edge_count||1)*6+200,forceLinkDistanceMethod:n=>{const e=n.source.node_type;let t=50;switch(e){case"topic":t=30;break;case"guest":t=30;break;case"clip":t=10;break;case"episode":t=15;break}return t*2/50}},Gx=(n,e,{numDimensions:t=ft.numDimensions,velocityDecay:s=ft.velocityDecay,forceChargeStrength:i=ft.forceChargeStrength,forceChargeMinDistance:r=ft.forceChargeMinDistance,forceChargeMaxDistance:o=ft.forceChargeMaxDistance,forceLinkStrength:a=ft.forceLinkStrength,forceCenterStrength:c=ft.forceCenterStrength,forceLinkDistanceMethod:l=ft.forceLinkDistanceMethod,forceCollideRadiusMethod:u=ft.forceCollideRadiusMethod,disableCollide:h=ft.disableCollide,disableCenter:d=ft.disableCenter,disableLink:f=ft.disableLink,disableCharge:m=ft.disableCharge})=>(cu.alpha(1).stop().numDimensions(t).velocityDecay(s).force("collide",h?null:$d().radius(u).iterations(1)).force("center",d?null:Qd().strength(c)).force("charge",m?null:Kd().strength(i).distanceMin(r).distanceMax(o)).nodes(n).force("link",f?null:Jd(e).id(p=>p.ref_id).distance(l).strength(a)).alpha(1).restart(),cu),Yx=({link:n,animated:e})=>{const t=E.useRef(null),s=Jt(),[i,r]=E.useState(new K(0,0,0)),[o,a]=E.useState(new K(0,0,0)),[c,l]=E.useState(8947848),u=tt(h=>h.selectionGraphData);return E.useEffect(()=>{var f,m,p,g,y,w;const h=(s==null?void 0:s.ref_id)||"",d=s&&(h===n.target||h===n.source);!n.onlyVisibleOnSelect||d?(r(new K(((f=n.sourcePosition)==null?void 0:f.x)||0,((m=n.sourcePosition)==null?void 0:m.y)||0,((p=n.sourcePosition)==null?void 0:p.z)||0)),a(new K(((g=n.targetPosition)==null?void 0:g.x)||0,((y=n.targetPosition)==null?void 0:y.y)||0,((w=n.targetPosition)==null?void 0:w.z)||0))):(r(new K(0,0,0)),a(new K(0,0,0))),l(d?n.color||ef.children.segmentColor:s?5592405:8947848)},[s,n]),kt(()=>{if(e&&t.current){const h=u.nodes.find(f=>f.ref_id===n.source),d=u.nodes.find(f=>f.ref_id===n.target);t.current.start.set((h==null?void 0:h.x)||0,(h==null?void 0:h.y)||0,(h==null?void 0:h.z)||0),t.current.end.set((d==null?void 0:d.x)||0,(d==null?void 0:d.y)||0,(d==null?void 0:d.z)||0)}}),D.jsx(D.Fragment,{children:D.jsx(xp,{ref:t,color:"0xFFFFFF",end:o,start:i})})},Zx=({links:n,simulation:e})=>{const t=E.useRef(null);return E.useEffect(()=>function(){t.current&&t.current.clear()},[t]),kt(()=>{if(t.current){const s=e.nodes();t.current.children.forEach((r,o)=>{var u;const a=n[o],c=s.find(h=>a.source===h.ref_id),l=s.find(h=>a.target===h.ref_id);(u=r.position)==null||u.set((c.x+l.x)/2,(c.y+l.y)/2,(c.z+l.z)/2)})}}),n.length?D.jsx("group",{ref:t,children:n.map(s=>D.jsx("mesh",{children:D.jsx(dr,{center:!0,sprite:!0,children:D.jsxs(Xx,{direction:"row",justify:"center",onClick:i=>{i.stopPropagation()},onPointerOut:i=>{i.stopPropagation()},onPointerOver:i=>{i.stopPropagation()},children:[D.jsx("span",{children:s.edge_type}),D.jsx(ai,{className:"icon",onClick:()=>console.log(123),children:D.jsx(Gf,{})})]})})},s.ref_id))}):null},Xx=Pt(ai)`
  text-align: center;

  outline-offset: 0px;
  background: rgba(0, 0, 0, 0.75);
  color: #eee;
  cursor: pointer;
  transition: font-size 0.4s, outline 0.4s;
  align-items: center;
  justify-content: center;
  font-family: Barlow;
  font-size: 12px;
  font-style: normal;
  font-weight: 700;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);

  &:hover {
    outline-offset: 4px;
    span {
      opacity: 0.1;
    }

    .icon {
      display: flex;
    }
  }

  .icon {
    position: absolute;
    width: 24px;
    height: 24px;
    /* bottom: 100%; */
    display: none;
    color: #000;
    border-radius: 40px;
    justify-content: center;
    align-items: center;
    background: #ffffff;
    color: #000;
    border-radius: 100%;
    font-size: 16px;
    cursor: pointer;
    transition: opacity 0.4s;
    box-shadow: 0px 2px 12px rgba(0, 0, 0, 0.5);
  }

  .badge-wrapper {
    position: absolute;
    top: -7px;
    left: -14px;
  }
`,$x=["#fff","#9747FF","#00887A","#0098A6","#0288D1","#33691E","#465A65","#512DA7","#5C6BC0","#5D4038","#662C00","#689F39","#6B1B00","#750000","#78909C","#7E57C2","#8C6E63","#AA47BC","#BF360C","#C2175B","#EC407A","#EF6C00","#F5511E","#FF9696","#FFC064","#FFCD29","#FFEA60"],Jc=E.memo(({node:n,hide:e})=>{const t=E.useRef(null),s=Jt(),r=Co().includes((n==null?void 0:n.ref_id)||""),o=!!s&&(s==null?void 0:s.ref_id)===n.ref_id,a=tt(h=>h.showSelectionGraph),c=tf();kt(({camera:h})=>{t!=null&&t.current&&t.current.quaternion.copy(h.quaternion)}),E.useMemo(()=>{let h=(n.edge_count||30)*4;return a&&o?h=40:!o&&r&&(h=0),h},[n.edge_count,o,r,a]);const l=E.useMemo(()=>s&&s.node_type==="Topic"&&!o?.2:1,[o,s]),u=$x[c.indexOf(n.node_type)]||_t.white;return D.jsx(D.Fragment,{children:D.jsx(_f,{ref:t,anchorX:"center",anchorY:"middle",color:u,fillOpacity:l,scale:20,userData:n,visible:!e,...gf,children:fu(n.name,10)})})});Jc.displayName="TextNode";const Bd=E.memo(()=>{const[n,e]=E.useState(null),{dataInitial:t}=oi(l=>l),s=Jt(),i=E.useRef(null),r=Co(),o=vf(t==null?void 0:t.nodes.length),{selectionGraphData:a,setSelectionData:c}=tt(ec(l=>l));return E.useEffect(()=>{const l=structuredClone((t==null?void 0:t.nodes)||[]),u=structuredClone((t==null?void 0:t.links)||[]);if(o===l.length||!r.length)return;const h=l.filter(d=>d.ref_id===(s==null?void 0:s.ref_id)||r.includes((d==null?void 0:d.ref_id)||"")).map(d=>{const f=d.ref_id===(s==null?void 0:s.ref_id)?{fx:0,fy:0,fz:0}:{};return{...d,x:0,y:0,z:0,...f}});if(h){const d=u.filter(f=>h.some(m=>m.ref_id===f.target)&&h.some(m=>m.ref_id===f.source));c({nodes:h,links:d})}},[t,s,r,c,o]),E.useEffect(()=>{if(n||!a.nodes.length)return;const l=structuredClone(a.links),u=Gx(a.nodes,l,{numDimensions:2,forceLinkStrength:.01,forceCenterStrength:.85,forceChargeStrength:-20,velocityDecay:.9});e(u)},[a,n]),E.useEffect(()=>()=>{c({nodes:[],links:[]})},[c]),kt(()=>{}),E.useEffect(()=>{n&&n.on("tick",()=>{i.current&&i.current.children.forEach((u,h)=>{const d=n.nodes()[h];d&&u.position.set(d.x,d.y,d.z)})})},[n]),D.jsxs(D.Fragment,{children:[D.jsx("group",{ref:i,name:"simulation-2d-group",children:a==null?void 0:a.nodes.map(l=>D.jsx("mesh",{children:l.name?D.jsx(Jc,{hide:!0,node:l},l.ref_id||l.id):D.jsx(Kc,{hide:!0,node:l},l.ref_id||l.id)},l.ref_id))}),D.jsx(yp,{fog:!0,lineWidth:.9,children:(a==null?void 0:a.links).map((l,u)=>D.jsx(Yx,{animated:!0,link:l},u.toString()))},`selection-links-${a==null?void 0:a.links.length}`),n&&D.jsx(Zx,{links:a.links,simulation:n})]})});Bd.displayName="SelectionDataNodes";const Vd=E.memo(()=>{const n=Jt(),e=Co(),{selectionGraphData:t,showSelectionGraph:s,setHoveredNode:i}=tt(d=>d),r=oi(d=>d.dataInitial),o=hu(d=>d.setTranscriptOpen),a=E.useCallback(d=>!!(s&&!t.nodes.find(f=>f.ref_id===d.ref_id)),[s,t]),c=E.useCallback(d=>{const f=d==null?void 0:d[0];f&&(o(!1),f.userData&&(a(f.userData)||tt.getState().setSelectedNode((f==null?void 0:f.userData)||null)))},[o,a]),l=E.useCallback(d=>{d.stopPropagation()},[i]),u=E.useCallback(d=>{var p;const m=d.intersections.map(g=>g.object)[0];if((p=m==null?void 0:m.userData)!=null&&p.ref_id){const g=m.userData;a(g)||(d.stopPropagation(),i(g))}},[i,a]),h=s&&!!n;return D.jsxs(fp,{filter:d=>d.filter(f=>{var m;return!!((m=f.userData)!=null&&m.ref_id)}),onChange:c,onPointerOut:l,onPointerOver:u,children:[!1,D.jsx(zd,{}),D.jsx("group",{name:"simulation-3d-group__nodes",children:r==null?void 0:r.nodes.map(d=>{const f=!!n&&(e.includes(d.ref_id)||n.ref_id===d.ref_id);return D.jsx("mesh",{children:d.name?D.jsx(Jc,{hide:h||f,node:d},d.ref_id||d.id):D.jsx(Kc,{hide:h,node:d},d.ref_id||d.id)},d.ref_id)})}),h&&D.jsx(Bd,{})]})});Vd.displayName="Cubes";const Qx={earthRef:null},Kx=uu(n=>({...Qx,setEarthRef:e=>n({earthRef:e})})),Jx=new K(0,0,0),ek=()=>{const n=E.useRef(null),e=E.useRef(null),{graphStyle:t,showSelectionGraph:s}=tt(a=>a),i=Kx(a=>a.setEarthRef),r=an("textures/earth/galaxy.png"),o=an("textures/earth/clouds.png");return kt(({camera:a})=>{e.current&&e.current.position.copy(a.getWorldPosition(Jx))}),E.useLayoutEffect(()=>{n.current&&i(n)},[i]),t!=="earth"||s?null:D.jsxs(D.Fragment,{children:[D.jsxs("mesh",{ref:n,userData:{type:"earth"},children:[D.jsx("sphereGeometry",{args:[Vr,200,200]}),D.jsx(tk,{})]}),D.jsxs("mesh",{children:[D.jsx("sphereGeometry",{args:[Vr+2,200,200]}),D.jsx("meshStandardMaterial",{alphaMap:o,map:o,transparent:!0})]}),D.jsxs("mesh",{children:[D.jsx("sphereGeometry",{args:[Vr*4,200,200]}),D.jsx("meshStandardMaterial",{map:r,opacity:.4,side:Ri,transparent:!0})]}),D.jsx("directionalLight",{ref:e,intensity:.9,position:[0,0,Vr*3]})]})},tk=()=>{const n=an("textures/earth/earth.jpeg"),e=an("textures/earth/bump.jpeg"),t=an("textures/earth/water.png"),s=E.useMemo(()=>new fr({map:n,bumpMap:e,aoMap:e,roughnessMap:e,metalnessMap:t,toneMapped:!0,roughness:35,metalness:0}),[n,e,t]);return D.jsx("meshStandardMaterial",{...s})},sk="C",nk=256,ik=256,rk={g:"LottieFiles AE 0.1.20"},ok=[{ty:0,nm:"I",sr:1,st:0,op:26,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_0",ind:1},{ty:0,nm:"I",sr:1,st:26,op:52,ip:26,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_1",ind:2},{ty:0,nm:"I",sr:1,st:52,op:78,ip:52,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_2",ind:3},{ty:0,nm:"I",sr:1,st:78,op:108,ip:78,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_3",ind:4}],ak="5.5.7",ck=60,lk=104,uk=0,hk=[{nm:"",id:"comp_0",layers:[{ty:4,nm:"I",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.656,.016],[0,20],[-34.641,0],[.016,-19.984]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[51.962,10],[17.321,30],[17.321,-10],[51.962,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,-9.984],[17.32,10],[17.32,-30],[-17.32,-50.016]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,30],[17.32,50],[17.305,10],[-17.32,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.321,10],[-51.962,30],[-51.962,-10],[-17.321,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[0,20],[-34.641,0],[0,-20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:1}]},{nm:"",id:"comp_1",layers:[{ty:4,nm:"R",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:0}},ef:[],shapes:[],ind:1},{ty:4,nm:"S",sr:1,st:-20,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,-10.016],[-17.32,-30],[17.32,-50],[51.961,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:2,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[.015,-20],[0,20],[34.641,40]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:3,parent:1},{ty:4,nm:"S",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,-10.016],[-17.32,-30],[17.32,-50],[51.961,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:4,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:33,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.324,30],[-17.34,-9.984],[17.336,-30.016],[17.336,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:5,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:35,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[.015,-20],[0,20],[34.641,40]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:6,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.324,30],[-17.34,-9.984],[17.336,-30.016],[17.336,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:7,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.305,30],[-17.336,-9.984],[17.336,-30.016],[17.32,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:8,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[.016,-20.016],[-34.643,-40],[-34.641,.016],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:9,parent:1},{ty:4,nm:"S",sr:1,st:-20,op:31,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,-10],[17.321,30],[-17.321,10],[-17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.305,50],[-51.961,30],[-17.321,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:10,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:34,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.305,30],[-17.336,-9.984],[17.336,-30.016],[17.32,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:11,parent:1},{ty:4,nm:"S",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,-10],[17.321,30],[-17.321,10],[-17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.305,50],[-51.961,30],[-17.321,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:12,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[.016,-20.016],[-34.643,-40],[-34.641,.016],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:13,parent:1}]},{nm:"",id:"comp_2",layers:[{ty:4,nm:"R",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:0}},ef:[],shapes:[],ind:1},{ty:4,nm:"T",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-34.656,.031],[.047,-19.969],[34.652,.031],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:2,parent:1},{ty:4,nm:"S",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[17.32,-9.984],[17.32,-50],[-17.32,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:3,parent:1},{ty:4,nm:"F",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.321,30],[-51.962,10],[-51.962,-30],[-17.321,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:4,parent:1},{ty:4,nm:"S",sr:1,st:0,op:30,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[17.32,-9.984],[17.32,-50],[-17.32,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:5,parent:1},{ty:4,nm:"F",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[51.962,30],[17.321,10],[17.321,-30],[51.962,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:6,parent:1},{ty:4,nm:"S",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,50],[17.32,30],[17.336,-10],[-17.336,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:7,parent:1},{ty:4,nm:"F",sr:1,st:0,op:30,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[51.962,30],[17.321,10],[17.321,-30],[51.962,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:8,parent:1},{ty:4,nm:"T",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-34.656,0],[.015,-20],[34.656,0],[.012,20.062]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:9,parent:1}]},{nm:"",id:"comp_3",layers:[{ty:4,nm:"R",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:0}},ef:[],shapes:[],ind:1},{ty:4,nm:"S",sr:1,st:0,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-10],[-17.32,-30.016],[-51.961,-10],[-17.305,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:2,parent:1},{ty:4,nm:"T",sr:1,st:0,op:32,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[.015,60.016],[-34.642,40],[-34.641,0],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:3,parent:1},{ty:4,nm:"S",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[-17.32,-30],[17.32,-10],[17.32,30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.312,-10],[-17.313,10],[17.332,30],[51.977,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:4,parent:1},{ty:4,nm:"F",sr:1,st:0,op:32,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-29.984],[17.348,10],[-17.305,30],[-17.305,-9.984]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:5,parent:1},{ty:4,nm:"F",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-30],[17.32,10],[-17.32,30],[-17.336,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:6,parent:1},{ty:4,nm:"S",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-10],[-17.32,-30.016],[-51.961,-10],[-17.305,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:7,parent:1},{ty:4,nm:"T",sr:1,st:0,op:32,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[0,-20],[0,-60.016],[34.641,-40]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:8,parent:1},{ty:4,nm:"S",sr:1,st:0,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[-17.32,-30],[17.32,-10],[17.32,30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.312,-10],[-17.313,10],[17.332,30],[51.977,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:9,parent:1},{ty:4,nm:"F",sr:1,st:0,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-30],[17.32,10],[-17.32,30],[-17.336,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:10,parent:1}]}],dk={nm:sk,h:nk,w:ik,meta:rk,layers:ok,v:ak,fr:ck,op:lk,ip:uk,assets:hk},fk=({meshId:n})=>{const e=E.useRef(null);return E.useEffect(()=>{const t=document.getElementById(`lottie-animation-${n}`);return t&&(e.current=sf.loadAnimation({container:t,animationData:dk,loop:!0,autoplay:!0})),()=>{e.current&&e.current.destroy()}},[n]),D.jsx("div",{id:`lottie-animation-${n}`,style:{width:"2em",height:"2em"}})},ya=()=>Math.floor(Math.random()*2001)-1e3,pk=()=>D.jsx(D.Fragment,{children:["a","b","c"].map(n=>{const e=ya(),t=ya(),s=ya();return D.jsx("mesh",{position:[e,t,s],children:D.jsx(dr,{center:!0,sprite:!0,children:D.jsx(mk,{children:D.jsx(fk,{meshId:n})})})},n)})}),mk=Pt.div`
  border: 2px solid white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
`;Object.values(yf).map(n=>n);const _k=n=>D.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:D.jsx("g",{id:"Type=Edit, Size=20x20",children:D.jsx("path",{id:"icon","fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.9243 3.3359L9.06461 9.19559C8.97523 9.28497 8.9036 9.39048 8.85353 9.50654L7.99772 11.49C7.89015 11.7394 8.14272 11.9919 8.39203 11.8843L10.3755 11.0285C10.4916 10.9785 10.5971 10.9068 10.6865 10.8175L16.5462 4.95777C16.994 4.50991 16.994 3.78377 16.5462 3.3359C16.0983 2.88804 15.3722 2.88804 14.9243 3.3359ZM14.5297 10.7363C14.5297 10.3876 14.8127 10.1047 15.1615 10.1047C15.5116 10.1047 15.7933 10.3889 15.7933 10.7363L15.7222 14.1051C15.7222 15.1499 14.8954 16 13.8506 16H5.87166C4.85054 16 4 15.1499 4 14.0814V6.0806C4 5.05918 4.85054 4.2091 5.87166 4.2091L9.68606 4.20936C10.0362 4.20936 10.3178 4.49228 10.3178 4.841C10.3178 5.18972 10.0349 5.47264 9.68606 5.47264H5.89535C5.54735 5.47264 5.26357 5.75609 5.26357 6.10428V14.1051C5.26357 14.4533 5.54735 14.7367 5.89535 14.7367H13.898C14.246 14.7367 14.5297 14.4533 14.5297 14.1051V10.7363Z",fill:"currentColor"})})}),Di=n=>({close:{backgroundColor:"rgba(48, 51, 66, 1)",borderColor:"#fff",fontColor:"rgba(255, 255, 255, 1)"},focus:{backgroundColor:n?"rgba(255, 255, 255, 0.90);":"rgba(255, 255, 255, 0.90)",borderColor:n?"#FFDB58bb":"#fff",fontColor:"rgba(48, 51, 66, 1)"},menu:{backgroundColor:"#00000066",borderColor:n?"#ffffff66":"#5078f2",fontColor:n?"#ffffff66":"#fff"}}),gk=new K,Hd=E.memo(()=>{const n=E.useRef(null),e=hu(_=>_.setSidebarOpen),[t,s]=Zr.useState(null),{open:i}=Xo("editNodeName"),{open:r}=Xo("addEdgeToNode"),{open:o}=Xo("mergeToNode"),[a]=nf(_=>[_.isAdmin]),[c]=oi(_=>[_.addNewNode]),l=Jt(),{showSelectionGraph:u,selectionGraphData:h,setSelectedNode:d,setShowSelectionGraph:f}=tt(_=>_),m=Yf(),p=E.useCallback(async()=>{try{if(l!=null&&l.ref_id){const _=await rf(l==null?void 0:l.ref_id,h.nodes.length||0);_&&c(_)}}catch(_){console.log(_)}},[c,l==null?void 0:l.ref_id,h.nodes.length]);kt(()=>{g()});const g=E.useCallback(()=>{const _=u?h:m;if(n.current){const x=_==null?void 0:_.nodes.find(T=>T.ref_id===(l==null?void 0:l.ref_id));if(x){const T=gk.set(x==null?void 0:x.x,x==null?void 0:x.y,x==null?void 0:x.z);n.current.position.copy(T)}}},[l,u,h,m]),y=E.useMemo(()=>{const _=a?[{key:"control-key-1",colors:Di(u).focus,icon:D.jsx($f,{}),left:-80,className:"add",onClick:T=>{s(T.currentTarget)}},{key:"control-key-2",colors:Di(u).focus,icon:D.jsx(_k,{}),left:-40,className:"edit",onClick:()=>{i()}}]:[],x=[{key:"control-key-4",colors:Di(u).focus,icon:D.jsx(Qf,{}),left:0,className:"expand",onClick:()=>{const T=!u;f(T),T&&e(!0)}},{key:"control-key-5",colors:Di(!0).close,icon:D.jsx(of,{}),left:40,className:"exit",onClick:()=>{p()}},{key:"control-key-6",colors:Di(!0).close,icon:D.jsx(Kf,{}),left:40,className:"exit",onClick:()=>{f(!1),d(null)}}];return[..._,...x].map((T,k)=>({...T,left:-80+k*40}))},[a,u,i,f,e,p,d]);if(!l)return null;const w=()=>{s(null)},S=!!t,v=S?"simple-popover":void 0;return D.jsx("group",{ref:n,children:D.jsxs(dr,{center:!0,className:"control-panel",onClick:_=>_.stopPropagation(),onKeyDown:_=>_.stopPropagation(),onPointerDown:_=>_.stopPropagation(),onPointerOut:_=>_.stopPropagation(),onPointerOver:_=>_.stopPropagation(),onPointerUp:_=>_.stopPropagation(),sprite:!0,zIndexRange:[16777271,16777272],children:[y.map(_=>D.jsx(vk,{backgroundColor:_.colors.backgroundColor,borderColor:_.colors.borderColor,className:_.className,fontColor:_.colors.fontColor,left:_.left,onClick:x=>{x.stopPropagation(),_.onClick(x)},children:_.icon},_.key)),D.jsxs(yk,{anchorEl:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},id:v,onClose:w,open:S,transformOrigin:{vertical:"top",horizontal:"right"},children:[D.jsxs(lu,{"data-testid":"merge",onClick:()=>{o(),w()},children:[D.jsx(Zf,{"data-testid":"MergeIcon"})," Merge"]}),D.jsxs(lu,{"data-testid":"add_edge",onClick:()=>{r(),w()},children:[D.jsx(Xf,{"data-testid":"AddCircleIcon"})," Add edge"]})]})]})})});Hd.displayName="NodeControls";const vk=Pt.div`
  position: fixed;
  top: -60px;
  left: ${n=>-7+n.left}px;
  width: 24px;
  height: 24px;

  border-radius: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: ${n=>n.backgroundColor?n.backgroundColor:"#000000bb"};
  color: ${n=>n.fontColor?n.fontColor:"#ffffff"};
  border-radius: 100%;
  font-size: 16px;
  cursor: pointer;
  transition: opacity 0.4s;
  box-shadow: 0px 2px 12px rgba(0, 0, 0, 0.5);
`,lu=Pt(ai).attrs({direction:"row",px:12,py:8})`
  display: flex;
  align-items: center;
  justify-content: start;
  gap: 12px;
  cursor: pointer;
  background: ${_t.BUTTON1};
  color: ${_t.white};

  &:hover {
    background: ${_t.BUTTON1_HOVER};
    color: ${_t.GRAY3};
  }
`,yk=Pt(Jf)`
  && {
    z-index: 9999;
  }
  .MuiPaper-root {
    min-width: 149px;
    color: ${_t.GRAY3};
    box-shadow: 0px 1px 6px 0px rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    z-index: 1;
    font-family: Barlow;
    font-size: 14px;
    font-weight: 500;
  }
`,jd=E.memo(()=>D.jsx(D.Fragment,{children:D.jsx(Hd,{})}));jd.displayName="NodeDetailsPanel";const Tk=()=>{const{dataInitial:n,isLoadingNew:e,isFetching:t,dataNew:s,resetDataNew:i}=oi(d=>d),r=E.useRef(null),o=E.useRef([]),{setData:a,simulation:c,simulationCreate:l,simulationHelpers:u,graphStyle:h}=tt(d=>d);return E.useEffect(()=>{if(!s)return;const d=s.nodes||[],f=s.links||[],m=structuredClone(d),p=structuredClone(f);if(c){const g=af.isEqual(s,n);u.addNodesAndLinks(m,p,g)}c||l(m,p),i()},[a,s,c,l,i,u,n]),E.useEffect(()=>{c&&u.setForces()},[h,u,c]),E.useEffect(()=>{c&&c.on("tick",()=>{if(r.current){const d=r.current.getObjectByName("simulation-3d-group__nodes"),f=r.current.getObjectByName("simulation-3d-group__connections");d.children.forEach((m,p)=>{const g=c.nodes()[p];g&&m.position.set(g.x,g.y,g.z)}),f.children.forEach((m,p)=>{const g=n==null?void 0:n.links[p],y=m;if(g){const w=c.nodes().find(O=>O.ref_id===g.source),S=c.nodes().find(O=>O.ref_id===g.target),{x:v,y:_,z:x}=w,{x:T,y:k,z:b}=S;o.current[p]={sx:v,sy:_,sz:x,tx:T,ty:k,tz:b},y.geometry.setPositions([v,_,x,T,k,b]);const{material:C}=y;C.color=new ds("white"),C.transparent=!0,C.opacity=.1}})}})},[n,c]),c?D.jsxs("group",{ref:r,children:[D.jsx(Vd,{}),D.jsx(ek,{}),!1,(e||t)&&D.jsx(pk,{}),h!=="earth"&&D.jsx(Fd,{linksPositions:o.current}),D.jsx(jd,{})]}):null},xk=()=>D.jsx(dr,{children:D.jsx(cp,{})}),kk=()=>{const{universeColor:n}=sp("universe",{universeColor:_t.black}),e=Jt(),t=E.useMemo(()=>e!=null&&e.node_type?du(e.node_type):A_,[e]);return D.jsxs(D.Fragment,{children:[D.jsx("color",{args:[n],attach:"background"}),D.jsx(kf,{}),D.jsx(Lx,{}),D.jsxs(bp,{children:[D.jsxs(rm,{autoClear:!1,multisampling:8,children:[D.jsx(lm,{darkness:.7,eskil:!1,offset:.05}),D.jsx(am,{luminanceThreshold:1,mipmapBlur:!0,resolutionX:Ee.AUTO_SIZE,resolutionY:Ee.AUTO_SIZE}),D.jsx(cm,{blendFunction:ee.SCREEN,blur:!0,edgeStrength:4,hiddenEdgeColor:t,visibleEdgeColor:t})]}),D.jsx(Tk,{})]})]})};let Ta=null;const wk={aspect:window.innerWidth/window.innerHeight,far:3e4,near:1,position:[ps.x,ps.y,ps.z]},Sk=()=>{const[n,e,t]=[Fs(o=>o.setIsUserScrollingOnHtmlPanel),Fs(o=>o.setIsUserScrolling),Fs(o=>o.setUserMovedCamera)],s=oi(o=>o.isFetching),i=E.useCallback(o=>{var l;const{target:a}=o,{offsetParent:c}=a;Ta&&clearTimeout(Ta),(l=c==null?void 0:c.classList)!=null&&l.contains("html-panel")&&c.clientHeight<c.scrollHeight&&n(!0),e(!0),t(!0),Ta=setTimeout(()=>{e(!1),n(!1)},200)},[e,n,t]),r=E.useCallback(o=>cf(o,"threeState"),[]);return D.jsxs(bk,{children:[D.jsx(E.Suspense,{fallback:null,children:D.jsxs(Tf,{camera:wk,id:"universe-canvas",onCreated:r,onWheel:i,children:[lf&&D.jsx(xf,{position:"bottom-right"}),D.jsxs(E.Suspense,{fallback:D.jsx(xk,{}),children:[D.jsx(kp,{}),D.jsx(wp,{}),D.jsx(Sp,{}),D.jsx(kk,{})]})]})}),s&&D.jsx(ep,{fullSize:!1}),D.jsx(tp,{})]})},bk=Pt(ai)`
  flex: 1 1 100%;
  position: relative;
`,ow=E.memo(Sk);export{ow as Universe};
